<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | JK ZelenÃ¡ mÃ­Ä¾a</title>
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#228B22;--primary-dark:#1a6b1a;--primary-light:#90EE90;--bg:#f4f6f9;--white:#fff;--dark:#1a1a1a;--gray:#666;--border:#e0e0e0;--success:#28a745;--danger:#dc3545;--warning:#ffc107;--info:#17a2b8;--sidebar-w:250px}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--dark);font-size:14px}
        .login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary),var(--primary-dark));padding:1rem}
        .login-box{background:var(--white);padding:2.5rem;border-radius:16px;width:100%;max-width:400px;box-shadow:0 20px 60px rgba(0,0,0,0.2)}
        .login-logo{text-align:center;margin-bottom:2rem}.login-logo img{height:80px}
        .login-title{text-align:center;font-size:1.5rem;font-weight:600;margin-bottom:0.5rem}
        .login-sub{text-align:center;color:var(--gray);margin-bottom:2rem}
        .form-group{margin-bottom:1rem}.form-group label{display:block;font-weight:500;margin-bottom:0.4rem;font-size:0.85rem}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:0.75rem;border:2px solid var(--border);border-radius:8px;font-size:0.95rem;font-family:inherit;transition:border 0.2s}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary)}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:0.75rem}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:0.4rem;padding:0.65rem 1.25rem;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.2s;border:none;font-family:inherit;font-size:0.9rem}
        .btn-primary{background:var(--primary);color:var(--white)}.btn-primary:hover{background:var(--primary-dark)}
        .btn-secondary{background:var(--bg);color:var(--dark);border:1px solid var(--border)}
        .btn-danger{background:var(--danger);color:var(--white)}.btn-success{background:var(--success);color:var(--white)}
        .btn-sm{padding:0.4rem 0.8rem;font-size:0.8rem}.btn-block{width:100%}.btn-icon{width:32px;height:32px;padding:0}
        .login-error{background:#ffe0e0;color:var(--danger);padding:0.75rem;border-radius:8px;margin-bottom:1rem;display:none;text-align:center}
        .app{display:none;min-height:100vh}.app.active{display:flex}
        .sidebar{width:var(--sidebar-w);background:linear-gradient(180deg,#1a1a1a,#2d2d2d);color:var(--white);position:fixed;height:100vh;overflow-y:auto;z-index:100}
        .sidebar-header{padding:1.5rem;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:0.75rem}
        .sidebar-header img{height:40px;filter:brightness(0) invert(1)}.sidebar-header span{font-weight:600;font-size:1.1rem}
        .nav-section{padding:0.75rem 0}.nav-title{font-size:0.65rem;font-weight:600;text-transform:uppercase;letter-spacing:0.1em;color:rgba(255,255,255,0.4);padding:0.5rem 1.25rem}
        .nav-item{display:flex;align-items:center;gap:0.75rem;padding:0.75rem 1.25rem;color:rgba(255,255,255,0.7);cursor:pointer;transition:all 0.2s;border:none;background:none;width:100%;text-align:left;font-size:0.9rem;font-family:inherit}
        .nav-item:hover{background:rgba(255,255,255,0.05);color:var(--white)}.nav-item.active{background:var(--primary);color:var(--white)}
        .nav-item .icon{width:22px;text-align:center;font-size:1.1rem}
        .main{flex:1;margin-left:var(--sidebar-w)}
        .header{background:var(--white);padding:1rem 1.5rem;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 10px rgba(0,0,0,0.05);position:sticky;top:0;z-index:50}
        .header h1{font-size:1.3rem;font-weight:600}.header-right{display:flex;gap:0.5rem;align-items:center}
        .header-btn{width:40px;height:40px;border:none;background:var(--bg);border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;text-decoration:none;color:inherit;font-size:1.1rem;transition:all 0.2s}
        .header-btn:hover{background:var(--primary);color:var(--white)}
        .content{padding:1.5rem}.page{display:none}.page.active{display:block;animation:fadeIn 0.3s}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}
        .stat-card{background:var(--white);padding:1.5rem;border-radius:12px;display:flex;align-items:center;gap:1rem;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
        .stat-icon{width:55px;height:55px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem}
        .stat-icon.green{background:linear-gradient(135deg,#228B22,#32CD32)}.stat-icon.blue{background:linear-gradient(135deg,#17a2b8,#20c997)}
        .stat-icon.orange{background:linear-gradient(135deg,#fd7e14,#ffc107)}.stat-icon.purple{background:linear-gradient(135deg,#6f42c1,#e83e8c)}
        .stat-value{font-size:1.75rem;font-weight:700}.stat-label{font-size:0.85rem;color:var(--gray)}
        .card{background:var(--white);border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
        .card-header{padding:1rem 1.25rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:0.75rem}
        .card-title{font-size:1.05rem;font-weight:600}.card-body{padding:1.25rem}
        .table-wrap{overflow-x:auto}table{width:100%;border-collapse:collapse;min-width:700px}
        th,td{padding:0.85rem 1rem;text-align:left}th{background:var(--bg);font-size:0.75rem;font-weight:600;text-transform:uppercase;color:var(--gray)}
        td{border-bottom:1px solid var(--border);font-size:0.9rem}tr:hover td{background:#f8f9fa}
        .badge{display:inline-flex;align-items:center;gap:0.3rem;padding:0.3rem 0.75rem;border-radius:50px;font-size:0.75rem;font-weight:500}
        .badge-success{background:rgba(40,167,69,0.1);color:var(--success)}.badge-warning{background:rgba(255,193,7,0.15);color:#856404}
        .badge-danger{background:rgba(220,53,69,0.1);color:var(--danger)}.badge-info{background:rgba(23,162,184,0.1);color:var(--info)}.badge-primary{background:rgba(34,139,34,0.1);color:var(--primary)}
        .actions{display:flex;gap:0.4rem}
        .action-btn{width:32px;height:32px;border:none;background:var(--bg);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.85rem;transition:all 0.2s}
        .action-btn:hover{background:var(--primary);color:var(--white)}.action-btn.danger:hover{background:var(--danger)}.action-btn.success:hover{background:var(--success)}
        .grid-2{display:grid;grid-template-columns:2fr 1fr;gap:1.5rem}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1000;padding:1rem;backdrop-filter:blur(4px)}
        .modal-overlay.active{display:flex}.modal{background:var(--white);border-radius:16px;width:100%;max-width:550px;max-height:90vh;overflow:hidden}
        .modal-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
        .modal-header h3{font-size:1.1rem}.modal-close{width:36px;height:36px;border:none;background:var(--bg);border-radius:10px;cursor:pointer;font-size:1.1rem}
        .modal-close:hover{background:var(--danger);color:var(--white)}.modal-body{padding:1.5rem;max-height:60vh;overflow-y:auto}
        .modal-footer{padding:1rem 1.5rem;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:0.75rem;background:#fafafa}
        .toast{position:fixed;bottom:1.5rem;right:1.5rem;padding:1rem 1.5rem;border-radius:10px;color:var(--white);font-weight:500;z-index:9999;transform:translateY(100px);opacity:0;transition:all 0.3s;box-shadow:0 5px 20px rgba(0,0,0,0.2)}
        .toast.show{transform:translateY(0);opacity:1}.toast.success{background:var(--success)}.toast.error{background:var(--danger)}
        .empty{text-align:center;padding:3rem;color:var(--gray)}.empty-icon{font-size:3rem;margin-bottom:1rem;opacity:0.5}
        .item-card{background:var(--bg);border-radius:10px;padding:1rem;margin-bottom:0.75rem}
        .item-header{display:flex;justify-content:space-between;align-items:flex-start}
        .item-title{font-weight:600;font-size:0.95rem}.item-meta{font-size:0.8rem;color:var(--gray);margin-top:0.25rem}
        .item-desc{font-size:0.85rem;color:var(--gray);margin-top:0.5rem;padding-top:0.5rem;border-top:1px dashed var(--border)}
        .feed-item-row{display:flex;gap:0.5rem;margin-bottom:0.5rem;align-items:center}.feed-item-row input{flex:1}
        .quick-actions{display:grid;grid-template-columns:repeat(2,1fr);gap:0.75rem}
        .quick-btn{display:flex;flex-direction:column;align-items:center;gap:0.5rem;padding:1.25rem;background:var(--bg);border-radius:10px;border:none;cursor:pointer;transition:all 0.2s;font-family:inherit}
        .quick-btn:hover{background:var(--primary);color:var(--white)}.quick-btn .icon{font-size:1.5rem}.quick-btn span{font-weight:500;font-size:0.85rem}
        @media(max-width:1200px){.stats-grid{grid-template-columns:repeat(2,1fr)}.grid-2{grid-template-columns:1fr}}
        @media(max-width:768px){.sidebar{display:none}.main{margin-left:0}.stats-grid{grid-template-columns:1fr}.form-row{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="login-page" id="loginPage">
        <div class="login-box">
            <div class="login-logo"><img src="/assets/logo.png" alt="Logo"></div>
            <h2 class="login-title">Admin Panel</h2>
            <p class="login-sub">JazdeckÃ½ klub ZelenÃ¡ mÃ­Ä¾a</p>
            <div class="login-error" id="loginError"></div>
            <form id="loginForm">
                <div class="form-group"><label>Email</label><input type="email" id="loginEmail" value="admin@jkzm.sk" required></div>
                <div class="form-group"><label>Heslo</label><input type="password" id="loginPassword" value="admin123" required></div>
                <button type="submit" class="btn btn-primary btn-block">PrihlÃ¡siÅ¥ sa</button>
            </form>
        </div>
    </div>

    <div class="app" id="app">
        <aside class="sidebar">
            <div class="sidebar-header"><img src="/assets/logo.png" alt="Logo"><span>ZelenÃ¡ mÃ­Ä¾a</span></div>
            <div class="nav-section">
                <div class="nav-title">PrehÄ¾ad</div>
                <button class="nav-item active" data-page="dashboard"><span class="icon">ğŸ“Š</span>Dashboard</button>
            </div>
            <div class="nav-section">
                <div class="nav-title">StajÅˆa</div>
                <button class="nav-item" data-page="horses"><span class="icon">ğŸ´</span>Kone</button>
                <button class="nav-item" data-page="feeding"><span class="icon">ğŸ¥•</span>KÅ•menie</button>
                <button class="nav-item" data-page="health"><span class="icon">ğŸ¥</span>Zdravie</button>
            </div>
            <div class="nav-section">
                <div class="nav-title">Ä½udia</div>
                <button class="nav-item" data-page="riders"><span class="icon">ğŸ‘¥</span>Jazdci</button>
                <button class="nav-item" data-page="trainers"><span class="icon">ğŸ‘¨â€ğŸ«</span>TrÃ©neri</button>
                <button class="nav-item" data-page="employees"><span class="icon">ğŸ‘·</span>Zamestnanci</button>
            </div>
            <div class="nav-section">
                <div class="nav-title">PrevÃ¡dzka</div>
                <button class="nav-item" data-page="trainings"><span class="icon">ğŸ“ˆ</span>TrÃ©ningy</button>
                <button class="nav-item" data-page="bookings"><span class="icon">ğŸ“‹</span>RezervÃ¡cie</button>
                <button class="nav-item" data-page="payments"><span class="icon">ğŸ’³</span>Platby</button>
                <button class="nav-item" data-page="messages"><span class="icon">âœ‰ï¸</span>SprÃ¡vy</button>
            </div>
        </aside>

        <main class="main">
            <header class="header">
                <h1 id="pageTitle">ğŸ“Š Dashboard</h1>
                <div class="header-right">
                    <a href="/" class="header-btn" title="Web">ğŸŒ</a>
                    <button class="header-btn" id="logoutBtn" title="OdhlÃ¡siÅ¥">ğŸšª</button>
                </div>
            </header>

            <div class="content">
                <!-- DASHBOARD -->
                <div class="page active" id="page-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-icon green">ğŸ´</div><div><div class="stat-value" id="statHorses">0</div><div class="stat-label">Kone</div></div></div>
                        <div class="stat-card"><div class="stat-icon blue">ğŸ‘¥</div><div><div class="stat-value" id="statRiders">0</div><div class="stat-label">Jazdci</div></div></div>
                        <div class="stat-card"><div class="stat-icon orange">ğŸ“ˆ</div><div><div class="stat-value" id="statTrainings">0</div><div class="stat-label">TrÃ©ningy</div></div></div>
                        <div class="stat-card"><div class="stat-icon purple">ğŸ’°</div><div><div class="stat-value" id="statRevenue">â‚¬0</div><div class="stat-label">TrÅ¾by</div></div></div>
                    </div>
                    <div class="grid-2">
                        <div class="card"><div class="card-header"><h3 class="card-title">ğŸ“… DneÅ¡nÃ© trÃ©ningy</h3><button class="btn btn-primary btn-sm" onclick="openTrainingModal()">+ NovÃ½</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>ÄŒas</th><th>Jazdec</th><th>KÃ´Åˆ</th><th>TrÃ©ner</th><th>Stav</th><th></th></tr></thead><tbody id="todayTrainings"></tbody></table></div></div></div>
                        <div class="card"><div class="card-header"><h3 class="card-title">âš¡ RÃ½chle akcie</h3></div><div class="card-body"><div class="quick-actions"><button class="quick-btn" onclick="openHorseModal()"><span class="icon">ğŸ´</span><span>PridaÅ¥ koÅˆa</span></button><button class="quick-btn" onclick="openRiderModal()"><span class="icon">ğŸ‘¥</span><span>PridaÅ¥ jazdca</span></button><button class="quick-btn" onclick="openTrainingModal()"><span class="icon">ğŸ“ˆ</span><span>NovÃ½ trÃ©ning</span></button><button class="quick-btn" onclick="openPaymentModal()"><span class="icon">ğŸ’³</span><span>PridaÅ¥ platbu</span></button></div></div></div>
                    </div>
                </div>

                <!-- HORSES -->
                <div class="page" id="page-horses"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ´ Kone</h3><button class="btn btn-primary btn-sm" onclick="openHorseModal()">+ PridaÅ¥</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Plemeno</th><th>Farba</th><th>Vek</th><th>ÃšroveÅˆ</th><th>Stav</th><th>Akcie</th></tr></thead><tbody id="horsesTable"></tbody></table></div></div></div></div>

                <!-- RIDERS -->
                <div class="page" id="page-riders"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ‘¥ Jazdci</h3><button class="btn btn-primary btn-sm" onclick="openRiderModal()">+ PridaÅ¥</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Email</th><th>TelefÃ³n</th><th>ÃšroveÅˆ</th><th>Stav</th><th>Akcie</th></tr></thead><tbody id="ridersTable"></tbody></table></div></div></div></div>

                <!-- TRAINERS -->
                <div class="page" id="page-trainers"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ‘¨â€ğŸ« TrÃ©neri</h3><button class="btn btn-primary btn-sm" onclick="openTrainerModal()">+ PridaÅ¥</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Å pecializÃ¡cia</th><th>Email</th><th>TelefÃ³n</th><th>Sadzba</th><th>Akcie</th></tr></thead><tbody id="trainersTable"></tbody></table></div></div></div></div>

                <!-- EMPLOYEES -->
                <div class="page" id="page-employees"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ‘· Zamestnanci</h3><button class="btn btn-primary btn-sm" onclick="openEmployeeModal()">+ PridaÅ¥</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>PozÃ­cia</th><th>Email</th><th>TelefÃ³n</th><th>NÃ¡stup</th><th>Akcie</th></tr></thead><tbody id="employeesTable"></tbody></table></div></div></div></div>

                <!-- TRAININGS -->
                <div class="page" id="page-trainings"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ“ˆ TrÃ©ningy</h3><button class="btn btn-primary btn-sm" onclick="openTrainingModal()">+ NovÃ½</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>DÃ¡tum</th><th>ÄŒas</th><th>Jazdec</th><th>KÃ´Åˆ</th><th>TrÃ©ner</th><th>Cena</th><th>Stav</th><th>Akcie</th></tr></thead><tbody id="trainingsTable"></tbody></table></div></div></div></div>

                <!-- FEEDING -->
                <div class="page" id="page-feeding"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ¥• KÅ•menie</h3><button class="btn btn-primary btn-sm" onclick="openFeedingModal()">+ PridaÅ¥</button></div><div class="card-body" id="feedingList"></div></div></div>

                <!-- HEALTH -->
                <div class="page" id="page-health"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ¥ Zdravie</h3><button class="btn btn-primary btn-sm" onclick="openHealthModal()">+ PridaÅ¥</button></div><div class="card-body" id="healthList"></div></div></div>

                <!-- BOOKINGS -->
                <div class="page" id="page-bookings"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ“‹ RezervÃ¡cie</h3></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Email</th><th>SluÅ¾ba</th><th>DÃ¡tum</th><th>Stav</th><th>Akcie</th></tr></thead><tbody id="bookingsTable"></tbody></table></div></div></div></div>

                <!-- PAYMENTS -->
                <div class="page" id="page-payments"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ’³ Platby</h3><button class="btn btn-primary btn-sm" onclick="openPaymentModal()">+ PridaÅ¥</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>DÃ¡tum</th><th>Jazdec</th><th>Suma</th><th>SpÃ´sob</th><th>Popis</th><th>Akcie</th></tr></thead><tbody id="paymentsTable"></tbody></table></div></div></div></div>

                <!-- MESSAGES -->
                <div class="page" id="page-messages"><div class="card"><div class="card-header"><h3 class="card-title">âœ‰ï¸ SprÃ¡vy</h3></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Email</th><th>SluÅ¾ba</th><th>SprÃ¡va</th><th>Stav</th><th>Akcie</th></tr></thead><tbody id="messagesTable"></tbody></table></div></div></div></div>
            </div>
        </main>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="horseModal"><div class="modal"><div class="modal-header"><h3 id="horseModalTitle">ğŸ´ PridaÅ¥ koÅˆa</h3><button class="modal-close" onclick="closeModal('horseModal')">âœ•</button></div><form id="horseForm"><input type="hidden" id="horseId"><div class="modal-body"><div class="form-group"><label>Meno *</label><input type="text" id="horseName" required></div><div class="form-row"><div class="form-group"><label>Plemeno</label><input type="text" id="horseBreed"></div><div class="form-group"><label>Farba</label><input type="text" id="horseColor"></div></div><div class="form-row"><div class="form-group"><label>DÃ¡tum narodenia</label><input type="date" id="horseBirth"></div><div class="form-group"><label>VÃ½Å¡ka (cm)</label><input type="number" id="horseHeight"></div></div><div class="form-row"><div class="form-group"><label>Pohlavie</label><select id="horseGender"><option value="">-</option><option value="stallion">Å½rebec</option><option value="mare">Kobyla</option><option value="gelding">Valach</option></select></div><div class="form-group"><label>ÃšroveÅˆ</label><select id="horseLevel"><option value="beginner">ZaÄiatoÄnÃ­ci</option><option value="intermediate">PokroÄilÃ­</option><option value="advanced">SkÃºsenÃ­</option><option value="children">Deti</option></select></div></div><div class="form-group"><label>Stav</label><select id="horseStatus"><option value="active">AktÃ­vny</option><option value="inactive">NeaktÃ­vny</option><option value="sick">ChorÃ½</option></select></div><div class="form-group"><label>PoznÃ¡mky</label><textarea id="horseNotes" rows="2"></textarea></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('horseModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="modal-overlay" id="riderModal"><div class="modal"><div class="modal-header"><h3 id="riderModalTitle">ğŸ‘¥ PridaÅ¥ jazdca</h3><button class="modal-close" onclick="closeModal('riderModal')">âœ•</button></div><form id="riderForm"><input type="hidden" id="riderId"><div class="modal-body"><div class="form-row"><div class="form-group"><label>Meno *</label><input type="text" id="riderFirstName" required></div><div class="form-group"><label>Priezvisko *</label><input type="text" id="riderLastName" required></div></div><div class="form-row"><div class="form-group"><label>Email</label><input type="email" id="riderEmail"></div><div class="form-group"><label>TelefÃ³n</label><input type="tel" id="riderPhone"></div></div><div class="form-row"><div class="form-group"><label>DÃ¡tum narodenia</label><input type="date" id="riderBirth"></div><div class="form-group"><label>ÃšroveÅˆ</label><select id="riderLevel"><option value="beginner">ZaÄiatoÄnÃ­k</option><option value="intermediate">PokroÄilÃ½</option><option value="advanced">SkÃºsenÃ½</option></select></div></div><div class="form-group"><label>PoznÃ¡mky</label><textarea id="riderNotes" rows="2"></textarea></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('riderModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="modal-overlay" id="trainerModal"><div class="modal"><div class="modal-header"><h3 id="trainerModalTitle">ğŸ‘¨â€ğŸ« PridaÅ¥ trÃ©nera</h3><button class="modal-close" onclick="closeModal('trainerModal')">âœ•</button></div><form id="trainerForm"><input type="hidden" id="trainerId"><div class="modal-body"><div class="form-row"><div class="form-group"><label>Meno *</label><input type="text" id="trainerFirstName" required></div><div class="form-group"><label>Priezvisko *</label><input type="text" id="trainerLastName" required></div></div><div class="form-row"><div class="form-group"><label>Email</label><input type="email" id="trainerEmail"></div><div class="form-group"><label>TelefÃ³n</label><input type="tel" id="trainerPhone"></div></div><div class="form-row"><div class="form-group"><label>Å pecializÃ¡cia</label><input type="text" id="trainerSpec"></div><div class="form-group"><label>HodinovÃ¡ sadzba (â‚¬)</label><input type="number" id="trainerRate" step="0.01"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('trainerModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="modal-overlay" id="employeeModal"><div class="modal"><div class="modal-header"><h3 id="employeeModalTitle">ğŸ‘· PridaÅ¥ zamestnanca</h3><button class="modal-close" onclick="closeModal('employeeModal')">âœ•</button></div><form id="employeeForm"><input type="hidden" id="employeeId"><div class="modal-body"><div class="form-row"><div class="form-group"><label>Meno *</label><input type="text" id="employeeFirstName" required></div><div class="form-group"><label>Priezvisko *</label><input type="text" id="employeeLastName" required></div></div><div class="form-row"><div class="form-group"><label>Email</label><input type="email" id="employeeEmail"></div><div class="form-group"><label>TelefÃ³n</label><input type="tel" id="employeePhone"></div></div><div class="form-row"><div class="form-group"><label>PozÃ­cia</label><input type="text" id="employeePosition"></div><div class="form-group"><label>DÃ¡tum nÃ¡stupu</label><input type="date" id="employeeHire"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('employeeModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="modal-overlay" id="trainingModal"><div class="modal"><div class="modal-header"><h3 id="trainingModalTitle">ğŸ“ˆ NovÃ½ trÃ©ning</h3><button class="modal-close" onclick="closeModal('trainingModal')">âœ•</button></div><form id="trainingForm"><input type="hidden" id="trainingId"><div class="modal-body"><div class="form-row"><div class="form-group"><label>DÃ¡tum *</label><input type="date" id="trainingDate" required></div><div class="form-group"><label>ÄŒas *</label><input type="time" id="trainingTime" required></div></div><div class="form-group"><label>Jazdec</label><select id="selRider"></select></div><div class="form-group"><label>KÃ´Åˆ</label><select id="selHorse"></select></div><div class="form-group"><label>TrÃ©ner</label><select id="selTrainer"></select></div><div class="form-row"><div class="form-group"><label>Trvanie (min)</label><input type="number" id="trainingDuration" value="60"></div><div class="form-group"><label>Cena (â‚¬)</label><input type="number" id="trainingPrice" step="0.01"></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('trainingModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="modal-overlay" id="feedingModal"><div class="modal"><div class="modal-header"><h3 id="feedingModalTitle">ğŸ¥• KÅ•menie</h3><button class="modal-close" onclick="closeModal('feedingModal')">âœ•</button></div><form id="feedingForm"><input type="hidden" id="feedingId"><div class="modal-body"><div class="form-group"><label>KÃ´Åˆ *</label><select id="feedingHorse" required></select></div><div class="form-row"><div class="form-group"><label>ÄŒas dÅˆa</label><select id="feedingTimeOfDay"><option value="morning">RÃ¡no</option><option value="noon">Obed</option><option value="evening">VeÄer</option></select></div><div class="form-group"><label>PresnÃ½ Äas</label><input type="time" id="feedingTime" value="07:00"></div></div><div class="form-group"><label>PoloÅ¾ky</label><div id="feedItems"></div><button type="button" class="btn btn-secondary btn-sm" onclick="addFeedItem()">+ PoloÅ¾ka</button></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('feedingModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="modal-overlay" id="healthModal"><div class="modal"><div class="modal-header"><h3 id="healthModalTitle">ğŸ¥ ZdravotnÃ½ zÃ¡znam</h3><button class="modal-close" onclick="closeModal('healthModal')">âœ•</button></div><form id="healthForm"><input type="hidden" id="healthId"><div class="modal-body"><div class="form-group"><label>KÃ´Åˆ *</label><select id="healthHorse" required></select></div><div class="form-row"><div class="form-group"><label>Typ *</label><select id="healthType"><option value="vaccination">OÄkovanie</option><option value="deworming">OdÄervenie</option><option value="farrier">PodkÃºvanie</option><option value="vet_visit">VeterinÃ¡r</option><option value="injury">Zranenie</option><option value="other">InÃ©</option></select></div><div class="form-group"><label>DÃ¡tum</label><input type="date" id="healthDate"></div></div><div class="form-group"><label>Popis</label><textarea id="healthDesc" rows="2"></textarea></div><div class="form-row"><div class="form-group"><label>VeterinÃ¡r</label><input type="text" id="healthVet"></div><div class="form-group"><label>NÃ¡klady (â‚¬)</label><input type="number" id="healthCost" step="0.01"></div></div><div class="form-group"><label>ÄalÅ¡Ã­ termÃ­n</label><input type="date" id="healthNext"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('healthModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="modal-overlay" id="paymentModal"><div class="modal"><div class="modal-header"><h3>ğŸ’³ PridaÅ¥ platbu</h3><button class="modal-close" onclick="closeModal('paymentModal')">âœ•</button></div><form id="paymentForm"><div class="modal-body"><div class="form-row"><div class="form-group"><label>DÃ¡tum *</label><input type="date" id="paymentDate" required></div><div class="form-group"><label>Suma (â‚¬) *</label><input type="number" id="paymentAmount" step="0.01" required></div></div><div class="form-group"><label>Jazdec</label><select id="selPaymentRider"></select></div><div class="form-group"><label>SpÃ´sob</label><select id="paymentMethod"><option value="cash">HotovosÅ¥</option><option value="card">Karta</option><option value="transfer">Prevod</option></select></div><div class="form-group"><label>Popis</label><input type="text" id="paymentDesc"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">ZruÅ¡iÅ¥</button><button type="submit" class="btn btn-primary">ğŸ’¾ UloÅ¾iÅ¥</button></div></form></div></div>

    <div class="toast" id="toast"></div>

    <script>
    let token = localStorage.getItem('jkzm_token'), user = JSON.parse(localStorage.getItem('jkzm_user') || 'null');
    let horses = [], riders = [], trainers = [], employees = [], trainingsData = [], feedingData = [], healthData = [];

    // API Helper
    async function api(endpoint, options = {}) {
        const headers = { 'Content-Type': 'application/json' };
        if (token) headers['Authorization'] = 'Bearer ' + token;
        try {
            const res = await fetch('/api' + endpoint, { ...options, headers });
            if (res.status === 401) { logout(); return null; }
            return await res.json();
        } catch (e) { console.error(e); return null; }
    }

    // Auth
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const err = document.getElementById('loginError');
        err.style.display = 'none';
        try {
            const res = await fetch('/api/auth/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: document.getElementById('loginEmail').value, password: document.getElementById('loginPassword').value }) });
            const data = await res.json();
            if (res.ok) { token = data.token; user = data.user; localStorage.setItem('jkzm_token', token); localStorage.setItem('jkzm_user', JSON.stringify(user)); showApp(); }
            else { err.textContent = data.error || 'Chyba'; err.style.display = 'block'; }
        } catch (e) { err.textContent = 'Chyba pripojenia'; err.style.display = 'block'; }
    });

    function logout() { localStorage.clear(); location.reload(); }
    document.getElementById('logoutBtn').addEventListener('click', logout);
    function showApp() { document.getElementById('loginPage').style.display = 'none'; document.getElementById('app').classList.add('active'); loadDashboard(); }

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
            item.classList.add('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + item.dataset.page).classList.add('active');
            document.getElementById('pageTitle').textContent = item.innerHTML;
            loadPage(item.dataset.page);
        });
    });

    function loadPage(page) {
        const loaders = { dashboard: loadDashboard, horses: loadHorses, riders: loadRiders, trainers: loadTrainers, employees: loadEmployees, feeding: loadFeeding, health: loadHealth, trainings: loadTrainings, bookings: loadBookings, payments: loadPayments, messages: loadMessages };
        if (loaders[page]) loaders[page]();
    }

    // Dashboard
    async function loadDashboard() {
        const [stats, today] = await Promise.all([api('/dashboard/stats'), api('/dashboard/today')]);
        if (stats) {
            document.getElementById('statHorses').textContent = stats.horses?.total || 0;
            document.getElementById('statRiders').textContent = stats.riders?.total || 0;
            document.getElementById('statTrainings').textContent = stats.trainings?.thisMonth || 0;
            document.getElementById('statRevenue').textContent = 'â‚¬' + (stats.revenue?.thisMonth || 0);
        }
        document.getElementById('todayTrainings').innerHTML = today?.length ? today.map(t => `<tr><td><strong>${t.scheduled_time?.slice(0,5) || '-'}</strong></td><td>${t.rider_name || '-'}</td><td>${t.horse_name || '-'}</td><td>${t.trainer_name || '-'}</td><td><span class="badge ${t.status === 'completed' ? 'badge-success' : 'badge-warning'}">${t.status === 'completed' ? 'âœ“' : 'â³'}</span></td><td><div class="actions"><button class="action-btn success" onclick="completeTraining(${t.id})">âœ“</button></div></td></tr>`).join('') : '<tr><td colspan="6" class="empty">Å½iadne trÃ©ningy</td></tr>';
    }

    // HORSES - CRUD
    async function loadHorses() {
        horses = await api('/horses') || [];
        const levels = { beginner: 'ZaÄiatoÄnÃ­ci', intermediate: 'PokroÄilÃ­', advanced: 'SkÃºsenÃ­', children: 'Deti' };
        document.getElementById('horsesTable').innerHTML = horses.length ? horses.map(h => `<tr><td><strong>${h.name}</strong></td><td>${h.breed || '-'}</td><td>${h.color || '-'}</td><td>${h.birth_date ? calcAge(h.birth_date) + 'r.' : '-'}</td><td><span class="badge badge-primary">${levels[h.level] || '-'}</span></td><td><span class="badge ${h.status === 'active' ? 'badge-success' : 'badge-warning'}">${h.status === 'active' ? 'AktÃ­vny' : 'NeaktÃ­vny'}</span></td><td><div class="actions"><button class="action-btn" onclick="editHorse(${h.id})">âœï¸</button><button class="action-btn danger" onclick="deleteHorse(${h.id})">ğŸ—‘ï¸</button></div></td></tr>`).join('') : '<tr><td colspan="7"><div class="empty">Å½iadne kone</div></td></tr>';
    }
    function openHorseModal(d = null) { document.getElementById('horseModalTitle').textContent = d ? 'âœï¸ UpraviÅ¥ koÅˆa' : 'ğŸ´ PridaÅ¥ koÅˆa'; document.getElementById('horseId').value = d?.id || ''; document.getElementById('horseName').value = d?.name || ''; document.getElementById('horseBreed').value = d?.breed || ''; document.getElementById('horseColor').value = d?.color || ''; document.getElementById('horseBirth').value = d?.birth_date || ''; document.getElementById('horseHeight').value = d?.height || ''; document.getElementById('horseGender').value = d?.gender || ''; document.getElementById('horseLevel').value = d?.level || 'beginner'; document.getElementById('horseStatus').value = d?.status || 'active'; document.getElementById('horseNotes').value = d?.notes || ''; openModal('horseModal'); }
    function editHorse(id) { const h = horses.find(x => x.id === id); if (h) openHorseModal(h); }
    async function deleteHorse(id) { if (confirm('VymazaÅ¥ koÅˆa?')) { await api('/horses/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadHorses(); loadDashboard(); } }
    document.getElementById('horseForm').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('horseId').value; const data = { name: document.getElementById('horseName').value, breed: document.getElementById('horseBreed').value, color: document.getElementById('horseColor').value, birth_date: document.getElementById('horseBirth').value, height: document.getElementById('horseHeight').value, gender: document.getElementById('horseGender').value, level: document.getElementById('horseLevel').value, status: document.getElementById('horseStatus').value, notes: document.getElementById('horseNotes').value }; if (id) await api('/horses/' + id, { method: 'PUT', body: JSON.stringify(data) }); else await api('/horses', { method: 'POST', body: JSON.stringify(data) }); closeModal('horseModal'); toast('UloÅ¾enÃ©'); loadHorses(); loadDashboard(); });

    // RIDERS - CRUD
    async function loadRiders() {
        riders = await api('/riders') || [];
        const levels = { beginner: 'ZaÄiatoÄnÃ­k', intermediate: 'PokroÄilÃ½', advanced: 'SkÃºsenÃ½' };
        document.getElementById('ridersTable').innerHTML = riders.length ? riders.map(r => `<tr><td><strong>${r.first_name} ${r.last_name}</strong></td><td>${r.email || '-'}</td><td>${r.phone || '-'}</td><td><span class="badge badge-info">${levels[r.level] || '-'}</span></td><td><span class="badge badge-success">AktÃ­vny</span></td><td><div class="actions"><button class="action-btn" onclick="editRider(${r.id})">âœï¸</button><button class="action-btn danger" onclick="deleteRider(${r.id})">ğŸ—‘ï¸</button></div></td></tr>`).join('') : '<tr><td colspan="6"><div class="empty">Å½iadni jazdci</div></td></tr>';
    }
    function openRiderModal(d = null) { document.getElementById('riderModalTitle').textContent = d ? 'âœï¸ UpraviÅ¥ jazdca' : 'ğŸ‘¥ PridaÅ¥ jazdca'; document.getElementById('riderId').value = d?.id || ''; document.getElementById('riderFirstName').value = d?.first_name || ''; document.getElementById('riderLastName').value = d?.last_name || ''; document.getElementById('riderEmail').value = d?.email || ''; document.getElementById('riderPhone').value = d?.phone || ''; document.getElementById('riderBirth').value = d?.birth_date || ''; document.getElementById('riderLevel').value = d?.level || 'beginner'; document.getElementById('riderNotes').value = d?.notes || ''; openModal('riderModal'); }
    function editRider(id) { const r = riders.find(x => x.id === id); if (r) openRiderModal(r); }
    async function deleteRider(id) { if (confirm('VymazaÅ¥ jazdca?')) { await api('/riders/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadRiders(); loadDashboard(); } }
    document.getElementById('riderForm').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('riderId').value; const data = { first_name: document.getElementById('riderFirstName').value, last_name: document.getElementById('riderLastName').value, email: document.getElementById('riderEmail').value, phone: document.getElementById('riderPhone').value, birth_date: document.getElementById('riderBirth').value, level: document.getElementById('riderLevel').value, notes: document.getElementById('riderNotes').value }; if (id) await api('/riders/' + id, { method: 'PUT', body: JSON.stringify(data) }); else await api('/riders', { method: 'POST', body: JSON.stringify(data) }); closeModal('riderModal'); toast('UloÅ¾enÃ©'); loadRiders(); loadDashboard(); });

    // TRAINERS - CRUD
    async function loadTrainers() {
        trainers = await api('/trainers') || [];
        document.getElementById('trainersTable').innerHTML = trainers.length ? trainers.map(t => `<tr><td><strong>${t.first_name} ${t.last_name}</strong></td><td>${t.specialization || '-'}</td><td>${t.email || '-'}</td><td>${t.phone || '-'}</td><td><strong>â‚¬${t.hourly_rate || 0}/h</strong></td><td><div class="actions"><button class="action-btn" onclick="editTrainer(${t.id})">âœï¸</button><button class="action-btn danger" onclick="deleteTrainer(${t.id})">ğŸ—‘ï¸</button></div></td></tr>`).join('') : '<tr><td colspan="6"><div class="empty">Å½iadni trÃ©neri</div></td></tr>';
    }
    function openTrainerModal(d = null) { document.getElementById('trainerModalTitle').textContent = d ? 'âœï¸ UpraviÅ¥ trÃ©nera' : 'ğŸ‘¨â€ğŸ« PridaÅ¥ trÃ©nera'; document.getElementById('trainerId').value = d?.id || ''; document.getElementById('trainerFirstName').value = d?.first_name || ''; document.getElementById('trainerLastName').value = d?.last_name || ''; document.getElementById('trainerEmail').value = d?.email || ''; document.getElementById('trainerPhone').value = d?.phone || ''; document.getElementById('trainerSpec').value = d?.specialization || ''; document.getElementById('trainerRate').value = d?.hourly_rate || ''; openModal('trainerModal'); }
    function editTrainer(id) { const t = trainers.find(x => x.id === id); if (t) openTrainerModal(t); }
    async function deleteTrainer(id) { if (confirm('VymazaÅ¥ trÃ©nera?')) { await api('/trainers/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadTrainers(); } }
    document.getElementById('trainerForm').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('trainerId').value; const data = { first_name: document.getElementById('trainerFirstName').value, last_name: document.getElementById('trainerLastName').value, email: document.getElementById('trainerEmail').value, phone: document.getElementById('trainerPhone').value, specialization: document.getElementById('trainerSpec').value, hourly_rate: document.getElementById('trainerRate').value }; if (id) await api('/trainers/' + id, { method: 'PUT', body: JSON.stringify(data) }); else await api('/trainers', { method: 'POST', body: JSON.stringify(data) }); closeModal('trainerModal'); toast('UloÅ¾enÃ©'); loadTrainers(); });

    // EMPLOYEES - CRUD
    async function loadEmployees() {
        employees = await api('/employees') || [];
        document.getElementById('employeesTable').innerHTML = employees.length ? employees.map(e => `<tr><td><strong>${e.first_name} ${e.last_name}</strong></td><td>${e.position || '-'}</td><td>${e.email || '-'}</td><td>${e.phone || '-'}</td><td>${e.hire_date || '-'}</td><td><div class="actions"><button class="action-btn" onclick="editEmployee(${e.id})">âœï¸</button><button class="action-btn danger" onclick="deleteEmployee(${e.id})">ğŸ—‘ï¸</button></div></td></tr>`).join('') : '<tr><td colspan="6"><div class="empty">Å½iadni zamestnanci</div></td></tr>';
    }
    function openEmployeeModal(d = null) { document.getElementById('employeeModalTitle').textContent = d ? 'âœï¸ UpraviÅ¥ zamestnanca' : 'ğŸ‘· PridaÅ¥ zamestnanca'; document.getElementById('employeeId').value = d?.id || ''; document.getElementById('employeeFirstName').value = d?.first_name || ''; document.getElementById('employeeLastName').value = d?.last_name || ''; document.getElementById('employeeEmail').value = d?.email || ''; document.getElementById('employeePhone').value = d?.phone || ''; document.getElementById('employeePosition').value = d?.position || ''; document.getElementById('employeeHire').value = d?.hire_date || ''; openModal('employeeModal'); }
    function editEmployee(id) { const e = employees.find(x => x.id === id); if (e) openEmployeeModal(e); }
    async function deleteEmployee(id) { if (confirm('VymazaÅ¥ zamestnanca?')) { await api('/employees/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadEmployees(); } }
    document.getElementById('employeeForm').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('employeeId').value; const data = { first_name: document.getElementById('employeeFirstName').value, last_name: document.getElementById('employeeLastName').value, email: document.getElementById('employeeEmail').value, phone: document.getElementById('employeePhone').value, position: document.getElementById('employeePosition').value, hire_date: document.getElementById('employeeHire').value }; if (id) await api('/employees/' + id, { method: 'PUT', body: JSON.stringify(data) }); else await api('/employees', { method: 'POST', body: JSON.stringify(data) }); closeModal('employeeModal'); toast('UloÅ¾enÃ©'); loadEmployees(); });

    // TRAININGS - CRUD
    async function loadTrainings() {
        trainingsData = await api('/trainings') || [];
        document.getElementById('trainingsTable').innerHTML = trainingsData.length ? trainingsData.map(t => `<tr><td>${t.scheduled_date || '-'}</td><td><strong>${t.scheduled_time?.slice(0,5) || '-'}</strong></td><td>${t.rider_name || '-'}</td><td>${t.horse_name || '-'}</td><td>${t.trainer_name || '-'}</td><td><strong>â‚¬${t.price || 0}</strong></td><td><span class="badge ${t.status === 'completed' ? 'badge-success' : 'badge-warning'}">${t.status === 'completed' ? 'âœ“' : 'â³'}</span></td><td><div class="actions"><button class="action-btn success" onclick="completeTraining(${t.id})">âœ“</button><button class="action-btn" onclick="editTraining(${t.id})">âœï¸</button><button class="action-btn danger" onclick="deleteTraining(${t.id})">ğŸ—‘ï¸</button></div></td></tr>`).join('') : '<tr><td colspan="8"><div class="empty">Å½iadne trÃ©ningy</div></td></tr>';
    }
    async function openTrainingModal(d = null) { await loadSelects(); document.getElementById('trainingModalTitle').textContent = d ? 'âœï¸ UpraviÅ¥ trÃ©ning' : 'ğŸ“ˆ NovÃ½ trÃ©ning'; document.getElementById('trainingId').value = d?.id || ''; document.getElementById('trainingDate').value = d?.scheduled_date || new Date().toISOString().split('T')[0]; document.getElementById('trainingTime').value = d?.scheduled_time?.slice(0,5) || '10:00'; document.getElementById('selRider').value = d?.rider_id || ''; document.getElementById('selHorse').value = d?.horse_id || ''; document.getElementById('selTrainer').value = d?.trainer_id || ''; document.getElementById('trainingDuration').value = d?.duration || 60; document.getElementById('trainingPrice').value = d?.price || ''; openModal('trainingModal'); }
    function editTraining(id) { const t = trainingsData.find(x => x.id === id); if (t) openTrainingModal(t); }
    async function deleteTraining(id) { if (confirm('VymazaÅ¥ trÃ©ning?')) { await api('/trainings/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadTrainings(); loadDashboard(); } }
    async function completeTraining(id) { await api('/trainings/' + id, { method: 'PATCH', body: JSON.stringify({ status: 'completed' }) }); toast('DokonÄenÃ©'); loadTrainings(); loadDashboard(); }
    document.getElementById('trainingForm').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('trainingId').value; const data = { scheduled_date: document.getElementById('trainingDate').value, scheduled_time: document.getElementById('trainingTime').value, rider_id: document.getElementById('selRider').value || null, horse_id: document.getElementById('selHorse').value || null, trainer_id: document.getElementById('selTrainer').value || null, duration: document.getElementById('trainingDuration').value, price: document.getElementById('trainingPrice').value }; if (id) await api('/trainings/' + id, { method: 'PUT', body: JSON.stringify(data) }); else await api('/trainings', { method: 'POST', body: JSON.stringify(data) }); closeModal('trainingModal'); toast('UloÅ¾enÃ©'); loadTrainings(); loadDashboard(); });

    // FEEDING - CRUD
    async function loadFeeding() {
        feedingData = await api('/feeding') || [];
        const times = { morning: 'â˜€ï¸ RÃ¡no', noon: 'ğŸŒ¤ï¸ Obed', evening: 'ğŸŒ™ VeÄer' };
        document.getElementById('feedingList').innerHTML = feedingData.length ? feedingData.map(s => `<div class="item-card"><div class="item-header"><div class="item-title">ğŸ´ ${s.horse_name} - ${times[s.time_of_day] || s.time_of_day} (${s.feed_time?.slice(0,5) || ''})</div><div class="actions"><button class="action-btn" onclick="editFeeding(${s.id})">âœï¸</button><button class="action-btn danger" onclick="deleteFeeding(${s.id})">ğŸ—‘ï¸</button></div></div>${(s.items || []).map(i => `<div style="display:flex;justify-content:space-between;padding:0.25rem 0;font-size:0.9rem;border-bottom:1px dashed var(--border)"><span>${i.feed_type}</span><strong>${i.amount} ${i.unit}</strong></div>`).join('') || '<div class="item-meta">Å½iadne poloÅ¾ky</div>'}</div>`).join('') : '<div class="empty"><div class="empty-icon">ğŸ¥•</div>Å½iadne kÅ•mne plÃ¡ny</div>';
    }
    async function openFeedingModal(d = null) { await loadHorsesSelect('feedingHorse'); document.getElementById('feedingModalTitle').textContent = d ? 'âœï¸ UpraviÅ¥ kÅ•menie' : 'ğŸ¥• PridaÅ¥ kÅ•menie'; document.getElementById('feedingId').value = d?.id || ''; document.getElementById('feedingHorse').value = d?.horse_id || ''; document.getElementById('feedingTimeOfDay').value = d?.time_of_day || 'morning'; document.getElementById('feedingTime').value = d?.feed_time?.slice(0,5) || '07:00'; document.getElementById('feedItems').innerHTML = ''; if (d?.items?.length) d.items.forEach(i => addFeedItem(i)); else addFeedItem(); openModal('feedingModal'); }
    function editFeeding(id) { const f = feedingData.find(x => x.id === id); if (f) openFeedingModal(f); }
    async function deleteFeeding(id) { if (confirm('VymazaÅ¥ kÅ•menie?')) { await api('/feeding/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadFeeding(); } }
    function addFeedItem(d = {}) { const div = document.createElement('div'); div.className = 'feed-item-row'; div.innerHTML = `<input type="text" placeholder="Krmivo" value="${d.feed_type || ''}" class="fi-type"><input type="number" placeholder="MnoÅ¾stvo" value="${d.amount || ''}" class="fi-amount" style="width:70px"><input type="text" placeholder="kg" value="${d.unit || 'kg'}" class="fi-unit" style="width:50px"><button type="button" class="btn btn-danger btn-sm btn-icon" onclick="this.parentElement.remove()">âœ•</button>`; document.getElementById('feedItems').appendChild(div); }
    document.getElementById('feedingForm').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('feedingId').value; const data = { horse_id: document.getElementById('feedingHorse').value, time_of_day: document.getElementById('feedingTimeOfDay').value, feed_time: document.getElementById('feedingTime').value, items: [] }; document.querySelectorAll('.feed-item-row').forEach(r => { const t = r.querySelector('.fi-type').value, a = r.querySelector('.fi-amount').value, u = r.querySelector('.fi-unit').value; if (t && a) data.items.push({ feed_type: t, amount: parseFloat(a), unit: u || 'kg' }); }); if (id) await api('/feeding/' + id, { method: 'PUT', body: JSON.stringify(data) }); else await api('/feeding', { method: 'POST', body: JSON.stringify(data) }); closeModal('feedingModal'); toast('UloÅ¾enÃ©'); loadFeeding(); });

    // HEALTH - CRUD
    async function loadHealth() {
        healthData = await api('/health') || [];
        const types = { vaccination: 'ğŸ’‰ OÄkovanie', deworming: 'ğŸ’Š OdÄervenie', farrier: 'ğŸ”¨ PodkÃºvanie', vet_visit: 'ğŸ‘¨â€âš•ï¸ VeterinÃ¡r', injury: 'ğŸ©¹ Zranenie', other: 'ğŸ“‹ InÃ©' };
        document.getElementById('healthList').innerHTML = healthData.length ? healthData.map(r => `<div class="item-card"><div class="item-header"><div><div class="item-title">ğŸ´ ${r.horse_name} - ${types[r.record_type] || r.record_type}</div><div class="item-meta">${r.record_date || ''} ${r.vet_name ? 'â€¢ ' + r.vet_name : ''} ${r.cost ? 'â€¢ â‚¬' + r.cost : ''}</div></div><div class="actions"><button class="action-btn" onclick="editHealth(${r.id})">âœï¸</button><button class="action-btn danger" onclick="deleteHealth(${r.id})">ğŸ—‘ï¸</button></div></div>${r.description ? '<div class="item-desc">' + r.description + '</div>' : ''}${r.next_date ? '<div class="item-meta" style="margin-top:0.5rem;color:var(--warning)">â° ÄalÅ¡Ã­: ' + r.next_date + '</div>' : ''}</div>`).join('') : '<div class="empty"><div class="empty-icon">ğŸ¥</div>Å½iadne zdravotnÃ© zÃ¡znamy</div>';
    }
    async function openHealthModal(d = null) { await loadHorsesSelect('healthHorse'); document.getElementById('healthModalTitle').textContent = d ? 'âœï¸ UpraviÅ¥ zÃ¡znam' : 'ğŸ¥ NovÃ½ zÃ¡znam'; document.getElementById('healthId').value = d?.id || ''; document.getElementById('healthHorse').value = d?.horse_id || ''; document.getElementById('healthType').value = d?.record_type || 'vaccination'; document.getElementById('healthDate').value = d?.record_date || new Date().toISOString().split('T')[0]; document.getElementById('healthDesc').value = d?.description || ''; document.getElementById('healthVet').value = d?.vet_name || ''; document.getElementById('healthCost').value = d?.cost || ''; document.getElementById('healthNext').value = d?.next_date || ''; openModal('healthModal'); }
    function editHealth(id) { const h = healthData.find(x => x.id === id); if (h) openHealthModal(h); }
    async function deleteHealth(id) { if (confirm('VymazaÅ¥ zÃ¡znam?')) { await api('/health/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadHealth(); } }
    document.getElementById('healthForm').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('healthId').value; const data = { horse_id: document.getElementById('healthHorse').value, record_type: document.getElementById('healthType').value, record_date: document.getElementById('healthDate').value, description: document.getElementById('healthDesc').value, vet_name: document.getElementById('healthVet').value, cost: document.getElementById('healthCost').value, next_date: document.getElementById('healthNext').value }; if (id) await api('/health/' + id, { method: 'PUT', body: JSON.stringify(data) }); else await api('/health', { method: 'POST', body: JSON.stringify(data) }); closeModal('healthModal'); toast('UloÅ¾enÃ©'); loadHealth(); });

    // BOOKINGS
    async function loadBookings() { const bookings = await api('/bookings') || []; document.getElementById('bookingsTable').innerHTML = bookings.length ? bookings.map(b => `<tr><td><strong>${b.name}</strong></td><td>${b.email || '-'}</td><td>${b.service || '-'}</td><td>${b.preferred_date || '-'}</td><td><span class="badge ${b.status === 'confirmed' ? 'badge-success' : 'badge-warning'}">${b.status === 'confirmed' ? 'âœ“' : 'â³'}</span></td><td><div class="actions"><button class="action-btn success" onclick="confirmBooking(${b.id})">âœ“</button></div></td></tr>`).join('') : '<tr><td colspan="6"><div class="empty">Å½iadne rezervÃ¡cie</div></td></tr>'; }
    async function confirmBooking(id) { await api('/bookings/' + id + '/status', { method: 'PATCH', body: JSON.stringify({ status: 'confirmed' }) }); toast('PotvrdenÃ©'); loadBookings(); }

    // PAYMENTS
    async function loadPayments() { const payments = await api('/payments') || []; const methods = { cash: 'HotovosÅ¥', card: 'Karta', transfer: 'Prevod' }; document.getElementById('paymentsTable').innerHTML = payments.length ? payments.map(p => `<tr><td>${p.payment_date || '-'}</td><td>${p.rider_name || '-'}</td><td><strong style="color:var(--success)">â‚¬${p.amount || 0}</strong></td><td>${methods[p.payment_method] || 'HotovosÅ¥'}</td><td>${p.description || '-'}</td><td><div class="actions"><button class="action-btn danger" onclick="deletePayment(${p.id})">ğŸ—‘ï¸</button></div></td></tr>`).join('') : '<tr><td colspan="6"><div class="empty">Å½iadne platby</div></td></tr>'; }
    async function openPaymentModal() { await loadSelects(); document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0]; document.getElementById('paymentAmount').value = ''; document.getElementById('selPaymentRider').value = ''; document.getElementById('paymentMethod').value = 'cash'; document.getElementById('paymentDesc').value = ''; openModal('paymentModal'); }
    async function deletePayment(id) { if (confirm('VymazaÅ¥ platbu?')) { await api('/payments/' + id, { method: 'DELETE' }); toast('VymazanÃ©'); loadPayments(); loadDashboard(); } }
    document.getElementById('paymentForm').addEventListener('submit', async (e) => { e.preventDefault(); const data = { payment_date: document.getElementById('paymentDate').value, amount: document.getElementById('paymentAmount').value, rider_id: document.getElementById('selPaymentRider').value || null, payment_method: document.getElementById('paymentMethod').value, description: document.getElementById('paymentDesc').value }; await api('/payments', { method: 'POST', body: JSON.stringify(data) }); closeModal('paymentModal'); toast('PridanÃ©'); loadPayments(); loadDashboard(); });

    // MESSAGES
    async function loadMessages() { const messages = await api('/contact') || []; document.getElementById('messagesTable').innerHTML = messages.length ? messages.map(m => `<tr><td><strong>${m.name}</strong></td><td>${m.email || '-'}</td><td>${m.service || '-'}</td><td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${m.message || '-'}</td><td><span class="badge ${m.status === 'new' ? 'badge-warning' : 'badge-success'}">${m.status === 'new' ? 'ğŸ†•' : 'âœ“'}</span></td><td><div class="actions"><button class="action-btn success" onclick="markRead(${m.id})">âœ“</button></div></td></tr>`).join('') : '<tr><td colspan="6"><div class="empty">Å½iadne sprÃ¡vy</div></td></tr>'; }
    async function markRead(id) { await api('/contact/' + id + '/status', { method: 'PATCH', body: JSON.stringify({ status: 'read' }) }); toast('OK'); loadMessages(); }

    // HELPERS
    async function loadSelects() { const [h, r, t] = await Promise.all([api('/horses'), api('/riders'), api('/trainers')]); horses = h || []; riders = r || []; trainers = t || []; document.getElementById('selHorse').innerHTML = '<option value="">-- KÃ´Åˆ --</option>' + horses.map(x => `<option value="${x.id}">${x.name}</option>`).join(''); document.getElementById('selRider').innerHTML = '<option value="">-- Jazdec --</option>' + riders.map(x => `<option value="${x.id}">${x.first_name} ${x.last_name}</option>`).join(''); document.getElementById('selTrainer').innerHTML = '<option value="">-- TrÃ©ner --</option>' + trainers.map(x => `<option value="${x.id}">${x.first_name} ${x.last_name}</option>`).join(''); document.getElementById('selPaymentRider').innerHTML = '<option value="">-- Jazdec --</option>' + riders.map(x => `<option value="${x.id}">${x.first_name} ${x.last_name}</option>`).join(''); }
    async function loadHorsesSelect(id) { const h = await api('/horses') || []; document.getElementById(id).innerHTML = '<option value="">-- KÃ´Åˆ --</option>' + h.map(x => `<option value="${x.id}">${x.name}</option>`).join(''); }
    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); }));
    function toast(msg) { const t = document.getElementById('toast'); t.textContent = 'âœ“ ' + msg; t.className = 'toast success show'; setTimeout(() => t.classList.remove('show'), 3000); }
    function calcAge(d) { return new Date().getFullYear() - new Date(d).getFullYear(); }

    if (token && user) showApp();
    </script>
</body>
</html>
