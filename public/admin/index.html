<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | JK Zelen√° m√≠ƒæa - Profesion√°lny syst√©m</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#228B22;--primary-dark:#1a6b1a;--primary-light:#90EE90;--danger:#dc3545;--warning:#ffc107;--info:#17a2b8;--success:#28a745;--dark:#1a1a1a;--gray:#6c757d;--gray-light:#e9ecef;--light:#f8f9fa;--white:#fff;--shadow:0 2px 10px rgba(0,0,0,0.1);--radius:12px}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:var(--light);min-height:100vh;display:flex}
        .sidebar{width:280px;background:linear-gradient(180deg,var(--dark) 0%,#2d2d2d 100%);color:var(--white);padding:1.5rem;position:fixed;height:100vh;overflow-y:auto;z-index:100}
        .sidebar-header{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;padding-bottom:1.5rem;border-bottom:1px solid rgba(255,255,255,0.1)}
        .sidebar-header img{height:50px;filter:brightness(0) invert(1)}.sidebar-header h2{font-size:1rem;font-weight:600}
        .sidebar-header small{display:block;font-size:0.75rem;opacity:0.7;margin-top:0.25rem}
        .nav-section{margin-bottom:1.5rem}.nav-section-title{font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;opacity:0.5;margin-bottom:0.75rem;padding-left:0.5rem}
        .nav-item{display:flex;align-items:center;gap:0.75rem;padding:0.75rem 1rem;border-radius:var(--radius);cursor:pointer;transition:all 0.2s;margin-bottom:0.25rem;font-size:0.9rem}
        .nav-item:hover{background:rgba(255,255,255,0.1)}.nav-item.active{background:var(--primary);font-weight:500}
        .nav-item .icon{width:20px;text-align:center;font-size:1rem}.nav-item .badge{margin-left:auto;background:var(--danger);padding:0.15rem 0.5rem;border-radius:10px;font-size:0.7rem;font-weight:600}
        .main{margin-left:280px;flex:1;padding:2rem;min-height:100vh}
        .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}
        .header h1{font-size:1.75rem;color:var(--dark)}.header-actions{display:flex;gap:1rem;align-items:center}
        .btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.6rem 1.25rem;border-radius:var(--radius);font-weight:500;cursor:pointer;transition:all 0.2s;border:none;font-family:inherit;font-size:0.9rem}
        .btn-primary{background:var(--primary);color:var(--white)}.btn-primary:hover{background:var(--primary-dark)}
        .btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary)}.btn-outline:hover{background:var(--primary);color:var(--white)}
        .btn-danger{background:var(--danger);color:var(--white)}.btn-warning{background:var(--warning);color:var(--dark)}
        .btn-sm{padding:0.4rem 0.75rem;font-size:0.8rem}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-bottom:2rem}
        .stat-card{background:var(--white);padding:1.5rem;border-radius:var(--radius);box-shadow:var(--shadow)}
        .stat-card .icon{width:50px;height:50px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:1rem}
        .stat-card .icon.green{background:rgba(34,139,34,0.1);color:var(--primary)}
        .stat-card .icon.blue{background:rgba(23,162,184,0.1);color:var(--info)}
        .stat-card .icon.orange{background:rgba(255,193,7,0.1);color:#e67e00}
        .stat-card .icon.red{background:rgba(220,53,69,0.1);color:var(--danger)}
        .stat-card .value{font-size:2rem;font-weight:700;color:var(--dark)}.stat-card .label{color:var(--gray);font-size:0.85rem}
        .card{background:var(--white);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:1.5rem}
        .card-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--gray-light);display:flex;justify-content:space-between;align-items:center}
        .card-header h3{font-size:1.1rem;font-weight:600;color:var(--dark)}.card-body{padding:1.5rem}
        .table{width:100%;border-collapse:collapse}.table th,.table td{padding:0.875rem 1rem;text-align:left;border-bottom:1px solid var(--gray-light)}
        .table th{font-weight:600;color:var(--gray);font-size:0.8rem;text-transform:uppercase;letter-spacing:0.5px;background:var(--light)}
        .table tbody tr:hover{background:var(--light)}.table tbody tr:last-child td{border-bottom:none}
        .badge{display:inline-block;padding:0.3rem 0.75rem;border-radius:20px;font-size:0.75rem;font-weight:500}
        .badge-success{background:rgba(40,167,69,0.1);color:var(--success)}
        .badge-warning{background:rgba(255,193,7,0.2);color:#856404}
        .badge-danger{background:rgba(220,53,69,0.1);color:var(--danger)}
        .badge-info{background:rgba(23,162,184,0.1);color:var(--info)}
        .badge-gray{background:var(--gray-light);color:var(--gray)}
        .avatar{width:40px;height:40px;border-radius:50%;background:var(--primary);color:var(--white);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.9rem}
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;padding:1rem}
        .modal.active{display:flex}.modal-content{background:var(--white);border-radius:var(--radius);width:100%;max-width:700px;max-height:90vh;overflow-y:auto}
        .modal-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--gray-light);display:flex;justify-content:space-between;align-items:center}
        .modal-header h3{font-size:1.2rem}.modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--gray)}
        .modal-body{padding:1.5rem}.modal-footer{padding:1rem 1.5rem;border-top:1px solid var(--gray-light);display:flex;justify-content:flex-end;gap:0.75rem}
        .form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.form-group{margin-bottom:1rem}
        .form-group label{display:block;margin-bottom:0.5rem;font-weight:500;color:var(--dark);font-size:0.9rem}
        .form-group label small{font-weight:400;color:var(--gray)}
        .form-control{width:100%;padding:0.7rem 1rem;border:2px solid var(--gray-light);border-radius:var(--radius);font-family:inherit;font-size:0.9rem;transition:border 0.2s}
        .form-control:focus{outline:none;border-color:var(--primary)}select.form-control{cursor:pointer}textarea.form-control{resize:vertical;min-height:80px}
        .tabs{display:flex;gap:0;border-bottom:2px solid var(--gray-light);margin-bottom:1.5rem}
        .tab{padding:0.875rem 1.5rem;cursor:pointer;color:var(--gray);font-weight:500;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all 0.2s;font-size:0.9rem}
        .tab:hover{color:var(--primary)}.tab.active{color:var(--primary);border-bottom-color:var(--primary)}
        .alert{padding:1rem 1.25rem;border-radius:var(--radius);margin-bottom:1rem;display:flex;align-items:center;gap:0.75rem}
        .alert-warning{background:rgba(255,193,7,0.15);color:#856404;border-left:4px solid var(--warning)}
        .alert-danger{background:rgba(220,53,69,0.1);color:var(--danger);border-left:4px solid var(--danger)}
        .alert-info{background:rgba(23,162,184,0.1);color:var(--info);border-left:4px solid var(--info)}
        .alert-success{background:rgba(40,167,69,0.1);color:var(--success);border-left:4px solid var(--success)}
        .toast{position:fixed;bottom:2rem;right:2rem;background:var(--dark);color:var(--white);padding:1rem 1.5rem;border-radius:var(--radius);transform:translateY(150%);opacity:0;transition:all 0.3s;z-index:9999}
        .toast.show{transform:translateY(0);opacity:1}.toast.success{background:var(--success)}.toast.error{background:var(--danger)}
        .section{display:none}.section.active{display:block}
        .search-box{position:relative}.search-box input{padding-left:2.5rem;width:250px}
        .search-box::before{content:'üîç';position:absolute;left:0.75rem;top:50%;transform:translateY(-50%);font-size:0.9rem}
        .vet-timeline{position:relative;padding-left:2rem}.vet-timeline::before{content:'';position:absolute;left:0.5rem;top:0;bottom:0;width:2px;background:var(--gray-light)}
        .vet-item{position:relative;margin-bottom:1.5rem;padding:1rem;background:var(--light);border-radius:var(--radius)}
        .vet-item::before{content:'';position:absolute;left:-1.65rem;top:1rem;width:12px;height:12px;border-radius:50%;background:var(--primary);border:2px solid var(--white)}
        .vet-item.overdue::before{background:var(--danger)}.vet-item.soon::before{background:var(--warning)}
        .vet-item-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}
        .vet-item-title{font-weight:600;color:var(--dark)}.vet-item-date{font-size:0.85rem;color:var(--gray)}
        .quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:2rem}
        .quick-action{background:var(--white);padding:1.25rem;border-radius:var(--radius);text-align:center;cursor:pointer;transition:all 0.2s;box-shadow:var(--shadow)}
        .quick-action:hover{transform:translateY(-3px);box-shadow:0 5px 20px rgba(0,0,0,0.15)}
        .quick-action .icon{font-size:2rem;margin-bottom:0.5rem}.quick-action span{font-size:0.85rem;color:var(--gray)}
        .notifications-list{max-height:400px;overflow-y:auto}
        .notification-item{display:flex;gap:1rem;padding:1rem;border-bottom:1px solid var(--gray-light);transition:background 0.2s}
        .notification-item:hover{background:var(--light)}.notification-item:last-child{border-bottom:none}
        .notification-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .notification-icon.warning{background:rgba(255,193,7,0.2)}.notification-icon.danger{background:rgba(220,53,69,0.1)}
        .notification-icon.info{background:rgba(23,162,184,0.1)}
        .notification-content{flex:1}.notification-title{font-weight:500;color:var(--dark);margin-bottom:0.25rem}
        .notification-text{font-size:0.85rem;color:var(--gray)}.notification-time{font-size:0.75rem;color:var(--gray)}
        .progress-bar{height:8px;background:var(--gray-light);border-radius:4px;overflow:hidden}
        .progress-bar .fill{height:100%;border-radius:4px;transition:width 0.3s}
        .login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary),var(--primary-dark))}
        .login-box{background:var(--white);padding:2.5rem;border-radius:var(--radius);width:100%;max-width:400px;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
        .login-box h2{text-align:center;margin-bottom:2rem;color:var(--dark)}.login-box img{display:block;margin:0 auto 1.5rem;height:80px}
        @media(max-width:1024px){.sidebar{transform:translateX(-100%);transition:transform 0.3s}.sidebar.open{transform:translateX(0)}.main{margin-left:0}}
        .fieldset{border:1px solid var(--gray-light);border-radius:var(--radius);padding:1rem;margin-bottom:1rem}
        .fieldset legend{padding:0 0.5rem;font-weight:600;color:var(--primary);font-size:0.9rem}
        .horse-card{display:grid;grid-template-columns:100px 1fr;gap:1rem;padding:1rem;border:1px solid var(--gray-light);border-radius:var(--radius);margin-bottom:1rem}
        .horse-card img{width:100px;height:100px;object-fit:cover;border-radius:var(--radius)}
        .horse-card-info h4{margin-bottom:0.25rem}.horse-card-info p{font-size:0.85rem;color:var(--gray)}
        .horse-card-badges{display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:0.5rem}
    </style>
</head>
<body>
    <!-- LOGIN PAGE -->
    <div id="loginPage" class="login-page">
        <div class="login-box">
            <img src="/assets/logo.png" alt="Logo">
            <h2>Admin Panel</h2>
            <p style="text-align:center;color:var(--gray);margin-bottom:1.5rem">Jazdeck√Ω klub Zelen√° m√≠ƒæa<br><small>Profesion√°lny syst√©m podƒæa SJF/≈†VPS/FEI</small></p>
            <form id="loginForm">
                <div class="form-group"><label>Email</label><input type="email" class="form-control" id="loginEmail" value="admin@jkzm.sk" required></div>
                <div class="form-group"><label>Heslo</label><input type="password" class="form-control" id="loginPassword" value="admin123" required></div>
                <button type="submit" class="btn btn-primary" style="width:100%;padding:0.875rem;margin-top:0.5rem">Prihl√°si≈• sa</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" style="display:none;width:100%">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="/assets/logo.png" alt="Logo">
                <div><h2>JK Zelen√° m√≠ƒæa</h2><small>Admin Panel PRO</small></div>
            </div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Prehƒæad</div>
                    <div class="nav-item active" data-section="dashboard"><span class="icon">üìä</span>Dashboard<span class="badge" id="alertBadge">0</span></div>
                    <div class="nav-item" data-section="notifications"><span class="icon">üîî</span>Upozornenia</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Evidencia</div>
                    <div class="nav-item" data-section="horses"><span class="icon">üê¥</span>Kone</div>
                    <div class="nav-item" data-section="riders"><span class="icon">üèá</span>Jazdci</div>
                    <div class="nav-item" data-section="trainers"><span class="icon">üë®‚Äçüè´</span>Tr√©neri</div>
                    <div class="nav-item" data-section="employees"><span class="icon">üë∑</span>Zamestnanci</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Prev√°dzka</div>
                    <div class="nav-item" data-section="trainings"><span class="icon">üìÖ</span>Tr√©ningy</div>
                    <div class="nav-item" data-section="vet"><span class="icon">üè•</span>Veterin√°rne z√°znamy</div>
                    <div class="nav-item" data-section="feeding"><span class="icon">üåæ</span>K≈ïmenie</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">≈†port</div>
                    <div class="nav-item" data-section="competitions"><span class="icon">üèÜ</span>Preteky</div>
                    <div class="nav-item" data-section="licenses"><span class="icon">üìã</span>Licencie SJF/FEI</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Financie</div>
                    <div class="nav-item" data-section="payments"><span class="icon">üí≥</span>Platby</div>
                    <div class="nav-item" data-section="memberships"><span class="icon">üé´</span>ƒålenstv√°</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Web</div>
                    <div class="nav-item" data-section="bookings"><span class="icon">üìù</span>Rezerv√°cie</div>
                    <div class="nav-item" data-section="messages"><span class="icon">‚úâÔ∏è</span>Spr√°vy</div>
                </div>
            </nav>
            <div style="margin-top:auto;padding-top:2rem;border-top:1px solid rgba(255,255,255,0.1)">
                <div class="nav-item" onclick="window.open('/','_blank')"><span class="icon">üåê</span>Zobrazi≈• web</div>
                <div class="nav-item" onclick="logout()"><span class="icon">üö™</span>Odhl√°si≈•</div>
            </div>
        </aside>

        <main class="main">
            <!-- DASHBOARD -->
            <section id="dashboard" class="section active">
                <div class="header"><h1>Dashboard</h1><div class="header-actions"><span id="currentDate"></span></div></div>
                
                <div id="criticalAlerts"></div>
                
                <div class="stats-grid">
                    <div class="stat-card"><div class="icon green">üê¥</div><div class="value" id="statHorses">0</div><div class="label">Akt√≠vnych kon√≠</div></div>
                    <div class="stat-card"><div class="icon blue">üèá</div><div class="value" id="statRiders">0</div><div class="label">Jazdcov</div></div>
                    <div class="stat-card"><div class="icon orange">üìÖ</div><div class="value" id="statTrainings">0</div><div class="label">Dne≈°n√Ωch tr√©ningov</div></div>
                    <div class="stat-card"><div class="icon red">‚ö†Ô∏è</div><div class="value" id="statAlerts">0</div><div class="label">Upozornen√≠</div></div>
                </div>

                <div class="quick-actions">
                    <div class="quick-action" onclick="showSection('trainings');openModal('trainingModal')"><div class="icon">‚ûï</div><span>Nov√Ω tr√©ning</span></div>
                    <div class="quick-action" onclick="showSection('vet');openModal('vetModal')"><div class="icon">üíâ</div><span>Veterin√°rny z√°znam</span></div>
                    <div class="quick-action" onclick="showSection('horses');openModal('horseModal')"><div class="icon">üê¥</div><span>Prida≈• ko≈àa</span></div>
                    <div class="quick-action" onclick="showSection('riders');openModal('riderModal')"><div class="icon">üë§</div><span>Prida≈• jazdca</span></div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem">
                    <div class="card">
                        <div class="card-header"><h3>üìÖ Dne≈°n√© tr√©ningy</h3></div>
                        <div class="card-body"><div id="todayTrainings"><p style="color:var(--gray)">Naƒç√≠tavam...</p></div></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>üîî Bl√≠≈æiace sa term√≠ny</h3></div>
                        <div class="card-body"><div id="upcomingDeadlines"><p style="color:var(--gray)">Naƒç√≠tavam...</p></div></div>
                    </div>
                </div>
            </section>

            <!-- HORSES -->
            <section id="horses" class="section">
                <div class="header"><h1>üê¥ Evidencia kon√≠</h1><div class="header-actions"><div class="search-box"><input type="text" class="form-control" placeholder="Hƒæada≈•..." id="searchHorses"></div><button class="btn btn-primary" onclick="openModal('horseModal')">+ Prida≈• ko≈àa</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>Plemeno</th><th>Pas/UELN</th><th>ƒåip</th><th>SJF/FEI</th><th>Oƒçkovanie</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="horsesTable"></tbody></table></div></div>
            </section>

            <!-- RIDERS -->
            <section id="riders" class="section">
                <div class="header"><h1>üèá Evidencia jazdcov</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('riderModal')">+ Prida≈• jazdca</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>Kateg√≥ria</th><th>SJF licencia</th><th>FEI ID</th><th>√örove≈à</th><th>Lek. potvrdenie</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="ridersTable"></tbody></table></div></div>
            </section>

            <!-- TRAINERS -->
            <section id="trainers" class="section">
                <div class="header"><h1>üë®‚Äçüè´ Tr√©neri</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('trainerModal')">+ Prida≈• tr√©nera</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>SJF stupe≈à</th><th>≈†pecializ√°cia</th><th>Typ √∫v√§zku</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="trainersTable"></tbody></table></div></div>
            </section>

            <!-- EMPLOYEES -->
            <section id="employees" class="section">
                <div class="header"><h1>üë∑ Zamestnanci</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('employeeModal')">+ Prida≈•</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>Poz√≠cia</th><th>Telef√≥n</th><th>Typ</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="employeesTable"></tbody></table></div></div>
            </section>

            <!-- TRAININGS -->
            <section id="trainings" class="section">
                <div class="header"><h1>üìÖ Tr√©ningy</h1><div class="header-actions"><input type="date" class="form-control" id="trainingDateFilter" style="width:auto"><button class="btn btn-primary" onclick="openModal('trainingModal')">+ Nov√Ω tr√©ning</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>D√°tum/ƒåas</th><th>Jazdec</th><th>K√¥≈à</th><th>Tr√©ner</th><th>Typ</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="trainingsTable"></tbody></table></div></div>
            </section>

            <!-- VET RECORDS -->
            <section id="vet" class="section">
                <div class="header"><h1>üè• Veterin√°rne z√°znamy</h1><div class="header-actions"><select class="form-control" id="vetHorseFilter" style="width:200px"><option value="">V≈°etky kone</option></select><button class="btn btn-primary" onclick="openModal('vetModal')">+ Nov√Ω z√°znam</button></div></div>
                
                <div class="stats-grid" style="margin-bottom:1.5rem">
                    <div class="stat-card" style="border-left:4px solid var(--danger)"><div class="value" id="vetOverdue">0</div><div class="label">Po term√≠ne</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="value" id="vetSoon">0</div><div class="label">Do 30 dn√≠</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--success)"><div class="value" id="vetOk">0</div><div class="label">V poriadku</div></div>
                </div>

                <div class="card"><div class="card-header"><h3>Veterin√°rne z√°znamy</h3></div><div class="card-body"><table class="table"><thead><tr><th>K√¥≈à</th><th>Typ</th><th>D√°tum</th><th>ƒéal≈°√≠ term√≠n</th><th>Veterin√°r</th><th>Pozn√°mka</th><th>Akcie</th></tr></thead><tbody id="vetTable"></tbody></table></div></div>
            </section>

            <!-- FEEDING -->
            <section id="feeding" class="section">
                <div class="header"><h1>üåæ K≈ïmenie</h1><div class="header-actions"><input type="date" class="form-control" id="feedingDate" style="width:auto"><button class="btn btn-primary" onclick="openModal('feedingModal')">+ Prida≈• z√°znam</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>K√¥≈à</th><th>D√°tum</th><th>ƒåas</th><th>K≈ïmil</th><th>Pozn√°mka</th><th>Akcie</th></tr></thead><tbody id="feedingTable"></tbody></table></div></div>
            </section>

            <!-- COMPETITIONS -->
            <section id="competitions" class="section">
                <div class="header"><h1>üèÜ Preteky a s√∫≈•a≈æe</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('competitionModal')">+ Prida≈• preteky</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>N√°zov</th><th>D√°tum</th><th>Miesto</th><th>Discipl√≠na</th><th>Typ</th><th>Uz√°vierka</th><th>Akcie</th></tr></thead><tbody id="competitionsTable"></tbody></table></div></div>
            </section>

            <!-- LICENSES -->
            <section id="licenses" class="section">
                <div class="header"><h1>üìã Licencie SJF/FEI</h1></div>
                <div class="tabs"><div class="tab active" data-tab="licRiders">Jazdci</div><div class="tab" data-tab="licHorses">Kone</div><div class="tab" data-tab="licTrainers">Tr√©neri</div></div>
                <div class="card"><div class="card-body" id="licensesContent"><p>Vyberte kateg√≥riu</p></div></div>
            </section>

            <!-- PAYMENTS -->
            <section id="payments" class="section">
                <div class="header"><h1>üí≥ Platby</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('paymentModal')">+ Nov√° platba</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>D√°tum</th><th>Jazdec</th><th>Typ</th><th>Popis</th><th>Suma</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="paymentsTable"></tbody></table></div></div>
            </section>

            <!-- MEMBERSHIPS -->
            <section id="memberships" class="section">
                <div class="header"><h1>üé´ ƒålenstv√°</h1></div>
                <div class="card"><div class="card-body"><p style="color:var(--gray)">Modul ƒçlenstv√° - v pr√≠prave</p></div></div>
            </section>

            <!-- NOTIFICATIONS -->
            <section id="notifications" class="section">
                <div class="header"><h1>üîî Upozornenia</h1></div>
                <div class="card"><div class="card-body notifications-list" id="notificationsList"></div></div>
            </section>

            <!-- BOOKINGS -->
            <section id="bookings" class="section">
                <div class="header"><h1>üìù Rezerv√°cie z webu</h1></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>D√°tum</th><th>Meno</th><th>Slu≈æba</th><th>Preferovan√Ω term√≠n</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="bookingsTable"></tbody></table></div></div>
            </section>

            <!-- MESSAGES -->
            <section id="messages" class="section">
                <div class="header"><h1>‚úâÔ∏è Spr√°vy z webu</h1></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>D√°tum</th><th>Meno</th><th>Email</th><th>Spr√°va</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="messagesTable"></tbody></table></div></div>
            </section>
        </main>
    </div>

    <!-- MODALS -->
    <!-- Horse Modal -->
    <div class="modal" id="horseModal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header"><h3 id="horseModalTitle">Prida≈• ko≈àa</h3><button class="modal-close" onclick="closeModal('horseModal')">√ó</button></div>
            <div class="modal-body">
                <form id="horseForm">
                    <input type="hidden" id="horseId">
                    <div class="tabs" style="margin-bottom:1rem"><div class="tab active" data-modal-tab="horseBasic">Z√°kladn√©</div><div class="tab" data-modal-tab="horseIdent">Identifik√°cia</div><div class="tab" data-modal-tab="horseSport">≈†port</div></div>
                    
                    <div id="horseBasic" class="modal-tab-content active">
                        <div class="form-row">
                            <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="horseName" required></div>
                            <div class="form-group"><label>Prez√Ωvka</label><input type="text" class="form-control" id="horseStableName"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Plemeno</label><input type="text" class="form-control" id="horseBreed"></div>
                            <div class="form-group"><label>Farba</label><input type="text" class="form-control" id="horseColor"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Pohlavie</label><select class="form-control" id="horseSex"><option value="gelding">Valach</option><option value="mare">Kobyla</option><option value="stallion">≈Ωrebec</option></select></div>
                            <div class="form-group"><label>D√°tum narodenia</label><input type="date" class="form-control" id="horseBirth"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>V√Ω≈°ka (cm)</label><input type="number" class="form-control" id="horseHeight"></div>
                            <div class="form-group"><label>V√°ha (kg)</label><input type="number" class="form-control" id="horseWeight"></div>
                        </div>
                        <div class="form-group"><label>Majiteƒæ</label><input type="text" class="form-control" id="horseOwner"></div>
                    </div>

                    <div id="horseIdent" class="modal-tab-content" style="display:none">
                        <fieldset class="fieldset"><legend>≈†VPS - Povinn√© √∫daje</legend>
                            <div class="form-row">
                                <div class="form-group"><label>ƒå√≠slo pasu ko≈àa *</label><input type="text" class="form-control" id="horsePassport" placeholder="SVK-2020-12345"></div>
                                <div class="form-group"><label>≈Ωivotn√© ƒç√≠slo (UELN)</label><input type="text" class="form-control" id="horseLifeNumber" placeholder="703099000012345"></div>
                            </div>
                            <div class="form-group"><label>Mikroƒçip <small>(ISO 11784, povinn√Ω od 2013)</small></label><input type="text" class="form-control" id="horseMicrochip" placeholder="941000012345678"></div>
                        </fieldset>
                        <fieldset class="fieldset"><legend>FEI registr√°cia</legend>
                            <div class="form-row">
                                <div class="form-group"><label>FEI ID</label><input type="text" class="form-control" id="horseFeiId" placeholder="SVK40123"></div>
                                <div class="form-group"><label>FEI pas - platnos≈•</label><input type="date" class="form-control" id="horseFeiExpiry"></div>
                            </div>
                        </fieldset>
                        <fieldset class="fieldset"><legend>SJF registr√°cia</legend>
                            <div class="form-row">
                                <div class="form-group"><label>SJF licencia ko≈àa</label><input type="text" class="form-control" id="horseSjfLicense" placeholder="SK-H-2020-001"></div>
                                <div class="form-group"><label>Platnos≈• do</label><input type="date" class="form-control" id="horseSjfExpiry"></div>
                            </div>
                        </fieldset>
                    </div>

                    <div id="horseSport" class="modal-tab-content" style="display:none">
                        <div class="form-row">
                            <div class="form-group"><label>√örove≈à</label><select class="form-control" id="horseLevel"><option value="beginner">Zaƒçiatoƒçn√≠ci</option><option value="intermediate">Pokroƒçil√≠</option><option value="advanced">Sk√∫sen√≠</option><option value="children">Deti</option><option value="competition">S√∫≈•a≈æn√Ω</option></select></div>
                            <div class="form-group"><label>Status</label><select class="form-control" id="horseStatus"><option value="active">Akt√≠vny</option><option value="retired">D√¥chodca</option><option value="sold">Predan√Ω</option><option value="temporary_out">Doƒçasne mimo</option></select></div>
                        </div>
                        <div class="form-group"><label>Discipl√≠ny</label><div style="display:flex;gap:1rem;flex-wrap:wrap"><label><input type="checkbox" class="horseDiscipline" value="skoky"> Skoky</label><label><input type="checkbox" class="horseDiscipline" value="drez√∫ra"> Drez√∫ra</label><label><input type="checkbox" class="horseDiscipline" value="v≈°estrannos≈•"> V≈°estrannos≈•</label><label><input type="checkbox" class="horseDiscipline" value="vytrvalos≈•"> Vytrvalos≈•</label><label><input type="checkbox" class="horseDiscipline" value="volt√≠≈æ"> Volt√≠≈æ</label><label><input type="checkbox" class="horseDiscipline" value="z√°prahy"> Z√°prahy</label></div></div>
                        <div class="form-group"><label>Pozn√°mky</label><textarea class="form-control" id="horseNotes"></textarea></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('horseModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="saveHorse()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <!-- Rider Modal -->
    <div class="modal" id="riderModal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header"><h3 id="riderModalTitle">Prida≈• jazdca</h3><button class="modal-close" onclick="closeModal('riderModal')">√ó</button></div>
            <div class="modal-body">
                <form id="riderForm">
                    <input type="hidden" id="riderId">
                    <fieldset class="fieldset"><legend>Osobn√© √∫daje</legend>
                        <div class="form-row">
                            <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="riderFirstName" required></div>
                            <div class="form-group"><label>Priezvisko *</label><input type="text" class="form-control" id="riderLastName" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>D√°tum narodenia</label><input type="date" class="form-control" id="riderBirth"></div>
                            <div class="form-group"><label>Pohlavie</label><select class="form-control" id="riderGender"><option value="female">≈Ωena</option><option value="male">Mu≈æ</option></select></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Email *</label><input type="email" class="form-control" id="riderEmail" required></div>
                            <div class="form-group"><label>Telef√≥n</label><input type="tel" class="form-control" id="riderPhone"></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>SJF registr√°cia</legend>
                        <div class="form-row">
                            <div class="form-group"><label>ƒå√≠slo licencie SJF</label><input type="text" class="form-control" id="riderSjfLicense" placeholder="SK-R-2020-001"></div>
                            <div class="form-group"><label>Typ licencie</label><select class="form-control" id="riderSjfType"><option value="none">Bez licencie (hobby)</option><option value="szvj">SZVJ - z√°kladn√Ω v√Ωcvik</option><option value="national">N√°rodn√° licencia</option><option value="international">Medzin√°rodn√°</option></select></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Platnos≈• do</label><input type="date" class="form-control" id="riderSjfExpiry"></div>
                            <div class="form-group"><label>D√°tum SZVJ sk√∫≈°ky</label><input type="date" class="form-control" id="riderSzvjDate"></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>FEI registr√°cia</legend>
                        <div class="form-row">
                            <div class="form-group"><label>FEI ID</label><input type="text" class="form-control" id="riderFeiId"></div>
                            <div class="form-group"><label>FEI platnos≈• do</label><input type="date" class="form-control" id="riderFeiExpiry"></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>Kateg√≥ria a √∫rove≈à</legend>
                        <div class="form-row">
                            <div class="form-group"><label>Kateg√≥ria (SJF)</label><select class="form-control" id="riderCategory"><option value="children">Deti (do 12)</option><option value="pony">Pony jazdci</option><option value="junior">Juniori (14-18)</option><option value="young_rider">Mlad√≠ jazdci (16-21)</option><option value="senior">Seniori (21+)</option><option value="amateur">Amat√©ri</option></select></div>
                            <div class="form-group"><label>√örove≈à</label><select class="form-control" id="riderLevel"><option value="beginner">Zaƒçiatoƒçn√≠k</option><option value="intermediate">Pokroƒçil√Ω</option><option value="advanced">Sk√∫sen√Ω</option><option value="competition">S√∫≈•a≈æn√Ω</option></select></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>Zdravotn√° sp√¥sobilos≈•</legend>
                        <div class="form-row">
                            <div class="form-group"><label>Lek√°rske potvrdenie</label><select class="form-control" id="riderMedical"><option value="true">Platn√©</option><option value="false">Neplatn√©</option></select></div>
                            <div class="form-group"><label>Platn√© do</label><input type="date" class="form-control" id="riderMedicalExpiry"></div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('riderModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="saveRider()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <!-- Trainer Modal -->
    <div class="modal" id="trainerModal">
        <div class="modal-content">
            <div class="modal-header"><h3>Prida≈• tr√©nera</h3><button class="modal-close" onclick="closeModal('trainerModal')">√ó</button></div>
            <div class="modal-body">
                <form id="trainerForm">
                    <input type="hidden" id="trainerId">
                    <div class="form-row">
                        <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="trainerFirstName" required></div>
                        <div class="form-group"><label>Priezvisko *</label><input type="text" class="form-control" id="trainerLastName" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Email</label><input type="email" class="form-control" id="trainerEmail"></div>
                        <div class="form-group"><label>Telef√≥n</label><input type="tel" class="form-control" id="trainerPhone"></div>
                    </div>
                    <fieldset class="fieldset"><legend>SJF kvalifik√°cia</legend>
                        <div class="form-row">
                            <div class="form-group"><label>ƒå√≠slo licencie</label><input type="text" class="form-control" id="trainerSjfLicense"></div>
                            <div class="form-group"><label>Kvalifikaƒçn√Ω stupe≈à (1-4)</label><select class="form-control" id="trainerLevel"><option value="1">1. stupe≈à</option><option value="2">2. stupe≈à</option><option value="3">3. stupe≈à</option><option value="4">4. stupe≈à (najvy≈°≈°√≠)</option></select></div>
                        </div>
                    </fieldset>
                    <div class="form-group"><label>≈†pecializ√°cie</label><div style="display:flex;gap:1rem;flex-wrap:wrap"><label><input type="checkbox" class="trainerSpec" value="skoky"> Skoky</label><label><input type="checkbox" class="trainerSpec" value="drez√∫ra"> Drez√∫ra</label><label><input type="checkbox" class="trainerSpec" value="volt√≠≈æ"> Volt√≠≈æ</label><label><input type="checkbox" class="trainerSpec" value="zaƒçiatoƒçn√≠ci"> Zaƒçiatoƒçn√≠ci</label></div></div>
                    <div class="form-row">
                        <div class="form-group"><label>Typ √∫v√§zku</label><select class="form-control" id="trainerEmployment"><option value="full_time">Pln√Ω √∫v√§zok</option><option value="part_time">ƒåiastoƒçn√Ω</option><option value="external">Extern√Ω</option><option value="volunteer">Dobrovoƒæn√≠k</option></select></div>
                        <div class="form-group"><label>Hodinov√° sadzba (‚Ç¨)</label><input type="number" class="form-control" id="trainerRate" step="0.01"></div>
                    </div>
                    <div class="form-group"><label>Bio / Popis</label><textarea class="form-control" id="trainerBio"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('trainerModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="saveTrainer()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header"><h3>Prida≈• zamestnanca</h3><button class="modal-close" onclick="closeModal('employeeModal')">√ó</button></div>
            <div class="modal-body">
                <form id="employeeForm">
                    <input type="hidden" id="employeeId">
                    <div class="form-row">
                        <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="employeeFirstName" required></div>
                        <div class="form-group"><label>Priezvisko *</label><input type="text" class="form-control" id="employeeLastName" required></div>
                    </div>
                    <div class="form-group"><label>Poz√≠cia</label><input type="text" class="form-control" id="employeePosition" placeholder="Stajn√≠k, pomocn√≠k..."></div>
                    <div class="form-row">
                        <div class="form-group"><label>Email</label><input type="email" class="form-control" id="employeeEmail"></div>
                        <div class="form-group"><label>Telef√≥n</label><input type="tel" class="form-control" id="employeePhone"></div>
                    </div>
                    <div class="form-group"><label>Typ √∫v√§zku</label><select class="form-control" id="employeeType"><option value="full_time">Pln√Ω √∫v√§zok</option><option value="part_time">ƒåiastoƒçn√Ω</option></select></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('employeeModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="saveEmployee()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <!-- Training Modal -->
    <div class="modal" id="trainingModal">
        <div class="modal-content">
            <div class="modal-header"><h3>Nov√Ω tr√©ning</h3><button class="modal-close" onclick="closeModal('trainingModal')">√ó</button></div>
            <div class="modal-body">
                <form id="trainingForm">
                    <input type="hidden" id="trainingId">
                    <div class="form-row">
                        <div class="form-group"><label>D√°tum *</label><input type="date" class="form-control" id="trainingDate" required></div>
                        <div class="form-group"><label>ƒåas *</label><input type="time" class="form-control" id="trainingTime" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Jazdec *</label><select class="form-control" id="trainingRider" required></select></div>
                        <div class="form-group"><label>K√¥≈à *</label><select class="form-control" id="trainingHorse" required></select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Tr√©ner *</label><select class="form-control" id="trainingTrainer" required></select></div>
                        <div class="form-group"><label>Typ tr√©ningu</label><select class="form-control" id="trainingType"><option value="individual">Individu√°lny</option><option value="group">Skupinov√Ω</option><option value="longe">Lon≈æovanie</option><option value="jumping">Skoky</option><option value="dressage">Drez√∫ra</option><option value="cross_country">Ter√©n</option><option value="theory">Te√≥ria</option><option value="szvj_preparation">Pr√≠prava SZVJ</option><option value="competition_prep">Pr√≠prava preteky</option></select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Trvanie (min)</label><input type="number" class="form-control" id="trainingDuration" value="60"></div>
                        <div class="form-group"><label>Cena (‚Ç¨)</label><input type="number" class="form-control" id="trainingPrice" step="0.01"></div>
                    </div>
                    <div class="form-group"><label>Pozn√°mky</label><textarea class="form-control" id="trainingNotes"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('trainingModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="saveTraining()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <!-- Vet Record Modal -->
    <div class="modal" id="vetModal">
        <div class="modal-content">
            <div class="modal-header"><h3>Veterin√°rny z√°znam</h3><button class="modal-close" onclick="closeModal('vetModal')">√ó</button></div>
            <div class="modal-body">
                <form id="vetForm">
                    <input type="hidden" id="vetId">
                    <div class="form-row">
                        <div class="form-group"><label>K√¥≈à *</label><select class="form-control" id="vetHorse" required></select></div>
                        <div class="form-group"><label>Typ z√°znamu *</label><select class="form-control" id="vetType" required>
                            <optgroup label="Oƒçkovanie"><option value="vaccination_flu">Chr√≠pka (FEI: 6 mes.)</option><option value="vaccination_tetanus">Tetanus</option><option value="vaccination_ehv">EHV-1 herpesv√≠rus</option><option value="vaccination_other">In√© oƒçkovanie</option></optgroup>
                            <optgroup label="Vy≈°etrenia"><option value="iae_test">IAE test (infekƒçn√° an√©mia)</option><option value="coggins_test">Coggins test</option><option value="examination">Veterin√°rna prehliadka</option><option value="fei_check">FEI veterin√°rna kontrola</option></optgroup>
                            <optgroup label="Starostlivos≈•"><option value="deworming">Odƒçervenie</option><option value="dental">Zuby</option><option value="farrier">Podkovanie</option></optgroup>
                            <optgroup label="Zdravie"><option value="treatment">Lieƒçba</option><option value="surgery">Chirurgia</option><option value="injury">Zranenie</option></optgroup>
                        </select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>D√°tum *</label><input type="date" class="form-control" id="vetDate" required></div>
                        <div class="form-group"><label>ƒéal≈°√≠ term√≠n</label><input type="date" class="form-control" id="vetNextDate"></div>
                    </div>
                    <div class="form-group"><label>Veterin√°r</label><input type="text" class="form-control" id="vetVeterinarian" placeholder="MVDr. J√°n Kov√°ƒç"></div>
                    <div class="form-group" id="vaccineFields" style="display:none">
                        <div class="form-row">
                            <div class="form-group"><label>N√°zov vakc√≠ny</label><input type="text" class="form-control" id="vetVaccineName"></div>
                            <div class="form-group"><label>≈†ar≈æa</label><input type="text" class="form-control" id="vetVaccineBatch"></div>
                        </div>
                    </div>
                    <div class="form-group"><label>Pozn√°mky</label><textarea class="form-control" id="vetNotes"></textarea></div>
                    <div class="form-group"><label>N√°klady (‚Ç¨)</label><input type="number" class="form-control" id="vetCost" step="0.01"></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('vetModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="saveVetRecord()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <!-- Feeding Modal -->
    <div class="modal" id="feedingModal">
        <div class="modal-content">
            <div class="modal-header"><h3>Z√°znam k≈ïmenia</h3><button class="modal-close" onclick="closeModal('feedingModal')">√ó</button></div>
            <div class="modal-body">
                <form id="feedingForm">
                    <input type="hidden" id="feedingId">
                    <div class="form-row">
                        <div class="form-group"><label>K√¥≈à *</label><select class="form-control" id="feedHorse" required></select></div>
                        <div class="form-group"><label>D√°tum *</label><input type="date" class="form-control" id="feedDate" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>ƒåas k≈ïmenia</label><select class="form-control" id="feedTime"><option value="morning">R√°no</option><option value="noon">Obed</option><option value="evening">Veƒçer</option></select></div>
                        <div class="form-group"><label>K≈ïmil</label><select class="form-control" id="feedBy"></select></div>
                    </div>
                    <div class="form-group"><label>Pozn√°mky</label><textarea class="form-control" id="feedNotes"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('feedingModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="saveFeeding()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header"><h3>Nov√° platba</h3><button class="modal-close" onclick="closeModal('paymentModal')">√ó</button></div>
            <div class="modal-body">
                <form id="paymentForm">
                    <input type="hidden" id="paymentId">
                    <div class="form-group"><label>Jazdec *</label><select class="form-control" id="paymentRider" required></select></div>
                    <div class="form-row">
                        <div class="form-group"><label>Typ platby *</label><select class="form-control" id="paymentType" required><option value="membership">ƒålensk√©</option><option value="training">Tr√©ning</option><option value="stabling">Ustajnenie</option><option value="competition">Preteky</option><option value="sjf_license">SJF licencia</option><option value="fei_registration">FEI registr√°cia</option><option value="vet_services">Veterin√°rne slu≈æby</option><option value="other">In√©</option></select></div>
                        <div class="form-group"><label>Suma (‚Ç¨) *</label><input type="number" class="form-control" id="paymentAmount" step="0.01" required></div>
                    </div>
                    <div class="form-group"><label>Popis</label><input type="text" class="form-control" id="paymentDescription"></div>
                    <div class="form-row">
                        <div class="form-group"><label>D√°tum splatnosti</label><input type="date" class="form-control" id="paymentDue"></div>
                        <div class="form-group"><label>Status</label><select class="form-control" id="paymentStatus"><option value="pending">Neuhraden√©</option><option value="paid">Uhraden√©</option><option value="overdue">Po splatnosti</option></select></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('paymentModal')">Zru≈°i≈•</button><button class="btn btn-primary" onclick="savePayment()">Ulo≈æi≈•</button></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
    let token = localStorage.getItem('jkzm_token');
    let horses = [], riders = [], trainers = [], employees = [], trainings = [], vetRecords = [], payments = [], bookings = [], messages = [], competitions = [];

    // Initialize
    if (token) { showApp(); loadAll(); } else { document.getElementById('loginPage').style.display = 'flex'; }

    // Login
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            const res = await fetch('/api/auth-login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email: document.getElementById('loginEmail').value, password: document.getElementById('loginPassword').value})
            });
            const data = await res.json();
            if (data.token) { token = data.token; localStorage.setItem('jkzm_token', token); showApp(); loadAll(); }
            else { showToast(data.error || 'Nespr√°vne prihlasovacie √∫daje', 'error'); }
        } catch(e) { showToast('Chyba pripojenia', 'error'); }
    });

    function showApp() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('sk-SK', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
    }

    function logout() { localStorage.removeItem('jkzm_token'); location.reload(); }

    // Navigation
    document.querySelectorAll('.nav-item[data-section]').forEach(item => {
        item.addEventListener('click', () => showSection(item.dataset.section));
    });

    function showSection(section) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.querySelector(`.nav-item[data-section="${section}"]`)?.classList.add('active');
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(section)?.classList.add('active');
    }

    // Modal tabs
    document.querySelectorAll('[data-modal-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
            const parent = tab.closest('.modal-body');
            parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            parent.querySelectorAll('.modal-tab-content').forEach(c => c.style.display = 'none');
            tab.classList.add('active');
            document.getElementById(tab.dataset.modalTab).style.display = 'block';
        });
    });

    // API calls
    async function api(endpoint, method = 'GET', body = null) {
        const opts = {method, headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`}};
        if (body) opts.body = JSON.stringify(body);
        const res = await fetch(`/api/${endpoint}`, opts);
        return res.json();
    }

    async function loadAll() {
        try {
            [horses, riders, trainers, employees, trainings, vetRecords, payments, bookings, messages, competitions] = await Promise.all([
                api('horses'), api('riders'), api('trainers'), api('employees'), api('trainings'), 
                api('vet-records'), api('payments'), api('bookings'), api('contact'), api('competitions')
            ]);
        } catch(e) {
            // Fallback if some endpoints don't exist
            horses = await api('horses').catch(() => []);
            riders = await api('riders').catch(() => []);
            trainers = await api('trainers').catch(() => []);
            employees = await api('employees').catch(() => []);
            trainings = await api('trainings').catch(() => []);
            vetRecords = [];
            payments = await api('payments').catch(() => []);
            bookings = await api('bookings').catch(() => []);
            messages = await api('contact').catch(() => []);
            competitions = [];
        }
        renderAll();
        loadDashboard();
        populateSelects();
    }

    function loadDashboard() {
        document.getElementById('statHorses').textContent = horses.filter(h => h.status === 'active').length;
        document.getElementById('statRiders').textContent = riders.filter(r => r.status === 'active').length;
        const today = new Date().toISOString().split('T')[0];
        const todayTrainings = trainings.filter(t => t.date === today);
        document.getElementById('statTrainings').textContent = todayTrainings.length;
        
        // Alerts - calculate overdue vaccinations, licenses etc
        let alerts = [];
        const now = new Date();
        const in30days = new Date(now.getTime() + 30*24*60*60*1000);
        
        // Check horse vaccinations (simplified - would normally check vet_records)
        horses.forEach(h => {
            if (h.sjf_license_valid_until && new Date(h.sjf_license_valid_until) < in30days) {
                alerts.push({type: 'warning', title: `SJF licencia - ${h.name}`, text: 'Bl√≠≈æi sa vypr≈°anie licencie'});
            }
        });
        
        document.getElementById('statAlerts').textContent = alerts.length;
        document.getElementById('alertBadge').textContent = alerts.length;
        
        // Critical alerts
        const criticalHtml = alerts.slice(0, 3).map(a => 
            `<div class="alert alert-${a.type}"><span>‚ö†Ô∏è</span><div><strong>${a.title}</strong> - ${a.text}</div></div>`
        ).join('');
        document.getElementById('criticalAlerts').innerHTML = criticalHtml;
        
        // Today's trainings
        document.getElementById('todayTrainings').innerHTML = todayTrainings.length ? todayTrainings.map(t => {
            const rider = riders.find(r => r.id === t.rider_id);
            const horse = horses.find(h => h.id === t.horse_id);
            return `<div style="display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--gray-light)">
                <div><strong>${t.start_time}</strong> - ${rider?.first_name || ''} ${rider?.last_name || ''} na ${horse?.name || ''}</div>
                <span class="badge badge-${t.status === 'completed' ? 'success' : 'info'}">${t.status}</span>
            </div>`;
        }).join('') : '<p style="color:var(--gray)">≈Ωiadne tr√©ningy dnes</p>';
        
        // Upcoming deadlines
        document.getElementById('upcomingDeadlines').innerHTML = alerts.length ? alerts.slice(0, 5).map(a => 
            `<div style="display:flex;gap:0.75rem;padding:0.75rem 0;border-bottom:1px solid var(--gray-light)">
                <span>‚ö†Ô∏è</span><div><strong>${a.title}</strong><br><small style="color:var(--gray)">${a.text}</small></div>
            </div>`
        ).join('') : '<p style="color:var(--gray)">≈Ωiadne bl√≠≈æiace sa term√≠ny</p>';
    }

    function populateSelects() {
        // Horse selects
        const horseOpts = '<option value="">Vyberte ko≈àa</option>' + horses.filter(h => h.status === 'active').map(h => `<option value="${h.id}">${h.name}</option>`).join('');
        document.querySelectorAll('#trainingHorse, #vetHorse, #feedHorse, #vetHorseFilter').forEach(s => s.innerHTML = horseOpts);
        
        // Rider selects
        const riderOpts = '<option value="">Vyberte jazdca</option>' + riders.filter(r => r.status === 'active').map(r => `<option value="${r.id}">${r.first_name} ${r.last_name}</option>`).join('');
        document.querySelectorAll('#trainingRider, #paymentRider').forEach(s => s.innerHTML = riderOpts);
        
        // Trainer selects
        const trainerOpts = '<option value="">Vyberte tr√©nera</option>' + trainers.filter(t => t.status === 'active').map(t => `<option value="${t.id}">${t.first_name} ${t.last_name}</option>`).join('');
        document.querySelectorAll('#trainingTrainer').forEach(s => s.innerHTML = trainerOpts);
        
        // Employee selects
        const empOpts = '<option value="">Vyberte</option>' + employees.filter(e => e.status === 'active').map(e => `<option value="${e.id}">${e.first_name} ${e.last_name}</option>`).join('');
        document.querySelectorAll('#feedBy').forEach(s => s.innerHTML = empOpts);
    }

    function renderAll() {
        renderHorses();
        renderRiders();
        renderTrainers();
        renderEmployees();
        renderTrainings();
        renderPayments();
        renderBookings();
        renderMessages();
    }

    // Render functions
    function renderHorses() {
        const levelLabels = {beginner:'Zaƒçiatoƒçn√≠ci',intermediate:'Pokroƒçil√≠',advanced:'Sk√∫sen√≠',children:'Deti',competition:'S√∫≈•a≈æn√Ω'};
        document.getElementById('horsesTable').innerHTML = horses.map(h => `
            <tr>
                <td><strong>${h.name}</strong>${h.stable_name ? `<br><small style="color:var(--gray)">${h.stable_name}</small>` : ''}</td>
                <td>${h.breed || '-'}</td>
                <td><small>${h.passport_number || '-'}<br>${h.life_number || ''}</small></td>
                <td><small>${h.microchip || '-'}</small></td>
                <td>${h.sjf_license_number ? `<span class="badge badge-success">SJF</span>` : ''}${h.fei_id ? ` <span class="badge badge-info">FEI</span>` : ''}</td>
                <td>${h.vaccination_status || '<span class="badge badge-warning">Skontrolova≈•</span>'}</td>
                <td><span class="badge badge-${h.status === 'active' ? 'success' : 'gray'}">${h.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editHorse(${h.id})">‚úèÔ∏è</button> <button class="btn btn-sm btn-danger" onclick="deleteHorse(${h.id})">üóëÔ∏è</button></td>
            </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--gray)">≈Ωiadne kone</td></tr>';
    }

    function renderRiders() {
        const catLabels = {children:'Deti',pony:'Pony',junior:'Junior',young_rider:'Mlad√Ω jazdec',senior:'Senior',amateur:'Amat√©r'};
        const levelLabels = {beginner:'Zaƒçiatoƒçn√≠k',intermediate:'Pokroƒçil√Ω',advanced:'Sk√∫sen√Ω',competition:'S√∫≈•a≈æn√Ω'};
        const licLabels = {none:'Hobby',szvj:'SZVJ',national:'N√°rodn√°',international:'Medzin√°rodn√°'};
        document.getElementById('ridersTable').innerHTML = riders.map(r => `
            <tr>
                <td><strong>${r.first_name} ${r.last_name}</strong></td>
                <td><span class="badge badge-info">${catLabels[r.category] || r.category || '-'}</span></td>
                <td>${r.sjf_license_number || '-'}<br><small>${licLabels[r.sjf_license_type] || ''}</small></td>
                <td>${r.fei_id || '-'}</td>
                <td>${levelLabels[r.level] || '-'}</td>
                <td><span class="badge badge-${r.medical_certificate_valid ? 'success' : 'danger'}">${r.medical_certificate_valid ? 'Platn√©' : 'Neplatn√©'}</span></td>
                <td><span class="badge badge-${r.status === 'active' ? 'success' : 'gray'}">${r.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editRider(${r.id})">‚úèÔ∏è</button> <button class="btn btn-sm btn-danger" onclick="deleteRider(${r.id})">üóëÔ∏è</button></td>
            </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--gray)">≈Ωiadni jazdci</td></tr>';
    }

    function renderTrainers() {
        document.getElementById('trainersTable').innerHTML = trainers.map(t => `
            <tr>
                <td><strong>${t.first_name} ${t.last_name}</strong></td>
                <td>${t.sjf_trainer_level ? `${t.sjf_trainer_level}. stupe≈à` : '-'}</td>
                <td>${(t.specializations || []).join(', ') || '-'}</td>
                <td>${t.employment_type || '-'}</td>
                <td><span class="badge badge-${t.status === 'active' ? 'success' : 'gray'}">${t.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editTrainer(${t.id})">‚úèÔ∏è</button> <button class="btn btn-sm btn-danger" onclick="deleteTrainer(${t.id})">üóëÔ∏è</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">≈Ωiadni tr√©neri</td></tr>';
    }

    function renderEmployees() {
        document.getElementById('employeesTable').innerHTML = employees.map(e => `
            <tr>
                <td><strong>${e.first_name} ${e.last_name}</strong></td>
                <td>${e.position || '-'}</td>
                <td>${e.phone || '-'}</td>
                <td>${e.employment_type || '-'}</td>
                <td><span class="badge badge-${e.status === 'active' ? 'success' : 'gray'}">${e.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editEmployee(${e.id})">‚úèÔ∏è</button> <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${e.id})">üóëÔ∏è</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">≈Ωiadni zamestnanci</td></tr>';
    }

    function renderTrainings() {
        const typeLabels = {individual:'Individu√°lny',group:'Skupinov√Ω',longe:'Lon≈æovanie',jumping:'Skoky',dressage:'Drez√∫ra',cross_country:'Ter√©n',theory:'Te√≥ria',szvj_preparation:'SZVJ pr√≠prava',competition_prep:'Pr√≠prava preteky'};
        document.getElementById('trainingsTable').innerHTML = trainings.map(t => {
            const rider = riders.find(r => r.id === t.rider_id);
            const horse = horses.find(h => h.id === t.horse_id);
            const trainer = trainers.find(tr => tr.id === t.trainer_id);
            return `<tr>
                <td><strong>${t.date}</strong><br><small>${t.start_time}</small></td>
                <td>${rider ? `${rider.first_name} ${rider.last_name}` : '-'}</td>
                <td>${horse?.name || '-'}</td>
                <td>${trainer ? `${trainer.first_name} ${trainer.last_name}` : '-'}</td>
                <td>${typeLabels[t.training_type] || t.training_type || '-'}</td>
                <td><span class="badge badge-${t.status === 'completed' ? 'success' : t.status === 'cancelled' ? 'danger' : 'info'}">${t.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editTraining(${t.id})">‚úèÔ∏è</button> <button class="btn btn-sm btn-danger" onclick="deleteTraining(${t.id})">üóëÔ∏è</button></td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">≈Ωiadne tr√©ningy</td></tr>';
    }

    function renderPayments() {
        const typeLabels = {membership:'ƒålensk√©',training:'Tr√©ning',stabling:'Ustajnenie',competition:'Preteky',sjf_license:'SJF licencia',fei_registration:'FEI',vet_services:'Veterin√°r',other:'In√©'};
        document.getElementById('paymentsTable').innerHTML = payments.map(p => {
            const rider = riders.find(r => r.id === p.rider_id);
            return `<tr>
                <td>${p.payment_date || p.created_at?.split('T')[0] || '-'}</td>
                <td>${rider ? `${rider.first_name} ${rider.last_name}` : '-'}</td>
                <td>${typeLabels[p.payment_type] || p.payment_type || '-'}</td>
                <td>${p.description || '-'}</td>
                <td><strong>${p.amount} ‚Ç¨</strong></td>
                <td><span class="badge badge-${p.status === 'paid' ? 'success' : p.status === 'overdue' ? 'danger' : 'warning'}">${p.status}</span></td>
                <td><button class="btn btn-sm btn-danger" onclick="deletePayment(${p.id})">üóëÔ∏è</button></td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">≈Ωiadne platby</td></tr>';
    }

    function renderBookings() {
        document.getElementById('bookingsTable').innerHTML = bookings.map(b => `
            <tr>
                <td>${b.created_at?.split('T')[0] || '-'}</td>
                <td><strong>${b.name}</strong><br><small>${b.email}</small></td>
                <td>${b.service || '-'}</td>
                <td>${b.preferred_date || '-'} ${b.preferred_time || ''}</td>
                <td><span class="badge badge-${b.status === 'confirmed' ? 'success' : 'warning'}">${b.status}</span></td>
                <td><button class="btn btn-sm btn-primary" onclick="confirmBooking(${b.id})">‚úì</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">≈Ωiadne rezerv√°cie</td></tr>';
    }

    function renderMessages() {
        document.getElementById('messagesTable').innerHTML = messages.map(m => `
            <tr>
                <td>${m.created_at?.split('T')[0] || '-'}</td>
                <td><strong>${m.name}</strong></td>
                <td>${m.email}</td>
                <td style="max-width:300px;overflow:hidden;text-overflow:ellipsis">${m.message}</td>
                <td><span class="badge badge-${m.status === 'read' ? 'gray' : 'warning'}">${m.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="markMessageRead(${m.id})">üìñ</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">≈Ωiadne spr√°vy</td></tr>';
    }

    // Modal functions
    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // CRUD - Horses
    async function saveHorse() {
        const id = document.getElementById('horseId').value;
        const data = {
            name: document.getElementById('horseName').value,
            stable_name: document.getElementById('horseStableName').value,
            breed: document.getElementById('horseBreed').value,
            color: document.getElementById('horseColor').value,
            sex: document.getElementById('horseSex').value,
            birth_date: document.getElementById('horseBirth').value || null,
            height_cm: document.getElementById('horseHeight').value || null,
            weight_kg: document.getElementById('horseWeight').value || null,
            passport_number: document.getElementById('horsePassport').value,
            life_number: document.getElementById('horseLifeNumber').value,
            microchip: document.getElementById('horseMicrochip').value,
            fei_id: document.getElementById('horseFeiId').value,
            fei_passport_expiry: document.getElementById('horseFeiExpiry').value || null,
            sjf_license_number: document.getElementById('horseSjfLicense').value,
            sjf_license_valid_until: document.getElementById('horseSjfExpiry').value || null,
            owner_name: document.getElementById('horseOwner').value,
            level: document.getElementById('horseLevel').value,
            status: document.getElementById('horseStatus').value,
            disciplines: Array.from(document.querySelectorAll('.horseDiscipline:checked')).map(c => c.value),
            notes: document.getElementById('horseNotes').value
        };
        await api(id ? `horses/${id}` : 'horses', id ? 'PUT' : 'POST', data);
        closeModal('horseModal');
        showToast('K√¥≈à ulo≈æen√Ω!', 'success');
        horses = await api('horses');
        renderHorses();
        populateSelects();
    }

    function editHorse(id) {
        const h = horses.find(x => x.id === id);
        if (!h) return;
        document.getElementById('horseId').value = h.id;
        document.getElementById('horseName').value = h.name || '';
        document.getElementById('horseStableName').value = h.stable_name || '';
        document.getElementById('horseBreed').value = h.breed || '';
        document.getElementById('horseColor').value = h.color || '';
        document.getElementById('horseSex').value = h.sex || 'gelding';
        document.getElementById('horseBirth').value = h.birth_date?.split('T')[0] || '';
        document.getElementById('horseHeight').value = h.height_cm || '';
        document.getElementById('horseWeight').value = h.weight_kg || '';
        document.getElementById('horsePassport').value = h.passport_number || '';
        document.getElementById('horseLifeNumber').value = h.life_number || '';
        document.getElementById('horseMicrochip').value = h.microchip || '';
        document.getElementById('horseFeiId').value = h.fei_id || '';
        document.getElementById('horseFeiExpiry').value = h.fei_passport_expiry?.split('T')[0] || '';
        document.getElementById('horseSjfLicense').value = h.sjf_license_number || '';
        document.getElementById('horseSjfExpiry').value = h.sjf_license_valid_until?.split('T')[0] || '';
        document.getElementById('horseOwner').value = h.owner_name || '';
        document.getElementById('horseLevel').value = h.level || 'beginner';
        document.getElementById('horseStatus').value = h.status || 'active';
        document.getElementById('horseNotes').value = h.notes || '';
        document.querySelectorAll('.horseDiscipline').forEach(c => c.checked = (h.disciplines || []).includes(c.value));
        document.getElementById('horseModalTitle').textContent = 'Upravi≈• ko≈àa';
        openModal('horseModal');
    }

    async function deleteHorse(id) {
        if (!confirm('Naozaj vymaza≈• tohto ko≈àa?')) return;
        await api(`horses/${id}`, 'DELETE');
        showToast('K√¥≈à vymazan√Ω', 'success');
        horses = await api('horses');
        renderHorses();
        populateSelects();
    }

    // CRUD - Riders
    async function saveRider() {
        const id = document.getElementById('riderId').value;
        const data = {
            first_name: document.getElementById('riderFirstName').value,
            last_name: document.getElementById('riderLastName').value,
            birth_date: document.getElementById('riderBirth').value || null,
            gender: document.getElementById('riderGender').value,
            email: document.getElementById('riderEmail').value,
            phone: document.getElementById('riderPhone').value,
            sjf_license_number: document.getElementById('riderSjfLicense').value,
            sjf_license_type: document.getElementById('riderSjfType').value,
            sjf_license_valid_until: document.getElementById('riderSjfExpiry').value || null,
            szvj_date: document.getElementById('riderSzvjDate').value || null,
            fei_id: document.getElementById('riderFeiId').value,
            fei_license_valid_until: document.getElementById('riderFeiExpiry').value || null,
            category: document.getElementById('riderCategory').value,
            level: document.getElementById('riderLevel').value,
            medical_certificate_valid: document.getElementById('riderMedical').value === 'true',
            medical_certificate_expiry: document.getElementById('riderMedicalExpiry').value || null
        };
        await api(id ? `riders/${id}` : 'riders', id ? 'PUT' : 'POST', data);
        closeModal('riderModal');
        showToast('Jazdec ulo≈æen√Ω!', 'success');
        riders = await api('riders');
        renderRiders();
        populateSelects();
    }

    function editRider(id) {
        const r = riders.find(x => x.id === id);
        if (!r) return;
        document.getElementById('riderId').value = r.id;
        document.getElementById('riderFirstName').value = r.first_name || '';
        document.getElementById('riderLastName').value = r.last_name || '';
        document.getElementById('riderBirth').value = r.birth_date?.split('T')[0] || '';
        document.getElementById('riderGender').value = r.gender || 'female';
        document.getElementById('riderEmail').value = r.email || '';
        document.getElementById('riderPhone').value = r.phone || '';
        document.getElementById('riderSjfLicense').value = r.sjf_license_number || '';
        document.getElementById('riderSjfType').value = r.sjf_license_type || 'none';
        document.getElementById('riderSjfExpiry').value = r.sjf_license_valid_until?.split('T')[0] || '';
        document.getElementById('riderSzvjDate').value = r.szvj_date?.split('T')[0] || '';
        document.getElementById('riderFeiId').value = r.fei_id || '';
        document.getElementById('riderFeiExpiry').value = r.fei_license_valid_until?.split('T')[0] || '';
        document.getElementById('riderCategory').value = r.category || 'senior';
        document.getElementById('riderLevel').value = r.level || 'beginner';
        document.getElementById('riderMedical').value = r.medical_certificate_valid ? 'true' : 'false';
        document.getElementById('riderMedicalExpiry').value = r.medical_certificate_expiry?.split('T')[0] || '';
        document.getElementById('riderModalTitle').textContent = 'Upravi≈• jazdca';
        openModal('riderModal');
    }

    async function deleteRider(id) {
        if (!confirm('Naozaj vymaza≈• tohto jazdca?')) return;
        await api(`riders/${id}`, 'DELETE');
        showToast('Jazdec vymazan√Ω', 'success');
        riders = await api('riders');
        renderRiders();
        populateSelects();
    }

    // CRUD - Trainers
    async function saveTrainer() {
        const id = document.getElementById('trainerId').value;
        const data = {
            first_name: document.getElementById('trainerFirstName').value,
            last_name: document.getElementById('trainerLastName').value,
            email: document.getElementById('trainerEmail').value,
            phone: document.getElementById('trainerPhone').value,
            sjf_license_number: document.getElementById('trainerSjfLicense').value,
            sjf_trainer_level: parseInt(document.getElementById('trainerLevel').value),
            specializations: Array.from(document.querySelectorAll('.trainerSpec:checked')).map(c => c.value),
            employment_type: document.getElementById('trainerEmployment').value,
            hourly_rate: document.getElementById('trainerRate').value || null,
            bio: document.getElementById('trainerBio').value
        };
        await api(id ? `trainers/${id}` : 'trainers', id ? 'PUT' : 'POST', data);
        closeModal('trainerModal');
        showToast('Tr√©ner ulo≈æen√Ω!', 'success');
        trainers = await api('trainers');
        renderTrainers();
        populateSelects();
    }

    function editTrainer(id) {
        const t = trainers.find(x => x.id === id);
        if (!t) return;
        document.getElementById('trainerId').value = t.id;
        document.getElementById('trainerFirstName').value = t.first_name || '';
        document.getElementById('trainerLastName').value = t.last_name || '';
        document.getElementById('trainerEmail').value = t.email || '';
        document.getElementById('trainerPhone').value = t.phone || '';
        document.getElementById('trainerSjfLicense').value = t.sjf_license_number || '';
        document.getElementById('trainerLevel').value = t.sjf_trainer_level || '1';
        document.querySelectorAll('.trainerSpec').forEach(c => c.checked = (t.specializations || []).includes(c.value));
        document.getElementById('trainerEmployment').value = t.employment_type || 'full_time';
        document.getElementById('trainerRate').value = t.hourly_rate || '';
        document.getElementById('trainerBio').value = t.bio || '';
        openModal('trainerModal');
    }

    async function deleteTrainer(id) {
        if (!confirm('Naozaj vymaza≈• tohto tr√©nera?')) return;
        await api(`trainers/${id}`, 'DELETE');
        showToast('Tr√©ner vymazan√Ω', 'success');
        trainers = await api('trainers');
        renderTrainers();
        populateSelects();
    }

    // CRUD - Employees
    async function saveEmployee() {
        const id = document.getElementById('employeeId').value;
        const data = {
            first_name: document.getElementById('employeeFirstName').value,
            last_name: document.getElementById('employeeLastName').value,
            position: document.getElementById('employeePosition').value,
            email: document.getElementById('employeeEmail').value,
            phone: document.getElementById('employeePhone').value,
            employment_type: document.getElementById('employeeType').value
        };
        await api(id ? `employees/${id}` : 'employees', id ? 'PUT' : 'POST', data);
        closeModal('employeeModal');
        showToast('Zamestnanec ulo≈æen√Ω!', 'success');
        employees = await api('employees');
        renderEmployees();
        populateSelects();
    }

    function editEmployee(id) {
        const e = employees.find(x => x.id === id);
        if (!e) return;
        document.getElementById('employeeId').value = e.id;
        document.getElementById('employeeFirstName').value = e.first_name || '';
        document.getElementById('employeeLastName').value = e.last_name || '';
        document.getElementById('employeePosition').value = e.position || '';
        document.getElementById('employeeEmail').value = e.email || '';
        document.getElementById('employeePhone').value = e.phone || '';
        document.getElementById('employeeType').value = e.employment_type || 'full_time';
        openModal('employeeModal');
    }

    async function deleteEmployee(id) {
        if (!confirm('Naozaj vymaza≈• tohto zamestnanca?')) return;
        await api(`employees/${id}`, 'DELETE');
        showToast('Zamestnanec vymazan√Ω', 'success');
        employees = await api('employees');
        renderEmployees();
        populateSelects();
    }

    // CRUD - Trainings
    async function saveTraining() {
        const id = document.getElementById('trainingId').value;
        const data = {
            rider_id: parseInt(document.getElementById('trainingRider').value),
            horse_id: parseInt(document.getElementById('trainingHorse').value),
            trainer_id: parseInt(document.getElementById('trainingTrainer').value),
            date: document.getElementById('trainingDate').value,
            start_time: document.getElementById('trainingTime').value,
            training_type: document.getElementById('trainingType').value,
            duration_minutes: parseInt(document.getElementById('trainingDuration').value) || 60,
            price: document.getElementById('trainingPrice').value || null,
            notes: document.getElementById('trainingNotes').value
        };
        await api(id ? `trainings/${id}` : 'trainings', id ? 'PUT' : 'POST', data);
        closeModal('trainingModal');
        showToast('Tr√©ning ulo≈æen√Ω!', 'success');
        trainings = await api('trainings');
        renderTrainings();
        loadDashboard();
    }

    function editTraining(id) {
        const t = trainings.find(x => x.id === id);
        if (!t) return;
        document.getElementById('trainingId').value = t.id;
        document.getElementById('trainingDate').value = t.date;
        document.getElementById('trainingTime').value = t.start_time;
        document.getElementById('trainingRider').value = t.rider_id;
        document.getElementById('trainingHorse').value = t.horse_id;
        document.getElementById('trainingTrainer').value = t.trainer_id;
        document.getElementById('trainingType').value = t.training_type || 'individual';
        document.getElementById('trainingDuration').value = t.duration_minutes || 60;
        document.getElementById('trainingPrice').value = t.price || '';
        document.getElementById('trainingNotes').value = t.notes || '';
        openModal('trainingModal');
    }

    async function deleteTraining(id) {
        if (!confirm('Naozaj vymaza≈• tento tr√©ning?')) return;
        await api(`trainings/${id}`, 'DELETE');
        showToast('Tr√©ning vymazan√Ω', 'success');
        trainings = await api('trainings');
        renderTrainings();
        loadDashboard();
    }

    // CRUD - Payments
    async function savePayment() {
        const data = {
            rider_id: parseInt(document.getElementById('paymentRider').value),
            payment_type: document.getElementById('paymentType').value,
            amount: parseFloat(document.getElementById('paymentAmount').value),
            description: document.getElementById('paymentDescription').value,
            due_date: document.getElementById('paymentDue').value || null,
            status: document.getElementById('paymentStatus').value
        };
        await api('payments', 'POST', data);
        closeModal('paymentModal');
        showToast('Platba ulo≈æen√°!', 'success');
        payments = await api('payments');
        renderPayments();
    }

    async function deletePayment(id) {
        if (!confirm('Naozaj vymaza≈• t√∫to platbu?')) return;
        await api(`payments/${id}`, 'DELETE');
        showToast('Platba vymazan√°', 'success');
        payments = await api('payments');
        renderPayments();
    }

    // CRUD - Vet Records
    async function saveVetRecord() {
        const data = {
            horse_id: parseInt(document.getElementById('vetHorse').value),
            record_type: document.getElementById('vetType').value,
            date: document.getElementById('vetDate').value,
            next_due_date: document.getElementById('vetNextDate').value || null,
            veterinarian: document.getElementById('vetVeterinarian').value,
            vaccine_name: document.getElementById('vetVaccineName').value,
            vaccine_batch: document.getElementById('vetVaccineBatch').value,
            notes: document.getElementById('vetNotes').value,
            cost: document.getElementById('vetCost').value || null
        };
        await api('vet-records', 'POST', data);
        closeModal('vetModal');
        showToast('Veterin√°rny z√°znam ulo≈æen√Ω!', 'success');
        vetRecords = await api('vet-records').catch(() => []);
    }

    // CRUD - Feeding
    async function saveFeeding() {
        const data = {
            horse_id: parseInt(document.getElementById('feedHorse').value),
            date: document.getElementById('feedDate').value,
            feeding_time: document.getElementById('feedTime').value,
            fed_by: document.getElementById('feedBy').value || null,
            notes: document.getElementById('feedNotes').value
        };
        await api('feeding', 'POST', data);
        closeModal('feedingModal');
        showToast('Z√°znam k≈ïmenia ulo≈æen√Ω!', 'success');
    }

    // Bookings
    async function confirmBooking(id) {
        await api(`bookings/${id}`, 'PUT', {status: 'confirmed'});
        showToast('Rezerv√°cia potvrden√°', 'success');
        bookings = await api('bookings');
        renderBookings();
    }

    // Messages
    async function markMessageRead(id) {
        await api(`contact/${id}`, 'PUT', {status: 'read'});
        showToast('Oznaƒçen√© ako preƒç√≠tan√©', 'success');
        messages = await api('contact');
        renderMessages();
    }

    // Vet type change - show/hide vaccine fields
    document.getElementById('vetType')?.addEventListener('change', function() {
        const isVaccine = this.value.startsWith('vaccination');
        document.getElementById('vaccineFields').style.display = isVaccine ? 'block' : 'none';
    });

    // Toast
    function showToast(msg, type = '') {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.className = 'toast show ' + type;
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    // Set today's date
    document.getElementById('trainingDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('vetDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('feedDate').value = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>
