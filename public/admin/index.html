<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | JK ZelenÃ¡ mÃ­Ä¾a - ProfesionÃ¡lny systÃ©m</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#228B22;--primary-dark:#1a6b1a;--primary-light:#90EE90;--danger:#dc3545;--warning:#ffc107;--info:#17a2b8;--success:#28a745;--dark:#1a1a1a;--gray:#6c757d;--gray-light:#e9ecef;--light:#f8f9fa;--white:#fff;--shadow:0 2px 10px rgba(0,0,0,0.1);--radius:12px}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:var(--light);min-height:100vh;display:flex}
        .sidebar{width:280px;background:linear-gradient(180deg,var(--dark) 0%,#2d2d2d 100%);color:var(--white);padding:1.5rem;position:fixed;height:100vh;overflow-y:auto;z-index:100}
        .sidebar-header{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;padding-bottom:1.5rem;border-bottom:1px solid rgba(255,255,255,0.1)}
        .sidebar-header img{height:50px;filter:brightness(0) invert(1)}.sidebar-header h2{font-size:1rem;font-weight:600}
        .sidebar-header small{display:block;font-size:0.75rem;opacity:0.7;margin-top:0.25rem}
        .nav-section{margin-bottom:1.5rem}.nav-section-title{font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;opacity:0.5;margin-bottom:0.75rem;padding-left:0.5rem}
        .nav-item{display:flex;align-items:center;gap:0.75rem;padding:0.75rem 1rem;border-radius:var(--radius);cursor:pointer;transition:all 0.2s;margin-bottom:0.25rem;font-size:0.9rem}
        .nav-item:hover{background:rgba(255,255,255,0.1)}.nav-item.active{background:var(--primary);font-weight:500}
        .nav-item .icon{width:20px;text-align:center;font-size:1rem}.nav-item .badge{margin-left:auto;background:var(--danger);padding:0.15rem 0.5rem;border-radius:10px;font-size:0.7rem;font-weight:600}
        .main{margin-left:280px;flex:1;padding:2rem;min-height:100vh}
        .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}
        .header h1{font-size:1.75rem;color:var(--dark)}.header-actions{display:flex;gap:1rem;align-items:center}
        .btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.6rem 1.25rem;border-radius:var(--radius);font-weight:500;cursor:pointer;transition:all 0.2s;border:none;font-family:inherit;font-size:0.9rem}
        .btn-primary{background:var(--primary);color:var(--white)}.btn-primary:hover{background:var(--primary-dark)}
        .btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary)}.btn-outline:hover{background:var(--primary);color:var(--white)}
        .btn-danger{background:var(--danger);color:var(--white)}.btn-warning{background:var(--warning);color:var(--dark)}
        .btn-sm{padding:0.4rem 0.75rem;font-size:0.8rem}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-bottom:2rem}
        .stat-card{background:var(--white);padding:1.5rem;border-radius:var(--radius);box-shadow:var(--shadow)}
        .stat-card .icon{width:50px;height:50px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:1rem}
        .stat-card .icon.green{background:rgba(34,139,34,0.1);color:var(--primary)}
        .stat-card .icon.blue{background:rgba(23,162,184,0.1);color:var(--info)}
        .stat-card .icon.orange{background:rgba(255,193,7,0.1);color:#e67e00}
        .stat-card .icon.red{background:rgba(220,53,69,0.1);color:var(--danger)}
        .stat-card .value{font-size:2rem;font-weight:700;color:var(--dark)}.stat-card .label{color:var(--gray);font-size:0.85rem}
        .card{background:var(--white);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:1.5rem}
        .card-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--gray-light);display:flex;justify-content:space-between;align-items:center}
        .card-header h3{font-size:1.1rem;font-weight:600;color:var(--dark)}.card-body{padding:1.5rem}
        .table{width:100%;border-collapse:collapse}.table th,.table td{padding:0.875rem 1rem;text-align:left;border-bottom:1px solid var(--gray-light)}
        .table th{font-weight:600;color:var(--gray);font-size:0.8rem;text-transform:uppercase;letter-spacing:0.5px;background:var(--light)}
        .table tbody tr:hover{background:var(--light)}.table tbody tr:last-child td{border-bottom:none}
        .badge{display:inline-block;padding:0.3rem 0.75rem;border-radius:20px;font-size:0.75rem;font-weight:500}
        .badge-success{background:rgba(40,167,69,0.1);color:var(--success)}
        .badge-warning{background:rgba(255,193,7,0.2);color:#856404}
        .badge-danger{background:rgba(220,53,69,0.1);color:var(--danger)}
        .badge-info{background:rgba(23,162,184,0.1);color:var(--info)}
        .badge-gray{background:var(--gray-light);color:var(--gray)}
        .avatar{width:40px;height:40px;border-radius:50%;background:var(--primary);color:var(--white);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.9rem}
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;padding:1rem}
        .modal.active{display:flex}.modal-content{background:var(--white);border-radius:var(--radius);width:100%;max-width:700px;max-height:90vh;overflow-y:auto}
        .modal-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--gray-light);display:flex;justify-content:space-between;align-items:center}
        .modal-header h3{font-size:1.2rem}.modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--gray)}
        .modal-body{padding:1.5rem}.modal-footer{padding:1rem 1.5rem;border-top:1px solid var(--gray-light);display:flex;justify-content:flex-end;gap:0.75rem}
        .icon-option{cursor:pointer;padding:0.25rem;border-radius:4px;transition:background 0.2s}.icon-option:hover{background:var(--gray-light)}
        .form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.form-group{margin-bottom:1rem}
        .form-group label{display:block;margin-bottom:0.5rem;font-weight:500;color:var(--dark);font-size:0.9rem}
        .form-group label small{font-weight:400;color:var(--gray)}
        .form-control{width:100%;padding:0.7rem 1rem;border:2px solid var(--gray-light);border-radius:var(--radius);font-family:inherit;font-size:0.9rem;transition:border 0.2s}
        .form-control:focus{outline:none;border-color:var(--primary)}select.form-control{cursor:pointer}textarea.form-control{resize:vertical;min-height:80px}
        .tabs{display:flex;gap:0;border-bottom:2px solid var(--gray-light);margin-bottom:1.5rem}
        .tab{padding:0.875rem 1.5rem;cursor:pointer;color:var(--gray);font-weight:500;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all 0.2s;font-size:0.9rem}
        .tab:hover{color:var(--primary)}.tab.active{color:var(--primary);border-bottom-color:var(--primary)}
        .alert{padding:1rem 1.25rem;border-radius:var(--radius);margin-bottom:1rem;display:flex;align-items:center;gap:0.75rem}
        .alert-warning{background:rgba(255,193,7,0.15);color:#856404;border-left:4px solid var(--warning)}
        .alert-danger{background:rgba(220,53,69,0.1);color:var(--danger);border-left:4px solid var(--danger)}
        .alert-info{background:rgba(23,162,184,0.1);color:var(--info);border-left:4px solid var(--info)}
        .alert-success{background:rgba(40,167,69,0.1);color:var(--success);border-left:4px solid var(--success)}
        .toast{position:fixed;bottom:2rem;right:2rem;background:var(--dark);color:var(--white);padding:1rem 1.5rem;border-radius:var(--radius);transform:translateY(150%);opacity:0;transition:all 0.3s;z-index:9999}
        .toast.show{transform:translateY(0);opacity:1}.toast.success{background:var(--success)}.toast.error{background:var(--danger)}
        .section{display:none}.section.active{display:block}
        .search-box{position:relative}.search-box input{padding-left:2.5rem;width:250px}
        .search-box::before{content:'ğŸ”';position:absolute;left:0.75rem;top:50%;transform:translateY(-50%);font-size:0.9rem}
        .vet-timeline{position:relative;padding-left:2rem}.vet-timeline::before{content:'';position:absolute;left:0.5rem;top:0;bottom:0;width:2px;background:var(--gray-light)}
        .vet-item{position:relative;margin-bottom:1.5rem;padding:1rem;background:var(--light);border-radius:var(--radius)}
        .vet-item::before{content:'';position:absolute;left:-1.65rem;top:1rem;width:12px;height:12px;border-radius:50%;background:var(--primary);border:2px solid var(--white)}
        .vet-item.overdue::before{background:var(--danger)}.vet-item.soon::before{background:var(--warning)}
        .vet-item-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}
        .vet-item-title{font-weight:600;color:var(--dark)}.vet-item-date{font-size:0.85rem;color:var(--gray)}
        .quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:2rem}
        .quick-action{background:var(--white);padding:1.25rem;border-radius:var(--radius);text-align:center;cursor:pointer;transition:all 0.2s;box-shadow:var(--shadow)}
        .quick-action:hover{transform:translateY(-3px);box-shadow:0 5px 20px rgba(0,0,0,0.15)}
        .quick-action .icon{font-size:2rem;margin-bottom:0.5rem}.quick-action span{font-size:0.85rem;color:var(--gray)}
        .notifications-list{max-height:400px;overflow-y:auto}
        .notification-item{display:flex;gap:1rem;padding:1rem;border-bottom:1px solid var(--gray-light);transition:background 0.2s}
        .notification-item:hover{background:var(--light)}.notification-item:last-child{border-bottom:none}
        .notification-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .notification-icon.warning{background:rgba(255,193,7,0.2)}.notification-icon.danger{background:rgba(220,53,69,0.1)}
        .notification-icon.info{background:rgba(23,162,184,0.1)}
        .notification-content{flex:1}.notification-title{font-weight:500;color:var(--dark);margin-bottom:0.25rem}
        .notification-text{font-size:0.85rem;color:var(--gray)}.notification-time{font-size:0.75rem;color:var(--gray)}
        .progress-bar{height:8px;background:var(--gray-light);border-radius:4px;overflow:hidden}
        .progress-bar .fill{height:100%;border-radius:4px;transition:width 0.3s}
        .login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary),var(--primary-dark))}
        .login-box{background:var(--white);padding:2.5rem;border-radius:var(--radius);width:100%;max-width:400px;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
        .login-box h2{text-align:center;margin-bottom:2rem;color:var(--dark)}.login-box img{display:block;margin:0 auto 1.5rem;height:80px}
        @media(max-width:1024px){.sidebar{transform:translateX(-100%);transition:transform 0.3s}.sidebar.open{transform:translateX(0)}.main{margin-left:0}}
        .fieldset{border:1px solid var(--gray-light);border-radius:var(--radius);padding:1rem;margin-bottom:1rem}
        .fieldset legend{padding:0 0.5rem;font-weight:600;color:var(--primary);font-size:0.9rem}
        .horse-card{display:grid;grid-template-columns:100px 1fr;gap:1rem;padding:1rem;border:1px solid var(--gray-light);border-radius:var(--radius);margin-bottom:1rem}
        .horse-card img{width:100px;height:100px;object-fit:cover;border-radius:var(--radius)}
        .horse-card-info h4{margin-bottom:0.25rem}.horse-card-info p{font-size:0.85rem;color:var(--gray)}
        .horse-card-badges{display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:0.5rem}
    </style>
    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <style>
        .ql-container { font-size: 1rem; }
        .ql-editor { min-height: 200px; }
    </style>
</head>
<body>
    <!-- LOGIN PAGE -->
    <div id="loginPage" class="login-page">
        <div class="login-box">
            <img src="/assets/logo.png" alt="Logo">
            <h2>Admin Panel</h2>
            <p style="text-align:center;color:var(--gray);margin-bottom:1.5rem">JazdeckÃ½ klub ZelenÃ¡ mÃ­Ä¾a<br><small>ProfesionÃ¡lny systÃ©m podÄ¾a SJF/Å VPS/FEI</small></p>
            <form id="loginForm">
                <div class="form-group"><label>Email</label><input type="email" class="form-control" id="loginEmail" value="admin@jkzm.sk" required></div>
                <div class="form-group"><label>Heslo</label><input type="password" class="form-control" id="loginPassword" value="admin123" required></div>
                <button type="submit" class="btn btn-primary" style="width:100%;padding:0.875rem;margin-top:0.5rem">PrihlÃ¡siÅ¥ sa</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" style="display:none;width:100%">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="/assets/logo.png" alt="Logo">
                <div><h2>JK ZelenÃ¡ mÃ­Ä¾a</h2><small>Admin Panel PRO</small></div>
            </div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">PrehÄ¾ad</div>
                    <div class="nav-item active" data-section="dashboard"><span class="icon">ğŸ“Š</span>PrehÄ¾ad<span class="badge" id="alertBadge">0</span></div>
                    <div class="nav-item" data-section="tasks"><span class="icon">âœ“</span>Ãšlohy<span class="badge" id="tasksBadge">0</span></div>
                    <div class="nav-item" data-section="notifications"><span class="icon">ğŸ””</span>Upozornenia</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Evidencia</div>
                    <div class="nav-item" data-section="horses"><span class="icon">ğŸ´</span>Kone</div>
                    <div class="nav-item" data-section="riders"><span class="icon">ğŸ‡</span>Jazdci</div>
                    <div class="nav-item" data-section="trainers"><span class="icon">ğŸ‘¨â€ğŸ«</span>TrÃ©neri</div>
                    <div class="nav-item" data-section="employees"><span class="icon">ğŸ‘·</span>Zamestnanci</div>
                    <div class="nav-item" data-section="docs-central"><span class="icon">ğŸ“</span>Dokumenty</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">PrevÃ¡dzka</div>
                    <div class="nav-item" data-section="arenas"><span class="icon">ğŸŸï¸</span>ArÃ©ny a Äasy</div>
                    <div class="nav-item" data-section="bookings"><span class="icon">ğŸ‡</span>TrÃ©ningy</div>
                    <div class="nav-item" data-section="trainings"><span class="icon">ğŸ“</span>InternÃ© zÃ¡znamy</div>
                    <div class="nav-item" data-section="vet"><span class="icon">ğŸ¥</span>VeterinÃ¡rne zÃ¡znamy</div>
                    <div class="nav-item" data-section="feeding"><span class="icon">ğŸŒ¾</span>KÅ•menie</div>
                    <div class="nav-item" data-section="stable-log"><span class="icon">ğŸ“–</span>MaÅ¡taÄ¾nÃ¡ kniha</div>
                    <div class="nav-item" data-section="visit-log"><span class="icon">ğŸ“‹</span>NÃ¡vÅ¡tevnÃ¡ kniha</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Å port</div>
                    <div class="nav-item" data-section="competitions"><span class="icon">ğŸ†</span>Preteky</div>
                    <div class="nav-item" data-section="licenses"><span class="icon">ğŸ“‹</span>Licencie SJF / FEI</div>
                    <div class="nav-item" data-section="sjf-register"><span class="icon">ğŸ›ï¸</span>SJF Register</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Financie</div>
                    <div class="nav-item" data-section="payments"><span class="icon">ğŸ’³</span>Platby</div>
                    <div class="nav-item" data-section="memberships"><span class="icon">ğŸ«</span>ÄŒlenstvÃ¡</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Web</div>
                    <div class="nav-item" data-section="messages"><span class="icon">âœ‰ï¸</span>SprÃ¡vy</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Obsah webu</div>
                    <div class="nav-item" data-section="articles"><span class="icon">ğŸ“°</span>ÄŒlÃ¡nky</div>
                    <div class="nav-item" data-section="gallery"><span class="icon">ğŸ–¼ï¸</span>GalÃ©ria</div>
                    <div class="nav-item" data-section="pages"><span class="icon">ğŸ“„</span>StrÃ¡nky</div>
                    <div class="nav-item" data-section="documents"><span class="icon">ğŸ“</span>Dokumenty webu</div>
                    <div class="nav-item" data-section="partners"><span class="icon">ğŸ¤</span>Partneri</div>
                    <div class="nav-item" data-section="services"><span class="icon">ğŸ› ï¸</span>SluÅ¾by</div>
                    <div class="nav-item" data-section="web-settings"><span class="icon">âš™ï¸</span>Nastavenia</div>
                </div>
            </nav>
            <div style="margin-top:auto;padding-top:2rem;border-top:1px solid rgba(255,255,255,0.1)">
                <div class="nav-item" onclick="window.open('/','_blank')"><span class="icon">ğŸŒ</span>ZobraziÅ¥ web</div>
                <div class="nav-item" onclick="logout()"><span class="icon">ğŸšª</span>OdhlÃ¡siÅ¥</div>
                
                <div class="nav-section" style="margin-top:1rem">
                    <div class="nav-section-title">SystÃ©m</div>
                    <div class="nav-item" data-section="compliance"><span class="icon">ğŸ›¡ï¸</span>Compliance</div>
                    <div class="nav-item" data-section="audit-trail"><span class="icon">ğŸ“‹</span>Audit trail</div>
                    <div class="nav-item" data-section="exports"><span class="icon">ğŸ“„</span>Exporty</div>
                    <div class="nav-item" data-section="admin-users"><span class="icon">ğŸ‘¤</span>Admin pouÅ¾Ã­vatelia</div>
                </div>
            </div>
        </aside>

        <main class="main">
            <!-- DASHBOARD -->
            <section id="dashboard" class="section active">
                <div class="header"><h1>PrehÄ¾ad</h1><div class="header-actions"><span id="currentDate"></span></div></div>
                
                <div id="criticalAlerts"></div>
                
                <div class="stats-grid">
                    <div class="stat-card"><div class="icon green">ğŸ´</div><div class="value" id="statHorses">0</div><div class="label">AktÃ­vnych konÃ­</div></div>
                    <div class="stat-card"><div class="icon blue">ğŸ‡</div><div class="value" id="statRiders">0</div><div class="label">Jazdcov</div></div>
                    <div class="stat-card"><div class="icon orange">ğŸ“…</div><div class="value" id="statTrainings">0</div><div class="label">DneÅ¡nÃ½ch trÃ©ningov</div></div>
                    <div class="stat-card"><div class="icon red">âš ï¸</div><div class="value" id="statAlerts">0</div><div class="label">UpozornenÃ­</div></div>
                </div>

                <div class="quick-actions">
                    <div class="quick-action" onclick="showSection('trainings');openModal('trainingModal')"><div class="icon">â•</div><span>NovÃ½ trÃ©ning</span></div>
                    <div class="quick-action" onclick="showSection('vet');openModal('vetModal')"><div class="icon">ğŸ’‰</div><span>VeterinÃ¡rny zÃ¡znam</span></div>
                    <div class="quick-action" onclick="showSection('horses');openModal('horseModal')"><div class="icon">ğŸ´</div><span>PridaÅ¥ koÅˆa</span></div>
                    <div class="quick-action" onclick="showSection('riders');openModal('riderModal')"><div class="icon">ğŸ‘¤</div><span>PridaÅ¥ jazdca</span></div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ“… DneÅ¡nÃ© trÃ©ningy</h3></div>
                        <div class="card-body"><div id="todayTrainings"><p style="color:var(--gray)">NaÄÃ­tavam...</p></div></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>ğŸ”” BlÃ­Å¾iace sa termÃ­ny</h3></div>
                        <div class="card-body"><div id="upcomingDeadlines"><p style="color:var(--gray)">NaÄÃ­tavam...</p></div></div>
                    </div>
                </div>
            </section>

            <!-- HORSES -->
            <section id="horses" class="section">
                <div class="header"><h1>ğŸ´ Evidencia konÃ­</h1><div class="header-actions"><div class="search-box"><input type="text" class="form-control" placeholder="HÄ¾adaÅ¥..." id="searchHorses"></div><button class="btn btn-primary" onclick="openModal('horseModal')">+ PridaÅ¥ koÅˆa</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>Plemeno</th><th>Pas/UELN</th><th>ÄŒip</th><th>SJF/FEI</th><th>OÄkovanie</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="horsesTable"></tbody></table></div></div>
            </section>

            <!-- RIDERS -->
            <section id="riders" class="section">
                <div class="header"><h1>ğŸ‡ Evidencia jazdcov</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('riderModal')">+ PridaÅ¥ jazdca</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>KategÃ³ria</th><th>SJF licencia</th><th>FEI ID</th><th>ÃšroveÅˆ</th><th>Lek. potvrdenie</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="ridersTable"></tbody></table></div></div>
            </section>

            <!-- TRAINERS -->
            <section id="trainers" class="section">
                <div class="header"><h1>ğŸ‘¨â€ğŸ« TrÃ©neri</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('trainerModal')">+ PridaÅ¥ trÃ©nera</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>SJF stupeÅˆ</th><th>Å pecializÃ¡cia</th><th>Typ ÃºvÃ¤zku</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="trainersTable"></tbody></table></div></div>
            </section>

            <!-- EMPLOYEES -->
            <section id="employees" class="section">
                <div class="header"><h1>ğŸ‘· Zamestnanci</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('employeeModal')">+ PridaÅ¥</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>Meno</th><th>PozÃ­cia</th><th>TelefÃ³n</th><th>Typ</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="employeesTable"></tbody></table></div></div>
            </section>

            <!-- TRAININGS -->
            <section id="trainings" class="section">
                <div class="header"><h1>ğŸ“ InternÃ© zÃ¡znamy trÃ©ningov</h1><div class="header-actions"><input type="date" class="form-control" id="trainingDateFilter" style="width:auto"><button class="btn btn-primary" onclick="openModal('trainingModal')">+ PridaÅ¥ zÃ¡znam</button></div></div>
                <div class="alert alert-info" style="margin-bottom:1rem;font-size:0.9rem">
                    â„¹ï¸ Tu mÃ´Å¾ete evidovaÅ¥ trÃ©ningy registrovanÃ½ch jazdcov s koÅˆmi a trÃ©nermi z databÃ¡zy. Pre rezervÃ¡cie z webu pouÅ¾ite sekciu <strong>TrÃ©ningy</strong>.
                </div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>DÃ¡tum/ÄŒas</th><th>Jazdec</th><th>KÃ´Åˆ</th><th>TrÃ©ner</th><th>Typ</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="trainingsTable"></tbody></table></div></div>
            </section>

            <!-- VET RECORDS -->
            <section id="vet" class="section">
                <div class="header"><h1>ğŸ¥ VeterinÃ¡rne zÃ¡znamy</h1><div class="header-actions"><select class="form-control" id="vetHorseFilter" style="width:200px"><option value="">VÅ¡etky kone</option></select><button class="btn btn-primary" onclick="openModal('vetModal')">+ PridaÅ¥ zÃ¡znam</button></div></div>
                
                <div class="stats-grid" style="margin-bottom:1.5rem">
                    <div class="stat-card" style="border-left:4px solid var(--danger)"><div class="value" id="vetOverdue">0</div><div class="label">Po termÃ­ne</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="value" id="vetSoon">0</div><div class="label">Do 30 dnÃ­</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--success)"><div class="value" id="vetOk">0</div><div class="label">V poriadku</div></div>
                </div>

                <div class="tabs" style="margin-bottom:1rem">
                    <div class="tab active" data-vet-tab="records">VÅ¡etky zÃ¡znamy</div>
                    <div class="tab" data-vet-tab="vaccinations">OÄkovania</div>
                    <div class="tab" data-vet-tab="deworming">OdÄervenie</div>
                    <div class="tab" data-vet-tab="farrier">KovÃ¡Ä</div>
                    <div class="tab" data-vet-tab="dental">ZubÃ¡r</div>
                    <div class="tab" data-vet-tab="treatment">LieÄba / Ãºraz</div>
                </div>

                <div id="vetRecordsTab" class="card">
                    <div class="card-header"><h3>VeterinÃ¡rne zÃ¡znamy</h3></div>
                    <div class="card-body"><table class="table"><thead><tr><th>KÃ´Åˆ</th><th>Typ</th><th>DÃ¡tum</th><th>ÄalÅ¡Ã­ termÃ­n</th><th>VeterinÃ¡r</th><th>PoznÃ¡mka</th><th>Akcie</th></tr></thead><tbody id="vetTable"></tbody></table></div>
                </div>

                <div id="vaccinationsTab" class="card" style="display:none">
                    <div class="card-header"><h3>OÄkovania</h3><button class="btn btn-sm btn-primary" onclick="openVaccinationModal()">+ PridaÅ¥ oÄkovanie</button></div>
                    <div class="card-body"><table class="table"><thead><tr><th>KÃ´Åˆ</th><th>Typ vakcÃ­ny</th><th>DÃ¡tum</th><th>ÄalÅ¡Ã­ termÃ­n</th><th>Å arÅ¾a</th><th>VeterinÃ¡r</th><th>Akcie</th></tr></thead><tbody id="vaccinationsTable"></tbody></table></div>
                </div>
            </section>

            <!-- FEEDING -->
            <section id="feeding" class="section">
                <div class="header"><h1>ğŸŒ¾ KÅ•menie</h1><div class="header-actions"><input type="date" class="form-control" id="feedingDate" style="width:auto"><button class="btn btn-primary" onclick="openModal('feedingModal')">+ PridaÅ¥ zÃ¡znam</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>KÃ´Åˆ</th><th>DÃ¡tum</th><th>ÄŒas</th><th>KÅ•mil</th><th>PoznÃ¡mka</th><th>PoloÅ¾ky</th><th>Akcie</th></tr></thead><tbody id="feedingTable"></tbody></table></div></div>
            </section>

            <!-- MAÅ TAÄ½NÃ KNIHA -->
            <section id="stable-log" class="section">
                <div class="header">
                    <h1>ğŸ“– MaÅ¡taÄ¾nÃ¡ kniha</h1>
                    <div class="header-actions">
                        <input type="date" class="form-control" id="stableLogFrom" style="width:auto">
                        <input type="date" class="form-control" id="stableLogTo" style="width:auto">
                        <select class="form-control" id="stableLogType" style="width:180px">
                            <option value="">VÅ¡etky typy</option>
                            <option value="arrival">PrÃ­jem koÅˆa</option>
                            <option value="departure">Odchod koÅˆa</option>
                            <option value="transfer">DoÄasnÃ½ presun</option>
                            <option value="return">NÃ¡vrat koÅˆa</option>
                            <option value="quarantine_start">KarantÃ©na</option>
                            <option value="quarantine_end">UkonÄenie karantÃ©ny</option>
                            <option value="death">Ãšhyn</option>
                        </select>
                        <select class="form-control" id="stableLogHorse" style="width:150px"><option value="">VÅ¡etky kone</option></select>
                        <button class="btn btn-outline" onclick="filterStableLog()">FiltrovaÅ¥</button>
                        <button class="btn btn-outline" onclick="printStableLog()">ğŸ–¨ï¸ TlaÄ</button>
                        <button class="btn btn-primary" onclick="openStableLogModal()">+ PridaÅ¥ zÃ¡znam</button>
                    </div>
                </div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>DÃ¡tum</th><th>KÃ´Åˆ</th><th>Typ udalosti</th><th>Miesto</th><th>ZodpovednÃ¡ osoba</th><th>PoznÃ¡mka</th><th>Akcie</th></tr></thead><tbody id="stableLogTable"></tbody></table></div></div>
            </section>

            <!-- NÃVÅ TEVNÃ KNIHA -->
            <section id="visit-log" class="section">
                <div class="header">
                    <h1>ğŸ“‹ NÃ¡vÅ¡tevnÃ¡ kniha</h1>
                    <div class="header-actions">
                        <input type="date" class="form-control" id="visitLogFrom" style="width:auto">
                        <input type="date" class="form-control" id="visitLogTo" style="width:auto">
                        <input type="text" class="form-control" id="visitLogSearch" placeholder="HÄ¾adaÅ¥..." style="width:150px">
                        <button class="btn btn-outline" onclick="filterVisitLog()">FiltrovaÅ¥</button>
                        <button class="btn btn-outline" onclick="printVisitLog()">ğŸ–¨ï¸ TlaÄ</button>
                        <button class="btn btn-primary" onclick="openVisitLogModal()">+ PridaÅ¥ zÃ¡znam</button>
                    </div>
                </div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>DÃ¡tum/ÄŒas</th><th>NÃ¡vÅ¡tevnÃ­k</th><th>OrganizÃ¡cia</th><th>ÃšÄel</th><th>Sprievod</th><th>Odchod</th><th>BOZP</th><th>Akcie</th></tr></thead><tbody id="visitLogTable"></tbody></table></div></div>
            </section>

            <!-- CENTRÃLNE DOKUMENTY -->
            <section id="docs-central" class="section">
                <div class="header">
                    <h1>ğŸ“ Dokumenty</h1>
                    <div class="header-actions">
                        <input type="date" class="form-control" id="docsFrom" style="width:auto">
                        <input type="date" class="form-control" id="docsTo" style="width:auto">
                        <select class="form-control" id="docsCategory" style="width:150px">
                            <option value="">VÅ¡etky kategÃ³rie</option>
                            <option value="passport">Pas koÅˆa</option>
                            <option value="vet_doc">VeterinÃ¡rny doklad</option>
                            <option value="death">Ãšhyn</option>
                            <option value="rendering">KafilÃ©ria</option>
                            <option value="license">Licencia</option>
                            <option value="receipt">PrÃ­jemka</option>
                            <option value="request">Å½iadanka</option>
                            <option value="mail">PoÅ¡ta</option>
                            <option value="contract">Zmluva</option>
                            <option value="other">InÃ©</option>
                        </select>
                        <input type="text" class="form-control" id="docsSearch" placeholder="HÄ¾adaÅ¥..." style="width:150px">
                        <button class="btn btn-outline" onclick="filterDocs()">FiltrovaÅ¥</button>
                        <button class="btn btn-outline" onclick="printDocs()">ğŸ–¨ï¸ TlaÄ</button>
                        <button class="btn btn-primary" onclick="openDocModal()">+ PridaÅ¥ dokument</button>
                    </div>
                </div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>DÃ¡tum</th><th>NÃ¡zov</th><th>KategÃ³ria</th><th>VÃ¤zba</th><th>SÃºbor</th><th>Akcie</th></tr></thead><tbody id="docsTable"></tbody></table></div></div>
            </section>

            <!-- COMPETITIONS -->
            <section id="competitions" class="section">
                <div class="header"><h1>ğŸ† Preteky a sÃºÅ¥aÅ¾e</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('competitionModal')">+ PridaÅ¥ preteky</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>NÃ¡zov</th><th>DÃ¡tum</th><th>Miesto</th><th>DisciplÃ­na</th><th>Typ</th><th>UzÃ¡vierka</th><th>Akcie</th></tr></thead><tbody id="competitionsTable"></tbody></table></div></div>
            </section>

            <!-- LICENSES -->
            <section id="licenses" class="section">
                <div class="header"><h1>ğŸ“‹ Licencie SJF/FEI</h1></div>
                <div class="tabs"><div class="tab active" data-tab="licRiders">Jazdci</div><div class="tab" data-tab="licHorses">Kone</div><div class="tab" data-tab="licTrainers">TrÃ©neri</div></div>
                <div class="card"><div class="card-body" id="licensesContent"><p>Vyberte kategÃ³riu</p></div></div>
            </section>

            <!-- SJF REGISTER -->
            <section id="sjf-register" class="section">
                <div class="header"><h1>ğŸ›ï¸ SJF Register</h1><small style="color:var(--muted)">DÃ¡ta z evidencia.sjf.sk</small></div>
                <div class="tabs">
                    <div class="tab active" data-tab="sjfClubs">Kluby</div>
                    <div class="tab" data-tab="sjfPersons">Osoby</div>
                    <div class="tab" data-tab="sjfLegend">ğŸ“– Vysvetlivky</div>
                </div>
                <div class="card" style="margin-bottom:1rem">
                    <div class="card-body" style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center">
                        <input type="text" id="sjfSearch" placeholder="ğŸ” HÄ¾adaÅ¥ meno, klub..." style="flex:1;min-width:200px;padding:0.5rem;border:1px solid var(--border);border-radius:var(--radius)">
                        <select id="sjfRegion" style="padding:0.5rem;border:1px solid var(--border);border-radius:var(--radius)">
                            <option value="">VÅ¡etky regiÃ³ny</option>
                            <option value="B">BratislavskÃ½ (B)</option>
                            <option value="Z">ZÃ¡padnÃ© Slovensko (Z)</option>
                            <option value="S">StrednÃ© Slovensko (S)</option>
                            <option value="V">VÃ½chodnÃ© Slovensko (V)</option>
                        </select>
                        <select id="sjfRole" style="padding:0.5rem;border:1px solid var(--border);border-radius:var(--radius);display:none">
                            <option value="">VÅ¡etky osoby</option>
                            <option value="judge">Rozhodcovia</option>
                            <option value="trainer">TrÃ©neri</option>
                            <option value="builder">Stavitelia parkÃºrov</option>
                            <option value="steward">Stewardi</option>
                        </select>
                        <select id="sjfStatus" style="padding:0.5rem;border:1px solid var(--border);border-radius:var(--radius)">
                            <option value="">VÅ¡etky statusy</option>
                            <option value="AktÃ­vny">AktÃ­vny</option>
                            <option value="NeaktÃ­vny">NeaktÃ­vny</option>
                        </select>
                    </div>
                </div>
                <div class="card"><div class="card-body" id="sjfContent"><p>NaÄÃ­tavam...</p></div></div>
            </section>

            <!-- PAYMENTS -->
            <section id="payments" class="section">
                <div class="header"><h1>ğŸ’³ Platby</h1><div class="header-actions"><button class="btn btn-primary" onclick="openModal('paymentModal')">+ NovÃ¡ platba</button></div></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>DÃ¡tum</th><th>Jazdec</th><th>Typ</th><th>Popis</th><th>Suma</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="paymentsTable"></tbody></table></div></div>
            </section>

            <!-- MEMBERSHIPS -->
            <section id="memberships" class="section">
                <div class="header"><h1>ğŸ« ÄŒlenstvÃ¡</h1></div>
                <div class="card"><div class="card-body"><p style="color:var(--gray)">Modul ÄlenstvÃ¡ - v prÃ­prave</p></div></div>
            </section>

            <!-- TASKS / ÃšLOHY -->
            <section id="tasks" class="section">
                <div class="header">
                    <h1>Ãšlohy</h1>
                    <div class="header-actions">
                        <select class="form-control" id="taskStatusFilter" style="width:150px">
                            <option value="">VÅ¡etky</option>
                            <option value="pending" selected>ÄŒakajÃºce</option>
                            <option value="in_progress">RozpracovanÃ©</option>
                            <option value="completed">DokonÄenÃ©</option>
                        </select>
                        <select class="form-control" id="taskPriorityFilter" style="width:120px">
                            <option value="">VÅ¡etky priority</option>
                            <option value="high">VysokÃ¡</option>
                            <option value="normal">NormÃ¡lna</option>
                            <option value="low">NÃ­zka</option>
                        </select>
                        <button class="btn btn-outline" onclick="loadTasks()">ObnoviÅ¥</button>
                        <button class="btn btn-primary" onclick="openTaskModal()">+ PridaÅ¥ Ãºlohu</button>
                    </div>
                </div>
                
                <div class="stats-grid" style="margin-bottom:1.5rem">
                    <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="value" id="tasksPending">0</div><div class="label">ÄŒakajÃºcich</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--primary)"><div class="value" id="tasksInProgress">0</div><div class="label">RozpracovanÃ½ch</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--danger)"><div class="value" id="tasksOverdue">0</div><div class="label">Po termÃ­ne</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--success)"><div class="value" id="tasksCompleted">0</div><div class="label">DokonÄenÃ½ch</div></div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Priorita</th>
                                    <th>Ãšloha</th>
                                    <th>KategÃ³ria</th>
                                    <th>VÃ¤zba</th>
                                    <th>TermÃ­n</th>
                                    <th>PriradenÃ©</th>
                                    <th>Status</th>
                                    <th>Akcie</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- NOTIFICATIONS / UPOZORNENIA -->
            <section id="notifications" class="section">
                <div class="header">
                    <h1>Upozornenia</h1>
                    <div class="header-actions">
                        <button class="btn btn-outline" onclick="runNotificationRules()">ObnoviÅ¥ upozornenia</button>
                        <button class="btn btn-primary" onclick="openNotificationModal()">+ PridaÅ¥ upozornenie</button>
                    </div>
                </div>
                
                <div class="stats-grid" style="margin-bottom:1.5rem">
                    <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="value" id="pendingNotifications">0</div><div class="label">NepreÄÃ­tanÃ½ch</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--danger)"><div class="value" id="urgentNotifications">0</div><div class="label">VysokÃ¡ priorita</div></div>
                    <div class="stat-card" style="border-left:4px solid var(--info)"><div class="value" id="systemNotifications">0</div><div class="label">SystÃ©movÃ½ch</div></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Zoznam upozornenÃ­</h3>
                        <select id="notificationStatusFilter" class="form-control" style="width:auto" onchange="loadNotifications()">
                            <option value="">VÅ¡etky</option>
                            <option value="pending" selected>AktÃ­vne</option>
                            <option value="completed">VyrieÅ¡enÃ©</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Zdroj</th>
                                    <th>NÃ¡zov</th>
                                    <th>Priorita</th>
                                    <th>VÃ¤zba</th>
                                    <th>TermÃ­n</th>
                                    <th>Status</th>
                                    <th>Akcie</th>
                                </tr>
                            </thead>
                            <tbody id="notificationsTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ARÃ‰NY A ÄŒASOVÃ‰ SLOTY -->
            <section id="arenas" class="section">
                <div class="header">
                    <h1>ğŸŸï¸ ArÃ©ny a rozvrhy</h1>
                    <button class="btn btn-primary" onclick="openArenaModal()">+ NovÃ¡ arÃ©na</button>
                </div>
                
                <div class="stats-grid" style="margin-bottom:1.5rem">
                    <div class="stat-card"><div class="icon green">ğŸŸï¸</div><div class="value" id="totalArenas">0</div><div class="label">ArÃ©n</div></div>
                    <div class="stat-card"><div class="icon blue">ğŸ“…</div><div class="value" id="todayReservations">0</div><div class="label">DneÅ¡nÃ½ch rezervÃ¡ciÃ­</div></div>
                    <div class="stat-card"><div class="icon orange">â³</div><div class="value" id="pendingReservations">0</div><div class="label">ÄŒakajÃºcich</div></div>
                </div>

                <div class="card">
                    <div class="card-header"><h3>TrÃ©ningovÃ© priestory</h3></div>
                    <div class="card-body" id="arenasContainer">
                        <p style="color:var(--gray);text-align:center;padding:2rem">NaÄÃ­tavam...</p>
                    </div>
                </div>
            </section>

            <!-- BOOKINGS -->
            <section id="bookings" class="section">
                <div class="header">
                    <h1>ğŸ‡ TrÃ©ningy / Jazdenia</h1>
                    <div class="header-actions">
                        <select id="reservationArenaFilter" class="form-control" style="width:auto;display:inline-block;margin-right:0.5rem">
                            <option value="">VÅ¡etky arÃ©ny</option>
                        </select>
                        <select id="reservationStatusFilter" class="form-control" style="width:auto;display:inline-block;margin-right:0.5rem">
                            <option value="">VÅ¡etky stavy</option>
                            <option value="pending">ÄŒakajÃºce</option>
                            <option value="confirmed">PotvrdenÃ©</option>
                            <option value="cancelled">ZruÅ¡enÃ©</option>
                            <option value="completed">DokonÄenÃ©</option>
                        </select>
                        <input type="date" id="reservationDateFrom" class="form-control" style="width:auto;display:inline-block;margin-right:0.5rem">
                        <input type="date" id="reservationDateTo" class="form-control" style="width:auto;display:inline-block">
                        <button class="btn btn-outline" onclick="loadReservations()" style="margin-left:0.5rem">ğŸ”„</button>
                    </div>
                </div>
                
                <div class="alert alert-info" style="margin-bottom:1rem;font-size:0.9rem">
                    ğŸ’¡ <strong>Tip:</strong> Klikni na Ä¾ubovoÄ¾nÃº bunku v kalendÃ¡ri pre zobrazenie detailu - kto je prihlÃ¡senÃ½ na danÃ½ deÅˆ.
                </div>
                
                <div class="card">
                    <div class="card-header"><h3>ğŸ“‹ Zoznam trÃ©ningov</h3></div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>DÃ¡tum</th>
                                    <th>ÄŒas</th>
                                    <th>ArÃ©na</th>
                                    <th>Meno</th>
                                    <th>Kontakt</th>
                                    <th>Jazdcov</th>
                                    <th>Typ</th>
                                    <th>Status</th>
                                    <th>Akcie</th>
                                </tr>
                            </thead>
                            <tbody id="reservationsTable">
                                <tr><td colspan="9" style="text-align:center;color:var(--gray)">NaÄÃ­tavam...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- KalendÃ¡rovÃ½ prehÄ¾ad -->
                <div class="card" style="margin-top:1.5rem">
                    <div class="card-header">
                        <h3>ğŸ“… TÃ½Å¾dennÃ½ prehÄ¾ad trÃ©ningov</h3>
                        <div style="display:flex;gap:0.5rem;align-items:center">
                            <button class="btn btn-sm btn-outline" onclick="changeWeek(-1)">â—€ PredoÅ¡lÃ½</button>
                            <span id="weekLabel" style="font-weight:500;min-width:200px;text-align:center"></span>
                            <button class="btn btn-sm btn-outline" onclick="changeWeek(1)">NasledujÃºci â–¶</button>
                        </div>
                    </div>
                    <div class="card-body" id="reservationsCalendar" style="overflow-x:auto"></div>
                </div>
            </section>

            <!-- MESSAGES -->
            <section id="messages" class="section">
                <div class="header"><h1>âœ‰ï¸ SprÃ¡vy z webu</h1></div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>DÃ¡tum</th><th>Meno</th><th>Email</th><th>SprÃ¡va</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="messagesTable"></tbody></table></div></div>
            </section>

            <!-- ÄŒLÃNKY -->
            <section id="articles" class="section">
                <div class="header">
                    <h1>ğŸ“° ÄŒlÃ¡nky a novinky</h1>
                    <div class="header-actions">
                        <select id="articleCategoryFilter" style="padding:0.5rem;border:1px solid var(--border);border-radius:var(--radius);margin-right:0.5rem">
                            <option value="">VÅ¡etky kategÃ³rie</option>
                        </select>
                        <select id="articleStatusFilter" style="padding:0.5rem;border:1px solid var(--border);border-radius:var(--radius);margin-right:0.5rem">
                            <option value="">VÅ¡etky</option>
                            <option value="published">PublikovanÃ©</option>
                            <option value="draft">Koncepty</option>
                        </select>
                        <button class="btn btn-primary" onclick="openArticleModal()">+ PridaÅ¥ ÄlÃ¡nok</button>
                    </div>
                </div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>NÃ¡zov</th><th>KategÃ³ria</th><th>Autor</th><th>Status</th><th>DÃ¡tum</th><th>Zobrazenia</th><th>Akcie</th></tr></thead><tbody id="articlesTable"></tbody></table></div></div>
            </section>

            <!-- GALÃ‰RIA -->
            <section id="gallery" class="section">
                <div class="header">
                    <h1>ğŸ–¼ï¸ GalÃ©ria</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="openAlbumModal()">+ PridaÅ¥ album</button>
                    </div>
                </div>
                <div id="albumsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem"></div>
            </section>

            <!-- STRÃNKY -->
            <section id="pages" class="section">
                <div class="header">
                    <h1>ğŸ“„ StrÃ¡nky</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openPageModal()">+ PridaÅ¥ strÃ¡nku</button>
                    </div>
                </div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>NÃ¡zov</th><th>URL</th><th>Å ablÃ³na</th><th>V menu</th><th>Status</th><th>Akcie</th></tr></thead><tbody id="pagesTable"></tbody></table></div></div>
            </section>

            <!-- DOKUMENTY -->
            <section id="documents" class="section">
                <div class="header">
                    <h1>ğŸ“ Dokumenty</h1>
                    <div class="header-actions">
                        <select id="docCategoryFilter" style="padding:0.5rem;border:1px solid var(--border);border-radius:var(--radius);margin-right:0.5rem">
                            <option value="">VÅ¡etky kategÃ³rie</option>
                            <option value="prihlÃ¡Å¡ky">PrihlÃ¡Å¡ky</option>
                            <option value="pravidlÃ¡">PravidlÃ¡</option>
                            <option value="vÃ½sledky">VÃ½sledky</option>
                            <option value="inÃ©">InÃ©</option>
                        </select>
                        <button class="btn btn-primary" onclick="openDocumentModal()">+ PridaÅ¥ dokument</button>
                    </div>
                </div>
                <div class="card"><div class="card-body"><table class="table"><thead><tr><th>NÃ¡zov</th><th>KategÃ³ria</th><th>SÃºbor</th><th>VeÄ¾kosÅ¥</th><th>Stiahnutia</th><th>Akcie</th></tr></thead><tbody id="documentsTable"></tbody></table></div></div>
            </section>

            <!-- PARTNERI -->
            <section id="partners" class="section">
                <div class="header">
                    <h1>ğŸ¤ Partneri a sponzori</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openPartnerModal()">+ PridaÅ¥ partnera</button>
                    </div>
                </div>
                <div id="partnersGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem"></div>
            </section>

            <!-- SLUÅ½BY -->
            <section id="services" class="section">
                <div class="header">
                    <h1>ğŸ› ï¸ SluÅ¾by</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openServiceModal()">+ NovÃ¡ sluÅ¾ba</button>
                    </div>
                </div>
                <div id="servicesGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem"></div>
            </section>

            <!-- WEB NASTAVENIA -->
            <section id="web-settings" class="section">
                <div class="header"><h1>âš™ï¸ Nastavenia webu</h1></div>
                <div class="tabs" style="margin-bottom:1rem">
                    <div class="tab active" data-settings-tab="general">VÅ¡eobecnÃ©</div>
                    <div class="tab" data-settings-tab="contact">Kontakt</div>
                    <div class="tab" data-settings-tab="social">SociÃ¡lne siete</div>
                </div>
                <div class="card">
                    <div class="card-body" id="settingsContent">
                        <div id="settingsGeneral" class="settings-tab-content active">
                            <div class="form-group"><label>NÃ¡zov klubu</label><input type="text" class="form-control" id="setting_site_name"></div>
                            <div class="form-group"><label>Popis</label><textarea class="form-control" id="setting_site_description" rows="3"></textarea></div>
                        </div>
                        <div id="settingsContact" class="settings-tab-content" style="display:none">
                            <div class="alert alert-info">Tieto Ãºdaje sa zobrazia v sekcii Kontakt na hlavnej strÃ¡nke.</div>
                            <div class="form-row">
                                <div class="form-group"><label>ğŸ“§ Email</label><input type="email" class="form-control" id="setting_contact_email" placeholder="apilera@apilera.com"></div>
                                <div class="form-group"><label>ğŸ“ TelefÃ³n</label><input type="text" class="form-control" id="setting_contact_phone" placeholder="+421905523022"></div>
                            </div>
                            <div class="form-group"><label>ğŸ“ Adresa <small>(mÃ´Å¾e byÅ¥ viacriadkovÃ¡)</small></label><textarea class="form-control" id="setting_contact_address" rows="3" placeholder="SÃ­dlo: ...&#10;PrevÃ¡dzka: ..."></textarea></div>
                            <div class="form-group"><label>ğŸ—ºï¸ Google Maps Embed <small>(celÃ½ iframe kÃ³d)</small></label><textarea class="form-control" id="setting_google_maps_embed" rows="4" placeholder='<iframe src="https://maps.google.com/maps?q=...&output=embed"></iframe>'></textarea></div>
                        </div>
                        <div id="settingsSocial" class="settings-tab-content" style="display:none">
                            <div class="form-group"><label>ğŸ“˜ Facebook URL</label><input type="url" class="form-control" id="setting_social_facebook" placeholder="https://www.facebook.com/..."></div>
                            <div class="form-group"><label>ğŸ“· Instagram URL</label><input type="url" class="form-control" id="setting_social_instagram" placeholder="https://www.instagram.com/..."></div>
                            <div class="form-group"><label>ğŸ¬ YouTube URL</label><input type="url" class="form-control" id="setting_social_youtube" placeholder="https://www.youtube.com/..."></div>
                        </div>
                        <div style="margin-top:1.5rem;display:flex;gap:1rem;align-items:center">
                            <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ UloÅ¾iÅ¥ nastavenia</button>
                            <button class="btn btn-outline" onclick="loadSettings()">ğŸ”„ ObnoviÅ¥</button>
                            <span id="settingsStatus" style="color:var(--gray);font-size:0.85rem"></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- COMPLIANCE DASHBOARD -->
            <section id="compliance" class="section">
                <div class="header">
                    <h1>ğŸ›¡ï¸ Compliance</h1>
                    <p style="margin:0;color:var(--gray)">Kontrola zÃ¡konnÃ½ch povinnostÃ­ a termÃ­nov</p>
                </div>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:1.5rem">
                    <div class="card">
                        <div class="card-header" style="background:rgba(255,193,7,0.1)">
                            <h3>âš ï¸ ExpirÃ¡cia licenciÃ­ (do 60 dnÃ­)</h3>
                        </div>
                        <div class="card-body" id="complianceHorseLicenses">
                            <p style="color:var(--gray)">NaÄÃ­tavam...</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" style="background:rgba(220,53,69,0.1)">
                            <h3>ğŸ’‰ ExpirÃ¡cia oÄkovanÃ­ (do 30 dnÃ­)</h3>
                        </div>
                        <div class="card-body" id="complianceVaccinations">
                            <p style="color:var(--gray)">NaÄÃ­tavam...</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" style="background:rgba(255,152,0,0.1)">
                            <h3>ğŸ“„ ChÃ½bajÃºce dokumenty</h3>
                        </div>
                        <div class="card-body" id="complianceMissingDocs">
                            <p style="color:var(--gray)">NaÄÃ­tavam...</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" style="background:rgba(156,39,176,0.1)">
                            <h3>ğŸ”’ Kone v karantÃ©ne</h3>
                        </div>
                        <div class="card-body" id="complianceQuarantine">
                            <p style="color:var(--gray)">NaÄÃ­tavam...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AUDIT TRAIL -->
            <section id="audit-trail" class="section">
                <div class="header">
                    <h1>Audit trail</h1>
                    <div class="header-actions">
                        <button class="btn btn-outline" onclick="printAuditTrail()">Tlac</button>
                        <button class="btn btn-outline" onclick="loadAuditLogs()">Obnovit</button>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom:1rem">
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Od</label>
                                <input type="date" class="form-control" id="auditFromDate">
                            </div>
                            <div class="form-group">
                                <label>Do</label>
                                <input type="date" class="form-control" id="auditToDate">
                            </div>
                            <div class="form-group">
                                <label>Entita</label>
                                <select class="form-control" id="auditEntityFilter">
                                    <option value="">Vsetky</option>
                                    <option value="horses">Kone</option>
                                    <option value="riders">Jazdci</option>
                                    <option value="trainers">Treneri</option>
                                    <option value="employees">Zamestnanci</option>
                                    <option value="vaccinations">Ockovania</option>
                                    <option value="feeding">Krmenie</option>
                                    <option value="stable_log">Mastalna kniha</option>
                                    <option value="visit_log">Navstevna kniha</option>
                                    <option value="documents_v2">Dokumenty</option>
                                    <option value="tasks">Ulohy</option>
                                    <option value="notifications">Upozornenia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Akcia</label>
                                <select class="form-control" id="auditActionFilter">
                                    <option value="">Vsetky</option>
                                    <option value="INSERT">Vytvorenie</option>
                                    <option value="UPDATE">Uprava</option>
                                    <option value="DELETE">Zmazanie</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Pouzivatel</label>
                                <select class="form-control" id="auditUserFilter">
                                    <option value="">Vsetci</option>
                                </select>
                            </div>
                            <div class="form-group" style="align-self:flex-end">
                                <button class="btn btn-primary" onclick="loadAuditLogs()">Filtrovat</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Zaznamy zmien</h3>
                        <span id="auditTotal" style="color:var(--gray)">0 zaznamov</span>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Datum a cas</th>
                                    <th>Entita</th>
                                    <th>Akcia</th>
                                    <th>Zmenene polia</th>
                                    <th>Pouzivatel</th>
                                    <th>Akcie</th>
                                </tr>
                            </thead>
                            <tbody id="auditLogsTable"></tbody>
                        </table>
                    </div>
                    <div class="card-footer" style="display:flex;justify-content:space-between;align-items:center">
                        <button class="btn btn-outline" onclick="loadAuditLogsPrev()" id="auditPrevBtn" disabled>Predchadzajuce</button>
                        <span id="auditPagination">Strana 1</span>
                        <button class="btn btn-outline" onclick="loadAuditLogsNext()" id="auditNextBtn">Nasledujuce</button>
                    </div>
                </div>
            </section>

            <!-- EXPORTS -->
            <section id="exports" class="section">
                <div class="header">
                    <h1>Exporty a tlac</h1>
                </div>
                
                <div class="stats-grid" style="grid-template-columns:repeat(5,1fr);margin-bottom:1.5rem">
                    <div class="stat-card" onclick="showExportTab('stable-log')" style="cursor:pointer">
                        <div class="stat-value">1</div>
                        <div class="stat-label">Mastalna kniha</div>
                    </div>
                    <div class="stat-card" onclick="showExportTab('visit-log')" style="cursor:pointer">
                        <div class="stat-value">2</div>
                        <div class="stat-label">Navstevna kniha</div>
                    </div>
                    <div class="stat-card" onclick="showExportTab('licenses')" style="cursor:pointer">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Licencie SJF/FEI</div>
                    </div>
                    <div class="stat-card" onclick="showExportTab('vaccinations')" style="cursor:pointer">
                        <div class="stat-value">4</div>
                        <div class="stat-label">Ockovania</div>
                    </div>
                    <div class="stat-card" onclick="showExportTab('documents')" style="cursor:pointer">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Dokumenty</div>
                    </div>
                </div>

                <!-- Tab: Mastalna kniha -->
                <div id="export-stable-log" class="export-tab">
                    <div class="card">
                        <div class="card-header"><h3>Mastalna kniha</h3></div>
                        <div class="card-body">
                            <div class="form-row" style="margin-bottom:1rem">
                                <div class="form-group"><label>Od</label><input type="date" class="form-control" id="exportStableFrom"></div>
                                <div class="form-group"><label>Do</label><input type="date" class="form-control" id="exportStableTo"></div>
                                <div class="form-group" style="align-self:flex-end">
                                    <button class="btn btn-primary" onclick="loadExportStableLog()">Nacitat</button>
                                    <button class="btn btn-outline" onclick="downloadExportCSV('stable-log')">CSV</button>
                                    <button class="btn btn-outline" onclick="printExportStableLog()">Tlac</button>
                                </div>
                            </div>
                            <table class="table">
                                <thead><tr><th>Datum</th><th>Cas</th><th>Typ</th><th>Kon</th><th>Pas</th><th>Poznamka</th></tr></thead>
                                <tbody id="exportStableTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tab: Navstevna kniha -->
                <div id="export-visit-log" class="export-tab" style="display:none">
                    <div class="card">
                        <div class="card-header"><h3>Navstevna kniha</h3></div>
                        <div class="card-body">
                            <div class="form-row" style="margin-bottom:1rem">
                                <div class="form-group"><label>Od</label><input type="date" class="form-control" id="exportVisitFrom"></div>
                                <div class="form-group"><label>Do</label><input type="date" class="form-control" id="exportVisitTo"></div>
                                <div class="form-group" style="align-self:flex-end">
                                    <button class="btn btn-primary" onclick="loadExportVisitLog()">Nacitat</button>
                                    <button class="btn btn-outline" onclick="downloadExportCSV('visit-log')">CSV</button>
                                    <button class="btn btn-outline" onclick="printExportVisitLog()">Tlac</button>
                                </div>
                            </div>
                            <table class="table">
                                <thead><tr><th>Datum</th><th>Cas</th><th>Meno</th><th>Organizacia</th><th>Dovod</th><th>Kontakt</th></tr></thead>
                                <tbody id="exportVisitTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tab: Licencie -->
                <div id="export-licenses" class="export-tab" style="display:none">
                    <div class="card">
                        <div class="card-header"><h3>Licencie SJF/FEI</h3></div>
                        <div class="card-body">
                            <div class="form-row" style="margin-bottom:1rem">
                                <div class="form-group"><label>Status</label>
                                    <select class="form-control" id="exportLicenseStatus">
                                        <option value="">Vsetky</option>
                                        <option value="active">Iba aktivne</option>
                                    </select>
                                </div>
                                <div class="form-group"><label>Expiracia do (dni)</label>
                                    <select class="form-control" id="exportLicenseExpiry">
                                        <option value="">Vsetky</option>
                                        <option value="30">30 dni</option>
                                        <option value="60">60 dni</option>
                                        <option value="90">90 dni</option>
                                    </select>
                                </div>
                                <div class="form-group" style="align-self:flex-end">
                                    <button class="btn btn-primary" onclick="loadExportLicenses()">Nacitat</button>
                                    <button class="btn btn-outline" onclick="downloadExportCSV('horses-licenses')">CSV</button>
                                    <button class="btn btn-outline" onclick="printExportLicenses()">Tlac</button>
                                </div>
                            </div>
                            <table class="table">
                                <thead><tr><th>Kon</th><th>Pas</th><th>SJF cislo</th><th>SJF platnost</th><th>FEI cislo</th><th>FEI platnost</th></tr></thead>
                                <tbody id="exportLicensesTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tab: Ockovania -->
                <div id="export-vaccinations" class="export-tab" style="display:none">
                    <div class="card">
                        <div class="card-header"><h3>Ockovania</h3></div>
                        <div class="card-body">
                            <div class="form-row" style="margin-bottom:1rem">
                                <div class="form-group"><label>Filter</label>
                                    <select class="form-control" id="exportVaccFilter">
                                        <option value="">Vsetky</option>
                                        <option value="30">Expiracia do 30 dni</option>
                                        <option value="60">Expiracia do 60 dni</option>
                                        <option value="overdue">Iba oneskorene</option>
                                    </select>
                                </div>
                                <div class="form-group" style="align-self:flex-end">
                                    <button class="btn btn-primary" onclick="loadExportVaccinations()">Nacitat</button>
                                    <button class="btn btn-outline" onclick="downloadExportCSV('vaccinations')">CSV</button>
                                    <button class="btn btn-outline" onclick="printExportVaccinations()">Tlac</button>
                                </div>
                            </div>
                            <table class="table">
                                <thead><tr><th>Kon</th><th>Typ vakciny</th><th>Datum</th><th>Dalsi termin</th><th>Veterinar</th></tr></thead>
                                <tbody id="exportVaccTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tab: Dokumenty -->
                <div id="export-documents" class="export-tab" style="display:none">
                    <div class="card">
                        <div class="card-header"><h3>Dokumenty</h3></div>
                        <div class="card-body">
                            <div class="form-row" style="margin-bottom:1rem">
                                <div class="form-group"><label>Od</label><input type="date" class="form-control" id="exportDocsFrom"></div>
                                <div class="form-group"><label>Do</label><input type="date" class="form-control" id="exportDocsTo"></div>
                                <div class="form-group"><label>Kategoria</label>
                                    <select class="form-control" id="exportDocsCategory">
                                        <option value="">Vsetky</option>
                                        <option value="pas">Pas</option>
                                        <option value="poistenie">Poistenie</option>
                                        <option value="veterinar">Veterinar</option>
                                        <option value="sutaz">Sutaz</option>
                                        <option value="ine">Ine</option>
                                    </select>
                                </div>
                                <div class="form-group" style="align-self:flex-end">
                                    <button class="btn btn-primary" onclick="loadExportDocuments()">Nacitat</button>
                                    <button class="btn btn-outline" onclick="downloadExportCSV('documents')">CSV</button>
                                    <button class="btn btn-outline" onclick="printExportDocuments()">Tlac</button>
                                </div>
                            </div>
                            <table class="table">
                                <thead><tr><th>Datum</th><th>Nazov</th><th>Kategoria</th><th>Kon</th><th>Subor</th></tr></thead>
                                <tbody id="exportDocsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ADMIN USERS -->
            <section id="admin-users" class="section">
                <div class="header"><h1>ğŸ‘¤ Admin pouÅ¾Ã­vatelia</h1><div class="header-actions"><button class="btn btn-primary" onclick="openAdminUserModal()">+ PridaÅ¥ pouÅ¾Ã­vateÄ¾a</button></div></div>
                <div class="card">
                    <div class="card-body">
                        <table class="table">
                            <thead><tr><th>PouÅ¾Ã­vateÄ¾</th><th>Email</th><th>Rola</th><th>Status</th><th>PoslednÃ© prihlÃ¡senie</th><th>Akcie</th></tr></thead>
                            <tbody id="adminUsersTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALS -->
    
    <!-- Arena Modal -->
    <!-- Day Detail Modal -->
    <div class="modal" id="dayDetailModal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header">
                <h3>ğŸ“… Detail dÅˆa</h3>
                <button class="modal-close" onclick="closeModal('dayDetailModal')">Ã—</button>
            </div>
            <div class="modal-body" id="dayDetailContent">
                <!-- DynamickÃ½ obsah -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('dayDetailModal')">ZavrieÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="modal" id="notificationModal">
        <div class="modal-content" style="max-width:500px">
            <div class="modal-header"><h3 id="notificationModalTitle">Nove upozornenie</h3><button class="modal-close" onclick="closeModal('notificationModal')">x</button></div>
            <div class="modal-body">
                <input type="hidden" id="notificationId">
                <div class="form-group"><label>Nazov *</label><input type="text" class="form-control" id="notificationTitle" required placeholder="Strucny nazov"></div>
                <div class="form-group"><label>Popis</label><textarea class="form-control" id="notificationMessage" rows="3" placeholder="Podrobnejsi popis..."></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Priorita</label>
                        <select class="form-control" id="notificationPriority">
                            <option value="low">Nizka</option>
                            <option value="normal" selected>Normalna</option>
                            <option value="high">Vysoka</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Termin</label><input type="date" class="form-control" id="notificationDueDate"></div>
                </div>
                <div class="form-group"><label>Suvisiaci kon</label>
                    <select class="form-control" id="notificationHorse">
                        <option value="">-- Ziadny --</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('notificationModal')">Zrusit</button>
                <button class="btn btn-primary" onclick="saveNotification()">Ulozit</button>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3 id="taskModalTitle">NovÃ¡ Ãºloha</h3><button class="modal-close" onclick="closeModal('taskModal')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="taskId">
                <div class="form-group"><label>NÃ¡zov Ãºlohy *</label><input type="text" class="form-control" id="taskTitle" required placeholder="StruÄnÃ½ popis Ãºlohy"></div>
                <div class="form-group"><label>PodrobnÃ½ popis</label><textarea class="form-control" id="taskDescription" rows="2"></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Priorita</label>
                        <select class="form-control" id="taskPriority">
                            <option value="low">NÃ­zka</option>
                            <option value="normal" selected>NormÃ¡lna</option>
                            <option value="high">VysokÃ¡</option>
                            <option value="urgent">UrgentnÃ¡</option>
                        </select>
                    </div>
                    <div class="form-group"><label>TermÃ­n</label><input type="date" class="form-control" id="taskDueDate"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>VÃ¤zba na koÅˆa</label>
                        <select class="form-control" id="taskHorse"><option value="">-- Å½iadna --</option></select>
                    </div>
                    <div class="form-group"><label>PriradiÅ¥ pouÅ¾Ã­vateÄ¾ovi</label>
                        <select class="form-control" id="taskAssigned"><option value="">-- NepriradenÃ© --</option></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('taskModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="saveTask()">UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <div class="modal" id="arenaModal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header"><h3 id="arenaModalTitle">NovÃ¡ arÃ©na</h3><button class="modal-close" onclick="closeModal('arenaModal')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="arenaId">
                <div class="form-row">
                    <div class="form-group"><label>NÃ¡zov *</label><input type="text" class="form-control" id="arenaName" required placeholder="napr. VonkajÅ¡ia arÃ©na"></div>
                    <div class="form-group"><label>Kapacita (max jazdcov)</label><input type="number" class="form-control" id="arenaCapacity" value="4" min="1"></div>
                </div>
                <div class="form-group"><label>Popis</label><textarea class="form-control" id="arenaDescription" rows="2" placeholder="Popis priestoru, rozmer, povrch..."></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label><input type="checkbox" id="arenaIndoor"> KrytÃ¡ hala</label></div>
                    <div class="form-group"><label><input type="checkbox" id="arenaActive" checked> AktÃ­vna</label></div>
                </div>
                
                <hr style="margin:1.5rem 0">
                <h4 style="margin-bottom:1rem">ğŸ“… Rozvrh otvÃ¡racÃ­ch hodÃ­n</h4>
                <div class="alert alert-info" style="font-size:0.85rem">Nastavte pre kaÅ¾dÃ½ deÅˆ otvÃ¡racie hodiny, dÄºÅ¾ku slotu a max. poÄet jazdcov.</div>
                
                <table class="table" style="font-size:0.9rem">
                    <thead>
                        <tr>
                            <th>DeÅˆ</th>
                            <th>OtvorenÃ© od</th>
                            <th>Do</th>
                            <th>DÄºÅ¾ka slotu</th>
                            <th>Max</th>
                            <th>PovolenÃ© Ãºrovne</th>
                            <th>Akt.</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTable">
                        <tr data-day="1"><td>Pondelok</td><td><input type="time" class="form-control" id="sched_1_open" value="08:00"></td><td><input type="time" class="form-control" id="sched_1_close" value="20:00"></td><td><select class="form-control" id="sched_1_duration"><option value="30">30</option><option value="60" selected>60</option><option value="90">90</option></select></td><td><input type="number" class="form-control" id="sched_1_max" value="4" min="1" style="width:50px"></td><td style="white-space:nowrap"><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_1_lvl_beginner" checked> ZaÄ</label><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_1_lvl_intermediate" checked> Str</label><label style="font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_1_lvl_advanced" checked> Pok</label></td><td style="text-align:center"><input type="checkbox" id="sched_1_active" checked></td></tr>
                        <tr data-day="2"><td>Utorok</td><td><input type="time" class="form-control" id="sched_2_open" value="08:00"></td><td><input type="time" class="form-control" id="sched_2_close" value="20:00"></td><td><select class="form-control" id="sched_2_duration"><option value="30">30</option><option value="60" selected>60</option><option value="90">90</option></select></td><td><input type="number" class="form-control" id="sched_2_max" value="4" min="1" style="width:50px"></td><td style="white-space:nowrap"><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_2_lvl_beginner" checked> ZaÄ</label><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_2_lvl_intermediate" checked> Str</label><label style="font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_2_lvl_advanced" checked> Pok</label></td><td style="text-align:center"><input type="checkbox" id="sched_2_active" checked></td></tr>
                        <tr data-day="3"><td>Streda</td><td><input type="time" class="form-control" id="sched_3_open" value="08:00"></td><td><input type="time" class="form-control" id="sched_3_close" value="20:00"></td><td><select class="form-control" id="sched_3_duration"><option value="30">30</option><option value="60" selected>60</option><option value="90">90</option></select></td><td><input type="number" class="form-control" id="sched_3_max" value="4" min="1" style="width:50px"></td><td style="white-space:nowrap"><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_3_lvl_beginner" checked> ZaÄ</label><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_3_lvl_intermediate" checked> Str</label><label style="font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_3_lvl_advanced" checked> Pok</label></td><td style="text-align:center"><input type="checkbox" id="sched_3_active" checked></td></tr>
                        <tr data-day="4"><td>Å tvrtok</td><td><input type="time" class="form-control" id="sched_4_open" value="08:00"></td><td><input type="time" class="form-control" id="sched_4_close" value="20:00"></td><td><select class="form-control" id="sched_4_duration"><option value="30">30</option><option value="60" selected>60</option><option value="90">90</option></select></td><td><input type="number" class="form-control" id="sched_4_max" value="4" min="1" style="width:50px"></td><td style="white-space:nowrap"><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_4_lvl_beginner" checked> ZaÄ</label><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_4_lvl_intermediate" checked> Str</label><label style="font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_4_lvl_advanced" checked> Pok</label></td><td style="text-align:center"><input type="checkbox" id="sched_4_active" checked></td></tr>
                        <tr data-day="5"><td>Piatok</td><td><input type="time" class="form-control" id="sched_5_open" value="08:00"></td><td><input type="time" class="form-control" id="sched_5_close" value="20:00"></td><td><select class="form-control" id="sched_5_duration"><option value="30">30</option><option value="60" selected>60</option><option value="90">90</option></select></td><td><input type="number" class="form-control" id="sched_5_max" value="4" min="1" style="width:50px"></td><td style="white-space:nowrap"><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_5_lvl_beginner" checked> ZaÄ</label><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_5_lvl_intermediate" checked> Str</label><label style="font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_5_lvl_advanced" checked> Pok</label></td><td style="text-align:center"><input type="checkbox" id="sched_5_active" checked></td></tr>
                        <tr data-day="6"><td>Sobota</td><td><input type="time" class="form-control" id="sched_6_open" value="09:00"></td><td><input type="time" class="form-control" id="sched_6_close" value="18:00"></td><td><select class="form-control" id="sched_6_duration"><option value="30">30</option><option value="60" selected>60</option><option value="90">90</option></select></td><td><input type="number" class="form-control" id="sched_6_max" value="4" min="1" style="width:50px"></td><td style="white-space:nowrap"><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_6_lvl_beginner" checked> ZaÄ</label><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_6_lvl_intermediate" checked> Str</label><label style="font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_6_lvl_advanced" checked> Pok</label></td><td style="text-align:center"><input type="checkbox" id="sched_6_active" checked></td></tr>
                        <tr data-day="0"><td>NedeÄ¾a</td><td><input type="time" class="form-control" id="sched_0_open" value="09:00"></td><td><input type="time" class="form-control" id="sched_0_close" value="16:00"></td><td><select class="form-control" id="sched_0_duration"><option value="30">30</option><option value="60" selected>60</option><option value="90">90</option></select></td><td><input type="number" class="form-control" id="sched_0_max" value="3" min="1" style="width:50px"></td><td style="white-space:nowrap"><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_0_lvl_beginner" checked> ZaÄ</label><label style="margin-right:8px;font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_0_lvl_intermediate" checked> Str</label><label style="font-weight:normal;font-size:0.8rem"><input type="checkbox" id="sched_0_lvl_advanced" checked> Pok</label></td><td style="text-align:center"><input type="checkbox" id="sched_0_active" checked></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('arenaModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="saveArena()">ğŸ’¾ UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Article Modal -->
    <div class="modal" id="articleModal">
        <div class="modal-content" style="max-width:900px">
            <div class="modal-header"><h3 id="articleModalTitle">NovÃ½ ÄlÃ¡nok</h3><button class="modal-close" onclick="closeModal('articleModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="articleForm">
                    <input type="hidden" id="articleId">
                    <div class="form-row">
                        <div class="form-group" style="flex:2"><label>NÃ¡zov *</label><input type="text" class="form-control" id="articleTitle" required></div>
                        <div class="form-group"><label>KategÃ³ria</label>
                            <select class="form-control" id="articleCategory"></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Autor</label><input type="text" class="form-control" id="articleAuthor"></div>
                        <div class="form-group"><label>Status</label>
                            <select class="form-control" id="articleStatus">
                                <option value="draft">Koncept</option>
                                <option value="published">PublikovanÃ½</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"><label>KrÃ¡tky popis</label><textarea class="form-control" id="articleExcerpt" rows="2"></textarea></div>
                    <div class="form-group">
                        <label>Obsah</label>
                        <div id="articleContentEditor" style="background:white;border:1px solid var(--border);border-radius:var(--radius)"></div>
                        <input type="hidden" id="articleContent">
                    </div>
                    <div class="form-group">
                        <label>TitulnÃ½ obrÃ¡zok</label>
                        <div style="display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap">
                            <input type="file" id="articleImageFile" accept="image/*" style="flex:1" onchange="uploadArticleImage(this)">
                            <span style="color:var(--muted)">alebo</span>
                            <input type="url" class="form-control" id="articleCoverImage" placeholder="URL: https://..." style="flex:2">
                        </div>
                        <div id="articleImagePreview" style="margin-top:0.5rem"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label><input type="checkbox" id="articleFeatured"> OdporÃºÄanÃ½</label></div>
                        <div class="form-group"><label><input type="checkbox" id="articlePinned"> PripnutÃ½</label></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('articleModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="saveArticle()">UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Page Modal -->
    <div class="modal" id="pageModal">
        <div class="modal-content" style="max-width:900px">
            <div class="modal-header"><h3 id="pageModalTitle">NovÃ¡ strÃ¡nka</h3><button class="modal-close" onclick="closeModal('pageModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="pageForm">
                    <input type="hidden" id="pageId">
                    <div class="form-row">
                        <div class="form-group" style="flex:2"><label>NÃ¡zov *</label><input type="text" class="form-control" id="pageTitle" required></div>
                        <div class="form-group"><label>URL slug *</label><input type="text" class="form-control" id="pageSlug" required placeholder="moja-stranka"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Å ablÃ³na</label>
                            <select class="form-control" id="pageTemplate">
                                <option value="default">Å tandardnÃ¡</option>
                                <option value="contact">Kontakt</option>
                                <option value="about">O nÃ¡s</option>
                                <option value="services">SluÅ¾by</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Poradie v menu</label><input type="number" class="form-control" id="pageMenuOrder" value="0"></div>
                    </div>
                    <div class="form-group">
                        <label>Obsah strÃ¡nky</label>
                        <div id="pageContentEditor" style="background:white;border:1px solid var(--border);border-radius:var(--radius)"></div>
                        <input type="hidden" id="pageContent">
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label><input type="checkbox" id="pagePublished"> PublikovanÃ¡</label></div>
                        <div class="form-group"><label><input type="checkbox" id="pageInMenu"> ZobraziÅ¥ v menu</label></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('pageModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="savePage()">UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Partner Modal -->
    <div class="modal" id="partnerModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3 id="partnerModalTitle">NovÃ½ partner</h3><button class="modal-close" onclick="closeModal('partnerModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="partnerForm">
                    <input type="hidden" id="partnerId">
                    <div class="form-group"><label>NÃ¡zov *</label><input type="text" class="form-control" id="partnerName" required></div>
                    <div class="form-group"><label>Typ</label>
                        <select class="form-control" id="partnerType">
                            <option value="partner">Partner</option>
                            <option value="sponzor">Sponzor</option>
                            <option value="hlavny_sponzor">HlavnÃ½ sponzor</option>
                            <option value="medialny_partner">MediÃ¡lny partner</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Web strÃ¡nka</label><input type="url" class="form-control" id="partnerWebsite" placeholder="https://www.example.com"></div>
                    <div class="form-group">
                        <label>Logo partnera</label>
                        <div style="display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap">
                            <input type="file" id="partnerLogoFile" accept="image/*" style="flex:1" onchange="uploadPartnerLogo(this)">
                            <span style="color:var(--muted)">alebo</span>
                            <input type="url" class="form-control" id="partnerLogo" placeholder="URL: https://..." style="flex:2">
                        </div>
                        <div id="partnerLogoPreview" style="margin-top:0.5rem"></div>
                    </div>
                    <div class="form-group"><label>Poradie</label><input type="number" class="form-control" id="partnerOrder" value="0"></div>
                    <div class="form-group"><label><input type="checkbox" id="partnerActive" checked> AktÃ­vny</label></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('partnerModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="savePartner()">UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="modal" id="serviceModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3 id="serviceModalTitle">NovÃ¡ sluÅ¾ba</h3><button class="modal-close" onclick="closeModal('serviceModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="serviceForm">
                    <input type="hidden" id="serviceId">
                    <div class="form-row">
                        <div class="form-group" style="flex:0 0 100px">
                            <label>Ikona</label>
                            <input type="text" class="form-control" id="serviceIcon" value="ğŸ‡" style="font-size:1.5rem;text-align:center" readonly onclick="toggleIconPicker()">
                            <div id="iconPicker" style="display:none;position:absolute;background:white;border:1px solid var(--border);border-radius:8px;padding:0.5rem;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:1000;width:280px;margin-top:0.25rem">
                                <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:0.25rem;font-size:1.5rem;text-align:center">
                                    <span class="icon-option" onclick="selectIcon('ğŸ‡')">ğŸ‡</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ´')">ğŸ´</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ')">ğŸ</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ ')">ğŸ </span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ†')">ğŸ†</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ¥‡')">ğŸ¥‡</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ¥ˆ')">ğŸ¥ˆ</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ¥‰')">ğŸ¥‰</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ¯')">ğŸ¯</span>
                                    <span class="icon-option" onclick="selectIcon('â­')">â­</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ ')">ğŸ </span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ¡')">ğŸ¡</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ•ï¸')">ğŸ•ï¸</span>
                                    <span class="icon-option" onclick="selectIcon('â›º')">â›º</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸŒ¾')">ğŸŒ¾</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸŒ¿')">ğŸŒ¿</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ€')">ğŸ€</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸŒ³')">ğŸŒ³</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ‘¶')">ğŸ‘¶</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ‘§')">ğŸ‘§</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ‘¦')">ğŸ‘¦</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ‘¨â€ğŸ«')">ğŸ‘¨â€ğŸ«</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ“š')">ğŸ“š</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ“…')">ğŸ“…</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ—“ï¸')">ğŸ—“ï¸</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ’ª')">ğŸ’ª</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸª')">ğŸª</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ­')">ğŸ­</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ¨')">ğŸ¨</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ“¸')">ğŸ“¸</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ¬')">ğŸ¬</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ')">ğŸ</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ’°')">ğŸ’°</span>
                                    <span class="icon-option" onclick="selectIcon('ğŸ›’')">ğŸ›’</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="flex:1">
                            <label>NÃ¡zov *</label>
                            <input type="text" class="form-control" id="serviceTitle" required>
                        </div>
                    </div>
                    <div class="form-group"><label>Popis</label><textarea class="form-control" id="serviceDescription" rows="3"></textarea></div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Å tÃ­tok (voliteÄ¾nÃ©)</label>
                            <input type="text" class="form-control" id="serviceBadgeText" placeholder="napr. ObsadenÃ©, Novinka...">
                        </div>
                        <div class="form-group">
                            <label>Typ Å¡tÃ­tku</label>
                            <select class="form-control" id="serviceBadgeType">
                                <option value="">-- Bez Å¡tÃ­tku --</option>
                                <option value="full">ğŸ”´ ObsadenÃ© (ÄervenÃ½)</option>
                                <option value="soon">ğŸŸ  Pripravujeme (oranÅ¾ovÃ½)</option>
                                <option value="new">ğŸŸ¢ Novinka (zelenÃ½)</option>
                                <option value="sale">ğŸ”µ Akcia (modrÃ½)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Poradie</label><input type="number" class="form-control" id="serviceOrder" value="0"></div>
                        <div class="form-group"><label><input type="checkbox" id="serviceActive" checked> AktÃ­vna</label></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('serviceModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="saveService()">UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Document Modal -->
    <div class="modal" id="documentModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3>NovÃ½ dokument</h3><button class="modal-close" onclick="closeModal('documentModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="documentForm">
                    <div class="form-group"><label>NÃ¡zov *</label><input type="text" class="form-control" id="webDocTitle" required></div>
                    <div class="form-group"><label>KategÃ³ria</label>
                        <select class="form-control" id="webDocCategory">
                            <option value="prihlÃ¡Å¡ky">PrihlÃ¡Å¡ky</option>
                            <option value="pravidlÃ¡">PravidlÃ¡</option>
                            <option value="vÃ½sledky">VÃ½sledky</option>
                            <option value="inÃ©">InÃ©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>SÃºbor *</label>
                        <div style="display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap">
                            <input type="file" id="webDocFile" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt" style="flex:1" onchange="uploadWebDocument(this)">
                            <span style="color:var(--muted)">alebo</span>
                            <input type="url" class="form-control" id="webDocFileUrl" placeholder="URL: https://..." style="flex:2">
                        </div>
                        <div id="webDocUploadStatus" style="margin-top:0.5rem;font-size:0.85rem"></div>
                    </div>
                    <div class="form-group"><label>NÃ¡zov sÃºboru</label><input type="text" class="form-control" id="webDocFileName" placeholder="dokument.pdf"></div>
                    <div class="form-group"><label>Popis</label><textarea class="form-control" id="webDocDescription" rows="2"></textarea></div>
                    <div class="form-group"><label><input type="checkbox" id="webDocPublic" checked> VerejnÃ½</label></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('documentModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="saveWebDocument()">UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Album Modal -->
    <div class="modal" id="albumModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3 id="albumModalTitle">NovÃ½ album</h3><button class="modal-close" onclick="closeModal('albumModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="albumForm">
                    <input type="hidden" id="albumId">
                    <div class="form-group"><label>NÃ¡zov *</label><input type="text" class="form-control" id="albumTitle" required></div>
                    <div class="form-group"><label>Popis</label><textarea class="form-control" id="albumDescription" rows="3"></textarea></div>
                    <div class="form-group">
                        <label>TitulnÃ½ obrÃ¡zok</label>
                        <div style="display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap">
                            <input type="file" id="albumCoverFile" accept="image/*" style="flex:1" onchange="uploadAlbumCover(this)">
                            <span style="color:var(--muted)">alebo</span>
                            <input type="url" class="form-control" id="albumCover" placeholder="URL: https://..." style="flex:2">
                        </div>
                        <div id="albumCoverPreview" style="margin-top:0.5rem"></div>
                    </div>
                    <div class="form-group"><label><input type="checkbox" id="albumPublic" checked> VerejnÃ½</label></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('albumModal')">ZruÅ¡iÅ¥</button>
                <button class="btn btn-primary" onclick="saveAlbum()">UloÅ¾iÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Photos Modal -->
    <div class="modal" id="photosModal">
        <div class="modal-content" style="max-width:900px">
            <div class="modal-header">
                <h3 id="photosModalTitle">Fotky a videÃ¡ v albume</h3>
                <button class="modal-close" onclick="closeModal('photosModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="currentAlbumId">
                <div style="margin-bottom:1rem;padding:1rem;background:var(--gray-light);border-radius:var(--radius)">
                    <label style="font-weight:600;display:block;margin-bottom:0.5rem">PridaÅ¥ fotky alebo videÃ¡</label>
                    <input type="file" id="photosUpload" accept="image/*,video/*" multiple onchange="uploadMedia(this)">
                    <p style="font-size:0.75rem;color:var(--muted);margin-top:0.25rem">Max. 50MB na sÃºbor. PodporovanÃ©: JPG, PNG, GIF, MP4, WebM</p>
                    <div id="photosUploadStatus" style="margin-top:0.5rem;font-size:0.85rem"></div>
                </div>
                <div id="photosGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem;max-height:400px;overflow-y:auto"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('photosModal')">ZavrieÅ¥</button>
            </div>
        </div>
    </div>

    <!-- Horse Modal -->
    <div class="modal" id="horseModal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header"><h3 id="horseModalTitle">PridaÅ¥ koÅˆa</h3><button class="modal-close" onclick="closeModal('horseModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="horseForm">
                    <input type="hidden" id="horseId">
                    <div class="tabs" style="margin-bottom:1rem"><div class="tab active" data-modal-tab="horseBasic">ZÃ¡kladnÃ©</div><div class="tab" data-modal-tab="horseIdent">IdentifikÃ¡cia</div><div class="tab" data-modal-tab="horseSport">Å port</div></div>
                    
                    <div id="horseBasic" class="modal-tab-content active">
                        <div class="form-row">
                            <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="horseName" required></div>
                            <div class="form-group"><label>PrezÃ½vka</label><input type="text" class="form-control" id="horseStableName"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Plemeno</label><input type="text" class="form-control" id="horseBreed"></div>
                            <div class="form-group"><label>Farba</label><input type="text" class="form-control" id="horseColor"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Pohlavie</label><select class="form-control" id="horseSex"><option value="gelding">Valach</option><option value="mare">Kobyla</option><option value="stallion">Å½rebec</option></select></div>
                            <div class="form-group"><label>DÃ¡tum narodenia</label><input type="date" class="form-control" id="horseBirth"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>VÃ½Å¡ka (cm)</label><input type="number" class="form-control" id="horseHeight"></div>
                            <div class="form-group"><label>VÃ¡ha (kg)</label><input type="number" class="form-control" id="horseWeight"></div>
                        </div>
                        <div class="form-group"><label>MajiteÄ¾</label><input type="text" class="form-control" id="horseOwner"></div>
                    </div>

                    <div id="horseIdent" class="modal-tab-content" style="display:none">
                        <fieldset class="fieldset"><legend>Å VPS - PovinnÃ© Ãºdaje</legend>
                            <div class="form-row">
                                <div class="form-group"><label>ÄŒÃ­slo pasu koÅˆa *</label><input type="text" class="form-control" id="horsePassport" placeholder="SVK-2020-12345"></div>
                                <div class="form-group"><label>Å½ivotnÃ© ÄÃ­slo (UELN)</label><input type="text" class="form-control" id="horseLifeNumber" placeholder="703099000012345"></div>
                            </div>
                            <div class="form-group"><label>MikroÄip <small>(ISO 11784, povinnÃ½ od 2013)</small></label><input type="text" class="form-control" id="horseMicrochip" placeholder="941000012345678"></div>
                        </fieldset>
                        <fieldset class="fieldset"><legend>FEI registrÃ¡cia</legend>
                            <div class="form-row">
                                <div class="form-group"><label>FEI ID</label><input type="text" class="form-control" id="horseFeiId" placeholder="SVK40123"></div>
                                <div class="form-group"><label>FEI pas - platnosÅ¥</label><input type="date" class="form-control" id="horseFeiExpiry"></div>
                            </div>
                        </fieldset>
                        <fieldset class="fieldset"><legend>SJF registrÃ¡cia</legend>
                            <div class="form-row">
                                <div class="form-group"><label>SJF licencia koÅˆa</label><input type="text" class="form-control" id="horseSjfLicense" placeholder="SK-H-2020-001"></div>
                                <div class="form-group"><label>PlatnosÅ¥ do</label><input type="date" class="form-control" id="horseSjfExpiry"></div>
                            </div>
                        </fieldset>
                    </div>

                    <div id="horseSport" class="modal-tab-content" style="display:none">
                        <div class="form-row">
                            <div class="form-group"><label>ÃšroveÅˆ</label><select class="form-control" id="horseLevel"><option value="beginner">ZaÄiatoÄnÃ­ci</option><option value="intermediate">PokroÄilÃ­</option><option value="advanced">SkÃºsenÃ­</option><option value="children">Deti</option><option value="competition">SÃºÅ¥aÅ¾nÃ½</option></select></div>
                            <div class="form-group"><label>Status</label><select class="form-control" id="horseStatus"><option value="active">AktÃ­vny</option><option value="retired">DÃ´chodca</option><option value="sold">PredanÃ½</option><option value="temporary_out">DoÄasne mimo</option></select></div>
                        </div>
                        <div class="form-group"><label>DisciplÃ­ny</label><div style="display:flex;gap:1rem;flex-wrap:wrap"><label><input type="checkbox" class="horseDiscipline" value="skoky"> Skoky</label><label><input type="checkbox" class="horseDiscipline" value="drezÃºra"> DrezÃºra</label><label><input type="checkbox" class="horseDiscipline" value="vÅ¡estrannosÅ¥"> VÅ¡estrannosÅ¥</label><label><input type="checkbox" class="horseDiscipline" value="vytrvalosÅ¥"> VytrvalosÅ¥</label><label><input type="checkbox" class="horseDiscipline" value="voltÃ­Å¾"> VoltÃ­Å¾</label><label><input type="checkbox" class="horseDiscipline" value="zÃ¡prahy"> ZÃ¡prahy</label></div></div>
                        <div class="form-group"><label>PoznÃ¡mky</label><textarea class="form-control" id="horseNotes"></textarea></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('horseModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveHorse()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- Rider Modal -->
    <div class="modal" id="riderModal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header"><h3 id="riderModalTitle">PridaÅ¥ jazdca</h3><button class="modal-close" onclick="closeModal('riderModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="riderForm">
                    <input type="hidden" id="riderId">
                    <fieldset class="fieldset"><legend>OsobnÃ© Ãºdaje</legend>
                        <div class="form-row">
                            <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="riderFirstName" required></div>
                            <div class="form-group"><label>Priezvisko *</label><input type="text" class="form-control" id="riderLastName" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>DÃ¡tum narodenia</label><input type="date" class="form-control" id="riderBirth"></div>
                            <div class="form-group"><label>Pohlavie</label><select class="form-control" id="riderGender"><option value="female">Å½ena</option><option value="male">MuÅ¾</option></select></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Email *</label><input type="email" class="form-control" id="riderEmail" required></div>
                            <div class="form-group"><label>TelefÃ³n</label><input type="tel" class="form-control" id="riderPhone"></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>SJF registrÃ¡cia</legend>
                        <div class="form-row">
                            <div class="form-group"><label>ÄŒÃ­slo licencie SJF</label><input type="text" class="form-control" id="riderSjfLicense" placeholder="SK-R-2020-001"></div>
                            <div class="form-group"><label>Typ licencie</label><select class="form-control" id="riderSjfType"><option value="none">Bez licencie (hobby)</option><option value="szvj">SZVJ - zÃ¡kladnÃ½ vÃ½cvik</option><option value="national">NÃ¡rodnÃ¡ licencia</option><option value="international">MedzinÃ¡rodnÃ¡</option></select></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>PlatnosÅ¥ do</label><input type="date" class="form-control" id="riderSjfExpiry"></div>
                            <div class="form-group"><label>DÃ¡tum SZVJ skÃºÅ¡ky</label><input type="date" class="form-control" id="riderSzvjDate"></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>FEI registrÃ¡cia</legend>
                        <div class="form-row">
                            <div class="form-group"><label>FEI ID</label><input type="text" class="form-control" id="riderFeiId"></div>
                            <div class="form-group"><label>FEI platnosÅ¥ do</label><input type="date" class="form-control" id="riderFeiExpiry"></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>KategÃ³ria a ÃºroveÅˆ</legend>
                        <div class="form-row">
                            <div class="form-group"><label>KategÃ³ria (SJF)</label><select class="form-control" id="riderCategory"><option value="children">Deti (do 12)</option><option value="pony">Pony jazdci</option><option value="junior">Juniori (14-18)</option><option value="young_rider">MladÃ­ jazdci (16-21)</option><option value="senior">Seniori (21+)</option><option value="amateur">AmatÃ©ri</option></select></div>
                            <div class="form-group"><label>ÃšroveÅˆ</label><select class="form-control" id="riderLevel"><option value="beginner">ZaÄiatoÄnÃ­k</option><option value="intermediate">PokroÄilÃ½</option><option value="advanced">SkÃºsenÃ½</option><option value="competition">SÃºÅ¥aÅ¾nÃ½</option></select></div>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset"><legend>ZdravotnÃ¡ spÃ´sobilosÅ¥</legend>
                        <div class="form-row">
                            <div class="form-group"><label>LekÃ¡rske potvrdenie</label><select class="form-control" id="riderMedical"><option value="true">PlatnÃ©</option><option value="false">NeplatnÃ©</option></select></div>
                            <div class="form-group"><label>PlatnÃ© do</label><input type="date" class="form-control" id="riderMedicalExpiry"></div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('riderModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveRider()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- Trainer Modal -->
    <div class="modal" id="trainerModal">
        <div class="modal-content">
            <div class="modal-header"><h3>PridaÅ¥ trÃ©nera</h3><button class="modal-close" onclick="closeModal('trainerModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="trainerForm">
                    <input type="hidden" id="trainerId">
                    <div class="form-row">
                        <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="trainerFirstName" required></div>
                        <div class="form-group"><label>Priezvisko *</label><input type="text" class="form-control" id="trainerLastName" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Email</label><input type="email" class="form-control" id="trainerEmail"></div>
                        <div class="form-group"><label>TelefÃ³n</label><input type="tel" class="form-control" id="trainerPhone"></div>
                    </div>
                    <fieldset class="fieldset"><legend>SJF kvalifikÃ¡cia</legend>
                        <div class="form-row">
                            <div class="form-group"><label>ÄŒÃ­slo licencie</label><input type="text" class="form-control" id="trainerSjfLicense"></div>
                            <div class="form-group"><label>KvalifikaÄnÃ½ stupeÅˆ (1-4)</label><select class="form-control" id="trainerLevel"><option value="1">1. stupeÅˆ</option><option value="2">2. stupeÅˆ</option><option value="3">3. stupeÅˆ</option><option value="4">4. stupeÅˆ (najvyÅ¡Å¡Ã­)</option></select></div>
                        </div>
                    </fieldset>
                    <div class="form-group"><label>Å pecializÃ¡cie</label><div style="display:flex;gap:1rem;flex-wrap:wrap"><label><input type="checkbox" class="trainerSpec" value="skoky"> Skoky</label><label><input type="checkbox" class="trainerSpec" value="drezÃºra"> DrezÃºra</label><label><input type="checkbox" class="trainerSpec" value="voltÃ­Å¾"> VoltÃ­Å¾</label><label><input type="checkbox" class="trainerSpec" value="zaÄiatoÄnÃ­ci"> ZaÄiatoÄnÃ­ci</label></div></div>
                    <div class="form-row">
                        <div class="form-group"><label>Typ ÃºvÃ¤zku</label><select class="form-control" id="trainerEmployment"><option value="full_time">PlnÃ½ ÃºvÃ¤zok</option><option value="part_time">ÄŒiastoÄnÃ½</option><option value="external">ExternÃ½</option><option value="volunteer">DobrovoÄ¾nÃ­k</option></select></div>
                        <div class="form-group"><label>HodinovÃ¡ sadzba (â‚¬)</label><input type="number" class="form-control" id="trainerRate" step="0.01"></div>
                    </div>
                    <div class="form-group"><label>Bio / Popis</label><textarea class="form-control" id="trainerBio"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('trainerModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveTrainer()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header"><h3>PridaÅ¥ zamestnanca</h3><button class="modal-close" onclick="closeModal('employeeModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="employeeForm">
                    <input type="hidden" id="employeeId">
                    <div class="form-row">
                        <div class="form-group"><label>Meno *</label><input type="text" class="form-control" id="employeeFirstName" required></div>
                        <div class="form-group"><label>Priezvisko *</label><input type="text" class="form-control" id="employeeLastName" required></div>
                    </div>
                    <div class="form-group"><label>PozÃ­cia</label><input type="text" class="form-control" id="employeePosition" placeholder="StajnÃ­k, pomocnÃ­k..."></div>
                    <div class="form-row">
                        <div class="form-group"><label>Email</label><input type="email" class="form-control" id="employeeEmail"></div>
                        <div class="form-group"><label>TelefÃ³n</label><input type="tel" class="form-control" id="employeePhone"></div>
                    </div>
                    <div class="form-group"><label>Typ ÃºvÃ¤zku</label><select class="form-control" id="employeeType"><option value="full_time">PlnÃ½ ÃºvÃ¤zok</option><option value="part_time">ÄŒiastoÄnÃ½</option></select></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('employeeModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveEmployee()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- Training Modal -->
    <div class="modal" id="trainingModal">
        <div class="modal-content">
            <div class="modal-header"><h3>NovÃ½ trÃ©ning</h3><button class="modal-close" onclick="closeModal('trainingModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="trainingForm">
                    <input type="hidden" id="trainingId">
                    <div class="form-row">
                        <div class="form-group"><label>DÃ¡tum *</label><input type="date" class="form-control" id="trainingDate" required></div>
                        <div class="form-group"><label>ÄŒas *</label><input type="time" class="form-control" id="trainingTime" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Jazdec *</label><select class="form-control" id="trainingRider" required></select></div>
                        <div class="form-group"><label>KÃ´Åˆ *</label><select class="form-control" id="trainingHorse" required></select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>TrÃ©ner *</label><select class="form-control" id="trainingTrainer" required></select></div>
                        <div class="form-group"><label>Typ trÃ©ningu</label><select class="form-control" id="trainingType"><option value="individual">IndividuÃ¡lny</option><option value="group">SkupinovÃ½</option><option value="longe">LonÅ¾ovanie</option><option value="jumping">Skoky</option><option value="dressage">DrezÃºra</option><option value="cross_country">TerÃ©n</option><option value="theory">TeÃ³ria</option><option value="szvj_preparation">PrÃ­prava SZVJ</option><option value="competition_prep">PrÃ­prava preteky</option></select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Trvanie (min)</label><input type="number" class="form-control" id="trainingDuration" value="60"></div>
                        <div class="form-group"><label>Cena (â‚¬)</label><input type="number" class="form-control" id="trainingPrice" step="0.01"></div>
                    </div>
                    <div class="form-group"><label>PoznÃ¡mky</label><textarea class="form-control" id="trainingNotes"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('trainingModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveTraining()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- Vet Record Modal -->
    <div class="modal" id="vetModal">
        <div class="modal-content">
            <div class="modal-header"><h3>VeterinÃ¡rny zÃ¡znam</h3><button class="modal-close" onclick="closeModal('vetModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="vetForm">
                    <input type="hidden" id="vetId">
                    <div class="form-row">
                        <div class="form-group"><label>KÃ´Åˆ *</label><select class="form-control" id="vetHorse" required></select></div>
                        <div class="form-group"><label>Typ zÃ¡znamu *</label><select class="form-control" id="vetType" required>
                            <optgroup label="OÄkovanie"><option value="vaccination_flu">ChrÃ­pka (FEI: 6 mes.)</option><option value="vaccination_tetanus">Tetanus</option><option value="vaccination_ehv">EHV-1 herpesvÃ­rus</option><option value="vaccination_other">InÃ© oÄkovanie</option></optgroup>
                            <optgroup label="VyÅ¡etrenia"><option value="iae_test">IAE test (infekÄnÃ¡ anÃ©mia)</option><option value="coggins_test">Coggins test</option><option value="examination">VeterinÃ¡rna prehliadka</option><option value="fei_check">FEI veterinÃ¡rna kontrola</option></optgroup>
                            <optgroup label="StarostlivosÅ¥"><option value="deworming">OdÄervenie</option><option value="dental">Zuby</option><option value="farrier">Podkovanie</option></optgroup>
                            <optgroup label="Zdravie"><option value="treatment">LieÄba</option><option value="surgery">Chirurgia</option><option value="injury">Zranenie</option></optgroup>
                        </select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>DÃ¡tum *</label><input type="date" class="form-control" id="vetDate" required></div>
                        <div class="form-group"><label>ÄalÅ¡Ã­ termÃ­n</label><input type="date" class="form-control" id="vetNextDate"></div>
                    </div>
                    <div class="form-group"><label>VeterinÃ¡r</label><input type="text" class="form-control" id="vetVeterinarian" placeholder="MVDr. JÃ¡n KovÃ¡Ä"></div>
                    <div class="form-group" id="vaccineFields" style="display:none">
                        <div class="form-row">
                            <div class="form-group"><label>NÃ¡zov vakcÃ­ny</label><input type="text" class="form-control" id="vetVaccineName"></div>
                            <div class="form-group"><label>Å arÅ¾a</label><input type="text" class="form-control" id="vetVaccineBatch"></div>
                        </div>
                    </div>
                    <div class="form-group"><label>PoznÃ¡mky</label><textarea class="form-control" id="vetNotes"></textarea></div>
                    <div class="form-group"><label>NÃ¡klady (â‚¬)</label><input type="number" class="form-control" id="vetCost" step="0.01"></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('vetModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveVetRecord()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- Feeding Modal -->
    <div class="modal" id="feedingModal">
        <div class="modal-content">
            <div class="modal-header"><h3>ZÃ¡znam kÅ•menia</h3><button class="modal-close" onclick="closeModal('feedingModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="feedingForm">
                    <input type="hidden" id="feedingId">
                    <div class="form-row">
                        <div class="form-group"><label>KÃ´Åˆ *</label><select class="form-control" id="feedHorse" required></select></div>
                        <div class="form-group"><label>DÃ¡tum *</label><input type="date" class="form-control" id="feedDate" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>ÄŒas kÅ•menia</label><select class="form-control" id="feedTime"><option value="morning">RÃ¡no</option><option value="noon">Obed</option><option value="evening">VeÄer</option></select></div>
                        <div class="form-group"><label>KÅ•mil</label><select class="form-control" id="feedBy"></select></div>
                    </div>
                    <div class="form-group"><label>PoznÃ¡mky</label><textarea class="form-control" id="feedNotes"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('feedingModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveFeeding()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- Vaccination Modal -->
    <div class="modal" id="vaccinationModal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="vaccinationModalTitle">Ockovanie</h3><button class="modal-close" onclick="closeModal('vaccinationModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="vaccinationForm">
                    <input type="hidden" id="vaccinationId">
                    <div class="form-row">
                        <div class="form-group"><label>Kon *</label><select class="form-control" id="vaccinationHorse" required></select></div>
                        <div class="form-group"><label>Typ vakciny *</label><input type="text" class="form-control" id="vaccinationType" required placeholder="Chripka, Tetanus..."></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Datum ockovania *</label><input type="date" class="form-control" id="vaccinationDate" required></div>
                        <div class="form-group"><label>Dalsi termin</label><input type="date" class="form-control" id="vaccinationNextDate"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Cislo sarze</label><input type="text" class="form-control" id="vaccinationBatch"></div>
                        <div class="form-group"><label>Veterinar</label><input type="text" class="form-control" id="vaccinationVetName" placeholder="MVDr. Jan Kovac"></div>
                    </div>
                    <div class="form-group"><label>Licencia veterinara</label><input type="text" class="form-control" id="vaccinationVetLicense"></div>
                    <div class="form-group"><label>Poznamky</label><textarea class="form-control" id="vaccinationNotes"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('vaccinationModal')">Zrusit</button><button class="btn btn-primary" onclick="saveVaccination()">Ulozit</button></div>
        </div>
    </div>

    <!-- Feeding Detail Modal -->
    <div class="modal" id="feedingDetailModal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header"><h3>Detail krmenia</h3><button class="modal-close" onclick="closeModal('feedingDetailModal')">Ã—</button></div>
            <div class="modal-body">
                <div id="feedingDetailInfo" style="margin-bottom:1rem;padding:1rem;background:var(--light);border-radius:var(--radius)"></div>
                <h4 style="margin-bottom:1rem">Polozky krmenia</h4>
                <table class="table" id="feedingItemsTable">
                    <thead><tr><th>Typ krmiva</th><th>Mnozstvo</th><th>Jednotka</th><th>Poznamka</th><th>Akcie</th></tr></thead>
                    <tbody></tbody>
                </table>
                <div style="margin-top:1.5rem;padding:1rem;background:rgba(40,167,69,0.1);border-radius:var(--radius)">
                    <h4 style="margin:0 0 1rem 0">Pridat polozku</h4>
                    <div style="display:flex;gap:0.5rem;flex-wrap:wrap;align-items:flex-end">
                        <div class="form-group" style="margin:0;flex:1;min-width:120px"><label>Typ krmiva</label><input type="text" id="newFeedType" class="form-control" placeholder="Seno, ovos..."></div>
                        <div class="form-group" style="margin:0;width:100px"><label>Mnozstvo</label><input type="number" id="newFeedQuantity" class="form-control" step="0.1"></div>
                        <div class="form-group" style="margin:0;width:80px"><label>Jednotka</label><select id="newFeedUnit" class="form-control"><option value="kg">kg</option><option value="l">l</option><option value="ks">ks</option><option value="g">g</option></select></div>
                        <div class="form-group" style="margin:0;flex:1;min-width:120px"><label>Poznamka</label><input type="text" id="newFeedNotes" class="form-control"></div>
                        <button class="btn btn-primary" onclick="addFeedingItem()">Pridat</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('feedingDetailModal')">Zavriet</button></div>
        </div>
    </div>

    <!-- Admin User Modal -->
    <div class="modal" id="adminUserModal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="adminUserModalTitle">Novy admin uzivatel</h3><button class="modal-close" onclick="closeModal('adminUserModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="adminUserForm">
                    <input type="hidden" id="adminUserId">
                    <div class="form-group"><label>Uzivatelske meno *</label><input type="text" class="form-control" id="adminUserUsername" required></div>
                    <div class="form-group"><label>Email</label><input type="email" class="form-control" id="adminUserEmail"></div>
                    <div class="form-group" id="adminUserPasswordGroup"><label>Heslo *</label><input type="password" class="form-control" id="adminUserPassword" placeholder="Min. 6 znakov"></div>
                    <div class="form-row">
                        <div class="form-group"><label>Rola</label><select class="form-control" id="adminUserRole"><option value="admin">Admin</option><option value="editor">Editor</option><option value="viewer">Viewer</option></select></div>
                        <div class="form-group"><label>Status</label><select class="form-control" id="adminUserActive"><option value="true">Aktivny</option><option value="false">Neaktivny</option></select></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('adminUserModal')">Zrusit</button><button class="btn btn-primary" onclick="saveAdminUser()">Ulozit</button></div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header"><h3>NovÃ¡ platba</h3><button class="modal-close" onclick="closeModal('paymentModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="paymentForm">
                    <input type="hidden" id="paymentId">
                    <div class="form-group"><label>Jazdec *</label><select class="form-control" id="paymentRider" required></select></div>
                    <div class="form-row">
                        <div class="form-group"><label>Typ platby *</label><select class="form-control" id="paymentType" required><option value="membership">ÄŒlenskÃ©</option><option value="training">TrÃ©ning</option><option value="stabling">Ustajnenie</option><option value="competition">Preteky</option><option value="sjf_license">SJF licencia</option><option value="fei_registration">FEI registrÃ¡cia</option><option value="vet_services">VeterinÃ¡rne sluÅ¾by</option><option value="other">InÃ©</option></select></div>
                        <div class="form-group"><label>Suma (â‚¬) *</label><input type="number" class="form-control" id="paymentAmount" step="0.01" required></div>
                    </div>
                    <div class="form-group"><label>Popis</label><input type="text" class="form-control" id="paymentDescription"></div>
                    <div class="form-row">
                        <div class="form-group"><label>DÃ¡tum splatnosti</label><input type="date" class="form-control" id="paymentDue"></div>
                        <div class="form-group"><label>Status</label><select class="form-control" id="paymentStatus"><option value="pending">NeuhradenÃ©</option><option value="paid">UhradenÃ©</option><option value="overdue">Po splatnosti</option></select></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('paymentModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="savePayment()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- STABLE LOG MODAL -->
    <div class="modal" id="stableLogModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3 id="stableLogModalTitle">NovÃ½ zÃ¡znam - MaÅ¡taÄ¾nÃ¡ kniha</h3><button class="modal-close" onclick="closeModal('stableLogModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="stableLogForm">
                    <input type="hidden" id="stableLogId">
                    <div class="form-row">
                        <div class="form-group"><label>KÃ´Åˆ</label><select class="form-control" id="stableLogHorseSelect"></select></div>
                        <div class="form-group"><label>Typ udalosti *</label><select class="form-control" id="stableLogEventType" required>
                            <option value="">Vyberte...</option>
                            <option value="arrival">PrÃ­jem koÅˆa</option>
                            <option value="departure">Odchod koÅˆa</option>
                            <option value="transfer">DoÄasnÃ½ presun</option>
                            <option value="return">NÃ¡vrat koÅˆa</option>
                            <option value="quarantine_start">KarantÃ©na</option>
                            <option value="quarantine_end">UkonÄenie karantÃ©ny</option>
                            <option value="death">Ãšhyn koÅˆovitÃ©ho zvieraÅ¥a</option>
                        </select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>DÃ¡tum *</label><input type="date" class="form-control" id="stableLogDate" required></div>
                        <div class="form-group"><label>ÄŒas</label><input type="time" class="form-control" id="stableLogTime"></div>
                        <div class="form-group"><label>DÃ¡tum do</label><input type="date" class="form-control" id="stableLogDateTo"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Miesto odkiaÄ¾</label><input type="text" class="form-control" id="stableLogFrom" placeholder="napr. JK ZelenÃ¡ mÃ­Ä¾a"></div>
                        <div class="form-group"><label>Miesto kam</label><input type="text" class="form-control" id="stableLogTo" placeholder="napr. VeterinÃ¡rna klinika"></div>
                    </div>
                    <div class="form-group"><label>DÃ´vod</label><input type="text" class="form-control" id="stableLogReason" placeholder="napr. Preteky, LieÄba, TrÃ©ning"></div>
                    <div class="form-row">
                        <div class="form-group"><label>ZodpovednÃ¡ osoba *</label><input type="text" class="form-control" id="stableLogResponsible" required placeholder="Meno a priezvisko"></div>
                        <div class="form-group"><label>Zamestnanec (voliteÄ¾nÃ©)</label><select class="form-control" id="stableLogEmployee"><option value="">-- NevybranÃ© --</option></select></div>
                    </div>
                    <div class="form-group"><label>PoznÃ¡mka</label><textarea class="form-control" id="stableLogNotes" rows="2"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('stableLogModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveStableLog()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- VISIT LOG MODAL -->
    <div class="modal" id="visitLogModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3 id="visitLogModalTitle">NovÃ½ zÃ¡znam - NÃ¡vÅ¡tevnÃ¡ kniha</h3><button class="modal-close" onclick="closeModal('visitLogModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="visitLogForm">
                    <input type="hidden" id="visitLogId">
                    <div class="form-row">
                        <div class="form-group"><label>Meno nÃ¡vÅ¡tevnÃ­ka *</label><input type="text" class="form-control" id="visitLogName" required></div>
                        <div class="form-group"><label>OrganizÃ¡cia / Firma</label><input type="text" class="form-control" id="visitLogOrg"></div>
                    </div>
                    <div class="form-group"><label>ÃšÄel nÃ¡vÅ¡tevy *</label><input type="text" class="form-control" id="visitLogPurpose" required placeholder="napr. Servis, VeterinÃ¡r, Kontrola, NÃ¡vÅ¡teva"></div>
                    <div class="form-row">
                        <div class="form-group"><label>TelefÃ³n</label><input type="tel" class="form-control" id="visitLogPhone"></div>
                        <div class="form-group"><label>Email</label><input type="email" class="form-control" id="visitLogEmail"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>DÃ¡tum prÃ­chodu *</label><input type="date" class="form-control" id="visitLogArrivalDate" required></div>
                        <div class="form-group"><label>ÄŒas prÃ­chodu *</label><input type="time" class="form-control" id="visitLogArrivalTime" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>DÃ¡tum odchodu</label><input type="date" class="form-control" id="visitLogDepartureDate"></div>
                        <div class="form-group"><label>ÄŒas odchodu</label><input type="time" class="form-control" id="visitLogDepartureTime"></div>
                    </div>
                    <div class="form-group"><label>Sprievod / ZodpovednÃ¡ osoba z klubu *</label><input type="text" class="form-control" id="visitLogEscort" required></div>
                    <div class="form-row">
                        <div class="form-group"><label><input type="checkbox" id="visitLogSafety"> BOZP pouÄenie</label></div>
                        <div class="form-group"><label>Podpis (text)</label><input type="text" class="form-control" id="visitLogSignature" placeholder="Pre tlaÄ"></div>
                    </div>
                    <div class="form-group"><label>PoznÃ¡mka</label><textarea class="form-control" id="visitLogNotes" rows="2"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('visitLogModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveVisitLog()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- DOCUMENT MODAL -->
    <div class="modal" id="docModal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header"><h3 id="docModalTitle">PridaÅ¥ dokument</h3><button class="modal-close" onclick="closeModal('docModal')">Ã—</button></div>
            <div class="modal-body">
                <form id="docForm">
                    <input type="hidden" id="docId">
                    <input type="hidden" id="docForHorseId">
                    <div class="form-group"><label>NÃ¡zov dokumentu *</label><input type="text" class="form-control" id="docTitle" required></div>
                    <div class="form-row">
                        <div class="form-group"><label>KategÃ³ria *</label><select class="form-control" id="docCategory" required>
                            <option value="">Vyberte...</option>
                            <option value="passport">Pas koÅˆa</option>
                            <option value="vet_doc">VeterinÃ¡rny doklad</option>
                            <option value="death">Ãšhyn</option>
                            <option value="rendering">KafilÃ©ria</option>
                            <option value="license">Licencia</option>
                            <option value="receipt">PrÃ­jemka</option>
                            <option value="request">Å½iadanka</option>
                            <option value="mail">PoÅ¡ta</option>
                            <option value="contract">Zmluva</option>
                            <option value="other">InÃ©</option>
                        </select></div>
                        <div class="form-group"><label>DÃ¡tum dokumentu</label><input type="date" class="form-control" id="docDate"></div>
                    </div>
                    <div class="form-group"><label>Popis</label><textarea class="form-control" id="docDescription" rows="2"></textarea></div>
                    
                    <div class="form-group">
                        <label>SÃºbor (max 4MB)</label>
                        <div style="display:flex;gap:0.5rem;align-items:center">
                            <input type="file" id="docFileInput" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" onchange="handleDocFileSelect(this)" style="flex:1">
                            <span id="docUploadStatus" style="font-size:0.85rem;color:var(--gray)"></span>
                        </div>
                        <input type="hidden" id="docFileUrl">
                        <small id="docFileLink" style="display:none;margin-top:0.5rem"><a href="#" target="_blank" id="docFileLinkUrl">ğŸ“„ ZobraziÅ¥ sÃºbor</a></small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group"><label>VÃ¤zba na koÅˆa</label><select class="form-control" id="docHorse"><option value="">-- NevybranÃ© --</option></select></div>
                        <div class="form-group"><label><input type="checkbox" id="docIsClub"> Dokument klubu/prevÃ¡dzky</label></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>VÃ¤zba na zÃ¡znam maÅ¡tale</label><select class="form-control" id="docStableLog"><option value="">-- NevybranÃ© --</option></select></div>
                        <div class="form-group"><label>VÃ¤zba na nÃ¡vÅ¡tevu</label><select class="form-control" id="docVisitLog"><option value="">-- NevybranÃ© --</option></select></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('docModal')">ZruÅ¡iÅ¥</button><button class="btn btn-primary" onclick="saveDoc()">UloÅ¾iÅ¥</button></div>
        </div>
    </div>

    <!-- HORSE DETAIL MODAL -->
    <div class="modal" id="horseDetailModal">
        <div class="modal-content" style="max-width:900px;max-height:90vh;overflow:auto">
            <div class="modal-header">
                <h3 id="horseDetailTitle">Detail koÅˆa</h3>
                <button class="modal-close" onclick="closeModal('horseDetailModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="tabs" style="margin-bottom:1rem">
                    <div class="tab active" data-horse-tab="info">ğŸ“‹ ZÃ¡kladnÃ© info</div>
                    <div class="tab" data-horse-tab="docs">ğŸ“ Dokumenty</div>
                    <div class="tab" data-horse-tab="history">ğŸ“– HistÃ³ria maÅ¡tale</div>
                    <div class="tab" data-horse-tab="vet">ğŸ¥ VeterinÃ¡rne zÃ¡znamy</div>
                </div>
                
                <div id="horseTabInfo" class="horse-tab-content">
                    <div id="horseDetailInfo">NaÄÃ­tavam...</div>
                </div>
                
                <div id="horseTabDocs" class="horse-tab-content" style="display:none">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
                        <h4 style="margin:0">Dokumenty koÅˆa</h4>
                        <button class="btn btn-primary btn-sm" onclick="openDocModalForHorse()">+ PridaÅ¥ dokument</button>
                    </div>
                    <table class="table">
                        <thead><tr><th>DÃ¡tum</th><th>NÃ¡zov</th><th>KategÃ³ria</th><th>SÃºbor</th><th>Akcie</th></tr></thead>
                        <tbody id="horseDocsTable"></tbody>
                    </table>
                </div>
                
                <div id="horseTabHistory" class="horse-tab-content" style="display:none">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
                        <h4 style="margin:0">HistÃ³ria maÅ¡tale</h4>
                        <button class="btn btn-primary btn-sm" onclick="openStableLogForHorse()">+ PridaÅ¥ zÃ¡znam</button>
                    </div>
                    <table class="table">
                        <thead><tr><th>DÃ¡tum</th><th>UdalosÅ¥</th><th>Miesto</th><th>ZodpovednÃ½</th><th>PoznÃ¡mka</th><th>Akcie</th></tr></thead>
                        <tbody id="horseHistoryTable"></tbody>
                    </table>
                </div>
                
                <div id="horseTabVet" class="horse-tab-content" style="display:none">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
                        <h4 style="margin:0">VeterinÃ¡rne zÃ¡znamy</h4>
                        <button class="btn btn-primary btn-sm" onclick="openVetForHorse()">+ PridaÅ¥ zÃ¡znam</button>
                    </div>
                    <table class="table">
                        <thead><tr><th>DÃ¡tum</th><th>Typ</th><th>VeterinÃ¡r</th><th>ÄalÅ¡Ã­ termÃ­n</th><th>PoznÃ¡mka</th></tr></thead>
                        <tbody id="horseVetTable"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="printHorseDetail()">ğŸ–¨ï¸ TlaÄ karty</button>
                <button class="btn btn-primary" onclick="closeModal('horseDetailModal')">ZavrieÅ¥</button>
            </div>
        </div>
    </div>

    <!-- PRINT MODAL -->
    <div class="modal" id="printModal">
        <div class="modal-content" style="max-width:900px;max-height:90vh;overflow:auto">
            <div class="modal-header"><h3 id="printModalTitle">TlaÄ</h3><button class="modal-close" onclick="closeModal('printModal')">Ã—</button></div>
            <div class="modal-body" id="printContent" style="background:white;padding:2rem"></div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('printModal')">ZavrieÅ¥</button><button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ TlaÄiÅ¥</button></div>
        </div>
    </div>

    <!-- Audit Detail Modal -->
    <div class="modal" id="auditDetailModal">
        <div class="modal-content" style="max-width:900px;max-height:90vh;overflow:auto">
            <div class="modal-header"><h3>Detail zmeny</h3><button class="modal-close" onclick="closeModal('auditDetailModal')">x</button></div>
            <div class="modal-body" id="auditDetailContent"></div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('auditDetailModal')">Zatvorit</button></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
    let token = localStorage.getItem('jkzm_token');
    let horses = [], riders = [], trainers = [], employees = [], trainings = [], vetRecords = [], payments = [], bookings = [], messages = [], competitions = [];

    // Initialize
    if (token) { showApp(); loadAll(); } else { document.getElementById('loginPage').style.display = 'flex'; }

    // Login
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            const res = await fetch('/api/auth-login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email: document.getElementById('loginEmail').value, password: document.getElementById('loginPassword').value})
            });
            const data = await res.json();
            if (data.token) { token = data.token; localStorage.setItem('jkzm_token', token); showApp(); loadAll(); }
            else { showToast(data.error || 'NesprÃ¡vne prihlasovacie Ãºdaje', 'error'); }
        } catch(e) { showToast('Chyba pripojenia', 'error'); }
    });

    function showApp() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('sk-SK', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
        // NaÄÃ­taÅ¥ sekciu z URL hash
        setTimeout(loadSectionFromHash, 200);
    }

    function logout() { localStorage.removeItem('jkzm_token'); location.reload(); }

    // Navigation
    document.querySelectorAll('.nav-item[data-section]').forEach(item => {
        item.addEventListener('click', () => showSection(item.dataset.section));
    });

    function showSection(section) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.querySelector(`.nav-item[data-section="${section}"]`)?.classList.add('active');
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(section)?.classList.add('active');
        // UloÅ¾iÅ¥ do URL hash
        window.location.hash = section;
    }
    
    // NaÄÃ­taÅ¥ sekciu z URL hash pri Å¡tarte
    function loadSectionFromHash() {
        const hash = window.location.hash.substring(1);
        if (hash && document.getElementById(hash)) {
            showSection(hash);
            // NaÄÃ­taÅ¥ dÃ¡ta pre danÃº sekciu
            if (hash === 'tasks') setTimeout(loadTasks, 100);
            if (hash === 'notifications') setTimeout(loadNotifications, 100);
            if (hash === 'audit-trail') { setTimeout(initAuditFilters, 100); setTimeout(loadAuditLogs, 150); }
            if (hash === 'exports') setTimeout(() => showExportTab('stable-log'), 100);
            if (hash === 'articles') setTimeout(loadArticles, 100);
            if (hash === 'gallery') setTimeout(loadAlbums, 100);
            if (hash === 'pages') setTimeout(loadPages, 100);
            if (hash === 'documents') setTimeout(loadDocuments, 100);
            if (hash === 'partners') setTimeout(loadPartners, 100);
            if (hash === 'services') setTimeout(loadServices, 100);
            if (hash === 'web-settings') setTimeout(loadSettings, 100);
        }
    }

    // Modal tabs
    document.querySelectorAll('[data-modal-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
            const parent = tab.closest('.modal-body');
            parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            parent.querySelectorAll('.modal-tab-content').forEach(c => c.style.display = 'none');
            tab.classList.add('active');
            document.getElementById(tab.dataset.modalTab).style.display = 'block';
        });
    });

    // API calls
    async function api(endpoint, method = 'GET', body = null) {
        const opts = {method, headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`}};
        if (body) opts.body = JSON.stringify(body);
        const res = await fetch(`/api/${endpoint}`, opts);
        const data = await res.json();
        // Ak je 401, presmeruj na login
        if (res.status === 401) {
            showToast('Neautorizovane - prihlaste sa znova', 'error');
            localStorage.removeItem('jkzm_token');
            setTimeout(() => location.reload(), 1500);
            throw new Error('Unauthorized');
        }
        // Ak je error v response, vrat prazdne pole pre GET list endpointy
        if (data && data.error && method === 'GET' && !endpoint.includes('/')) {
            console.warn('API error for', endpoint, ':', data.error);
            return [];
        }
        return data;
    }

    async function loadAll() {
        console.log('Loading all data...');
        try {
            // Nacitaj paralelne, ale s fallbackom
            const results = await Promise.allSettled([
                api('horses'), api('riders'), api('trainers'), api('employees'), api('trainings'), 
                api('vet-records'), api('payments'), api('bookings'), api('contact'), api('competitions')
            ]);
            
            // Bezpecne extrahovanie hodnot - skontroluj fulfilled status
            const getValue = (result) => {
                if (result.status === 'fulfilled' && Array.isArray(result.value)) {
                    return result.value;
                }
                return [];
            };
            
            horses = getValue(results[0]);
            riders = getValue(results[1]);
            trainers = getValue(results[2]);
            employees = getValue(results[3]);
            trainings = getValue(results[4]);
            vetRecords = getValue(results[5]);
            payments = getValue(results[6]);
            bookings = getValue(results[7]);
            messages = getValue(results[8]);
            competitions = getValue(results[9]);
            
            console.log('Loaded: horses=' + horses.length + ', riders=' + riders.length + ', trainers=' + trainers.length);
        } catch(e) {
            console.error('loadAll error:', e);
            horses = []; riders = []; trainers = []; employees = [];
            trainings = []; vetRecords = []; payments = [];
            bookings = []; messages = []; competitions = [];
        }
        renderAll();
        loadDashboard();
        populateSelects();
    }

    function loadDashboard() {
        document.getElementById('statHorses').textContent = horses.filter(h => h.status === 'active').length;
        document.getElementById('statRiders').textContent = riders.filter(r => r.status === 'active').length;
        const today = new Date().toISOString().split('T')[0];
        const todayTrainings = trainings.filter(t => t.date === today);
        document.getElementById('statTrainings').textContent = todayTrainings.length;
        
        // Alerts - calculate overdue vaccinations, licenses etc
        let alerts = [];
        const now = new Date();
        const in30days = new Date(now.getTime() + 30*24*60*60*1000);
        
        // Check horse vaccinations (simplified - would normally check vet_records)
        horses.forEach(h => {
            if (h.sjf_license_valid_until && new Date(h.sjf_license_valid_until) < in30days) {
                alerts.push({type: 'warning', title: `SJF licencia - ${h.name}`, text: 'BlÃ­Å¾i sa vyprÅ¡anie licencie'});
            }
        });
        
        document.getElementById('statAlerts').textContent = alerts.length;
        document.getElementById('alertBadge').textContent = alerts.length;
        
        // Critical alerts
        const criticalHtml = alerts.slice(0, 3).map(a => 
            `<div class="alert alert-${a.type}"><span>âš ï¸</span><div><strong>${a.title}</strong> - ${a.text}</div></div>`
        ).join('');
        document.getElementById('criticalAlerts').innerHTML = criticalHtml;
        
        // Today's trainings
        document.getElementById('todayTrainings').innerHTML = todayTrainings.length ? todayTrainings.map(t => {
            const rider = riders.find(r => r.id === t.rider_id);
            const horse = horses.find(h => h.id === t.horse_id);
            return `<div style="display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--gray-light)">
                <div><strong>${t.start_time}</strong> - ${rider?.first_name || ''} ${rider?.last_name || ''} na ${horse?.name || ''}</div>
                <span class="badge badge-${t.status === 'completed' ? 'success' : 'info'}">${t.status}</span>
            </div>`;
        }).join('') : '<p style="color:var(--gray)">Å½iadne trÃ©ningy dnes</p>';
        
        // Upcoming deadlines
        document.getElementById('upcomingDeadlines').innerHTML = alerts.length ? alerts.slice(0, 5).map(a => 
            `<div style="display:flex;gap:0.75rem;padding:0.75rem 0;border-bottom:1px solid var(--gray-light)">
                <span>âš ï¸</span><div><strong>${a.title}</strong><br><small style="color:var(--gray)">${a.text}</small></div>
            </div>`
        ).join('') : '<p style="color:var(--gray)">Å½iadne blÃ­Å¾iace sa termÃ­ny</p>';
    }

    function populateSelects() {
        // Horse selects - zobraz stable_name ak existuje
        const activeHorses = horses.filter(h => h.status === 'active');
        const horseOpts = activeHorses.length 
            ? '<option value="">Vyberte kona</option>' + activeHorses.map(h => {
                const label = h.stable_name ? `${h.stable_name} (${h.name})` : h.name;
                return `<option value="${h.id}">${label}</option>`;
            }).join('')
            : '<option value="">Ziadne kone - najprv pridajte v sekcii Kone</option>';
        
        document.querySelectorAll('#trainingHorse, #vetHorse, #feedHorse, #vetHorseFilter, #vaccinationHorse').forEach(s => { 
            if(s) s.innerHTML = horseOpts; 
        });
        
        console.log('Populated horse selects with', activeHorses.length, 'horses');
        
        // Rider selects
        const riderOpts = '<option value="">Vyberte jazdca</option>' + riders.filter(r => r.status === 'active').map(r => `<option value="${r.id}">${r.first_name} ${r.last_name}</option>`).join('');
        document.querySelectorAll('#trainingRider, #paymentRider').forEach(s => s.innerHTML = riderOpts);
        
        // Trainer selects
        const trainerOpts = '<option value="">Vyberte trÃ©nera</option>' + trainers.filter(t => t.status === 'active').map(t => `<option value="${t.id}">${t.first_name} ${t.last_name}</option>`).join('');
        document.querySelectorAll('#trainingTrainer').forEach(s => s.innerHTML = trainerOpts);
        
        // Employee selects
        const empOpts = '<option value="">Vyberte</option>' + employees.filter(e => e.status === 'active').map(e => `<option value="${e.id}">${e.first_name} ${e.last_name}</option>`).join('');
        document.querySelectorAll('#feedBy').forEach(s => s.innerHTML = empOpts);
    }

    function renderAll() {
        renderHorses();
        renderRiders();
        renderTrainers();
        renderEmployees();
        renderTrainings();
        renderPayments();
        renderBookings();
        renderMessages();
        renderFeeding();
        renderVetRecords();
    }

    // Render functions
    function renderHorses() {
        const levelLabels = {beginner:'ZaÄiatoÄnÃ­ci',intermediate:'PokroÄilÃ­',advanced:'SkÃºsenÃ­',children:'Deti',competition:'SÃºÅ¥aÅ¾nÃ½'};
        document.getElementById('horsesTable').innerHTML = horses.map(h => `
            <tr>
                <td><strong>${h.name}</strong>${h.stable_name ? `<br><small style="color:var(--gray)">${h.stable_name}</small>` : ''}</td>
                <td>${h.breed || '-'}</td>
                <td><small>${h.passport_number || '-'}<br>${h.life_number || ''}</small></td>
                <td><small>${h.microchip || '-'}</small></td>
                <td>${h.sjf_license_number ? `<span class="badge badge-success">SJF</span>` : ''}${h.fei_id ? ` <span class="badge badge-info">FEI</span>` : ''}</td>
                <td>${h.vaccination_status || '<span class="badge badge-warning">SkontrolovaÅ¥</span>'}</td>
                <td><span class="badge badge-${h.status === 'active' ? 'success' : 'gray'}">${h.status}</span></td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="openHorseDetail('${h.id}')" title="Detail">ğŸ‘ï¸</button>
                    <button class="btn btn-sm btn-outline" onclick="editHorse('${h.id}')" title="UpraviÅ¥">âœï¸</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteHorse('${h.id}')" title="ZmazaÅ¥">ğŸ—‘ï¸</button>
                </td>
            </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--gray)">Å½iadne kone</td></tr>';
    }

    function renderRiders() {
        const catLabels = {children:'Deti',pony:'Pony',junior:'Junior',young_rider:'MladÃ½ jazdec',senior:'Senior',amateur:'AmatÃ©r'};
        const levelLabels = {beginner:'ZaÄiatoÄnÃ­k',intermediate:'PokroÄilÃ½',advanced:'SkÃºsenÃ½',competition:'SÃºÅ¥aÅ¾nÃ½'};
        const licLabels = {none:'Hobby',szvj:'SZVJ',national:'NÃ¡rodnÃ¡',international:'MedzinÃ¡rodnÃ¡'};
        document.getElementById('ridersTable').innerHTML = riders.map(r => `
            <tr>
                <td><strong>${r.first_name} ${r.last_name}</strong></td>
                <td><span class="badge badge-info">${catLabels[r.category] || r.category || '-'}</span></td>
                <td>${r.sjf_license_number || '-'}<br><small>${licLabels[r.sjf_license_type] || ''}</small></td>
                <td>${r.fei_id || '-'}</td>
                <td>${levelLabels[r.level] || '-'}</td>
                <td><span class="badge badge-${r.medical_certificate_valid ? 'success' : 'danger'}">${r.medical_certificate_valid ? 'PlatnÃ©' : 'NeplatnÃ©'}</span></td>
                <td><span class="badge badge-${r.status === 'active' ? 'success' : 'gray'}">${r.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editRider('${r.id}')">âœï¸</button> <button class="btn btn-sm btn-danger" onclick="deleteRider('${r.id}')">ğŸ—‘ï¸</button></td>
            </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--gray)">Å½iadni jazdci</td></tr>';
    }

    function renderTrainers() {
        document.getElementById('trainersTable').innerHTML = trainers.map(t => `
            <tr>
                <td><strong>${t.first_name} ${t.last_name}</strong></td>
                <td>${t.sjf_trainer_level ? `${t.sjf_trainer_level}. stupeÅˆ` : '-'}</td>
                <td>${(t.specializations || []).join(', ') || '-'}</td>
                <td>${t.employment_type || '-'}</td>
                <td><span class="badge badge-${t.status === 'active' ? 'success' : 'gray'}">${t.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editTrainer('${t.id}')">âœï¸</button> <button class="btn btn-sm btn-danger" onclick="deleteTrainer('${t.id}')">ğŸ—‘ï¸</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Å½iadni trÃ©neri</td></tr>';
    }

    function renderEmployees() {
        document.getElementById('employeesTable').innerHTML = employees.map(e => `
            <tr>
                <td><strong>${e.first_name} ${e.last_name}</strong></td>
                <td>${e.position || '-'}</td>
                <td>${e.phone || '-'}</td>
                <td>${e.employment_type || '-'}</td>
                <td><span class="badge badge-${e.status === 'active' ? 'success' : 'gray'}">${e.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editEmployee('${e.id}')">âœï¸</button> <button class="btn btn-sm btn-danger" onclick="deleteEmployee('${e.id}')">ğŸ—‘ï¸</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Å½iadni zamestnanci</td></tr>';
    }

    function renderTrainings() {
        const typeLabels = {individual:'IndividuÃ¡lny',group:'SkupinovÃ½',longe:'LonÅ¾ovanie',jumping:'Skoky',dressage:'DrezÃºra',cross_country:'TerÃ©n',theory:'TeÃ³ria',szvj_preparation:'SZVJ prÃ­prava',competition_prep:'PrÃ­prava preteky'};
        document.getElementById('trainingsTable').innerHTML = trainings.map(t => {
            const rider = riders.find(r => r.id === t.rider_id);
            const horse = horses.find(h => h.id === t.horse_id);
            const trainer = trainers.find(tr => tr.id === t.trainer_id);
            return `<tr>
                <td><strong>${t.date}</strong><br><small>${t.start_time}</small></td>
                <td>${rider ? `${rider.first_name} ${rider.last_name}` : '-'}</td>
                <td>${horse?.name || '-'}</td>
                <td>${trainer ? `${trainer.first_name} ${trainer.last_name}` : '-'}</td>
                <td>${typeLabels[t.training_type] || t.training_type || '-'}</td>
                <td><span class="badge badge-${t.status === 'completed' ? 'success' : t.status === 'cancelled' ? 'danger' : 'info'}">${t.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="editTraining('${t.id}')">âœï¸</button> <button class="btn btn-sm btn-danger" onclick="deleteTraining('${t.id}')">ğŸ—‘ï¸</button></td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">Å½iadne trÃ©ningy</td></tr>';
    }

    function renderPayments() {
        const typeLabels = {membership:'ÄŒlenskÃ©',training:'TrÃ©ning',stabling:'Ustajnenie',competition:'Preteky',sjf_license:'SJF licencia',fei_registration:'FEI',vet_services:'VeterinÃ¡r',other:'InÃ©'};
        document.getElementById('paymentsTable').innerHTML = payments.map(p => {
            const rider = riders.find(r => r.id === p.rider_id);
            return `<tr>
                <td>${p.payment_date || p.created_at?.split('T')[0] || '-'}</td>
                <td>${rider ? `${rider.first_name} ${rider.last_name}` : '-'}</td>
                <td>${typeLabels[p.payment_type] || p.payment_type || '-'}</td>
                <td>${p.description || '-'}</td>
                <td><strong>${p.amount} â‚¬</strong></td>
                <td><span class="badge badge-${p.status === 'paid' ? 'success' : p.status === 'overdue' ? 'danger' : 'warning'}">${p.status}</span></td>
                <td><button class="btn btn-sm btn-danger" onclick="deletePayment('${p.id}')">ğŸ—‘ï¸</button></td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">Å½iadne platby</td></tr>';
    }

    function renderBookings() {
        document.getElementById('bookingsTable').innerHTML = bookings.map(b => `
            <tr>
                <td>${b.created_at?.split('T')[0] || '-'}</td>
                <td><strong>${b.name}</strong><br><small>${b.email}</small></td>
                <td>${b.service || '-'}</td>
                <td>${b.preferred_date || '-'} ${b.preferred_time || ''}</td>
                <td><span class="badge badge-${b.status === 'confirmed' ? 'success' : 'warning'}">${b.status}</span></td>
                <td><button class="btn btn-sm btn-primary" onclick="confirmBooking('${b.id}')">âœ“</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Å½iadne rezervÃ¡cie</td></tr>';
    }

    function renderMessages() {
        document.getElementById('messagesTable').innerHTML = messages.map(m => `
            <tr>
                <td>${m.created_at?.split('T')[0] || '-'}</td>
                <td><strong>${m.name}</strong></td>
                <td>${m.email}</td>
                <td style="max-width:300px;overflow:hidden;text-overflow:ellipsis">${m.message}</td>
                <td><span class="badge badge-${m.status === 'read' ? 'gray' : 'warning'}">${m.status}</span></td>
                <td><button class="btn btn-sm btn-outline" onclick="markMessageRead('${m.id}')">ğŸ“–</button></td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Å½iadne sprÃ¡vy</td></tr>';
    }

    // Modal functions
    function openModal(id) { 
        // Najprv naplnit selecty
        populateSelects();
        
        // Reset formulÃ¡ru pre novÃ© poloÅ¾ky
        if (id === 'horseModal') resetHorseForm();
        if (id === 'riderModal') resetRiderForm();
        if (id === 'trainerModal') resetTrainerForm();
        if (id === 'employeeModal') resetEmployeeForm();
        if (id === 'trainingModal') resetTrainingForm();
        if (id === 'vetModal') resetVetForm();
        if (id === 'feedingModal') resetFeedingForm();
        document.getElementById(id).classList.add('active'); 
    }
    
    // Zobraz modal BEZ resetovania (pre edit)
    function showModalOnly(id) {
        // Naplnit selecty pred otvorenim
        populateSelects();
        document.getElementById(id).classList.add('active');
    }
    
    function showModal(id) {
        document.getElementById(id).classList.add('active');
    }
    
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // Reset forms
    function resetHorseForm() {
        document.getElementById('horseId').value = '';
        document.getElementById('horseName').value = '';
        document.getElementById('horseStableName').value = '';
        document.getElementById('horseBreed').value = '';
        document.getElementById('horseColor').value = '';
        document.getElementById('horseSex').value = 'gelding';
        document.getElementById('horseBirth').value = '';
        document.getElementById('horseHeight').value = '';
        document.getElementById('horseWeight').value = '';
        document.getElementById('horsePassport').value = '';
        document.getElementById('horseLifeNumber').value = '';
        document.getElementById('horseMicrochip').value = '';
        document.getElementById('horseFeiId').value = '';
        document.getElementById('horseFeiExpiry').value = '';
        document.getElementById('horseSjfLicense').value = '';
        document.getElementById('horseSjfExpiry').value = '';
        document.getElementById('horseOwner').value = '';
        document.getElementById('horseLevel').value = 'beginner';
        document.getElementById('horseStatus').value = 'active';
        document.getElementById('horseNotes').value = '';
        document.querySelectorAll('.horseDiscipline').forEach(c => c.checked = false);
        document.getElementById('horseModalTitle').textContent = 'Pridat kona';
    }
    
    function resetRiderForm() {
        document.getElementById('riderId').value = '';
        document.getElementById('riderFirstName').value = '';
        document.getElementById('riderLastName').value = '';
        document.getElementById('riderBirth').value = '';
        document.getElementById('riderGender').value = 'female';
        document.getElementById('riderEmail').value = '';
        document.getElementById('riderPhone').value = '';
        document.getElementById('riderSjfLicense').value = '';
        document.getElementById('riderSjfType').value = 'none';
        document.getElementById('riderSjfExpiry').value = '';
        document.getElementById('riderSzvjDate').value = '';
        document.getElementById('riderFeiId').value = '';
        document.getElementById('riderFeiExpiry').value = '';
        document.getElementById('riderCategory').value = 'senior';
        document.getElementById('riderLevel').value = 'beginner';
        document.getElementById('riderMedical').value = 'false';
        document.getElementById('riderMedicalExpiry').value = '';
        document.getElementById('riderModalTitle').textContent = 'Pridat jazdca';
    }
    
    function resetTrainerForm() {
        if (document.getElementById('trainerId')) document.getElementById('trainerId').value = '';
        if (document.getElementById('trainerFirstName')) document.getElementById('trainerFirstName').value = '';
        if (document.getElementById('trainerLastName')) document.getElementById('trainerLastName').value = '';
        if (document.getElementById('trainerModalTitle')) document.getElementById('trainerModalTitle').textContent = 'Pridat trenera';
    }
    
    function resetEmployeeForm() {
        if (document.getElementById('employeeId')) document.getElementById('employeeId').value = '';
        if (document.getElementById('employeeFirstName')) document.getElementById('employeeFirstName').value = '';
        if (document.getElementById('employeeLastName')) document.getElementById('employeeLastName').value = '';
        if (document.getElementById('employeeModalTitle')) document.getElementById('employeeModalTitle').textContent = 'Pridat zamestnanca';
    }
    
    function resetTrainingForm() {
        if (document.getElementById('trainingId')) document.getElementById('trainingId').value = '';
        if (document.getElementById('trainingDate')) document.getElementById('trainingDate').value = new Date().toISOString().split('T')[0];
        if (document.getElementById('trainingStartTime')) document.getElementById('trainingStartTime').value = '';
        if (document.getElementById('trainingModalTitle')) document.getElementById('trainingModalTitle').textContent = 'Novy trening';
    }
    
    function resetVetForm() {
        if (document.getElementById('vetId')) document.getElementById('vetId').value = '';
        if (document.getElementById('vetHorse')) document.getElementById('vetHorse').value = '';
        if (document.getElementById('vetType')) document.getElementById('vetType').value = '';
        if (document.getElementById('vetDate')) document.getElementById('vetDate').value = new Date().toISOString().split('T')[0];
        if (document.getElementById('vetNextDate')) document.getElementById('vetNextDate').value = '';
        if (document.getElementById('vetVeterinarian')) document.getElementById('vetVeterinarian').value = '';
        if (document.getElementById('vetNotes')) document.getElementById('vetNotes').value = '';
    }
    
    function resetFeedingForm() {
        if (document.getElementById('feedingId')) document.getElementById('feedingId').value = '';
        if (document.getElementById('feedHorse')) document.getElementById('feedHorse').value = '';
        if (document.getElementById('feedDate')) document.getElementById('feedDate').value = new Date().toISOString().split('T')[0];
        if (document.getElementById('feedTime')) document.getElementById('feedTime').value = 'morning';
        if (document.getElementById('feedBy')) document.getElementById('feedBy').value = '';
        if (document.getElementById('feedNotes')) document.getElementById('feedNotes').value = '';
    }

    // CRUD - Horses
    async function saveHorse() {
        const id = document.getElementById('horseId').value;
        const data = {
            name: document.getElementById('horseName').value,
            stable_name: document.getElementById('horseStableName').value,
            breed: document.getElementById('horseBreed').value,
            color: document.getElementById('horseColor').value,
            sex: document.getElementById('horseSex').value,
            birth_date: document.getElementById('horseBirth').value || null,
            height_cm: document.getElementById('horseHeight').value || null,
            weight_kg: document.getElementById('horseWeight').value || null,
            passport_number: document.getElementById('horsePassport').value,
            life_number: document.getElementById('horseLifeNumber').value,
            microchip: document.getElementById('horseMicrochip').value,
            fei_id: document.getElementById('horseFeiId').value,
            fei_passport_expiry: document.getElementById('horseFeiExpiry').value || null,
            sjf_license_number: document.getElementById('horseSjfLicense').value,
            sjf_license_valid_until: document.getElementById('horseSjfExpiry').value || null,
            owner_name: document.getElementById('horseOwner').value,
            level: document.getElementById('horseLevel').value,
            status: document.getElementById('horseStatus').value,
            disciplines: Array.from(document.querySelectorAll('.horseDiscipline:checked')).map(c => c.value),
            notes: document.getElementById('horseNotes').value
        };
        
        if (!data.name) {
            showToast('Meno kona je povinne', 'error');
            return;
        }
        
        try {
            const result = await api(id ? `horses/${id}` : 'horses', id ? 'PUT' : 'POST', data);
            if (result && result.error) {
                showToast(result.error, 'error');
                return;
            }
            closeModal('horseModal');
            showToast(id ? 'Kon upraveny!' : 'Kon pridany!', 'success');
            // Refresh horses
            const newHorses = await api('horses');
            horses = Array.isArray(newHorses) ? newHorses : [];
            renderHorses();
            populateSelects();
        } catch(e) {
            console.error('saveHorse error:', e);
            showToast('Chyba pri ukladani', 'error');
        }
    }

    function editHorse(id) {
        const h = horses.find(x => x.id === id);
        if (!h) {
            showToast('Kon sa nenasiel', 'error');
            return;
        }
        document.getElementById('horseId').value = h.id;
        document.getElementById('horseName').value = h.name || '';
        document.getElementById('horseStableName').value = h.stable_name || '';
        document.getElementById('horseBreed').value = h.breed || '';
        document.getElementById('horseColor').value = h.color || '';
        document.getElementById('horseSex').value = h.sex || 'gelding';
        document.getElementById('horseBirth').value = h.birth_date?.split('T')[0] || '';
        document.getElementById('horseHeight').value = h.height_cm || '';
        document.getElementById('horseWeight').value = h.weight_kg || '';
        document.getElementById('horsePassport').value = h.passport_number || '';
        document.getElementById('horseLifeNumber').value = h.life_number || '';
        document.getElementById('horseMicrochip').value = h.microchip || '';
        document.getElementById('horseFeiId').value = h.fei_id || '';
        document.getElementById('horseFeiExpiry').value = h.fei_passport_expiry?.split('T')[0] || '';
        document.getElementById('horseSjfLicense').value = h.sjf_license_number || '';
        document.getElementById('horseSjfExpiry').value = h.sjf_license_valid_until?.split('T')[0] || '';
        document.getElementById('horseOwner').value = h.owner_name || '';
        document.getElementById('horseLevel').value = h.level || 'beginner';
        document.getElementById('horseStatus').value = h.status || 'active';
        document.getElementById('horseNotes').value = h.notes || '';
        document.querySelectorAll('.horseDiscipline').forEach(c => c.checked = (h.disciplines || []).includes(c.value));
        document.getElementById('horseModalTitle').textContent = 'Upravit kona';
        showModalOnly('horseModal');
    }

    async function deleteHorse(id) {
        if (!confirm('Naozaj vymazat tohto kona?')) return;
        try {
            const result = await api(`horses/${id}`, 'DELETE');
            if (result && result.error) {
                showToast(result.error, 'error');
                return;
            }
            showToast('Kon vymazany', 'success');
            // Refresh horses
            const newHorses = await api('horses');
            horses = Array.isArray(newHorses) ? newHorses : [];
            renderHorses();
            populateSelects();
        } catch(e) {
            console.error('deleteHorse error:', e);
            showToast('Chyba pri mazani', 'error');
        }
    }

    // CRUD - Riders
    async function saveRider() {
        const id = document.getElementById('riderId').value;
        const data = {
            first_name: document.getElementById('riderFirstName').value,
            last_name: document.getElementById('riderLastName').value,
            birth_date: document.getElementById('riderBirth').value || null,
            gender: document.getElementById('riderGender').value,
            email: document.getElementById('riderEmail').value,
            phone: document.getElementById('riderPhone').value,
            sjf_license_number: document.getElementById('riderSjfLicense').value,
            sjf_license_type: document.getElementById('riderSjfType').value,
            sjf_license_valid_until: document.getElementById('riderSjfExpiry').value || null,
            szvj_date: document.getElementById('riderSzvjDate').value || null,
            fei_id: document.getElementById('riderFeiId').value,
            fei_license_valid_until: document.getElementById('riderFeiExpiry').value || null,
            category: document.getElementById('riderCategory').value,
            level: document.getElementById('riderLevel').value,
            medical_certificate_valid: document.getElementById('riderMedical').value === 'true',
            medical_certificate_expiry: document.getElementById('riderMedicalExpiry').value || null
        };
        await api(id ? `riders/${id}` : 'riders', id ? 'PUT' : 'POST', data);
        closeModal('riderModal');
        showToast('Jazdec uloÅ¾enÃ½!', 'success');
        riders = await api('riders');
        renderRiders();
        populateSelects();
    }

    function editRider(id) {
        const r = riders.find(x => x.id === id);
        if (!r) return;
        document.getElementById('riderId').value = r.id;
        document.getElementById('riderFirstName').value = r.first_name || '';
        document.getElementById('riderLastName').value = r.last_name || '';
        document.getElementById('riderBirth').value = r.birth_date?.split('T')[0] || '';
        document.getElementById('riderGender').value = r.gender || 'female';
        document.getElementById('riderEmail').value = r.email || '';
        document.getElementById('riderPhone').value = r.phone || '';
        document.getElementById('riderSjfLicense').value = r.sjf_license_number || '';
        document.getElementById('riderSjfType').value = r.sjf_license_type || 'none';
        document.getElementById('riderSjfExpiry').value = r.sjf_license_valid_until?.split('T')[0] || '';
        document.getElementById('riderSzvjDate').value = r.szvj_date?.split('T')[0] || '';
        document.getElementById('riderFeiId').value = r.fei_id || '';
        document.getElementById('riderFeiExpiry').value = r.fei_license_valid_until?.split('T')[0] || '';
        document.getElementById('riderCategory').value = r.category || 'senior';
        document.getElementById('riderLevel').value = r.level || 'beginner';
        document.getElementById('riderMedical').value = r.medical_certificate_valid ? 'true' : 'false';
        document.getElementById('riderMedicalExpiry').value = r.medical_certificate_expiry?.split('T')[0] || '';
        document.getElementById('riderModalTitle').textContent = 'Upravit jazdca';
        showModalOnly('riderModal');
    }

    async function deleteRider(id) {
        if (!confirm('Naozaj vymazaÅ¥ tohto jazdca?')) return;
        await api(`riders/${id}`, 'DELETE');
        showToast('Jazdec vymazanÃ½', 'success');
        riders = await api('riders');
        renderRiders();
        populateSelects();
    }

    // CRUD - Trainers
    async function saveTrainer() {
        const id = document.getElementById('trainerId').value;
        const data = {
            first_name: document.getElementById('trainerFirstName').value,
            last_name: document.getElementById('trainerLastName').value,
            email: document.getElementById('trainerEmail').value,
            phone: document.getElementById('trainerPhone').value,
            sjf_license_number: document.getElementById('trainerSjfLicense').value,
            sjf_trainer_level: parseInt(document.getElementById('trainerLevel').value),
            specializations: Array.from(document.querySelectorAll('.trainerSpec:checked')).map(c => c.value),
            employment_type: document.getElementById('trainerEmployment').value,
            hourly_rate: document.getElementById('trainerRate').value || null,
            bio: document.getElementById('trainerBio').value
        };
        await api(id ? `trainers/${id}` : 'trainers', id ? 'PUT' : 'POST', data);
        closeModal('trainerModal');
        showToast('TrÃ©ner uloÅ¾enÃ½!', 'success');
        trainers = await api('trainers');
        renderTrainers();
        populateSelects();
    }

    function editTrainer(id) {
        const t = trainers.find(x => x.id === id);
        if (!t) return;
        document.getElementById('trainerId').value = t.id;
        document.getElementById('trainerFirstName').value = t.first_name || '';
        document.getElementById('trainerLastName').value = t.last_name || '';
        document.getElementById('trainerEmail').value = t.email || '';
        document.getElementById('trainerPhone').value = t.phone || '';
        document.getElementById('trainerSjfLicense').value = t.sjf_license_number || '';
        document.getElementById('trainerLevel').value = t.sjf_trainer_level || '1';
        document.querySelectorAll('.trainerSpec').forEach(c => c.checked = (t.specializations || []).includes(c.value));
        document.getElementById('trainerEmployment').value = t.employment_type || 'full_time';
        document.getElementById('trainerRate').value = t.hourly_rate || '';
        document.getElementById('trainerBio').value = t.bio || '';
        document.getElementById('trainerModalTitle').textContent = 'Upravit trenera';
        showModalOnly('trainerModal');
    }

    async function deleteTrainer(id) {
        if (!confirm('Naozaj vymazaÅ¥ tohto trÃ©nera?')) return;
        await api(`trainers/${id}`, 'DELETE');
        showToast('TrÃ©ner vymazanÃ½', 'success');
        trainers = await api('trainers');
        renderTrainers();
        populateSelects();
    }

    // CRUD - Employees
    async function saveEmployee() {
        const id = document.getElementById('employeeId').value;
        const data = {
            first_name: document.getElementById('employeeFirstName').value,
            last_name: document.getElementById('employeeLastName').value,
            position: document.getElementById('employeePosition').value,
            email: document.getElementById('employeeEmail').value,
            phone: document.getElementById('employeePhone').value,
            employment_type: document.getElementById('employeeType').value
        };
        await api(id ? `employees/${id}` : 'employees', id ? 'PUT' : 'POST', data);
        closeModal('employeeModal');
        showToast('Zamestnanec uloÅ¾enÃ½!', 'success');
        employees = await api('employees');
        renderEmployees();
        populateSelects();
    }

    function editEmployee(id) {
        const e = employees.find(x => x.id === id);
        if (!e) return;
        document.getElementById('employeeId').value = e.id;
        document.getElementById('employeeFirstName').value = e.first_name || '';
        document.getElementById('employeeLastName').value = e.last_name || '';
        document.getElementById('employeePosition').value = e.position || '';
        document.getElementById('employeeEmail').value = e.email || '';
        document.getElementById('employeePhone').value = e.phone || '';
        document.getElementById('employeeType').value = e.employment_type || 'full_time';
        document.getElementById('employeeModalTitle').textContent = 'Upravit zamestnanca';
        showModalOnly('employeeModal');
    }

    async function deleteEmployee(id) {
        if (!confirm('Naozaj vymazaÅ¥ tohto zamestnanca?')) return;
        await api(`employees/${id}`, 'DELETE');
        showToast('Zamestnanec vymazanÃ½', 'success');
        employees = await api('employees');
        renderEmployees();
        populateSelects();
    }

    // CRUD - Trainings
    async function saveTraining() {
        const id = document.getElementById('trainingId').value;
        const riderId = document.getElementById('trainingRider').value;
        const horseId = document.getElementById('trainingHorse').value;
        const trainerId = document.getElementById('trainingTrainer').value;
        const data = {
            rider_id: riderId || null,
            horse_id: horseId || null,
            trainer_id: trainerId || null,
            date: document.getElementById('trainingDate').value,
            start_time: document.getElementById('trainingTime').value,
            training_type: document.getElementById('trainingType').value,
            duration_minutes: parseInt(document.getElementById('trainingDuration').value) || 60,
            price: document.getElementById('trainingPrice').value || null,
            trainer_notes: document.getElementById('trainingNotes').value
        };
        await api(id ? `trainings/${id}` : 'trainings', id ? 'PUT' : 'POST', data);
        closeModal('trainingModal');
        showToast('TrÃ©ning uloÅ¾enÃ½!', 'success');
        trainings = await api('trainings');
        renderTrainings();
        loadDashboard();
    }

    function editTraining(id) {
        const t = trainings.find(x => x.id === id);
        if (!t) return;
        document.getElementById('trainingId').value = t.id;
        document.getElementById('trainingDate').value = t.date;
        document.getElementById('trainingTime').value = t.start_time;
        document.getElementById('trainingRider').value = t.rider_id;
        document.getElementById('trainingHorse').value = t.horse_id;
        document.getElementById('trainingTrainer').value = t.trainer_id;
        document.getElementById('trainingType').value = t.training_type || 'individual';
        document.getElementById('trainingDuration').value = t.duration_minutes || 60;
        document.getElementById('trainingPrice').value = t.price || '';
        document.getElementById('trainingNotes').value = t.notes || '';
        document.getElementById('trainingModalTitle').textContent = 'Upravit trening';
        showModalOnly('trainingModal');
    }

    async function deleteTraining(id) {
        if (!confirm('Naozaj vymazaÅ¥ tento trÃ©ning?')) return;
        await api(`trainings/${id}`, 'DELETE');
        showToast('TrÃ©ning vymazanÃ½', 'success');
        trainings = await api('trainings');
        renderTrainings();
        loadDashboard();
    }

    // CRUD - Payments
    async function savePayment() {
        const riderId = document.getElementById('paymentRider').value;
        const data = {
            rider_id: riderId || null,
            payment_type: document.getElementById('paymentType').value,
            amount: parseFloat(document.getElementById('paymentAmount').value),
            description: document.getElementById('paymentDescription').value,
            payment_date: document.getElementById('paymentDue').value || null,
            status: document.getElementById('paymentStatus').value
        };
        await api('payments', 'POST', data);
        closeModal('paymentModal');
        showToast('Platba uloÅ¾enÃ¡!', 'success');
        payments = await api('payments');
        renderPayments();
    }

    async function deletePayment(id) {
        if (!confirm('Naozaj vymazaÅ¥ tÃºto platbu?')) return;
        await api(`payments/${id}`, 'DELETE');
        showToast('Platba vymazanÃ¡', 'success');
        payments = await api('payments');
        renderPayments();
    }

    // CRUD - Vet Records
    async function saveVetRecord() {
        const id = document.getElementById('vetId')?.value;
        const horseId = document.getElementById('vetHorse').value;
        const data = {
            horse_id: horseId || null,
            record_type: document.getElementById('vetType').value,
            record_date: document.getElementById('vetDate').value,
            next_due_date: document.getElementById('vetNextDate').value || null,
            vet_name: document.getElementById('vetVeterinarian').value,
            vaccine_name: document.getElementById('vetVaccineName')?.value || null,
            vaccine_batch: document.getElementById('vetVaccineBatch')?.value || null,
            notes: document.getElementById('vetNotes').value,
            cost: document.getElementById('vetCost')?.value || null
        };
        
        try {
            let result;
            if (id) {
                result = await api(`vet-records/${id}`, 'PUT', data);
            } else {
                result = await api('vet-records', 'POST', data);
            }
            
            if (result && result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            closeModal('vetModal');
            showToast('Veterinarny zaznam ulozeny!', 'success');
            vetRecords = await api('vet-records').catch(() => []);
            if (!Array.isArray(vetRecords)) vetRecords = [];
            renderVetRecords();
        } catch(e) {
            console.error('saveVetRecord error:', e);
            showToast('Chyba pri ukladani', 'error');
        }
    }

    // CRUD - Feeding
    async function saveFeeding() {
        const horseId = document.getElementById('feedHorse').value;
        const employeeId = document.getElementById('feedBy').value;
        const data = {
            horse_id: horseId || null,
            date: document.getElementById('feedDate').value,
            time_slot: document.getElementById('feedTime').value,
            employee_id: employeeId || null,
            notes: document.getElementById('feedNotes').value
        };
        await api('feeding', 'POST', data);
        closeModal('feedingModal');
        showToast('Zaznam krmenia ulozeny!', 'success');
        await loadFeedingData();
    }

    // ===== FEEDING =====
    let feedingData = [];

    async function loadFeedingData() {
        feedingData = await api('feeding').catch(() => []);
        renderFeeding();
    }

    function renderFeeding() {
        const timeLabels = {morning:'Rano',noon:'Obed',evening:'Vecer'};
        document.getElementById('feedingTable').innerHTML = feedingData.map(f => {
            const horse = horses.find(h => h.id === f.horse_id);
            const emp = employees.find(e => e.id === f.employee_id);
            return `<tr>
                <td><strong>${horse?.name || '-'}</strong></td>
                <td>${f.date || '-'}</td>
                <td>${timeLabels[f.time_slot] || f.time_slot || '-'}</td>
                <td>${emp ? emp.first_name + ' ' + emp.last_name : '-'}</td>
                <td>${f.notes || '-'}</td>
                <td><button class="btn btn-sm btn-info" onclick="openFeedingDetail('${f.id}')">Detail</button></td>
                <td><button class="btn btn-sm btn-danger" onclick="deleteFeeding('${f.id}')">Zmazat</button></td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">Ziadne zaznamy</td></tr>';
    }

    async function deleteFeeding(id) {
        if (!confirm('Naozaj zmazat tento zaznam krmenia?')) return;
        await api(`feeding/${id}`, 'DELETE');
        showToast('Zaznam zmazany', 'success');
        await loadFeedingData();
    }

    // ===== FEEDING ITEMS (DETAIL) =====
    let currentFeedingId = null;

    async function openFeedingDetail(feedingId) {
        currentFeedingId = feedingId;
        const feeding = feedingData.find(f => f.id === feedingId);
        const horse = horses.find(h => h.id === feeding?.horse_id);
        const timeLabels = {morning:'Rano',noon:'Obed',evening:'Vecer'};
        
        document.getElementById('feedingDetailInfo').innerHTML = `
            <strong>Kon:</strong> ${horse?.name || '-'} | 
            <strong>Datum:</strong> ${feeding?.date || '-'} | 
            <strong>Cas:</strong> ${timeLabels[feeding?.time_slot] || '-'}
        `;
        
        await loadFeedingItems(feedingId);
        openModal('feedingDetailModal');
    }

    async function loadFeedingItems(feedingId) {
        const items = await api(`feeding-items?feeding_id=${feedingId}`).catch(() => []);
        const tbody = document.querySelector('#feedingItemsTable tbody');
        tbody.innerHTML = items.length ? items.map(item => `
            <tr>
                <td>${item.feed_type}</td>
                <td>${item.quantity}</td>
                <td>${item.unit}</td>
                <td>${item.notes || '-'}</td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="deleteFeedingItem('${item.id}')">Zmazat</button>
                </td>
            </tr>
        `).join('') : '<tr><td colspan="5" style="text-align:center;color:var(--gray)">Ziadne polozky</td></tr>';
    }

    async function addFeedingItem() {
        const feed_type = document.getElementById('newFeedType').value;
        const quantity = document.getElementById('newFeedQuantity').value;
        const unit = document.getElementById('newFeedUnit').value;
        const notes = document.getElementById('newFeedNotes').value;
        
        if (!feed_type || !quantity) {
            showToast('Vyplnte typ a mnozstvo', 'error');
            return;
        }
        
        await api('feeding-items', 'POST', {
            feeding_id: currentFeedingId,
            feed_type,
            quantity: parseFloat(quantity),
            unit,
            notes
        });
        
        showToast('Polozka pridana', 'success');
        document.getElementById('newFeedType').value = '';
        document.getElementById('newFeedQuantity').value = '';
        document.getElementById('newFeedNotes').value = '';
        await loadFeedingItems(currentFeedingId);
    }

    async function deleteFeedingItem(itemId) {
        if (!confirm('Zmazat tuto polozku?')) return;
        await api(`feeding-items/${itemId}`, 'DELETE');
        showToast('Polozka zmazana', 'success');
        await loadFeedingItems(currentFeedingId);
    }

    // ===== VET RECORDS =====
    function renderVetRecords() {
        document.getElementById('vetTable').innerHTML = vetRecords.map(v => {
            const horse = horses.find(h => h.id === v.horse_id);
            return `<tr>
                <td><strong>${horse?.name || '-'}</strong></td>
                <td>${v.record_type || '-'}</td>
                <td>${v.record_date || '-'}</td>
                <td>${v.next_due_date || '-'}</td>
                <td>${v.vet_name || '-'}</td>
                <td>${v.notes || '-'}</td>
                <td><button class="btn btn-sm btn-outline" onclick="editVetRecord('${v.id}')">Upravit</button> <button class="btn btn-sm btn-danger" onclick="deleteVetRecord('${v.id}')">Zmazat</button></td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">Ziadne zaznamy</td></tr>';
    }

    async function editVetRecord(id) {
        const v = vetRecords.find(r => r.id === id);
        if (!v) return;
        document.getElementById('vetId').value = v.id;
        document.getElementById('vetHorse').value = v.horse_id || '';
        document.getElementById('vetType').value = v.record_type || '';
        document.getElementById('vetDate').value = v.record_date || '';
        document.getElementById('vetNextDate').value = v.next_due_date || '';
        document.getElementById('vetVeterinarian').value = v.vet_name || '';
        document.getElementById('vetNotes').value = v.notes || '';
        document.querySelector('#vetModal .modal-header h3').textContent = 'Upravit zaznam';
        showModalOnly('vetModal');
    }

    async function deleteVetRecord(id) {
        if (!confirm('Naozaj zmazat tento zaznam?')) return;
        await api(`vet-records/${id}`, 'DELETE');
        showToast('Zaznam zmazany', 'success');
        vetRecords = await api('vet-records').catch(() => []);
        renderVetRecords();
    }

    // ===== VACCINATIONS =====
    let vaccinations = [];

    async function loadVaccinations() {
        vaccinations = await api('vaccinations').catch(() => []);
        renderVaccinations();
    }

    function renderVaccinations() {
        document.getElementById('vaccinationsTable').innerHTML = vaccinations.map(v => {
            const horse = horses.find(h => h.id === v.horse_id);
            return `<tr>
                <td><strong>${horse?.name || '-'}</strong></td>
                <td>${v.vaccine_type || '-'}</td>
                <td>${v.vaccination_date || '-'}</td>
                <td>${v.next_date || '-'}</td>
                <td>${v.batch_number || '-'}</td>
                <td>${v.vet_name || '-'}</td>
                <td>
                    <button class="btn btn-sm btn-outline" onclick="editVaccination('${v.id}')">Upravit</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteVaccination('${v.id}')">Zmazat</button>
                </td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">Ziadne ockovania</td></tr>';
    }

    function openVaccinationModal(id = null) {
        // Naplnit selecty
        populateSelects();
        
        document.getElementById('vaccinationId').value = '';
        document.getElementById('vaccinationHorse').value = '';
        document.getElementById('vaccinationType').value = '';
        document.getElementById('vaccinationDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('vaccinationNextDate').value = '';
        document.getElementById('vaccinationBatch').value = '';
        document.getElementById('vaccinationVetName').value = '';
        document.getElementById('vaccinationVetLicense').value = '';
        document.getElementById('vaccinationNotes').value = '';
        document.getElementById('vaccinationModalTitle').textContent = 'Nove ockovanie';
        showModalOnly('vaccinationModal');
    }

    async function editVaccination(id) {
        const v = vaccinations.find(x => x.id === id);
        if (!v) return;
        document.getElementById('vaccinationId').value = v.id;
        document.getElementById('vaccinationHorse').value = v.horse_id || '';
        document.getElementById('vaccinationType').value = v.vaccine_type || '';
        document.getElementById('vaccinationDate').value = v.vaccination_date || '';
        document.getElementById('vaccinationNextDate').value = v.next_date || '';
        document.getElementById('vaccinationBatch').value = v.batch_number || '';
        document.getElementById('vaccinationVetName').value = v.vet_name || '';
        document.getElementById('vaccinationVetLicense').value = v.vet_license || '';
        document.getElementById('vaccinationNotes').value = v.notes || '';
        document.getElementById('vaccinationModalTitle').textContent = 'Upravit ockovanie';
        showModalOnly('vaccinationModal');
    }

    async function saveVaccination() {
        const id = document.getElementById('vaccinationId').value;
        const data = {
            horse_id: document.getElementById('vaccinationHorse').value || null,
            vaccine_type: document.getElementById('vaccinationType').value,
            vaccination_date: document.getElementById('vaccinationDate').value,
            next_date: document.getElementById('vaccinationNextDate').value || null,
            batch_number: document.getElementById('vaccinationBatch').value || null,
            vet_name: document.getElementById('vaccinationVetName').value || null,
            vet_license: document.getElementById('vaccinationVetLicense').value || null,
            notes: document.getElementById('vaccinationNotes').value || null
        };
        
        if (!data.vaccine_type || !data.vaccination_date) {
            showToast('Vyplnte typ vakciny a datum', 'error');
            return;
        }
        
        try {
            let result;
            if (id) {
                result = await api(`vaccinations/${id}`, 'PUT', data);
            } else {
                result = await api('vaccinations', 'POST', data);
            }
            
            if (result && result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            closeModal('vaccinationModal');
            showToast('Ockovanie ulozene', 'success');
            
            // Prepni na tab Ockovania a nacitaj data
            document.querySelectorAll('[data-vet-tab]').forEach(t => t.classList.remove('active'));
            document.querySelector('[data-vet-tab="vaccinations"]').classList.add('active');
            document.getElementById('vetRecordsTab').style.display = 'none';
            document.getElementById('vaccinationsTab').style.display = 'block';
            
            await loadVaccinations();
        } catch(e) {
            console.error('saveVaccination error:', e);
            showToast('Chyba pri ukladani', 'error');
        }
    }

    async function deleteVaccination(id) {
        if (!confirm('Naozaj zmazat toto ockovanie?')) return;
        await api(`vaccinations/${id}`, 'DELETE');
        showToast('Ockovanie zmazane', 'success');
        await loadVaccinations();
    }

    // ===== ADMIN USERS =====
    let adminUsers = [];

    async function loadAdminUsers() {
        adminUsers = await api('admin-users').catch(() => []);
        renderAdminUsers();
    }

    function renderAdminUsers() {
        document.getElementById('adminUsersTable').innerHTML = adminUsers.map(u => `
            <tr>
                <td><strong>${u.username}</strong></td>
                <td>${u.email || '-'}</td>
                <td><span class="badge badge-${u.role === 'admin' ? 'success' : 'info'}">${u.role}</span></td>
                <td><span class="badge badge-${u.is_active ? 'success' : 'danger'}">${u.is_active ? 'Aktivny' : 'Neaktivny'}</span></td>
                <td>${u.last_login ? new Date(u.last_login).toLocaleString('sk') : 'Nikdy'}</td>
                <td>
                    <button class="btn btn-sm btn-outline" onclick="editAdminUser('${u.id}')">Upravit</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteAdminUser('${u.id}')">Zmazat</button>
                </td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Ziadni pouzivatelia</td></tr>';
    }

    function openAdminUserModal() {
        document.getElementById('adminUserId').value = '';
        document.getElementById('adminUserUsername').value = '';
        document.getElementById('adminUserEmail').value = '';
        document.getElementById('adminUserPassword').value = '';
        document.getElementById('adminUserRole').value = 'admin';
        document.getElementById('adminUserActive').value = 'true';
        document.getElementById('adminUserPasswordGroup').style.display = 'block';
        document.getElementById('adminUserModalTitle').textContent = 'Novy admin uzivatel';
        openModal('adminUserModal');
    }

    async function editAdminUser(id) {
        const u = adminUsers.find(x => x.id === id);
        if (!u) return;
        document.getElementById('adminUserId').value = u.id;
        document.getElementById('adminUserUsername').value = u.username;
        document.getElementById('adminUserEmail').value = u.email || '';
        document.getElementById('adminUserPassword').value = '';
        document.getElementById('adminUserRole').value = u.role || 'admin';
        document.getElementById('adminUserActive').value = u.is_active ? 'true' : 'false';
        document.getElementById('adminUserPasswordGroup').style.display = 'none';
        document.getElementById('adminUserModalTitle').textContent = 'Upravit pouzivatela';
        openModal('adminUserModal');
    }

    async function saveAdminUser() {
        const id = document.getElementById('adminUserId').value;
        const data = {
            username: document.getElementById('adminUserUsername').value,
            email: document.getElementById('adminUserEmail').value || null,
            role: document.getElementById('adminUserRole').value,
            is_active: document.getElementById('adminUserActive').value === 'true'
        };
        
        const password = document.getElementById('adminUserPassword').value;
        if (password) data.password = password;
        
        if (!data.username) {
            showToast('Vyplnte uzivatelske meno', 'error');
            return;
        }
        
        if (!id && !password) {
            showToast('Heslo je povinne pre noveho pouzivatela', 'error');
            return;
        }
        
        if (id) {
            await api(`admin-users/${id}`, 'PUT', data);
        } else {
            await api('admin-users', 'POST', data);
        }
        
        closeModal('adminUserModal');
        showToast('Uzivatel ulozeny', 'success');
        await loadAdminUsers();
    }

    async function deleteAdminUser(id) {
        if (!confirm('Naozaj zmazat tohto pouzivatela?')) return;
        try {
            await api(`admin-users/${id}`, 'DELETE');
            showToast('Uzivatel zmazany', 'success');
            await loadAdminUsers();
        } catch(e) {
            showToast('Nemozno zmazat posledneho admina', 'error');
        }
    }

    // ===== COMPLIANCE DASHBOARD =====
    async function loadCompliance() {
        const now = new Date();
        const in60days = new Date(now.getTime() + 60*24*60*60*1000);
        const in30days = new Date(now.getTime() + 30*24*60*60*1000);
        
        // Expirujuce SJF licencie koni
        const expiringLicenses = horses.filter(h => {
            if (!h.sjf_license_valid_until) return false;
            const expiry = new Date(h.sjf_license_valid_until);
            return expiry <= in60days && h.status === 'active';
        }).slice(0, 10);
        
        document.getElementById('complianceHorseLicenses').innerHTML = expiringLicenses.length ? 
            expiringLicenses.map(h => {
                const days = Math.ceil((new Date(h.sjf_license_valid_until) - now) / (1000*60*60*24));
                const isOverdue = days < 0;
                return `<div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid var(--gray-light)">
                    <span>${h.name}</span>
                    <span class="badge badge-${isOverdue ? 'danger' : 'warning'}">${isOverdue ? 'Po termine' : days + ' dni'}</span>
                </div>`;
            }).join('') : '<p style="color:var(--gray)">Ziadne expirujuce licencie</p>';
        
        // Expirujuce ockovania
        await loadVaccinations();
        const expiringVaccinations = vaccinations.filter(v => {
            if (!v.next_date) return false;
            const nextDate = new Date(v.next_date);
            return nextDate <= in30days;
        }).slice(0, 10);
        
        document.getElementById('complianceVaccinations').innerHTML = expiringVaccinations.length ?
            expiringVaccinations.map(v => {
                const horse = horses.find(h => h.id === v.horse_id);
                const days = Math.ceil((new Date(v.next_date) - now) / (1000*60*60*24));
                const isOverdue = days < 0;
                return `<div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid var(--gray-light)">
                    <span>${horse?.name || '-'} - ${v.vaccine_type}</span>
                    <span class="badge badge-${isOverdue ? 'danger' : 'warning'}">${isOverdue ? 'Po termine' : days + ' dni'}</span>
                </div>`;
            }).join('') : '<p style="color:var(--gray)">Ziadne expirujuce ockovania</p>';
    }

    // ===== VET TABS =====
    document.querySelectorAll('[data-vet-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('[data-vet-tab]').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            const tabName = tab.dataset.vetTab;
            document.getElementById('vetRecordsTab').style.display = tabName === 'records' ? 'block' : 'none';
            document.getElementById('vaccinationsTab').style.display = tabName === 'vaccinations' ? 'block' : 'none';
            if (tabName === 'vaccinations') loadVaccinations();
        });
    });

    // Bookings
    async function confirmBooking(id) {
        await api(`bookings/${id}`, 'PUT', {status: 'confirmed'});
        showToast('RezervÃ¡cia potvrdenÃ¡', 'success');
        bookings = await api('bookings');
        renderBookings();
    }

    // Messages
    async function markMessageRead(id) {
        await api(`contact/${id}`, 'PUT', {status: 'read'});
        showToast('OznaÄenÃ© ako preÄÃ­tanÃ©', 'success');
        messages = await api('contact');
        renderMessages();
    }

    // Vet type change - show/hide vaccine fields
    document.getElementById('vetType')?.addEventListener('change', function() {
        const isVaccine = this.value.startsWith('vaccination');
        document.getElementById('vaccineFields').style.display = isVaccine ? 'block' : 'none';
    });

    // Toast
    function showToast(msg, type = '') {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.className = 'toast show ' + type;
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    // ===== SJF REGISTER =====
    let currentSjfTab = 'sjfClubs';
    
    // Tab prepÃ­nanie pre SJF
    document.querySelectorAll('#sjf-register .tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('#sjf-register .tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            currentSjfTab = tab.dataset.tab;
            // UkÃ¡Å¾/skry filter role podÄ¾a tabu
            document.getElementById('sjfRole').style.display = currentSjfTab === 'sjfPersons' ? 'block' : 'none';
            loadSjfData();
        });
    });
    
    // Filtre
    document.getElementById('sjfSearch').addEventListener('input', debounce(loadSjfData, 300));
    document.getElementById('sjfRegion').addEventListener('change', loadSjfData);
    document.getElementById('sjfRole').addEventListener('change', loadSjfData);
    document.getElementById('sjfStatus').addEventListener('change', loadSjfData);
    
    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }
    
    async function loadSjfData() {
        const search = document.getElementById('sjfSearch').value;
        const region = document.getElementById('sjfRegion').value;
        const status = document.getElementById('sjfStatus').value;
        const role = document.getElementById('sjfRole').value;
        const container = document.getElementById('sjfContent');
        
        // Vysvetlivky tab
        if (currentSjfTab === 'sjfLegend') {
            showSjfLegend();
            return;
        }
        
        container.innerHTML = '<p>NaÄÃ­tavam...</p>';
        
        try {
            if (currentSjfTab === 'sjfClubs') {
                await loadSjfClubs(search, region, status);
            } else if (currentSjfTab === 'sjfPersons') {
                await loadSjfPersons(search, region, status, role);
            }
        } catch (e) {
            container.innerHTML = '<p style="color:var(--danger)">Chyba: ' + e.message + '</p>';
        }
    }
    
    function showSjfLegend() {
        document.getElementById('sjfContent').innerHTML = `
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem">
                <div>
                    <h3 style="margin-bottom:1rem;color:var(--primary)">ğŸ† Rozhodcovia (R)</h3>
                    <table class="table" style="font-size:0.85rem">
                        <tr><td><code>RS</code></td><td>Skoky</td></tr>
                        <tr><td><code>RD</code></td><td>DrezÃºra</td></tr>
                        <tr><td><code>RC</code></td><td>VÅ¡estrannosÅ¥ (Cross)</td></tr>
                        <tr><td><code>RV</code></td><td>VoltÃ­Å¾</td></tr>
                        <tr><td><code>RE</code></td><td>VytrvalosÅ¥ (Endurance)</td></tr>
                        <tr><td><code>RA</code></td><td>AreÃ¡l</td></tr>
                        <tr><td><code>RPV</code></td><td>Para VoltÃ­Å¾</td></tr>
                        <tr><td><code>F</code></td><td>FEI medzinÃ¡rodnÃ½</td></tr>
                    </table>
                    <p style="margin-top:0.5rem;font-size:0.8rem;color:var(--muted)">ÄŒÃ­slo = ÃºroveÅˆ (1-4, kde 4 je najvyÅ¡Å¡ia)</p>
                </div>
                <div>
                    <h3 style="margin-bottom:1rem;color:var(--primary)">ğŸ—ï¸ Stavitelia parkÃºrov (S)</h3>
                    <table class="table" style="font-size:0.85rem">
                        <tr><td><code>SS</code></td><td>Skoky</td></tr>
                        <tr><td><code>SC</code></td><td>VÅ¡estrannosÅ¥ Cross</td></tr>
                        <tr><td><code>SA</code></td><td>AreÃ¡l</td></tr>
                        <tr><td><code>FSS</code></td><td>FEI medzinÃ¡rodnÃ½ Skoky</td></tr>
                    </table>
                    <p style="margin-top:0.5rem;font-size:0.8rem;color:var(--muted)">ÄŒÃ­slo = ÃºroveÅˆ (1-4)</p>
                </div>
                <div>
                    <h3 style="margin-bottom:1rem;color:var(--primary)">ğŸ‘¨â€ğŸ« TrÃ©neri</h3>
                    <table class="table" style="font-size:0.85rem">
                        <tr><td><code>TrÃ©ner 1</code></td><td>ZÃ¡kladnÃ¡ licencia</td></tr>
                        <tr><td><code>TrÃ©ner 2</code></td><td>StrednÃ¡ licencia</td></tr>
                        <tr><td><code>TrÃ©ner 3</code></td><td>NajvyÅ¡Å¡ia licencia</td></tr>
                        <tr><td><code>C</code></td><td>Coach</td></tr>
                    </table>
                </div>
                <div>
                    <h3 style="margin-bottom:1rem;color:var(--primary)">ğŸ« Stewardi (K)</h3>
                    <table class="table" style="font-size:0.85rem">
                        <tr><td><code>KS</code></td><td>Skoky</td></tr>
                        <tr><td><code>KD</code></td><td>DrezÃºra</td></tr>
                        <tr><td><code>KC</code></td><td>VÅ¡estrannosÅ¥</td></tr>
                        <tr><td><code>KE</code></td><td>VytrvalosÅ¥</td></tr>
                        <tr><td><code>FKS</code></td><td>FEI Steward</td></tr>
                    </table>
                </div>
                <div>
                    <h3 style="margin-bottom:1rem;color:var(--primary)">ğŸ“ RegiÃ³ny</h3>
                    <table class="table" style="font-size:0.85rem">
                        <tr><td><code>B</code></td><td>BratislavskÃ½ kraj</td></tr>
                        <tr><td><code>Z</code></td><td>ZÃ¡padnÃ© Slovensko</td></tr>
                        <tr><td><code>S</code></td><td>StrednÃ© Slovensko</td></tr>
                        <tr><td><code>V</code></td><td>VÃ½chodnÃ© Slovensko</td></tr>
                    </table>
                </div>
                <div>
                    <h3 style="margin-bottom:1rem;color:var(--primary)">â„¹ï¸ Status</h3>
                    <table class="table" style="font-size:0.85rem">
                        <tr><td style="color:var(--success)">â—</td><td><strong>AktÃ­vny</strong> - platnÃ¡ licencia pre aktuÃ¡lnu sezÃ³nu</td></tr>
                        <tr><td style="color:var(--muted)">â—</td><td><strong>NeaktÃ­vny</strong> - licencia ÄakÃ¡ na obnovenie alebo expirovala</td></tr>
                    </table>
                    <p style="margin-top:0.5rem;font-size:0.8rem;color:var(--muted)">Licencie sa aktivujÃº priebeÅ¾ne poÄas roka</p>
                </div>
            </div>
        `;
    }
    
    async function loadSjfClubs(search, region, status) {
        let url = `/api/sjf-clubs?`;
        if (search) url += `search=${encodeURIComponent(search)}&`;
        if (region) url += `region=${region}&`;
        if (status) url += `status=${status}&`;
        
        const res = await fetch(url);
        const data = await res.json();
        
        if (data.length === 0) {
            document.getElementById('sjfContent').innerHTML = '<p>Å½iadne kluby</p>';
            return;
        }
        
        let html = '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1rem">';
        data.forEach(c => {
            html += `
                <div style="border:1px solid var(--border);border-radius:var(--radius);padding:1rem;background:var(--card)">
                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:0.5rem">
                        <strong style="font-size:1rem">${c.name}</strong>
                        ${c.is_riding_school ? '<span style="background:var(--success);color:#fff;padding:0.1rem 0.5rem;border-radius:10px;font-size:0.7rem">JÅ </span>' : ''}
                    </div>
                    <div style="font-size:0.85rem;color:var(--muted);margin-bottom:0.5rem">
                        ğŸ“ ${c.city || '-'} ${c.region ? '('+c.region+')' : ''}
                    </div>
                    <div style="font-size:0.85rem;display:flex;flex-direction:column;gap:0.25rem">
                        ${c.contact_person ? '<div>ğŸ‘¤ ' + c.contact_person + '</div>' : ''}
                        ${c.phone ? '<div>ğŸ“ <a href="tel:' + c.phone.replace(/[^0-9+]/g,'') + '">' + c.phone + '</a></div>' : ''}
                        ${c.email ? '<div>âœ‰ï¸ <a href="mailto:' + c.email + '">' + c.email + '</a></div>' : ''}
                    </div>
                </div>
            `;
        });
        html += '</div>';
        html += `<p style="margin-top:1rem;color:var(--muted);font-size:0.85rem">ZobrazenÃ½ch: ${data.length} klubov</p>`;
        
        document.getElementById('sjfContent').innerHTML = html;
    }
    
    async function loadSjfPersons(search, region, status, role) {
        let url = `/api/sjf-persons?`;
        if (role) url += `role=${role}&`;
        if (search) url += `search=${encodeURIComponent(search)}&`;
        if (region) url += `region=${region}&`;
        if (status) url += `status=${status}&`;
        
        const res = await fetch(url);
        const data = await res.json();
        
        if (data.length === 0) {
            document.getElementById('sjfContent').innerHTML = '<p>Å½iadne osoby</p>';
            return;
        }
        
        // ZobrazÃ­me vÅ¡etky licencie osoby
        let html = '<table class="table"><thead><tr><th>Meno</th><th>Klub</th><th>RegiÃ³n</th><th>Licencie</th><th>Status</th></tr></thead><tbody>';
        data.forEach(p => {
            // Zozbieraj vÅ¡etky licencie
            let licenses = [];
            if (p.judge_license) licenses.push('<span title="Rozhodca">ğŸ† ' + p.judge_license + '</span>');
            if (p.trainer_license) licenses.push('<span title="TrÃ©ner">ğŸ‘¨â€ğŸ« ' + p.trainer_license + '</span>');
            if (p.course_builder_license) licenses.push('<span title="StaviteÄ¾ parkÃºrov">ğŸ—ï¸ ' + p.course_builder_license + '</span>');
            if (p.steward_license) licenses.push('<span title="Steward">ğŸ« ' + p.steward_license + '</span>');
            
            const licenseStr = licenses.length > 0 ? licenses.join('<br>') : '-';
            const statusColor = p.sjf_license_status === 'AktÃ­vny' ? 'var(--success)' : 'var(--muted)';
            html += `
                <tr>
                    <td><strong>${p.first_name} ${p.surname}</strong></td>
                    <td style="font-size:0.85rem">${p.club_name || '-'}</td>
                    <td>${p.region || '-'}</td>
                    <td style="font-size:0.85rem">${licenseStr}</td>
                    <td><span style="color:${statusColor}">${p.sjf_license_status || '-'}</span></td>
                </tr>
            `;
        });
        html += '</tbody></table>';
        html += `<p style="margin-top:1rem;color:var(--muted);font-size:0.85rem">ZobrazenÃ½ch: ${data.length} osÃ´b</p>`;
        
        document.getElementById('sjfContent').innerHTML = html;
    }
    
    // NaÄÃ­taj SJF dÃ¡ta pri prepnutÃ­ na sekciu
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
            if (item.dataset.section === 'sjf-register') {
                setTimeout(loadSjfData, 100);
            }
            if (item.dataset.section === 'articles') {
                setTimeout(loadArticles, 100);
            }
            if (item.dataset.section === 'gallery') {
                setTimeout(loadAlbums, 100);
            }
            if (item.dataset.section === 'pages') {
                setTimeout(loadPages, 100);
            }
            if (item.dataset.section === 'documents') {
                setTimeout(loadDocuments, 100);
            }
            if (item.dataset.section === 'partners') {
                setTimeout(loadPartners, 100);
            }
            if (item.dataset.section === 'services') {
                setTimeout(loadServices, 100);
            }
            if (item.dataset.section === 'web-settings') {
                setTimeout(loadSettings, 100);
            }
        });
    });

    // ===== QUILL EDITORS =====
    let articleEditor = null;
    let pageEditor = null;
    
    function initEditors() {
        // Article editor
        if (!articleEditor && document.getElementById('articleContentEditor')) {
            articleEditor = new Quill('#articleContentEditor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'align': [] }],
                        ['link', 'image'],
                        ['clean']
                    ]
                },
                placeholder: 'NapÃ­Å¡te obsah ÄlÃ¡nku...'
            });
        }
        
        // Page editor
        if (!pageEditor && document.getElementById('pageContentEditor')) {
            pageEditor = new Quill('#pageContentEditor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'align': [] }],
                        ['link', 'image'],
                        ['clean']
                    ]
                },
                placeholder: 'NapÃ­Å¡te obsah strÃ¡nky...'
            });
        }
    }
    
    // InicializovaÅ¥ editory po naÄÃ­tanÃ­
    setTimeout(initEditors, 500);

    // ===== CMS FUNKCIE =====
    
    // ÄŒLÃNKY
    let articleCategories = [];
    
    async function loadArticleCategories() {
        try {
            const res = await fetch('/api/article-categories');
            articleCategories = await res.json();
            const select = document.getElementById('articleCategoryFilter');
            select.innerHTML = '<option value="">VÅ¡etky kategÃ³rie</option>';
            articleCategories.forEach(c => {
                select.innerHTML += `<option value="${c.id}">${c.name}</option>`;
            });
        } catch(e) { console.error(e); }
    }
    
    async function loadArticles() {
        await loadArticleCategories();
        const status = document.getElementById('articleStatusFilter').value;
        const category = document.getElementById('articleCategoryFilter').value;
        
        let url = '/api/articles?';
        if (status) url += `status=${status}&`;
        if (category) url += `category=${category}&`;
        
        try {
            const res = await fetch(url);
            const data = await res.json();
            const tbody = document.getElementById('articlesTable');
            
            if (!data.length) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--muted)">Å½iadne ÄlÃ¡nky</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(a => {
                const statusBadge = a.status === 'published' 
                    ? '<span style="color:var(--success)">PublikovanÃ½</span>'
                    : '<span style="color:var(--warning)">Koncept</span>';
                const cat = a.article_categories ? `<span style="background:${a.article_categories.color};color:#fff;padding:0.1rem 0.5rem;border-radius:10px;font-size:0.75rem">${a.article_categories.name}</span>` : '-';
                const date = a.published_at ? new Date(a.published_at).toLocaleDateString('sk') : '-';
                return `<tr>
                    <td><strong>${a.title}</strong>${a.is_featured ? ' â­' : ''}${a.is_pinned ? ' ğŸ“Œ' : ''}</td>
                    <td>${cat}</td>
                    <td>${a.author || '-'}</td>
                    <td>${statusBadge}</td>
                    <td>${date}</td>
                    <td>${a.views || 0}</td>
                    <td>
                        <button class="btn btn-small" onclick="editArticle('${a.id}')">âœï¸</button>
                        <button class="btn btn-small btn-danger" onclick="deleteArticle('${a.id}')">ğŸ—‘ï¸</button>
                    </td>
                </tr>`;
            }).join('');
        } catch(e) {
            document.getElementById('articlesTable').innerHTML = '<tr><td colspan="7" style="color:var(--danger)">Chyba: ' + e.message + '</td></tr>';
        }
    }
    
    document.getElementById('articleStatusFilter').addEventListener('change', loadArticles);
    document.getElementById('articleCategoryFilter').addEventListener('change', loadArticles);
    
    // Upload ÄlÃ¡nkovÃ½ obrÃ¡zok
    async function uploadArticleImage(input) {
        const file = input.files[0];
        if (!file) return;
        
        if (!file.type.startsWith('image/')) {
            showToast('ProsÃ­m vyberte obrÃ¡zok', 'error');
            return;
        }
        if (file.size > 5 * 1024 * 1024) {
            showToast('MaximÃ¡lna veÄ¾kosÅ¥ je 5MB', 'error');
            return;
        }
        
        document.getElementById('articleImagePreview').innerHTML = '<span style="color:var(--muted)">NahrÃ¡vam...</span>';
        
        try {
            const base64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
            
            const res = await fetch('/api/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ file: base64, filename: file.name, folder: 'articles' })
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            document.getElementById('articleCoverImage').value = data.url;
            document.getElementById('articleImagePreview').innerHTML = '<img src="'+data.url+'" style="max-height:100px;border-radius:4px">';
            showToast('ObrÃ¡zok nahranÃ½!', 'success');
        } catch(e) {
            document.getElementById('articleImagePreview').innerHTML = '';
            showToast('Chyba pri nahrÃ¡vanÃ­: ' + e.message, 'error');
        }
    }

    async function openArticleModal(id = null) {
        // NaÄÃ­taj kategÃ³rie ak eÅ¡te nie sÃº
        if (!articleCategories.length) {
            await loadArticleCategories();
        }
        
        // NaplÅˆ kategÃ³rie do selectu
        const catSelect = document.getElementById('articleCategory');
        catSelect.innerHTML = '<option value="">-- Bez kategÃ³rie --</option>';
        articleCategories.forEach(c => {
            catSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`;
        });
        
        // Reset formulÃ¡ra
        document.getElementById('articleForm').reset();
        if (articleEditor) articleEditor.root.innerHTML = '';
        document.getElementById('articleId').value = '';
        document.getElementById('articleModalTitle').textContent = 'NovÃ½ ÄlÃ¡nok';
        document.getElementById('articleImagePreview').innerHTML = '';
        document.getElementById('articleImageFile').value = '';
        
        if (id) {
            // EditÃ¡cia - naÄÃ­taj dÃ¡ta
            try {
                const res = await fetch(`/api/articles/${id}`);
                const a = await res.json();
                
                document.getElementById('articleId').value = a.id;
                document.getElementById('articleTitle').value = a.title || '';
                document.getElementById('articleCategory').value = a.category_id || '';
                document.getElementById('articleAuthor').value = a.author || '';
                document.getElementById('articleStatus').value = a.status || 'draft';
                document.getElementById('articleExcerpt').value = a.excerpt || '';
                if (articleEditor) {
                    articleEditor.root.innerHTML = a.content || '';
                }
                document.getElementById('articleCoverImage').value = a.cover_image || '';
                document.getElementById('articleFeatured').checked = a.is_featured || false;
                document.getElementById('articlePinned').checked = a.is_pinned || false;
                document.getElementById('articleImagePreview').innerHTML = a.cover_image 
                    ? '<img src="'+a.cover_image+'" style="max-height:100px;border-radius:4px">' : '';
                document.getElementById('articleModalTitle').textContent = 'UpraviÅ¥ ÄlÃ¡nok';
            } catch(e) {
                console.error('Error loading article:', e);
                showToast('Chyba pri naÄÃ­tanÃ­ ÄlÃ¡nku', 'error');
                return;
            }
        }
        
        openModal('articleModal');
    }
    
    async function saveArticle() {
        const id = document.getElementById('articleId').value;
        const article = {
            title: document.getElementById('articleTitle').value,
            category_id: document.getElementById('articleCategory').value || null,
            author: document.getElementById('articleAuthor').value,
            status: document.getElementById('articleStatus').value,
            excerpt: document.getElementById('articleExcerpt').value,
            content: articleEditor ? articleEditor.root.innerHTML : '',
            cover_image: document.getElementById('articleCoverImage').value,
            is_featured: document.getElementById('articleFeatured').checked,
            is_pinned: document.getElementById('articlePinned').checked
        };
        
        if (!article.title) {
            showToast('NÃ¡zov je povinnÃ½', 'error');
            return;
        }
        
        // Ak publikujeme, nastavÃ­me dÃ¡tum
        if (article.status === 'published') {
            article.published_at = new Date().toISOString();
        }
        
        try {
            const url = id ? `/api/articles/${id}` : '/api/articles';
            const method = id ? 'PUT' : 'POST';
            
            const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(article)
            });
            
            if (!res.ok) throw new Error('Chyba pri ukladanÃ­');
            
            closeModal('articleModal');
            showToast(id ? 'ÄŒlÃ¡nok upravenÃ½' : 'ÄŒlÃ¡nok vytvorenÃ½', 'success');
            loadArticles();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    function editArticle(id) {
        openArticleModal(id);
    }
    
    async function deleteArticle(id) {
        if (!confirm('Naozaj vymazaÅ¥ ÄlÃ¡nok?')) return;
        await fetch(`/api/articles/${id}`, { method: 'DELETE' });
        loadArticles();
    }
    
    // GALÃ‰RIA
    async function loadAlbums() {
        try {
            const res = await fetch('/api/albums');
            const data = await res.json();
            const grid = document.getElementById('albumsGrid');
            
            if (!data.length) {
                grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:2rem">Å½iadne albumy. Vytvorte prvÃ½ album.</div>';
                return;
            }
            
            grid.innerHTML = data.map(a => `
                <div class="card" style="overflow:hidden">
                    <div style="height:150px;background:${a.cover_image ? `url(${a.cover_image}) center/cover` : 'linear-gradient(135deg,var(--primary),var(--secondary))'};display:flex;align-items:center;justify-content:center">
                        ${!a.cover_image ? '<span style="font-size:3rem">ğŸ–¼ï¸</span>' : ''}
                    </div>
                    <div class="card-body">
                        <h4 style="margin-bottom:0.5rem">${a.title}</h4>
                        <p style="color:var(--muted);font-size:0.85rem;margin-bottom:0.5rem">${a.description || 'Bez popisu'}</p>
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <span style="font-size:0.85rem">${a.photos?.length || 0} fotiek</span>
                            <div>
                                <button class="btn btn-small" onclick="openAlbumPhotos('${a.id}')">ğŸ“·</button>
                                <button class="btn btn-small" onclick="editAlbum('${a.id}')">âœï¸</button>
                                <button class="btn btn-small btn-danger" onclick="deleteAlbum('${a.id}')">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        } catch(e) {
            document.getElementById('albumsGrid').innerHTML = '<div style="color:var(--danger)">Chyba: ' + e.message + '</div>';
        }
    }
    
    // Upload album cover
    async function uploadAlbumCover(input) {
        const file = input.files[0];
        if (!file) return;
        
        if (!file.type.startsWith('image/')) {
            showToast('ProsÃ­m vyberte obrÃ¡zok', 'error');
            return;
        }
        if (file.size > 5 * 1024 * 1024) {
            showToast('MaximÃ¡lna veÄ¾kosÅ¥ je 5MB', 'error');
            return;
        }
        
        document.getElementById('albumCoverPreview').innerHTML = '<span style="color:var(--muted)">NahrÃ¡vam...</span>';
        
        try {
            const base64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
            
            const res = await fetch('/api/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ file: base64, filename: file.name, folder: 'albums' })
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            document.getElementById('albumCover').value = data.url;
            document.getElementById('albumCoverPreview').innerHTML = '<img src="'+data.url+'" style="max-height:100px;border-radius:4px">';
            showToast('ObrÃ¡zok nahranÃ½!', 'success');
        } catch(e) {
            document.getElementById('albumCoverPreview').innerHTML = '';
            showToast('Chyba pri nahrÃ¡vanÃ­: ' + e.message, 'error');
        }
    }

    function openAlbumModal(id = null) {
        document.getElementById('albumForm').reset();
        document.getElementById('albumId').value = '';
        document.getElementById('albumModalTitle').textContent = 'NovÃ½ album';
        document.getElementById('albumPublic').checked = true;
        document.getElementById('albumCoverPreview').innerHTML = '';
        document.getElementById('albumCoverFile').value = '';
        openModal('albumModal');
    }
    
    async function saveAlbum() {
        const id = document.getElementById('albumId').value;
        const album = {
            title: document.getElementById('albumTitle').value,
            description: document.getElementById('albumDescription').value,
            cover_image: document.getElementById('albumCover').value,
            is_public: document.getElementById('albumPublic').checked
        };
        
        if (!album.title) {
            showToast('NÃ¡zov je povinnÃ½', 'error');
            return;
        }
        
        try {
            const url = id ? `/api/albums/${id}` : '/api/albums';
            const method = id ? 'PUT' : 'POST';
            
            const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(album)
            });
            
            if (!res.ok) throw new Error('Chyba pri ukladanÃ­');
            
            closeModal('albumModal');
            showToast(id ? 'Album upravenÃ½' : 'Album vytvorenÃ½', 'success');
            loadAlbums();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function editAlbum(id) {
        try {
            const res = await fetch(`/api/albums/${id}`);
            const a = await res.json();
            document.getElementById('albumId').value = a.id;
            document.getElementById('albumTitle').value = a.title || '';
            document.getElementById('albumDescription').value = a.description || '';
            document.getElementById('albumCover').value = a.cover_image || '';
            document.getElementById('albumPublic').checked = a.is_public !== false;
            document.getElementById('albumCoverFile').value = '';
            document.getElementById('albumCoverPreview').innerHTML = a.cover_image 
                ? '<img src="'+a.cover_image+'" style="max-height:100px;border-radius:4px">' : '';
            document.getElementById('albumModalTitle').textContent = 'UpraviÅ¥ album';
            openModal('albumModal');
        } catch(e) {
            showToast('Chyba pri naÄÃ­tanÃ­ albumu', 'error');
        }
    }
    
    async function deleteAlbum(id) {
        if (!confirm('Naozaj vymazaÅ¥ album a vÅ¡etky fotky?')) return;
        await fetch(`/api/albums/${id}`, { method: 'DELETE' });
        loadAlbums();
    }
    
    async function openAlbumPhotos(id) {
        document.getElementById('currentAlbumId').value = id;
        document.getElementById('photosUploadStatus').innerHTML = '';
        document.getElementById('photosUpload').value = '';
        
        try {
            const res = await fetch(`/api/photos?album_id=${id}`);
            const photos = await res.json();
            
            const grid = document.getElementById('photosGrid');
            if (!photos.length) {
                grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:2rem">ZatiaÄ¾ Å¾iadne mÃ©diÃ¡ v tomto albume</div>';
            } else {
                grid.innerHTML = photos.map(p => {
                    const isVideo = p.url && (p.url.includes('.mp4') || p.url.includes('.mov') || p.url.includes('.webm') || p.url.includes('.avi'));
                    const title = p.title || '';
                    
                    if (isVideo) {
                        return `
                            <div style="position:relative;border-radius:8px;overflow:hidden;aspect-ratio:1;background:#1a1a1a">
                                <video src="${p.url}" style="width:100%;height:100%;object-fit:cover" muted></video>
                                <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2rem;opacity:0.8">â–¶ï¸</div>
                                <button onclick="deleteMedia('${p.id}')" style="position:absolute;top:4px;right:4px;background:rgba(220,38,38,0.9);color:white;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px">âœ•</button>
                                <button onclick="playVideo('${p.url}')" style="position:absolute;bottom:4px;right:4px;background:rgba(0,0,0,0.7);color:white;border:none;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:11px">PrehraÅ¥</button>
                                ${title ? `<div style="position:absolute;bottom:0;left:0;right:30%;background:rgba(0,0,0,0.6);color:white;padding:4px 8px;font-size:0.75rem">${title}</div>` : ''}
                            </div>
                        `;
                    } else {
                        return `
                            <div style="position:relative;border-radius:8px;overflow:hidden;aspect-ratio:1;background:#f0f0f0">
                                <img src="${p.url}" alt="${title}" style="width:100%;height:100%;object-fit:cover" onclick="viewImage('${p.url}')">
                                <button onclick="deleteMedia('${p.id}')" style="position:absolute;top:4px;right:4px;background:rgba(220,38,38,0.9);color:white;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px">âœ•</button>
                                ${title ? `<div style="position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.6);color:white;padding:4px 8px;font-size:0.75rem">${title}</div>` : ''}
                            </div>
                        `;
                    }
                }).join('');
            }
            
            // ZÃ­skaÅ¥ nÃ¡zov albumu
            const albumRes = await fetch(`/api/albums/${id}`);
            const album = await albumRes.json();
            document.getElementById('photosModalTitle').textContent = `MÃ©diÃ¡: ${album.title}`;
            
            openModal('photosModal');
        } catch(e) {
            showToast('Chyba pri naÄÃ­tanÃ­ mÃ©diÃ­: ' + e.message, 'error');
        }
    }
    
    function viewImage(url) {
        window.open(url, '_blank');
    }
    
    function playVideo(url) {
        window.open(url, '_blank');
    }
    
    async function uploadMedia(input) {
        const files = input.files;
        if (!files.length) return;
        
        const albumId = document.getElementById('currentAlbumId').value;
        const status = document.getElementById('photosUploadStatus');
        const smallFileLimit = 4 * 1024 * 1024; // 4MB pre base64 upload
        const maxFileLimit = 50 * 1024 * 1024; // 50MB pre direct upload
        
        status.innerHTML = `<span style="color:var(--muted)">NahrÃ¡vam ${files.length} sÃºborov...</span>`;
        
        let uploaded = 0;
        let errors = 0;
        let skipped = 0;
        
        for (const file of files) {
            if (file.size > maxFileLimit) {
                skipped++;
                status.innerHTML = `<span style="color:var(--warning)">PreskoÄenÃ©: ${file.name} (max 50MB)</span>`;
                continue;
            }
            
            try {
                status.innerHTML = `<span style="color:var(--muted)">NahrÃ¡vam ${file.name}... (${uploaded + 1}/${files.length})</span>`;
                
                const isVideo = file.type.startsWith('video/');
                const folder = isVideo ? 'videos' : 'photos';
                let publicUrl;
                
                if (file.size <= smallFileLimit) {
                    // MalÃ© sÃºbory - base64 upload cez API
                    const base64 = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result);
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                    
                    const uploadRes = await fetch('/api/upload', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ file: base64, filename: file.name, folder: folder })
                    });
                    
                    const uploadData = await uploadRes.json();
                    if (uploadData.error) throw new Error(uploadData.error);
                    publicUrl = uploadData.url;
                } else {
                    // VeÄ¾kÃ© sÃºbory - direct upload cez signed URL
                    const signedRes = await fetch('/api/upload-signed', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ filename: file.name, folder: folder, contentType: file.type })
                    });
                    
                    const signedData = await signedRes.json();
                    if (signedData.error) throw new Error(signedData.error);
                    
                    // Direct upload to Supabase
                    const directUpload = await fetch(signedData.signedUrl, {
                        method: 'PUT',
                        headers: { 'Content-Type': file.type },
                        body: file
                    });
                    
                    if (!directUpload.ok) throw new Error('Direct upload failed');
                    publicUrl = signedData.publicUrl;
                }
                
                // PridaÅ¥ do DB
                await fetch('/api/photos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        album_id: albumId,
                        url: publicUrl,
                        title: file.name.replace(/\.[^/.]+$/, ''),
                        sort_order: uploaded
                    })
                });
                
                uploaded++;
            } catch(e) {
                errors++;
                status.innerHTML = `<span style="color:var(--danger)">Chyba: ${file.name} - ${e.message}</span>`;
            }
        }
        
        if (uploaded > 0) {
            showToast(`NahranÃ½ch ${uploaded} sÃºborov`, 'success');
            openAlbumPhotos(albumId);
        }
        if (errors > 0) {
            showToast(`${errors} sÃºborov sa nepodarilo nahraÅ¥`, 'error');
        }
        if (skipped > 0) {
            showToast(`${skipped} sÃºborov preskoÄenÃ½ch (prÃ­liÅ¡ veÄ¾kÃ©)`, 'warning');
        }
        
        input.value = '';
        status.innerHTML = '';
    }
    
    async function deleteMedia(id) {
        if (!confirm('Naozaj vymazaÅ¥?')) return;
        
        try {
            await fetch('/api/photos', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ids: [id] })
            });
            showToast('VymazanÃ©', 'success');
            openAlbumPhotos(document.getElementById('currentAlbumId').value);
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    // STRÃNKY
    async function loadPages() {
        try {
            const res = await fetch('/api/pages');
            const data = await res.json();
            const tbody = document.getElementById('pagesTable');
            
            if (!data.length) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted)">Å½iadne strÃ¡nky</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(p => `
                <tr>
                    <td><strong>${p.title}</strong></td>
                    <td><code>/${p.slug}</code></td>
                    <td>${p.template}</td>
                    <td>${p.show_in_menu ? 'âœ…' : 'âŒ'}</td>
                    <td>${p.is_published ? '<span style="color:var(--success)">PublikovanÃ¡</span>' : '<span style="color:var(--muted)">SkrytÃ¡</span>'}</td>
                    <td>
                        <button class="btn btn-small" onclick="editPage('${p.id}')">âœï¸</button>
                        <button class="btn btn-small btn-danger" onclick="deletePage('${p.id}')">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        } catch(e) {
            document.getElementById('pagesTable').innerHTML = '<tr><td colspan="6" style="color:var(--danger)">Chyba: ' + e.message + '</td></tr>';
        }
    }
    
    function openPageModal(id = null) {
        document.getElementById('pageForm').reset();
        if (pageEditor) pageEditor.root.innerHTML = '';
        document.getElementById('pageId').value = '';
        document.getElementById('pageModalTitle').textContent = 'NovÃ¡ strÃ¡nka';
        document.getElementById('pagePublished').checked = false;
        document.getElementById('pageInMenu').checked = false;
        openModal('pageModal');
    }
    
    async function savePage() {
        const id = document.getElementById('pageId').value;
        const page = {
            title: document.getElementById('pageTitle').value,
            slug: document.getElementById('pageSlug').value,
            template: document.getElementById('pageTemplate').value,
            menu_order: parseInt(document.getElementById('pageMenuOrder').value) || 0,
            content: pageEditor ? pageEditor.root.innerHTML : '',
            is_published: document.getElementById('pagePublished').checked,
            show_in_menu: document.getElementById('pageInMenu').checked
        };
        
        if (!page.title || !page.slug) {
            showToast('NÃ¡zov a URL slug sÃº povinnÃ©', 'error');
            return;
        }
        
        try {
            const url = id ? `/api/pages/${id}` : '/api/pages';
            const method = id ? 'PUT' : 'POST';
            
            const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(page)
            });
            
            if (!res.ok) throw new Error('Chyba pri ukladanÃ­');
            
            closeModal('pageModal');
            showToast(id ? 'StrÃ¡nka upravenÃ¡' : 'StrÃ¡nka vytvorenÃ¡', 'success');
            loadPages();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function editPage(id) {
        try {
            const res = await fetch(`/api/pages/${id}`);
            const p = await res.json();
            document.getElementById('pageId').value = p.id;
            document.getElementById('pageTitle').value = p.title || '';
            document.getElementById('pageSlug').value = p.slug || '';
            document.getElementById('pageTemplate').value = p.template || 'default';
            document.getElementById('pageMenuOrder').value = p.menu_order || 0;
            if (pageEditor) {
                pageEditor.root.innerHTML = p.content || '';
            }
            document.getElementById('pagePublished').checked = p.is_published || false;
            document.getElementById('pageInMenu').checked = p.show_in_menu || false;
            document.getElementById('pageModalTitle').textContent = 'UpraviÅ¥ strÃ¡nku';
            openModal('pageModal');
        } catch(e) {
            showToast('Chyba pri naÄÃ­tanÃ­ strÃ¡nky', 'error');
        }
    }
    
    async function deletePage(id) {
        if (!confirm('Naozaj vymazaÅ¥ strÃ¡nku?')) return;
        await fetch(`/api/pages/${id}`, { method: 'DELETE' });
        loadPages();
    }
    
    // DOKUMENTY
    async function loadDocuments() {
        const category = document.getElementById('docCategoryFilter').value;
        let url = '/api/documents?';
        if (category) url += `category=${category}&`;
        
        try {
            const res = await fetch(url);
            const data = await res.json();
            const tbody = document.getElementById('documentsTable');
            
            if (!data.length) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted)">Å½iadne dokumenty</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(d => {
                const size = d.file_size ? (d.file_size / 1024).toFixed(1) + ' KB' : '-';
                return `<tr>
                    <td><strong>${d.title}</strong></td>
                    <td>${d.category || '-'}</td>
                    <td><a href="${d.file_url}" target="_blank">${d.file_name || 'StiahnuÅ¥'}</a></td>
                    <td>${size}</td>
                    <td>${d.download_count || 0}</td>
                    <td>
                        <button class="btn btn-small btn-danger" onclick="deleteDocument('${d.id}')">ğŸ—‘ï¸</button>
                    </td>
                </tr>`;
            }).join('');
        } catch(e) {
            document.getElementById('documentsTable').innerHTML = '<tr><td colspan="6" style="color:var(--danger)">Chyba: ' + e.message + '</td></tr>';
        }
    }
    
    document.getElementById('docCategoryFilter').addEventListener('change', loadDocuments);
    
    // Upload dokumentu
    async function uploadWebDocument(input) {
        const file = input.files[0];
        if (!file) return;
        
        if (file.size > 10 * 1024 * 1024) {
            showToast('MaximÃ¡lna veÄ¾kosÅ¥ je 10MB', 'error');
            return;
        }
        
        document.getElementById('webDocUploadStatus').innerHTML = '<span style="color:var(--muted)">NahrÃ¡vam...</span>';
        
        try {
            const base64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
            
            const res = await fetch('/api/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ file: base64, filename: file.name, folder: 'documents' })
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            document.getElementById('webDocFileUrl').value = data.url;
            document.getElementById('webDocFileName').value = file.name;
            document.getElementById('webDocUploadStatus').innerHTML = '<span style="color:var(--success)">âœ“ ' + file.name + '</span>';
            showToast('SÃºbor nahranÃ½!', 'success');
        } catch(e) {
            document.getElementById('webDocUploadStatus').innerHTML = '';
            showToast('Chyba pri nahrÃ¡vanÃ­: ' + e.message, 'error');
        }
    }

    function openDocumentModal() {
        document.getElementById('documentForm').reset();
        document.getElementById('webDocPublic').checked = true;
        document.getElementById('webDocUploadStatus').innerHTML = '';
        document.getElementById('webDocFile').value = '';
        openModal('documentModal');
    }
    
    async function saveWebDocument() {
        const doc = {
            title: document.getElementById('webDocTitle').value,
            category: document.getElementById('webDocCategory').value,
            file_url: document.getElementById('webDocFileUrl').value,
            file_name: document.getElementById('webDocFileName').value,
            description: document.getElementById('webDocDescription').value,
            is_public: document.getElementById('webDocPublic').checked
        };
        
        if (!doc.title || !doc.file_url) {
            showToast('NÃ¡zov a URL sÃºboru sÃº povinnÃ©', 'error');
            return;
        }
        
        try {
            const res = await fetch('/api/documents', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(doc)
            });
            
            if (!res.ok) throw new Error('Chyba pri ukladanÃ­');
            
            closeModal('documentModal');
            showToast('Dokument pridanÃ½', 'success');
            loadDocuments();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function deleteDocument(id) {
        if (!confirm('Naozaj vymazaÅ¥ dokument?')) return;
        try {
            await fetch(`/api/documents/${id}`, { method: 'DELETE' });
            showToast('Dokument vymazanÃ½', 'success');
            loadDocuments();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    // PARTNERI
    async function loadPartners() {
        try {
            const res = await fetch('/api/partners');
            const data = await res.json();
            const grid = document.getElementById('partnersGrid');
            
            if (!data.length) {
                grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:2rem">Å½iadni partneri</div>';
                return;
            }
            
            grid.innerHTML = data.map(p => `
                <div class="card">
                    <div class="card-body" style="text-align:center">
                        ${p.logo_url ? `<img src="${p.logo_url}" style="max-height:80px;margin-bottom:1rem;max-width:100%">` : '<div style="height:80px;display:flex;align-items:center;justify-content:center;font-size:2rem">ğŸ¤</div>'}
                        <h4>${p.name}</h4>
                        <span style="font-size:0.8rem;color:var(--muted)">${p.partner_type}</span>
                        ${p.website ? `<br><a href="${p.website}" target="_blank" rel="noopener" style="font-size:0.85rem">ğŸ”— Web</a>` : ''}
                        <div style="margin-top:0.5rem">
                            <button class="btn btn-small" onclick="editPartner('${p.id}')">âœï¸</button>
                            <button class="btn btn-small btn-danger" onclick="deletePartner('${p.id}')">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                </div>
            `).join('');
        } catch(e) {
            document.getElementById('partnersGrid').innerHTML = '<div style="color:var(--danger)">Chyba: ' + e.message + '</div>';
        }
    }
    
    // Upload logo partnera
    async function uploadPartnerLogo(input) {
        const file = input.files[0];
        if (!file) return;
        
        // ValidÃ¡cia
        if (!file.type.startsWith('image/')) {
            showToast('ProsÃ­m vyberte obrÃ¡zok', 'error');
            return;
        }
        if (file.size > 2 * 1024 * 1024) {
            showToast('MaximÃ¡lna veÄ¾kosÅ¥ je 2MB', 'error');
            return;
        }
        
        // UkÃ¡Å¾ loading
        document.getElementById('partnerLogoPreview').innerHTML = '<span style="color:var(--muted)">NahrÃ¡vam...</span>';
        
        try {
            // Konvertuj na base64
            const base64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
            
            // Upload
            const res = await fetch('/api/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    file: base64,
                    filename: file.name,
                    folder: 'logos'
                })
            });
            
            const data = await res.json();
            
            if (data.error) throw new Error(data.error);
            
            // Nastav URL do inputu
            document.getElementById('partnerLogo').value = data.url;
            document.getElementById('partnerLogoPreview').innerHTML = `<img src="${data.url}" style="max-height:60px;border-radius:4px">`;
            showToast('Logo nahranÃ©!', 'success');
        } catch(e) {
            document.getElementById('partnerLogoPreview').innerHTML = '';
            showToast('Chyba pri nahrÃ¡vanÃ­: ' + e.message, 'error');
        }
    }

    function openPartnerModal() {
        document.getElementById('partnerForm').reset();
        document.getElementById('partnerId').value = '';
        document.getElementById('partnerModalTitle').textContent = 'NovÃ½ partner';
        document.getElementById('partnerActive').checked = true;
        document.getElementById('partnerLogoPreview').innerHTML = '';
        document.getElementById('partnerLogoFile').value = '';
        openModal('partnerModal');
    }
    
    async function savePartner() {
        const id = document.getElementById('partnerId').value;
        const partner = {
            name: document.getElementById('partnerName').value,
            partner_type: document.getElementById('partnerType').value,
            website: document.getElementById('partnerWebsite').value || null,
            logo_url: document.getElementById('partnerLogo').value || null,
            sort_order: parseInt(document.getElementById('partnerOrder').value) || 0,
            is_active: document.getElementById('partnerActive').checked
        };
        
        if (!partner.name) {
            showToast('NÃ¡zov je povinnÃ½', 'error');
            return;
        }
        
        try {
            const url = id ? `/api/partners/${id}` : '/api/partners';
            const method = id ? 'PUT' : 'POST';
            
            const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(partner)
            });
            
            if (!res.ok) throw new Error('Chyba pri ukladanÃ­');
            
            closeModal('partnerModal');
            showToast(id ? 'Partner upravenÃ½' : 'Partner pridanÃ½', 'success');
            loadPartners();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function editPartner(id) {
        try {
            const res = await fetch('/api/partners');
            const partners = await res.json();
            const p = partners.find(x => x.id === id);
            if (!p) throw new Error('Partner nenÃ¡jdenÃ½');
            
            document.getElementById('partnerId').value = p.id;
            document.getElementById('partnerName').value = p.name || '';
            document.getElementById('partnerType').value = p.partner_type || 'partner';
            document.getElementById('partnerWebsite').value = p.website || '';
            document.getElementById('partnerLogo').value = p.logo_url || '';
            document.getElementById('partnerOrder').value = p.sort_order || 0;
            document.getElementById('partnerActive').checked = p.is_active !== false;
            document.getElementById('partnerLogoFile').value = '';
            document.getElementById('partnerLogoPreview').innerHTML = p.logo_url 
                ? `<img src="${p.logo_url}" style="max-height:60px;border-radius:4px">`
                : '';
            document.getElementById('partnerModalTitle').textContent = 'UpraviÅ¥ partnera';
            openModal('partnerModal');
        } catch(e) {
            showToast('Chyba pri naÄÃ­tanÃ­ partnera', 'error');
        }
    }
    
    async function deletePartner(id) {
        if (!confirm('Naozaj vymazaÅ¥ partnera?')) return;
        try {
            await fetch(`/api/partners/${id}`, { method: 'DELETE' });
            showToast('Partner vymazanÃ½', 'success');
            loadPartners();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    // SLUÅ½BY
    async function loadServices() {
        try {
            const res = await fetch('/api/services');
            const services = await res.json();
            const grid = document.getElementById('servicesGrid');
            
            if (!services.length) {
                grid.innerHTML = '<div style="color:var(--muted);text-align:center;padding:2rem">ZatiaÄ¾ Å¾iadne sluÅ¾by. <a href="#" onclick="openServiceModal();return false">PridaÅ¥ prvÃº sluÅ¾bu</a></div>';
                return;
            }
            
            const badgeColors = {
                'full': { bg: '#fee2e2', color: '#dc2626' },
                'soon': { bg: '#fef3c7', color: '#d97706' },
                'new': { bg: '#d1fae5', color: '#059669' },
                'sale': { bg: '#dbeafe', color: '#2563eb' }
            };
            
            grid.innerHTML = services.map(s => {
                let badgeHtml = '';
                if (s.badge_text && s.badge_type && badgeColors[s.badge_type]) {
                    const bc = badgeColors[s.badge_type];
                    badgeHtml = `<span style="background:${bc.bg};color:${bc.color};padding:0.25rem 0.5rem;border-radius:10px;font-size:0.7rem;font-weight:600">${s.badge_text}</span>`;
                }
                
                const activeClass = s.is_active === false ? 'opacity:0.5;' : '';
                
                return `<div class="card" style="${activeClass}">
                    <div class="card-body" style="text-align:center;padding:1.5rem">
                        <div style="font-size:2.5rem;margin-bottom:0.5rem">${s.icon || 'ğŸ‡'}</div>
                        <h3 style="margin-bottom:0.5rem;color:var(--primary)">${s.title}</h3>
                        <p style="color:var(--muted);font-size:0.9rem;margin-bottom:0.75rem">${s.description || ''}</p>
                        ${badgeHtml}
                        <div style="margin-top:1rem;display:flex;gap:0.5rem;justify-content:center">
                            <button class="btn btn-small" onclick="editService('${s.id}')">âœï¸</button>
                            <button class="btn btn-small btn-danger" onclick="deleteService('${s.id}')">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                </div>`;
            }).join('');
        } catch(e) {
            document.getElementById('servicesGrid').innerHTML = '<div style="color:var(--danger)">Chyba: ' + e.message + '</div>';
        }
    }
    
    // Icon Picker
    function toggleIconPicker() {
        const picker = document.getElementById('iconPicker');
        picker.style.display = picker.style.display === 'none' ? 'block' : 'none';
    }
    
    function selectIcon(icon) {
        document.getElementById('serviceIcon').value = icon;
        document.getElementById('iconPicker').style.display = 'none';
    }
    
    // ZavrieÅ¥ icon picker pri kliknutÃ­ mimo
    document.addEventListener('click', function(e) {
        const picker = document.getElementById('iconPicker');
        const input = document.getElementById('serviceIcon');
        if (picker && input && !picker.contains(e.target) && e.target !== input) {
            picker.style.display = 'none';
        }
    });

    function openServiceModal() {
        document.getElementById('serviceForm').reset();
        document.getElementById('serviceId').value = '';
        document.getElementById('serviceIcon').value = 'ğŸ‡';
        document.getElementById('serviceActive').checked = true;
        document.getElementById('serviceModalTitle').textContent = 'NovÃ¡ sluÅ¾ba';
        openModal('serviceModal');
    }
    
    async function editService(id) {
        try {
            const res = await fetch(`/api/services/${id}`);
            const s = await res.json();
            document.getElementById('serviceId').value = s.id;
            document.getElementById('serviceIcon').value = s.icon || 'ğŸ‡';
            document.getElementById('serviceTitle').value = s.title || '';
            document.getElementById('serviceDescription').value = s.description || '';
            document.getElementById('serviceBadgeText').value = s.badge_text || '';
            document.getElementById('serviceBadgeType').value = s.badge_type || '';
            document.getElementById('serviceOrder').value = s.sort_order || 0;
            document.getElementById('serviceActive').checked = s.is_active !== false;
            document.getElementById('serviceModalTitle').textContent = 'UpraviÅ¥ sluÅ¾bu';
            openModal('serviceModal');
        } catch(e) {
            showToast('Chyba pri naÄÃ­tanÃ­ sluÅ¾by', 'error');
        }
    }
    
    async function saveService() {
        const id = document.getElementById('serviceId').value;
        const service = {
            icon: document.getElementById('serviceIcon').value || 'ğŸ‡',
            title: document.getElementById('serviceTitle').value,
            description: document.getElementById('serviceDescription').value,
            badge_text: document.getElementById('serviceBadgeText').value || null,
            badge_type: document.getElementById('serviceBadgeType').value || null,
            sort_order: parseInt(document.getElementById('serviceOrder').value) || 0,
            is_active: document.getElementById('serviceActive').checked
        };
        
        if (!service.title) {
            showToast('NÃ¡zov je povinnÃ½', 'error');
            return;
        }
        
        try {
            const url = id ? `/api/services/${id}` : '/api/services';
            const method = id ? 'PUT' : 'POST';
            const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(service)
            });
            if (!res.ok) throw new Error('Chyba pri ukladanÃ­');
            showToast(id ? 'SluÅ¾ba upravenÃ¡' : 'SluÅ¾ba vytvorenÃ¡', 'success');
            closeModal('serviceModal');
            loadServices();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function deleteService(id) {
        if (!confirm('Naozaj vymazaÅ¥ sluÅ¾bu?')) return;
        try {
            await fetch(`/api/services/${id}`, { method: 'DELETE' });
            showToast('SluÅ¾ba vymazanÃ¡', 'success');
            loadServices();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    // NASTAVENIA
    document.querySelectorAll('[data-settings-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('[data-settings-tab]').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            document.querySelectorAll('.settings-tab-content').forEach(c => c.style.display = 'none');
            document.getElementById('settings' + tab.dataset.settingsTab.charAt(0).toUpperCase() + tab.dataset.settingsTab.slice(1)).style.display = 'block';
        });
    });
    
    async function loadSettings() {
        const status = document.getElementById('settingsStatus');
        status.textContent = 'NaÄÃ­tavam...';
        try {
            const res = await fetch('/api/settings');
            if (!res.ok) throw new Error('API error: ' + res.status);
            const settings = await res.json();
            
            let count = 0;
            Object.entries(settings).forEach(([key, value]) => {
                const el = document.getElementById('setting_' + key);
                if (el) {
                    el.value = value || '';
                    count++;
                }
            });
            status.textContent = 'NaÄÃ­tanÃ© (' + count + ' nastavenÃ­)';
            setTimeout(() => { status.textContent = ''; }, 3000);
        } catch(e) { 
            console.error('loadSettings error:', e);
            status.textContent = 'âŒ Chyba: ' + e.message;
            showToast('Chyba pri naÄÃ­tanÃ­ nastavenÃ­: ' + e.message, 'error');
        }
    }
    
    async function saveSettings() {
        const status = document.getElementById('settingsStatus');
        status.textContent = 'UkladÃ¡m...';
        
        const settings = {};
        document.querySelectorAll('[id^="setting_"]').forEach(el => {
            const key = el.id.replace('setting_', '');
            settings[key] = el.value;
        });
        
        console.log('Saving settings:', settings);
        
        try {
            const res = await fetch('/api/settings', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            });
            
            if (!res.ok) throw new Error('API error: ' + res.status);
            
            const result = await res.json();
            if (result.error) throw new Error(result.error);
            
            status.textContent = 'âœ… UloÅ¾enÃ©';
            showToast('Nastavenia uloÅ¾enÃ©', 'success');
            setTimeout(() => { status.textContent = ''; }, 3000);
        } catch(e) {
            console.error('saveSettings error:', e);
            status.textContent = 'âŒ Chyba';
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    // Set today's date
    document.getElementById('trainingDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('vetDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('feedDate').value = new Date().toISOString().split('T')[0];

    // =====================================================
    // ARÃ‰NY A REZERVÃCIE - NOVÃ SYSTÃ‰M
    // =====================================================
    let arenas = [];
    let reservations = [];
    let currentWeekStart = new Date();
    currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay() + 1);

    // ---- ARÃ‰NY ----
    async function loadArenas() {
        try {
            const res = await fetch('/api/arenas?include_schedules=true');
            const data = await res.json();
            
            // DeduplicÃ¡cia arÃ©n podÄ¾a ID
            const seen = new Set();
            arenas = data.filter(arena => {
                if (seen.has(arena.id)) return false;
                seen.add(arena.id);
                return true;
            });
            
            renderArenas();
            updateArenaStats();
            populateArenaFilters();
        } catch(e) {
            console.error('loadArenas error:', e);
            document.getElementById('arenasContainer').innerHTML = '<p style="color:var(--danger);text-align:center;padding:2rem">Chyba pri naÄÃ­tanÃ­ arÃ©n</p>';
        }
    }

    function renderArenas() {
        const container = document.getElementById('arenasContainer');
        if (!container) return;
        
        const dayNames = ['Ne', 'Po', 'Ut', 'St', 'Å t', 'Pi', 'So'];
        
        container.innerHTML = arenas.map(arena => {
            const schedules = arena.schedules || [];
            const schedulesByDay = {};
            schedules.forEach(s => { schedulesByDay[s.day_of_week] = s; });
            
            return `
                <div class="fieldset" style="border-left: 4px solid ${arena.is_indoor ? '#17a2b8' : '#228B22'}; margin-bottom: 1.5rem;">
                    <legend style="display:flex;align-items:center;gap:0.5rem">
                        ${arena.is_indoor ? 'ğŸ ' : 'ğŸŒ³'} ${arena.name}
                        <span class="badge ${arena.is_active ? 'badge-success' : 'badge-gray'}">${arena.is_active ? 'AktÃ­vna' : 'NeaktÃ­vna'}</span>
                    </legend>
                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:1rem">
                        <div>
                            <p style="color:var(--gray);font-size:0.9rem;margin:0">${arena.description || ''}</p>
                            <p style="margin:0.5rem 0;font-size:0.85rem">
                                <strong>Kapacita:</strong> ${arena.capacity} jazdcov
                            </p>
                        </div>
                        <div style="display:flex;gap:0.5rem">
                            <button class="btn btn-sm btn-outline" onclick="openArenaModal(${arena.id})">âœï¸ UpraviÅ¥</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteArena(${arena.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:0.5rem;font-size:0.8rem">
                        ${[1,2,3,4,5,6,0].map(day => {
                            const sched = schedulesByDay[day];
                            return `
                                <div>
                                    <div style="font-weight:600;text-align:center;padding:0.25rem;background:var(--light);border-radius:4px;margin-bottom:0.25rem">${dayNames[day]}</div>
                                    ${sched && sched.is_active ? `
                                        <div style="background:#e8f5e9;padding:0.5rem;border-radius:4px;text-align:center">
                                            <div style="font-weight:500">${sched.open_time?.substring(0,5)} - ${sched.close_time?.substring(0,5)}</div>
                                            <div style="color:var(--gray);font-size:0.75rem">${sched.slot_duration} min / max ${sched.max_riders}</div>
                                        </div>
                                    ` : '<div style="color:var(--gray);text-align:center;padding:0.5rem;background:#f5f5f5;border-radius:4px">ZatvorenÃ©</div>'}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }).join('') || '<p style="color:var(--gray);text-align:center;padding:2rem">Å½iadne arÃ©ny. Pridajte prvÃº kliknutÃ­m na "+ NovÃ¡ arÃ©na".</p>';
    }

    async function updateArenaStats() {
        const el1 = document.getElementById('totalArenas');
        if (el1) el1.textContent = arenas.length;
        
        // DneÅ¡nÃ© rezervÃ¡cie
        const today = new Date().toISOString().split('T')[0];
        try {
            const res = await fetch(`/api/reservations?date=${today}`);
            const todayRes = await res.json();
            const el2 = document.getElementById('todayReservations');
            const el3 = document.getElementById('pendingReservations');
            if (el2) el2.textContent = todayRes.filter(r => r.status !== 'cancelled').length;
            if (el3) el3.textContent = todayRes.filter(r => r.status === 'pending').length;
        } catch(e) {}
    }

    function openArenaModal(id = null) {
        document.getElementById('arenaId').value = id || '';
        document.getElementById('arenaModalTitle').textContent = id ? 'UpraviÅ¥ arÃ©nu' : 'NovÃ¡ arÃ©na';
        
        // Reset rozvrhu
        [0,1,2,3,4,5,6].forEach(day => {
            const defaults = { open: '08:00', close: '20:00', duration: '60', max: '4', active: true };
            if (day === 0) { defaults.open = '09:00'; defaults.close = '16:00'; defaults.max = '3'; }
            if (day === 6) { defaults.open = '09:00'; defaults.close = '18:00'; }
            
            document.getElementById(`sched_${day}_open`).value = defaults.open;
            document.getElementById(`sched_${day}_close`).value = defaults.close;
            document.getElementById(`sched_${day}_duration`).value = defaults.duration;
            document.getElementById(`sched_${day}_max`).value = defaults.max;
            document.getElementById(`sched_${day}_active`).checked = defaults.active;
            
            // Reset ÃºrovnÃ­ - vÅ¡etky zaÅ¡krtnutÃ©
            document.getElementById(`sched_${day}_lvl_beginner`).checked = true;
            document.getElementById(`sched_${day}_lvl_intermediate`).checked = true;
            document.getElementById(`sched_${day}_lvl_advanced`).checked = true;
        });
        
        if (id) {
            const arena = arenas.find(a => a.id === id);
            if (arena) {
                document.getElementById('arenaName').value = arena.name;
                document.getElementById('arenaDescription').value = arena.description || '';
                document.getElementById('arenaCapacity').value = arena.capacity;
                document.getElementById('arenaIndoor').checked = arena.is_indoor;
                document.getElementById('arenaActive').checked = arena.is_active;
                
                // NaplÅˆ rozvrh
                (arena.schedules || []).forEach(s => {
                    document.getElementById(`sched_${s.day_of_week}_open`).value = s.open_time?.substring(0,5) || '08:00';
                    document.getElementById(`sched_${s.day_of_week}_close`).value = s.close_time?.substring(0,5) || '20:00';
                    document.getElementById(`sched_${s.day_of_week}_duration`).value = s.slot_duration || 60;
                    document.getElementById(`sched_${s.day_of_week}_max`).value = s.max_riders || 4;
                    document.getElementById(`sched_${s.day_of_week}_active`).checked = s.is_active !== false;
                    
                    // Nastav povolenÃ© Ãºrovne z checkboxov
                    const allowedLevels = s.allowed_levels || 'all';
                    if (allowedLevels === 'all') {
                        document.getElementById(`sched_${s.day_of_week}_lvl_beginner`).checked = true;
                        document.getElementById(`sched_${s.day_of_week}_lvl_intermediate`).checked = true;
                        document.getElementById(`sched_${s.day_of_week}_lvl_advanced`).checked = true;
                    } else {
                        const levels = allowedLevels.split(',');
                        document.getElementById(`sched_${s.day_of_week}_lvl_beginner`).checked = levels.includes('beginner');
                        document.getElementById(`sched_${s.day_of_week}_lvl_intermediate`).checked = levels.includes('intermediate');
                        document.getElementById(`sched_${s.day_of_week}_lvl_advanced`).checked = levels.includes('advanced');
                    }
                });
            }
        } else {
            document.getElementById('arenaName').value = '';
            document.getElementById('arenaDescription').value = '';
            document.getElementById('arenaCapacity').value = 4;
            document.getElementById('arenaIndoor').checked = false;
            document.getElementById('arenaActive').checked = true;
        }
        
        openModal('arenaModal');
    }

    async function saveArena() {
        const id = document.getElementById('arenaId').value;
        
        // Zozbieraj rozvrhy
        const schedules = [];
        [0,1,2,3,4,5,6].forEach(day => {
            const isActive = document.getElementById(`sched_${day}_active`).checked;
            if (isActive) {
                // ZÃ­skaj vybranÃ© Ãºrovne z checkboxov
                const selectedLevels = [];
                if (document.getElementById(`sched_${day}_lvl_beginner`).checked) selectedLevels.push('beginner');
                if (document.getElementById(`sched_${day}_lvl_intermediate`).checked) selectedLevels.push('intermediate');
                if (document.getElementById(`sched_${day}_lvl_advanced`).checked) selectedLevels.push('advanced');
                const allowedLevels = selectedLevels.length === 3 ? 'all' : selectedLevels.join(',');
                
                schedules.push({
                    day_of_week: day,
                    open_time: document.getElementById(`sched_${day}_open`).value,
                    close_time: document.getElementById(`sched_${day}_close`).value,
                    slot_duration: parseInt(document.getElementById(`sched_${day}_duration`).value),
                    max_riders: parseInt(document.getElementById(`sched_${day}_max`).value),
                    allowed_levels: allowedLevels,
                    is_active: true
                });
            }
        });
        
        const data = {
            name: document.getElementById('arenaName').value,
            description: document.getElementById('arenaDescription').value,
            capacity: parseInt(document.getElementById('arenaCapacity').value) || 4,
            is_indoor: document.getElementById('arenaIndoor').checked,
            is_active: document.getElementById('arenaActive').checked,
            schedules
        };
        
        if (id) data.id = parseInt(id);
        
        try {
            const res = await fetch('/api/arenas', {
                method: id ? 'PUT' : 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            if (!res.ok) throw new Error('API error');
            
            closeModal('arenaModal');
            showToast('ArÃ©na uloÅ¾enÃ¡', 'success');
            loadArenas();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    async function deleteArena(id) {
        if (!confirm('Naozaj vymazaÅ¥ tÃºto arÃ©nu vrÃ¡tane vÅ¡etkÃ½ch rozvrhov?')) return;
        
        try {
            await fetch(`/api/arenas?id=${id}`, { method: 'DELETE' });
            showToast('ArÃ©na vymazanÃ¡', 'success');
            loadArenas();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    // ---- REZERVÃCIE ----
    function populateArenaFilters() {
        const select = document.getElementById('reservationArenaFilter');
        if (!select) return;
        
        select.innerHTML = '<option value="">VÅ¡etky arÃ©ny</option>' +
            arenas.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
    }

    async function loadReservations() {
        try {
            const arenaId = document.getElementById('reservationArenaFilter')?.value || '';
            const status = document.getElementById('reservationStatusFilter')?.value || '';
            const dateFrom = document.getElementById('reservationDateFrom')?.value || '';
            const dateTo = document.getElementById('reservationDateTo')?.value || '';
            
            let url = '/api/reservations?';
            if (arenaId) url += `arena_id=${arenaId}&`;
            if (status) url += `status=${status}&`;
            if (dateFrom) url += `date_from=${dateFrom}&`;
            if (dateTo) url += `date_to=${dateTo}&`;
            
            const res = await fetch(url);
            reservations = await res.json();
            
            renderReservationsTable();
            renderReservationsCalendar();
        } catch(e) {
            console.error('loadReservations error:', e);
        }
    }

    function renderReservationsTable() {
        const tbody = document.getElementById('reservationsTable');
        if (!tbody) return;
        
        const statusBadge = {
            pending: '<span class="badge badge-warning">ÄŒakajÃºca</span>',
            confirmed: '<span class="badge badge-success">PotvrdenÃ¡</span>',
            cancelled: '<span class="badge badge-danger">ZruÅ¡enÃ¡</span>',
            completed: '<span class="badge badge-info">DokonÄenÃ¡</span>'
        };
        
        const serviceTypes = {
            lesson: 'Jazda',
            free_ride: 'VoÄ¾nÃ¡ jazda',
            longing: 'LonÅ¾ovanie',
            training: 'TrÃ©ning'
        };
        
        tbody.innerHTML = reservations.map(r => `
            <tr>
                <td>${new Date(r.reservation_date).toLocaleDateString('sk')}</td>
                <td>${r.start_time?.substring(0,5) || '-'} - ${r.end_time?.substring(0,5) || '-'}</td>
                <td>${r.arenas?.name || 'ArÃ©na ' + r.arena_id}</td>
                <td><strong>${r.customer_name}</strong>${r.customer_email ? '<br><small>' + r.customer_email + '</small>' : ''}</td>
                <td>${r.customer_phone || '-'}</td>
                <td>${r.riders_count || 1}</td>
                <td>${serviceTypes[r.service_type] || r.service_type || '-'}</td>
                <td>${statusBadge[r.status] || r.status}</td>
                <td>
                    ${r.status === 'pending' ? `
                        <button class="btn btn-sm btn-primary" onclick="updateReservationStatus(${r.id}, 'confirmed')" title="PotvrdiÅ¥">âœ“</button>
                        <button class="btn btn-sm btn-danger" onclick="updateReservationStatus(${r.id}, 'cancelled')" title="ZruÅ¡iÅ¥">âœ•</button>
                    ` : ''}
                    ${r.status === 'confirmed' ? `
                        <button class="btn btn-sm btn-warning" onclick="updateReservationStatus(${r.id}, 'completed')" title="DokonÄiÅ¥">âœ“</button>
                    ` : ''}
                </td>
            </tr>
        `).join('') || '<tr><td colspan="9" style="text-align:center;color:var(--gray)">Å½iadne rezervÃ¡cie</td></tr>';
    }

    function renderReservationsCalendar() {
        const container = document.getElementById('reservationsCalendar');
        if (!container) return;
        
        // DeduplicÃ¡cia arÃ©n (pre istotu)
        const uniqueArenas = arenas.filter((arena, index, self) => 
            index === self.findIndex(a => a.id === arena.id)
        );
        
        if (uniqueArenas.length === 0) {
            container.innerHTML = '<p style="text-align:center;color:var(--gray);padding:2rem">Najprv pridajte arÃ©ny v sekcii "ArÃ©ny a Äasy"</p>';
            return;
        }
        
        const dayNames = ['Ne', 'Po', 'Ut', 'St', 'Å t', 'Pi', 'So'];
        const days = [];
        const startDate = new Date(currentWeekStart);
        
        for (let i = 0; i < 7; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);
            days.push(date);
        }
        
        document.getElementById('weekLabel').textContent = 
            `${days[0].toLocaleDateString('sk')} - ${days[6].toLocaleDateString('sk')}`;
        
        // Helper na normalizÃ¡ciu dÃ¡tumu
        const normalizeDate = (d) => {
            if (!d) return '';
            const date = new Date(d);
            return date.toISOString().split('T')[0];
        };
        
        container.innerHTML = `
            <table class="table" style="font-size:0.85rem">
                <thead>
                    <tr>
                        <th style="width:120px">ArÃ©na</th>
                        ${days.map(d => `<th style="text-align:center;${d.toDateString() === new Date().toDateString() ? 'background:#e8f5e9' : ''}">${dayNames[d.getDay()]}<br><small>${d.getDate()}.${d.getMonth()+1}.</small></th>`).join('')}
                    </tr>
                </thead>
                <tbody>
                    ${uniqueArenas.map(arena => `
                        <tr>
                            <td style="border-left:3px solid ${arena.is_indoor ? '#17a2b8' : '#228B22'}">
                                ${arena.is_indoor ? 'ğŸ ' : 'ğŸŒ³'} ${arena.name}
                            </td>
                            ${days.map(d => {
                                const dateStr = normalizeDate(d);
                                const dayRes = reservations.filter(r => 
                                    r.arena_id === arena.id && 
                                    normalizeDate(r.reservation_date) === dateStr &&
                                    r.status !== 'cancelled'
                                );
                                const pending = dayRes.filter(r => r.status === 'pending').length;
                                const confirmed = dayRes.filter(r => r.status === 'confirmed' || r.status === 'completed').length;
                                const isToday = d.toDateString() === new Date().toDateString();
                                const total = confirmed + pending;
                                
                                return `<td style="text-align:center;cursor:pointer;${isToday ? 'background:#e8f5e9' : ''}" 
                                           onclick="showDayDetail(${arena.id}, '${arena.name}', '${dateStr}')"
                                           title="Klikni pre detail">
                                    ${total > 0 ? 
                                        `<span class="badge badge-${pending > 0 ? 'warning' : 'success'}">${confirmed}${pending > 0 ? '+' + pending : ''}</span>` : 
                                        '<span style="color:#ddd">-</span>'}
                                </td>`;
                            }).join('')}
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }

    // Zobrazenie detailu dÅˆa
    function showDayDetail(arenaId, arenaName, dateStr) {
        const normalizeDate = (d) => {
            if (!d) return '';
            const date = new Date(d);
            return date.toISOString().split('T')[0];
        };
        
        const dayReservations = reservations.filter(r => 
            r.arena_id === arenaId && 
            normalizeDate(r.reservation_date) === dateStr &&
            r.status !== 'cancelled'
        ).sort((a, b) => a.start_time.localeCompare(b.start_time));
        
        const formattedDate = new Date(dateStr).toLocaleDateString('sk', { 
            weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' 
        });
        
        const statusBadges = {
            pending: '<span class="badge badge-warning">ÄŒakajÃºca</span>',
            confirmed: '<span class="badge badge-success">PotvrdenÃ¡</span>',
            completed: '<span class="badge badge-info">DokonÄenÃ¡</span>'
        };
        
        const serviceTypes = {
            lesson: 'Jazda/TrÃ©ning',
            free_ride: 'VoÄ¾nÃ¡ jazda',
            longing: 'LonÅ¾ovanie',
            training: 'TrÃ©ning'
        };
        
        const skillLabels = {
            beginner: 'ZaÄiatoÄnÃ­k',
            intermediate: 'Mierne pokroÄilÃ½',
            advanced: 'PokroÄilÃ½'
        };
        
        let content = `
            <div style="margin-bottom:1rem">
                <h4 style="margin:0">${arenaName}</h4>
                <p style="color:var(--gray);margin:0.25rem 0 0 0">${formattedDate}</p>
            </div>
        `;
        
        if (dayReservations.length === 0) {
            content += `<p style="text-align:center;color:var(--gray);padding:2rem">Å½iadne trÃ©ningy v tento deÅˆ</p>`;
        } else {
            content += `
                <table class="table" style="font-size:0.9rem">
                    <thead>
                        <tr>
                            <th>ÄŒas</th>
                            <th>Meno</th>
                            <th>Kontakt</th>
                            <th>Jazdcov</th>
                            <th>ÃšroveÅˆ</th>
                            <th>Status</th>
                            <th>Akcie</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${dayReservations.map(r => `
                            <tr>
                                <td><strong>${r.start_time?.substring(0,5) || '-'} - ${r.end_time?.substring(0,5) || '-'}</strong></td>
                                <td>
                                    <strong>${r.customer_name}</strong>
                                    ${r.notes ? `<br><small style="color:var(--gray)">${r.notes}</small>` : ''}
                                </td>
                                <td>
                                    <a href="tel:${r.customer_phone}">${r.customer_phone}</a>
                                    ${r.customer_email ? `<br><small>${r.customer_email}</small>` : ''}
                                </td>
                                <td style="text-align:center">${r.riders_count || 1}</td>
                                <td>${skillLabels[r.skill_level] || '-'}</td>
                                <td>${statusBadges[r.status] || r.status}</td>
                                <td>
                                    ${r.status === 'pending' ? `
                                        <button class="btn btn-sm btn-primary" onclick="updateReservationStatus(${r.id}, 'confirmed');closeModal('dayDetailModal');" title="PotvrdiÅ¥">âœ“</button>
                                        <button class="btn btn-sm btn-danger" onclick="updateReservationStatus(${r.id}, 'cancelled');closeModal('dayDetailModal');" title="ZruÅ¡iÅ¥">âœ•</button>
                                    ` : ''}
                                    ${r.status === 'confirmed' ? `
                                        <button class="btn btn-sm btn-info" onclick="updateReservationStatus(${r.id}, 'completed');closeModal('dayDetailModal');" title="DokonÄiÅ¥">âœ“</button>
                                    ` : ''}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div style="margin-top:1rem;padding:1rem;background:#f8f9fa;border-radius:8px;font-size:0.9rem">
                    <strong>SÃºhrn:</strong> ${dayReservations.length} trÃ©ningov, 
                    ${dayReservations.reduce((sum, r) => sum + (r.riders_count || 1), 0)} jazdcov celkom
                </div>
            `;
        }
        
        document.getElementById('dayDetailContent').innerHTML = content;
        openModal('dayDetailModal');
    }

    function changeWeek(delta) {
        currentWeekStart.setDate(currentWeekStart.getDate() + (delta * 7));
        loadReservations();
    }

    async function updateReservationStatus(id, status) {
        try {
            await fetch('/api/reservations', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, status })
            });
            showToast('Status aktualizovanÃ½', 'success');
            loadReservations();
            updateArenaStats();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    // Event listeners pre filtre
    document.getElementById('reservationArenaFilter')?.addEventListener('change', loadReservations);
    document.getElementById('reservationStatusFilter')?.addEventListener('change', loadReservations);
    document.getElementById('reservationDateFrom')?.addEventListener('change', loadReservations);
    document.getElementById('reservationDateTo')?.addEventListener('change', loadReservations);

    // =====================================================
    // NOTIFIKÃCIE
    // =====================================================
    let notifications = [];

    async function loadNotifications() {
        try {
            const status = document.getElementById('notificationStatusFilter')?.value || '';
            let url = '/api/notifications';
            if (status) url += `?status=${status}`;
            
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            notifications = await res.json();
            renderNotificationsTable();
            updateNotificationStats();
        } catch(e) {
            console.error('loadNotifications error:', e);
        }
    }

    function renderNotificationsTable() {
        const tbody = document.getElementById('notificationsTable');
        if (!tbody) return;

        const sourceLabels = { manual: 'Manualne', rule: 'Automaticke', system: 'System' };
        const priorityBadges = { low: 'badge-gray', normal: 'badge-info', high: 'badge-warning', urgent: 'badge-danger' };
        const priorityLabels = { low: 'Nizka', normal: 'Normalna', high: 'Vysoka', urgent: 'Urgentna' };
        const statusBadges = { pending: 'badge-warning', active: 'badge-info', resolved: 'badge-success', dismissed: 'badge-gray' };
        const statusLabels = { pending: 'Aktivne', active: 'Aktivne', resolved: 'Vyriesene', dismissed: 'Skryte' };

        tbody.innerHTML = notifications.map(n => {
            const horseName = n.horses ? (n.horses.stable_name || n.horses.name) : '-';
            return `
            <tr class="${n.is_read ? '' : 'table-row-highlight'}">
                <td><span class="badge ${n.source === 'rule' ? 'badge-info' : 'badge-gray'}">${sourceLabels[n.source] || n.source}</span></td>
                <td><strong>${n.title || ''}</strong>${n.message ? `<br><small style="color:var(--gray)">${n.message.substring(0, 60)}${n.message.length > 60 ? '...' : ''}</small>` : ''}</td>
                <td><span class="badge ${priorityBadges[n.priority] || 'badge-gray'}">${priorityLabels[n.priority] || n.priority}</span></td>
                <td>${horseName}</td>
                <td>${n.due_date ? n.due_date : '-'}</td>
                <td><span class="badge ${statusBadges[n.status] || 'badge-gray'}">${statusLabels[n.status] || n.status}</span></td>
                <td>
                    ${!n.is_read ? `<button class="btn btn-sm btn-outline" onclick="markNotificationRead('${n.id}')" title="Oznacit ako precitane">Precitat</button>` : ''}
                    ${n.status === 'pending' ? `<button class="btn btn-sm btn-success" onclick="resolveNotification('${n.id}')" title="Vyriesit">Vyriesit</button>` : ''}
                    <button class="btn btn-sm btn-danger" onclick="dismissNotification('${n.id}')" title="Skryt">Skryt</button>
                </td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">Ziadne upozornenia</td></tr>';
    }

    function updateNotificationStats() {
        const pending = notifications.filter(n => n.status === 'pending' && !n.is_dismissed).length;
        const highPriority = notifications.filter(n => (n.priority === 'high' || n.priority === 'urgent') && n.status === 'pending').length;
        const fromRules = notifications.filter(n => n.source === 'rule').length;
        
        const el1 = document.getElementById('pendingNotifications');
        const el2 = document.getElementById('urgentNotifications');
        const el3 = document.getElementById('systemNotifications');
        if (el1) el1.textContent = pending;
        if (el2) el2.textContent = highPriority;
        if (el3) el3.textContent = fromRules;
        
        // Update badge in nav
        const badge = document.getElementById('alertBadge');
        if (badge) badge.textContent = pending;
    }

    async function markNotificationRead(id) {
        try {
            await fetch('/api/notifications', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                body: JSON.stringify({ id, is_read: true })
            });
            loadNotifications();
        } catch(e) { console.error(e); }
    }

    async function resolveNotification(id) {
        try {
            await fetch('/api/notifications', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                body: JSON.stringify({ id, status: 'resolved', is_read: true })
            });
            loadNotifications();
        } catch(e) { console.error(e); }
    }

    async function dismissNotification(id) {
        if (!confirm('Naozaj skryt toto upozornenie?')) return;
        try {
            await fetch('/api/notifications', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                body: JSON.stringify({ id, status: 'dismissed', is_dismissed: true })
            });
            loadNotifications();
        } catch(e) { console.error(e); }
    }

    async function openNotificationModal(id = null) {
        document.getElementById('notificationId').value = id || '';
        document.getElementById('notificationModalTitle').textContent = id ? 'Upravit upozornenie' : 'Nove upozornenie';
        
        try {
            const horsesRes = await fetch('/api/horses', { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            const horsesList = await horsesRes.json();
            
            document.getElementById('notificationHorse').innerHTML = '<option value="">-- Ziadny --</option>' +
                (horsesList || []).map(h => `<option value="${h.id}">${h.stable_name || h.name}</option>`).join('');
        } catch(e) {
            console.error('Error loading horses:', e);
        }
        
        // Reset form
        document.getElementById('notificationPriority').value = 'normal';
        document.getElementById('notificationTitle').value = '';
        document.getElementById('notificationMessage').value = '';
        document.getElementById('notificationHorse').value = '';
        document.getElementById('notificationDueDate').value = '';
        
        if (id) {
            const n = notifications.find(x => x.id === id);
            if (n) {
                document.getElementById('notificationPriority').value = n.priority || 'normal';
                document.getElementById('notificationTitle').value = n.title || '';
                document.getElementById('notificationMessage').value = n.message || '';
                document.getElementById('notificationHorse').value = n.assigned_horse_id || '';
                document.getElementById('notificationDueDate').value = n.due_date || '';
            }
        } else {
            document.getElementById('notificationType').value = 'info';
            document.getElementById('notificationPriority').value = 'normal';
            document.getElementById('notificationTitle').value = '';
            document.getElementById('notificationMessage').value = '';
            document.getElementById('notificationTrainer').value = '';
            document.getElementById('notificationHorse').value = '';
            document.getElementById('notificationDueDate').value = '';
            document.getElementById('notificationStatus').value = 'pending';
        }
        
        openModal('notificationModal');
    }

    function editNotification(id) {
        openNotificationModal(id);
    }

    async function saveNotification() {
        const id = document.getElementById('notificationId').value;
        const data = {
            title: document.getElementById('notificationTitle').value,
            message: document.getElementById('notificationMessage').value,
            priority: document.getElementById('notificationPriority').value,
            assigned_horse_id: document.getElementById('notificationHorse').value || null,
            due_date: document.getElementById('notificationDueDate').value || null
        };
        
        if (!data.title) {
            alert('Zadajte nazov');
            return;
        }
        
        try {
            if (id) {
                data.id = id;
                await fetch('/api/notifications', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                    body: JSON.stringify(data)
                });
            } else {
                await fetch('/api/notifications', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                    body: JSON.stringify(data)
                });
            }
            closeModal('notificationModal');
            loadNotifications();
        } catch(e) {
            alert('Chyba: ' + e.message);
        }
    }

    async function completeNotification(id) {
        try {
            await fetch(`/api/notifications/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: 'completed' })
            });
            showToast('OznaÄenÃ© ako dokonÄenÃ©', 'success');
            loadNotifications();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    async function deleteNotification(id) {
        if (!confirm('Naozaj vymazaÅ¥ toto upozornenie?')) return;
        try {
            await fetch(`/api/notifications/${id}`, { method: 'DELETE' });
            showToast('Upozornenie vymazanÃ©', 'success');
            loadNotifications();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    document.getElementById('notificationStatusFilter')?.addEventListener('change', loadNotifications);

    // NaÄÃ­taj pri prechode na sekciu
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
            if (item.dataset.section === 'arenas') {
                setTimeout(loadArenas, 100);
            }
            if (item.dataset.section === 'bookings') {
                setTimeout(() => { loadArenas(); loadReservations(); }, 100);
            }
            if (item.dataset.section === 'notifications') {
                setTimeout(loadNotifications, 100);
            }
            if (item.dataset.section === 'vet') {
                setTimeout(loadVaccinations, 100);
            }
            if (item.dataset.section === 'feeding') {
                setTimeout(loadFeedingData, 100);
            }
            if (item.dataset.section === 'compliance') {
                setTimeout(loadCompliance, 100);
            }
            if (item.dataset.section === 'admin-users') {
                setTimeout(loadAdminUsers, 100);
            }
            if (item.dataset.section === 'stable-log') {
                setTimeout(loadStableLog, 100);
            }
            if (item.dataset.section === 'visit-log') {
                setTimeout(loadVisitLog, 100);
            }
            if (item.dataset.section === 'docs-central') {
                setTimeout(loadDocsCentral, 100);
            }
        });
    });

    // ===== STABLE LOG (MAÅ TAÄ½NÃ KNIHA) =====
    let stableLogs = [];
    
    async function loadStableLog() {
        const from = document.getElementById('stableLogFrom')?.value || '';
        const to = document.getElementById('stableLogTo')?.value || '';
        const type = document.getElementById('stableLogType')?.value || '';
        const horse = document.getElementById('stableLogHorse')?.value || '';
        
        let url = '/api/stable-log?';
        if (from) url += `date_from=${from}&`;
        if (to) url += `date_to=${to}&`;
        if (type) url += `event_type=${type}&`;
        if (horse) url += `horse_id=${horse}&`;
        
        try {
            const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
            stableLogs = await res.json();
            if (!Array.isArray(stableLogs)) stableLogs = [];
            renderStableLog();
            populateStableLogHorseFilter();
        } catch(e) {
            console.error('loadStableLog error:', e);
            stableLogs = [];
        }
    }
    
    function populateStableLogHorseFilter() {
        const select = document.getElementById('stableLogHorse');
        if (!select) return;
        const opts = '<option value="">VÅ¡etky kone</option>' + horses.filter(h => h.status === 'active').map(h => `<option value="${h.id}">${h.stable_name || h.name}</option>`).join('');
        select.innerHTML = opts;
    }
    
    const eventTypeLabels = {
        arrival: 'PrÃ­jem koÅˆa', departure: 'Odchod koÅˆa', transfer: 'DoÄasnÃ½ presun',
        return: 'NÃ¡vrat koÅˆa', quarantine_start: 'KarantÃ©na',
        quarantine_end: 'UkonÄenie karantÃ©ny', death: 'Ãšhyn koÅˆovitÃ©ho zvieraÅ¥a'
    };
    
    function renderStableLog() {
        document.getElementById('stableLogTable').innerHTML = stableLogs.map(s => {
            const horse = s.horses || horses.find(h => h.id === s.horse_id);
            return `<tr>
                <td><strong>${s.event_date}</strong>${s.event_time ? `<br><small>${s.event_time}</small>` : ''}</td>
                <td>${horse ? (horse.stable_name || horse.name) : '-'}</td>
                <td><span class="badge badge-${s.event_type === 'death' ? 'danger' : 'info'}">${eventTypeLabels[s.event_type] || s.event_type}</span></td>
                <td>${s.location_from || ''} ${s.location_to ? 'â†’ ' + s.location_to : ''}</td>
                <td>${s.responsible_person || '-'}</td>
                <td>${s.notes || '-'}</td>
                <td>
                    <button class="btn btn-sm btn-outline" onclick="editStableLog('${s.id}')">âœï¸</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteStableLog('${s.id}')">ğŸ—‘ï¸</button>
                </td>
            </tr>`;
        }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gray)">Å½iadne zÃ¡znamy</td></tr>';
    }
    
    function filterStableLog() { loadStableLog(); }
    
    function openStableLogModal() {
        document.getElementById('stableLogId').value = '';
        document.getElementById('stableLogHorseSelect').innerHTML = '<option value="">-- NevybranÃ© --</option>' + horses.filter(h => h.status === 'active').map(h => `<option value="${h.id}">${h.stable_name || h.name}</option>`).join('');
        document.getElementById('stableLogEmployee').innerHTML = '<option value="">-- NevybranÃ© --</option>' + employees.filter(e => e.status === 'active').map(e => `<option value="${e.id}">${e.first_name} ${e.last_name}</option>`).join('');
        document.getElementById('stableLogEventType').value = '';
        document.getElementById('stableLogDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('stableLogTime').value = '';
        document.getElementById('stableLogDateTo').value = '';
        document.getElementById('stableLogFrom').value = '';
        document.getElementById('stableLogTo').value = '';
        document.getElementById('stableLogReason').value = '';
        document.getElementById('stableLogResponsible').value = '';
        document.getElementById('stableLogNotes').value = '';
        document.getElementById('stableLogModalTitle').textContent = 'NovÃ½ zÃ¡znam - MaÅ¡taÄ¾nÃ¡ kniha';
        showModalOnly('stableLogModal');
    }
    
    function editStableLog(id) {
        const s = stableLogs.find(x => x.id === id);
        if (!s) return;
        document.getElementById('stableLogId').value = s.id;
        document.getElementById('stableLogHorseSelect').innerHTML = '<option value="">-- NevybranÃ© --</option>' + horses.filter(h => h.status === 'active').map(h => `<option value="${h.id}">${h.stable_name || h.name}</option>`).join('');
        document.getElementById('stableLogHorseSelect').value = s.horse_id || '';
        document.getElementById('stableLogEmployee').innerHTML = '<option value="">-- NevybranÃ© --</option>' + employees.filter(e => e.status === 'active').map(e => `<option value="${e.id}">${e.first_name} ${e.last_name}</option>`).join('');
        document.getElementById('stableLogEmployee').value = s.employee_id || '';
        document.getElementById('stableLogEventType').value = s.event_type || '';
        document.getElementById('stableLogDate').value = s.event_date || '';
        document.getElementById('stableLogTime').value = s.event_time || '';
        document.getElementById('stableLogDateTo').value = s.date_to || '';
        document.getElementById('stableLogFrom').value = s.location_from || '';
        document.getElementById('stableLogTo').value = s.location_to || '';
        document.getElementById('stableLogReason').value = s.reason || '';
        document.getElementById('stableLogResponsible').value = s.responsible_person || '';
        document.getElementById('stableLogNotes').value = s.notes || '';
        document.getElementById('stableLogModalTitle').textContent = 'UpraviÅ¥ zÃ¡znam';
        showModalOnly('stableLogModal');
    }
    
    async function saveStableLog() {
        const id = document.getElementById('stableLogId').value;
        const data = {
            horse_id: document.getElementById('stableLogHorseSelect').value || null,
            event_type: document.getElementById('stableLogEventType').value,
            event_date: document.getElementById('stableLogDate').value,
            event_time: document.getElementById('stableLogTime').value || null,
            date_to: document.getElementById('stableLogDateTo').value || null,
            location_from: document.getElementById('stableLogFrom').value || null,
            location_to: document.getElementById('stableLogTo').value || null,
            reason: document.getElementById('stableLogReason').value || null,
            responsible_person: document.getElementById('stableLogResponsible').value,
            employee_id: document.getElementById('stableLogEmployee').value || null,
            notes: document.getElementById('stableLogNotes').value || null
        };
        
        if (!data.event_type || !data.event_date || !data.responsible_person) {
            showToast('VyplÅˆte povinnÃ© polia', 'error');
            return;
        }
        
        try {
            const res = await fetch(id ? `/api/stable-log/${id}` : '/api/stable-log', {
                method: id ? 'PUT' : 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify(data)
            });
            if (!res.ok) throw new Error('Chyba servera');
            showToast('ZÃ¡znam uloÅ¾enÃ½', 'success');
            closeModal('stableLogModal');
            loadStableLog();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function deleteStableLog(id) {
        if (!confirm('Naozaj zmazaÅ¥ tento zÃ¡znam?')) return;
        try {
            await fetch(`/api/stable-log/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showToast('ZÃ¡znam zmazanÃ½', 'success');
            loadStableLog();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    function printStableLog() {
        const from = document.getElementById('stableLogFrom')?.value || '';
        const to = document.getElementById('stableLogTo')?.value || '';
        const today = new Date().toLocaleDateString('sk-SK');
        let html = `
            <div style="text-align:center;margin-bottom:2rem">
                <h1>JAZDECKÃ KLUB ZELENÃ MÃÄ½A</h1>
                <h2>ZÃ¡znamovÃ¡ kniha pohybu koÅˆovitÃ½ch zvierat</h2>
                <p>Obdobie: ${from || 'od zaÄiatku'} â€“ ${to || 'do dnes'}</p>
            </div>
            <table style="width:100%;border-collapse:collapse" border="1">
                <thead><tr style="background:#f0f0f0">
                    <th style="padding:8px">DÃ¡tum</th><th style="padding:8px">KÃ´Åˆ</th><th style="padding:8px">UdalosÅ¥</th>
                    <th style="padding:8px">Miesto</th><th style="padding:8px">ZodpovednÃ¡ osoba</th><th style="padding:8px">PoznÃ¡mka</th>
                </tr></thead>
                <tbody>
        `;
        stableLogs.forEach(s => {
            const horse = s.horses || horses.find(h => h.id === s.horse_id);
            html += `<tr>
                <td style="padding:8px">${s.event_date}${s.event_time ? ' ' + s.event_time : ''}</td>
                <td style="padding:8px">${horse ? (horse.stable_name || horse.name) : '-'}</td>
                <td style="padding:8px">${eventTypeLabels[s.event_type] || s.event_type}</td>
                <td style="padding:8px">${s.location_from || ''} ${s.location_to ? 'â†’ ' + s.location_to : ''}</td>
                <td style="padding:8px">${s.responsible_person || '-'}</td>
                <td style="padding:8px">${s.notes || '-'}</td>
            </tr>`;
        });
        html += `</tbody></table>
            <div style="margin-top:3rem;display:flex;justify-content:space-between">
                <div>DÃ¡tum: ${today}</div>
                <div>Podpis: _______________</div>
            </div>
            <p style="margin-top:2rem;font-size:0.85rem;color:#666;text-align:center">
                Dokument bol vytvorenÃ½ elektronickÃ½m evidenÄnÃ½m systÃ©mom prevÃ¡dzky.
            </p>`;
        document.getElementById('printContent').innerHTML = html;
        document.getElementById('printModalTitle').textContent = 'TlaÄ - MaÅ¡taÄ¾nÃ¡ kniha';
        showModalOnly('printModal');
    }

    // ===== VISIT LOG (NÃVÅ TEVNÃ KNIHA) =====
    let visitLogs = [];
    
    async function loadVisitLog() {
        const from = document.getElementById('visitLogFrom')?.value || '';
        const to = document.getElementById('visitLogTo')?.value || '';
        const search = document.getElementById('visitLogSearch')?.value || '';
        
        let url = '/api/visit-log?';
        if (from) url += `date_from=${from}&`;
        if (to) url += `date_to=${to}&`;
        if (search) url += `search=${encodeURIComponent(search)}&`;
        
        try {
            const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
            visitLogs = await res.json();
            if (!Array.isArray(visitLogs)) visitLogs = [];
            renderVisitLog();
        } catch(e) {
            console.error('loadVisitLog error:', e);
            visitLogs = [];
        }
    }
    
    function renderVisitLog() {
        document.getElementById('visitLogTable').innerHTML = visitLogs.map(v => `<tr>
            <td><strong>${v.arrival_date}</strong><br><small>${v.arrival_time}</small></td>
            <td>${v.visitor_name}</td>
            <td>${v.organization || '-'}</td>
            <td>${v.purpose}</td>
            <td>${v.escort_person}</td>
            <td>${v.departure_date ? v.departure_date + ' ' + (v.departure_time || '') : '-'}</td>
            <td>${v.safety_briefing ? 'âœ…' : 'âŒ'}</td>
            <td>
                <button class="btn btn-sm btn-outline" onclick="editVisitLog('${v.id}')">âœï¸</button>
                <button class="btn btn-sm btn-danger" onclick="deleteVisitLog('${v.id}')">ğŸ—‘ï¸</button>
            </td>
        </tr>`).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--gray)">Å½iadne zÃ¡znamy</td></tr>';
    }
    
    function filterVisitLog() { loadVisitLog(); }
    
    function openVisitLogModal() {
        document.getElementById('visitLogId').value = '';
        document.getElementById('visitLogName').value = '';
        document.getElementById('visitLogOrg').value = '';
        document.getElementById('visitLogPurpose').value = '';
        document.getElementById('visitLogPhone').value = '';
        document.getElementById('visitLogEmail').value = '';
        document.getElementById('visitLogArrivalDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('visitLogArrivalTime').value = new Date().toTimeString().slice(0,5);
        document.getElementById('visitLogDepartureDate').value = '';
        document.getElementById('visitLogDepartureTime').value = '';
        document.getElementById('visitLogEscort').value = '';
        document.getElementById('visitLogSafety').checked = false;
        document.getElementById('visitLogSignature').value = '';
        document.getElementById('visitLogNotes').value = '';
        document.getElementById('visitLogModalTitle').textContent = 'NovÃ½ zÃ¡znam - NÃ¡vÅ¡tevnÃ¡ kniha';
        showModalOnly('visitLogModal');
    }
    
    function editVisitLog(id) {
        const v = visitLogs.find(x => x.id === id);
        if (!v) return;
        document.getElementById('visitLogId').value = v.id;
        document.getElementById('visitLogName').value = v.visitor_name || '';
        document.getElementById('visitLogOrg').value = v.organization || '';
        document.getElementById('visitLogPurpose').value = v.purpose || '';
        document.getElementById('visitLogPhone').value = v.contact_phone || '';
        document.getElementById('visitLogEmail').value = v.contact_email || '';
        document.getElementById('visitLogArrivalDate').value = v.arrival_date || '';
        document.getElementById('visitLogArrivalTime').value = v.arrival_time || '';
        document.getElementById('visitLogDepartureDate').value = v.departure_date || '';
        document.getElementById('visitLogDepartureTime').value = v.departure_time || '';
        document.getElementById('visitLogEscort').value = v.escort_person || '';
        document.getElementById('visitLogSafety').checked = v.safety_briefing || false;
        document.getElementById('visitLogSignature').value = v.signature_text || '';
        document.getElementById('visitLogNotes').value = v.notes || '';
        document.getElementById('visitLogModalTitle').textContent = 'UpraviÅ¥ zÃ¡znam';
        showModalOnly('visitLogModal');
    }
    
    async function saveVisitLog() {
        const id = document.getElementById('visitLogId').value;
        const data = {
            visitor_name: document.getElementById('visitLogName').value,
            organization: document.getElementById('visitLogOrg').value || null,
            purpose: document.getElementById('visitLogPurpose').value,
            contact_phone: document.getElementById('visitLogPhone').value || null,
            contact_email: document.getElementById('visitLogEmail').value || null,
            arrival_date: document.getElementById('visitLogArrivalDate').value,
            arrival_time: document.getElementById('visitLogArrivalTime').value,
            departure_date: document.getElementById('visitLogDepartureDate').value || null,
            departure_time: document.getElementById('visitLogDepartureTime').value || null,
            escort_person: document.getElementById('visitLogEscort').value,
            safety_briefing: document.getElementById('visitLogSafety').checked,
            signature_text: document.getElementById('visitLogSignature').value || null,
            notes: document.getElementById('visitLogNotes').value || null
        };
        
        if (!data.visitor_name || !data.purpose || !data.arrival_date || !data.arrival_time || !data.escort_person) {
            showToast('VyplÅˆte povinnÃ© polia', 'error');
            return;
        }
        
        try {
            const res = await fetch(id ? `/api/visit-log/${id}` : '/api/visit-log', {
                method: id ? 'PUT' : 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify(data)
            });
            if (!res.ok) throw new Error('Chyba servera');
            showToast('ZÃ¡znam uloÅ¾enÃ½', 'success');
            closeModal('visitLogModal');
            loadVisitLog();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function deleteVisitLog(id) {
        if (!confirm('Naozaj zmazaÅ¥ tento zÃ¡znam?')) return;
        try {
            await fetch(`/api/visit-log/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showToast('ZÃ¡znam zmazanÃ½', 'success');
            loadVisitLog();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    function printVisitLog() {
        const from = document.getElementById('visitLogFrom')?.value || '';
        const to = document.getElementById('visitLogTo')?.value || '';
        const today = new Date().toLocaleDateString('sk-SK');
        let html = `
            <div style="text-align:center;margin-bottom:2rem">
                <h1>JAZDECKÃ KLUB ZELENÃ MÃÄ½A</h1>
                <h2>Kniha nÃ¡vÅ¡tev prevÃ¡dzky</h2>
                <p>Obdobie: ${from || 'od zaÄiatku'} â€“ ${to || 'do dnes'}</p>
            </div>
            <table style="width:100%;border-collapse:collapse" border="1">
                <thead><tr style="background:#f0f0f0">
                    <th style="padding:8px">PrÃ­chod</th><th style="padding:8px">Meno</th><th style="padding:8px">OrganizÃ¡cia</th>
                    <th style="padding:8px">ÃšÄel</th><th style="padding:8px">Sprievod</th><th style="padding:8px">Odchod</th><th style="padding:8px">Podpis</th>
                </tr></thead>
                <tbody>
        `;
        visitLogs.forEach(v => {
            html += `<tr>
                <td style="padding:8px">${v.arrival_date} ${v.arrival_time}</td>
                <td style="padding:8px">${v.visitor_name}</td>
                <td style="padding:8px">${v.organization || '-'}</td>
                <td style="padding:8px">${v.purpose}</td>
                <td style="padding:8px">${v.escort_person}</td>
                <td style="padding:8px">${v.departure_date ? v.departure_date + ' ' + (v.departure_time || '') : ''}</td>
                <td style="padding:8px">${v.signature_text || ''}</td>
            </tr>`;
        });
        html += `</tbody></table>
            <div style="margin-top:3rem;display:flex;justify-content:space-between">
                <div>DÃ¡tum: ${today}</div>
                <div>Overil: _______________</div>
            </div>
            <p style="margin-top:2rem;font-size:0.85rem;color:#666;text-align:center">
                Dokument bol vytvorenÃ½ elektronickÃ½m evidenÄnÃ½m systÃ©mom prevÃ¡dzky.
            </p>`;
        document.getElementById('printContent').innerHTML = html;
        document.getElementById('printModalTitle').textContent = 'TlaÄ - NÃ¡vÅ¡tevnÃ¡ kniha';
        showModalOnly('printModal');
    }

    // ===== DOCUMENTS CENTRAL =====
    let docsCentral = [];
    
    async function loadDocsCentral() {
        const from = document.getElementById('docsFrom')?.value || '';
        const to = document.getElementById('docsTo')?.value || '';
        const category = document.getElementById('docsCategory')?.value || '';
        const search = document.getElementById('docsSearch')?.value || '';
        
        let url = '/api/documents-v2?';
        if (from) url += `date_from=${from}&`;
        if (to) url += `date_to=${to}&`;
        if (category) url += `category=${category}&`;
        if (search) url += `search=${encodeURIComponent(search)}&`;
        
        try {
            const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
            docsCentral = await res.json();
            if (!Array.isArray(docsCentral)) docsCentral = [];
            renderDocsCentral();
        } catch(e) {
            console.error('loadDocsCentral error:', e);
            docsCentral = [];
        }
    }
    
    const docCategoryLabels = {
        passport: 'Pas koÅˆa', vet_doc: 'VeterinÃ¡rny doklad', death: 'Ãšhyn', rendering: 'KafilÃ©ria',
        license: 'Licencia', receipt: 'PrÃ­jemka', request: 'Å½iadanka', mail: 'PoÅ¡ta',
        contract: 'Zmluva', other: 'InÃ©'
    };
    
    function renderDocsCentral() {
        document.getElementById('docsTable').innerHTML = docsCentral.map(d => {
            const horse = d.horses || horses.find(h => h.id === d.horse_id);
            let link = '-';
            if (horse) link = `ğŸ´ ${horse.stable_name || horse.name}`;
            else if (d.is_club_document) link = 'ğŸ¢ Klub';
            else if (d.stable_log_id) link = 'ğŸ“– MaÅ¡taÄ¾';
            else if (d.visit_log_id) link = 'ğŸ“‹ NÃ¡vÅ¡teva';
            
            return `<tr>
                <td>${d.document_date || '-'}</td>
                <td><strong>${d.title}</strong>${d.description ? `<br><small>${d.description.slice(0,50)}...</small>` : ''}</td>
                <td><span class="badge badge-info">${docCategoryLabels[d.category] || d.category}</span></td>
                <td>${link}</td>
                <td>${d.file_url ? `<a href="${d.file_url}" target="_blank">ğŸ“„ SÃºbor</a>` : '-'}</td>
                <td>
                    <button class="btn btn-sm btn-outline" onclick="editDoc('${d.id}')">âœï¸</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteDoc('${d.id}')">ğŸ—‘ï¸</button>
                </td>
            </tr>`;
        }).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Å½iadne dokumenty</td></tr>';
    }
    
    function filterDocs() { loadDocsCentral(); }
    
    async function openDocModal() {
        document.getElementById('docId').value = '';
        document.getElementById('docForHorseId').value = '';
        document.getElementById('docTitle').value = '';
        document.getElementById('docCategory').value = '';
        document.getElementById('docDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('docDescription').value = '';
        document.getElementById('docFileUrl').value = '';
        document.getElementById('docFileInput').value = '';
        document.getElementById('docUploadStatus').textContent = '';
        document.getElementById('docFileLink').style.display = 'none';
        document.getElementById('docHorse').innerHTML = '<option value="">-- NevybranÃ© --</option>' + horses.map(h => `<option value="${h.id}">${h.stable_name || h.name}</option>`).join('');
        document.getElementById('docIsClub').checked = false;
        
        // Load stable logs for select
        try {
            const res = await fetch('/api/stable-log', { headers: { 'Authorization': `Bearer ${token}` } });
            const logs = await res.json();
            document.getElementById('docStableLog').innerHTML = '<option value="">-- NevybranÃ© --</option>' + (logs || []).map(s => `<option value="${s.id}">${s.event_date} - ${eventTypeLabels[s.event_type] || s.event_type}</option>`).join('');
        } catch(e) {}
        
        // Load visit logs for select
        try {
            const res = await fetch('/api/visit-log', { headers: { 'Authorization': `Bearer ${token}` } });
            const logs = await res.json();
            document.getElementById('docVisitLog').innerHTML = '<option value="">-- NevybranÃ© --</option>' + (logs || []).map(v => `<option value="${v.id}">${v.arrival_date} - ${v.visitor_name}</option>`).join('');
        } catch(e) {}
        
        document.getElementById('docModalTitle').textContent = 'PridaÅ¥ dokument';
        showModalOnly('docModal');
    }
    
    async function editDoc(id) {
        const d = docsCentral.find(x => x.id === id);
        if (!d) return;
        
        await openDocModal();
        document.getElementById('docId').value = d.id;
        document.getElementById('docTitle').value = d.title || '';
        document.getElementById('docCategory').value = d.category || '';
        document.getElementById('docDate').value = d.document_date || '';
        document.getElementById('docDescription').value = d.description || '';
        document.getElementById('docFileUrl').value = d.file_url || '';
        
        // Show existing file link
        if (d.file_url) {
            document.getElementById('docFileLink').style.display = 'block';
            document.getElementById('docFileLinkUrl').href = d.file_url;
            document.getElementById('docUploadStatus').textContent = 'ExistujÃºci sÃºbor';
        }
        
        document.getElementById('docHorse').value = d.horse_id || '';
        document.getElementById('docIsClub').checked = d.is_club_document || false;
        document.getElementById('docStableLog').value = d.stable_log_id || '';
        document.getElementById('docVisitLog').value = d.visit_log_id || '';
        document.getElementById('docModalTitle').textContent = 'UpraviÅ¥ dokument';
    }
    
    async function saveDoc() {
        const id = document.getElementById('docId').value;
        const data = {
            title: document.getElementById('docTitle').value,
            category: document.getElementById('docCategory').value,
            document_date: document.getElementById('docDate').value || null,
            description: document.getElementById('docDescription').value || null,
            file_url: document.getElementById('docFileUrl').value || null,
            horse_id: document.getElementById('docHorse').value || null,
            is_club_document: document.getElementById('docIsClub').checked,
            stable_log_id: document.getElementById('docStableLog').value || null,
            visit_log_id: document.getElementById('docVisitLog').value || null
        };
        
        if (!data.title || !data.category) {
            showToast('VyplÅˆte nÃ¡zov a kategÃ³riu', 'error');
            return;
        }
        
        try {
            const res = await fetch(id ? `/api/documents-v2/${id}` : '/api/documents-v2', {
                method: id ? 'PUT' : 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify(data)
            });
            if (!res.ok) throw new Error('Chyba servera');
            showToast('Dokument uloÅ¾enÃ½', 'success');
            closeModal('docModal');
            loadDocsCentral();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    async function deleteDoc(id) {
        if (!confirm('Naozaj zmazaÅ¥ tento dokument?')) return;
        try {
            await fetch(`/api/documents-v2/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showToast('Dokument zmazanÃ½', 'success');
            loadDocsCentral();
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }
    
    function printDocs() {
        const from = document.getElementById('docsFrom')?.value || '';
        const to = document.getElementById('docsTo')?.value || '';
        const today = new Date().toLocaleDateString('sk-SK');
        let html = `
            <div style="text-align:center;margin-bottom:2rem">
                <h1>JAZDECKÃ KLUB ZELENÃ MÃÄ½A</h1>
                <h2>Evidencia dokumentov</h2>
                <p>Obdobie: ${from || 'od zaÄiatku'} â€“ ${to || 'do dnes'}</p>
            </div>
            <table style="width:100%;border-collapse:collapse" border="1">
                <thead><tr style="background:#f0f0f0">
                    <th style="padding:8px">DÃ¡tum</th><th style="padding:8px">NÃ¡zov</th><th style="padding:8px">KategÃ³ria</th><th style="padding:8px">VÃ¤zba</th>
                </tr></thead>
                <tbody>
        `;
        docsCentral.forEach(d => {
            const horse = d.horses || horses.find(h => h.id === d.horse_id);
            let link = '-';
            if (horse) link = horse.stable_name || horse.name;
            else if (d.is_club_document) link = 'PrevÃ¡dzka';
            
            html += `<tr>
                <td style="padding:8px">${d.document_date || '-'}</td>
                <td style="padding:8px">${d.title}</td>
                <td style="padding:8px">${docCategoryLabels[d.category] || d.category}</td>
                <td style="padding:8px">${link}</td>
            </tr>`;
        });
        html += `</tbody></table>
            <p style="margin-top:2rem;font-size:0.85rem;color:#666;text-align:center">
                Dokument bol vytvorenÃ½ elektronickÃ½m evidenÄnÃ½m systÃ©mom prevÃ¡dzky.
            </p>`;
        document.getElementById('printContent').innerHTML = html;
        document.getElementById('printModalTitle').textContent = 'TlaÄ - Dokumenty';
        showModalOnly('printModal');
    }

    // ===== HORSE DETAIL =====
    let currentHorseId = null;
    let horseDocs = [];
    let horseHistory = [];
    let horseVetRecords = [];

    async function openHorseDetail(horseId) {
        currentHorseId = horseId;
        const horse = horses.find(h => h.id === horseId);
        if (!horse) { showToast('KÃ´Åˆ nenÃ¡jdenÃ½', 'error'); return; }
        
        document.getElementById('horseDetailTitle').textContent = `${horse.stable_name || horse.name} - Detail`;
        
        // Reset tabs
        document.querySelectorAll('[data-horse-tab]').forEach(t => t.classList.remove('active'));
        document.querySelector('[data-horse-tab="info"]').classList.add('active');
        document.querySelectorAll('.horse-tab-content').forEach(c => c.style.display = 'none');
        document.getElementById('horseTabInfo').style.display = 'block';
        
        // Render basic info
        renderHorseDetailInfo(horse);
        
        // Load related data
        await Promise.all([
            loadHorseDocs(horseId),
            loadHorseHistory(horseId),
            loadHorseVetRecords(horseId)
        ]);
        
        showModalOnly('horseDetailModal');
    }

    function renderHorseDetailInfo(h) {
        const levelLabels = {beginner:'ZaÄiatoÄnÃ­ci',intermediate:'PokroÄilÃ­',advanced:'SkÃºsenÃ­',children:'Deti',competition:'SÃºÅ¥aÅ¾nÃ½'};
        document.getElementById('horseDetailInfo').innerHTML = `
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:1rem">
                <div class="card" style="margin:0">
                    <div class="card-header"><h4 style="margin:0">ğŸ“‹ ZÃ¡kladnÃ© Ãºdaje</h4></div>
                    <div class="card-body">
                        <p><strong>Meno:</strong> ${h.name}</p>
                        <p><strong>Volacia meno:</strong> ${h.stable_name || '-'}</p>
                        <p><strong>Plemeno:</strong> ${h.breed || '-'}</p>
                        <p><strong>Farba:</strong> ${h.color || '-'}</p>
                        <p><strong>Pohlavie:</strong> ${h.sex || '-'}</p>
                        <p><strong>DÃ¡tum narodenia:</strong> ${h.birth_date || '-'}</p>
                        <p><strong>VÃ½Å¡ka:</strong> ${h.height_cm ? h.height_cm + ' cm' : '-'}</p>
                        <p><strong>HmotnosÅ¥:</strong> ${h.weight_kg ? h.weight_kg + ' kg' : '-'}</p>
                    </div>
                </div>
                <div class="card" style="margin:0">
                    <div class="card-header"><h4 style="margin:0">ğŸ“ IdentifikÃ¡cia</h4></div>
                    <div class="card-body">
                        <p><strong>ÄŒÃ­slo pasu:</strong> ${h.passport_number || '-'}</p>
                        <p><strong>Å½ivotnÃ© ÄÃ­slo (UELN):</strong> ${h.life_number || '-'}</p>
                        <p><strong>MikroÄip:</strong> ${h.microchip || '-'}</p>
                        <p><strong>FEI ID:</strong> ${h.fei_id || '-'}</p>
                        <p><strong>FEI pas platnÃ½ do:</strong> ${h.fei_passport_expiry || '-'}</p>
                        <p><strong>SJF licencia:</strong> ${h.sjf_license_number || '-'}</p>
                        <p><strong>SJF platnÃ¡ do:</strong> ${h.sjf_license_valid_until || '-'}</p>
                    </div>
                </div>
                <div class="card" style="margin:0">
                    <div class="card-header"><h4 style="margin:0">ğŸ‘¤ OstatnÃ©</h4></div>
                    <div class="card-body">
                        <p><strong>MajiteÄ¾:</strong> ${h.owner_name || '-'}</p>
                        <p><strong>ÃšroveÅˆ:</strong> ${levelLabels[h.level] || h.level || '-'}</p>
                        <p><strong>DisciplÃ­ny:</strong> ${(h.disciplines || []).join(', ') || '-'}</p>
                        <p><strong>Status:</strong> <span class="badge badge-${h.status === 'active' ? 'success' : 'gray'}">${h.status}</span></p>
                        <p><strong>PoznÃ¡mky:</strong> ${h.notes || '-'}</p>
                    </div>
                </div>
            </div>
        `;
    }

    async function loadHorseDocs(horseId) {
        try {
            const res = await fetch(`/api/documents-v2?horse_id=${horseId}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            horseDocs = await res.json();
            if (!Array.isArray(horseDocs)) horseDocs = [];
            renderHorseDocs();
        } catch(e) {
            console.error('loadHorseDocs error:', e);
            horseDocs = [];
        }
    }

    function renderHorseDocs() {
        document.getElementById('horseDocsTable').innerHTML = horseDocs.map(d => `
            <tr>
                <td>${d.document_date || '-'}</td>
                <td><strong>${d.title}</strong></td>
                <td><span class="badge badge-info">${docCategoryLabels[d.category] || d.category}</span></td>
                <td>${d.file_url ? `<a href="${d.file_url}" target="_blank">ğŸ“„ OtvoriÅ¥</a>` : '-'}</td>
                <td>
                    <button class="btn btn-sm btn-outline" onclick="editDoc('${d.id}')">âœï¸</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteDocFromHorse('${d.id}')">ğŸ—‘ï¸</button>
                </td>
            </tr>
        `).join('') || '<tr><td colspan="5" style="text-align:center;color:var(--gray)">Å½iadne dokumenty</td></tr>';
    }

    async function deleteDocFromHorse(id) {
        if (!confirm('ZmazaÅ¥ tento dokument?')) return;
        try {
            await fetch(`/api/documents-v2/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showToast('Dokument zmazanÃ½', 'success');
            loadHorseDocs(currentHorseId);
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    async function loadHorseHistory(horseId) {
        try {
            const res = await fetch(`/api/stable-log?horse_id=${horseId}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            horseHistory = await res.json();
            if (!Array.isArray(horseHistory)) horseHistory = [];
            renderHorseHistory();
        } catch(e) {
            console.error('loadHorseHistory error:', e);
            horseHistory = [];
        }
    }

    function renderHorseHistory() {
        document.getElementById('horseHistoryTable').innerHTML = horseHistory.map(s => `
            <tr>
                <td><strong>${s.event_date}</strong>${s.event_time ? `<br><small>${s.event_time}</small>` : ''}</td>
                <td><span class="badge badge-${s.event_type === 'death' ? 'danger' : 'info'}">${eventTypeLabels[s.event_type] || s.event_type}</span></td>
                <td>${s.location_from || ''} ${s.location_to ? 'â†’ ' + s.location_to : ''}</td>
                <td>${s.responsible_person || '-'}</td>
                <td>${s.notes || '-'}</td>
                <td>
                    <button class="btn btn-sm btn-outline" onclick="editStableLogFromHorse('${s.id}')">âœï¸</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteStableLogFromHorse('${s.id}')">ğŸ—‘ï¸</button>
                </td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Å½iadne zÃ¡znamy</td></tr>';
    }

    async function deleteStableLogFromHorse(id) {
        if (!confirm('ZmazaÅ¥ tento zÃ¡znam?')) return;
        try {
            await fetch(`/api/stable-log/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            showToast('ZÃ¡znam zmazanÃ½', 'success');
            loadHorseHistory(currentHorseId);
        } catch(e) {
            showToast('Chyba: ' + e.message, 'error');
        }
    }

    function editStableLogFromHorse(id) {
        closeModal('horseDetailModal');
        editStableLog(id);
    }

    async function loadHorseVetRecords(horseId) {
        try {
            const res = await fetch(`/api/vet-records?horse_id=${horseId}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            horseVetRecords = await res.json();
            if (!Array.isArray(horseVetRecords)) horseVetRecords = [];
            renderHorseVetRecords();
        } catch(e) {
            console.error('loadHorseVetRecords error:', e);
            horseVetRecords = [];
        }
    }

    function renderHorseVetRecords() {
        const typeLabels = {vaccination:'OÄkovanie',deworming:'OdÄervenie',dental:'Zuby',farrier:'PodkÃºvanie',checkup:'Prehliadka',injury:'Zranenie',surgery:'OperÃ¡cia',other:'InÃ©'};
        document.getElementById('horseVetTable').innerHTML = horseVetRecords.map(v => `
            <tr>
                <td>${v.record_date || '-'}</td>
                <td><span class="badge badge-info">${typeLabels[v.record_type] || v.record_type}</span></td>
                <td>${v.vet_name || '-'}</td>
                <td>${v.next_due_date || '-'}</td>
                <td>${v.notes || '-'}</td>
            </tr>
        `).join('') || '<tr><td colspan="5" style="text-align:center;color:var(--gray)">Å½iadne zÃ¡znamy</td></tr>';
    }

    // Horse detail tab switching
    document.querySelectorAll('[data-horse-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('[data-horse-tab]').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            document.querySelectorAll('.horse-tab-content').forEach(c => c.style.display = 'none');
            const tabName = tab.dataset.horseTab;
            if (tabName === 'info') document.getElementById('horseTabInfo').style.display = 'block';
            if (tabName === 'docs') document.getElementById('horseTabDocs').style.display = 'block';
            if (tabName === 'history') document.getElementById('horseTabHistory').style.display = 'block';
            if (tabName === 'vet') document.getElementById('horseTabVet').style.display = 'block';
        });
    });

    // Open doc modal for current horse
    function openDocModalForHorse() {
        closeModal('horseDetailModal');
        openDocModal();
        document.getElementById('docHorse').value = currentHorseId;
        document.getElementById('docForHorseId').value = currentHorseId;
    }

    // Open stable log modal for current horse
    function openStableLogForHorse() {
        closeModal('horseDetailModal');
        openStableLogModal();
        document.getElementById('stableLogHorseSelect').value = currentHorseId;
    }

    // Open vet modal for current horse  
    function openVetForHorse() {
        closeModal('horseDetailModal');
        openModal('vetModal');
        document.getElementById('vetHorse').value = currentHorseId;
    }

    // File upload handler
    async function handleDocFileSelect(input) {
        const file = input.files[0];
        if (!file) return;
        
        if (file.size > 4 * 1024 * 1024) {
            showToast('SÃºbor je prÃ­liÅ¡ veÄ¾kÃ½ (max 4MB)', 'error');
            input.value = '';
            return;
        }
        
        document.getElementById('docUploadStatus').textContent = 'NahrÃ¡vam...';
        
        try {
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64 = e.target.result;
                
                const res = await fetch('/api/upload', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        file: base64,
                        filename: file.name,
                        folder: 'documents'
                    })
                });
                
                const data = await res.json();
                
                if (data.url) {
                    document.getElementById('docFileUrl').value = data.url;
                    document.getElementById('docUploadStatus').textContent = 'âœ… NahratÃ©';
                    document.getElementById('docFileLink').style.display = 'block';
                    document.getElementById('docFileLinkUrl').href = data.url;
                } else {
                    throw new Error(data.error || 'Upload zlyhal');
                }
            };
            reader.readAsDataURL(file);
        } catch(e) {
            console.error('Upload error:', e);
            document.getElementById('docUploadStatus').textContent = 'âŒ Chyba';
            showToast('Chyba nahrÃ¡vania: ' + e.message, 'error');
        }
    }

    // Print horse detail card
    function printHorseDetail() {
        const horse = horses.find(h => h.id === currentHorseId);
        if (!horse) return;
        const today = new Date().toLocaleDateString('sk-SK');
        
        let html = `
            <div style="text-align:center;margin-bottom:2rem">
                <h1>JAZDECKÃ KLUB ZELENÃ MÃÄ½A</h1>
                <h2>EvidenÄnÃ¡ karta koÅˆa: ${horse.name}</h2>
            </div>
            <table style="width:100%;border-collapse:collapse;margin-bottom:2rem" border="1">
                <tr><td style="padding:8px;width:30%"><strong>Volacia meno:</strong></td><td style="padding:8px">${horse.stable_name || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>Plemeno:</strong></td><td style="padding:8px">${horse.breed || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>Farba:</strong></td><td style="padding:8px">${horse.color || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>DÃ¡tum narodenia:</strong></td><td style="padding:8px">${horse.birth_date || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>ÄŒÃ­slo pasu:</strong></td><td style="padding:8px">${horse.passport_number || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>UELN:</strong></td><td style="padding:8px">${horse.life_number || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>MikroÄip:</strong></td><td style="padding:8px">${horse.microchip || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>FEI ID:</strong></td><td style="padding:8px">${horse.fei_id || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>SJF licencia:</strong></td><td style="padding:8px">${horse.sjf_license_number || '-'}</td></tr>
                <tr><td style="padding:8px"><strong>MajiteÄ¾:</strong></td><td style="padding:8px">${horse.owner_name || '-'}</td></tr>
            </table>
            <h3>HistÃ³ria maÅ¡tale</h3>
            <table style="width:100%;border-collapse:collapse" border="1">
                <thead><tr style="background:#f0f0f0">
                    <th style="padding:8px">DÃ¡tum</th><th style="padding:8px">UdalosÅ¥</th><th style="padding:8px">Miesto</th><th style="padding:8px">ZodpovednÃ½</th>
                </tr></thead>
                <tbody>
        `;
        horseHistory.forEach(s => {
            html += `<tr>
                <td style="padding:8px">${s.event_date}</td>
                <td style="padding:8px">${eventTypeLabels[s.event_type] || s.event_type}</td>
                <td style="padding:8px">${s.location_from || ''} ${s.location_to ? 'â†’ ' + s.location_to : ''}</td>
                <td style="padding:8px">${s.responsible_person || '-'}</td>
            </tr>`;
        });
        html += `</tbody></table>
            <p style="margin-top:2rem;font-size:0.85rem;color:#666;text-align:center">
                Dokument bol vytvorenÃ½ elektronickÃ½m evidenÄnÃ½m systÃ©mom prevÃ¡dzky. DÃ¡tum: ${today}
            </p>`;
        
        document.getElementById('printContent').innerHTML = html;
        document.getElementById('printModalTitle').textContent = 'TlaÄ karty koÅˆa';
        closeModal('horseDetailModal');
        showModalOnly('printModal');
    }

    // ===== TASKS (ÃšLOHY) =====
    let tasks = [];
    
    async function loadTasks() {
        try {
            const status = document.getElementById('taskStatusFilter')?.value || '';
            const priority = document.getElementById('taskPriorityFilter')?.value || '';
            
            let url = '/api/tasks?';
            if (status) url += `status=${status}&`;
            if (priority) url += `priority=${priority}&`;
            
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            if (!res.ok) throw new Error('Failed to load tasks');
            tasks = await res.json();
            renderTasks();
            updateTaskStats();
        } catch(e) {
            console.error('loadTasks error:', e);
        }
    }
    
    function renderTasks() {
        const tbody = document.getElementById('tasksTable');
        if (!tbody) return;
        
        const priorityBadges = { low: 'badge-gray', normal: 'badge-info', high: 'badge-warning', urgent: 'badge-danger' };
        const priorityLabels = { low: 'NÃ­zka', normal: 'NormÃ¡lna', high: 'VysokÃ¡', urgent: 'UrgentnÃ¡' };
        const statusBadges = { open: 'badge-warning', in_progress: 'badge-info', completed: 'badge-success', cancelled: 'badge-gray' };
        const statusLabels = { open: 'OtvorenÃ¡', in_progress: 'RozpracovanÃ¡', completed: 'DokonÄenÃ¡', cancelled: 'ZruÅ¡enÃ¡' };
        
        const today = new Date().toISOString().split('T')[0];
        
        tbody.innerHTML = tasks.map(t => {
            const isOverdue = t.due_date && t.due_date < today && t.status !== 'completed';
            const horseName = t.horses ? (t.horses.stable_name || t.horses.name) : '';
            const assignedName = t.assigned?.username || '';
            
            return `<tr class="${isOverdue ? 'table-row-danger' : ''}">
                <td><span class="badge ${priorityBadges[t.priority]}">${priorityLabels[t.priority] || t.priority}</span></td>
                <td><strong>${t.title}</strong>${t.description ? `<br><small style="color:var(--gray)">${t.description.substring(0, 60)}...</small>` : ''}</td>
                <td>${t.category || '-'}</td>
                <td>${horseName ? 'ğŸ´ ' + horseName : '-'}</td>
                <td>${t.due_date ? `<span class="${isOverdue ? 'text-danger' : ''}">${t.due_date}</span>` : '-'}</td>
                <td>${assignedName || '-'}</td>
                <td><span class="badge ${statusBadges[t.status]}">${statusLabels[t.status] || t.status}</span></td>
                <td>
                    ${t.status !== 'completed' ? `<button class="btn btn-sm btn-success" onclick="completeTask('${t.id}')" title="DokonÄiÅ¥">âœ“</button>` : ''}
                    <button class="btn btn-sm btn-outline" onclick="editTask('${t.id}')">UpraviÅ¥</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteTask('${t.id}')">ZmazaÅ¥</button>
                </td>
            </tr>`;
        }).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--gray)">Å½iadne Ãºlohy</td></tr>';
    }
    
    function updateTaskStats() {
        const today = new Date().toISOString().split('T')[0];
        const pending = tasks.filter(t => t.status === 'open').length;
        const inProgress = tasks.filter(t => t.status === 'in_progress').length;
        const overdue = tasks.filter(t => t.due_date && t.due_date < today && t.status !== 'completed').length;
        const completed = tasks.filter(t => t.status === 'completed').length;
        
        const el1 = document.getElementById('tasksPending'); if (el1) el1.textContent = pending;
        const el2 = document.getElementById('tasksInProgress'); if (el2) el2.textContent = inProgress;
        const el3 = document.getElementById('tasksOverdue'); if (el3) el3.textContent = overdue;
        const el4 = document.getElementById('tasksCompleted'); if (el4) el4.textContent = completed;
        
        const badge = document.getElementById('tasksBadge');
        if (badge) badge.textContent = pending + inProgress;
    }
    
    async function openTaskModal(id = null) {
        document.getElementById('taskId').value = id || '';
        document.getElementById('taskModalTitle').textContent = id ? 'UpraviÅ¥ Ãºlohu' : 'NovÃ¡ Ãºloha';
        
        // Reset form
        document.getElementById('taskTitle').value = '';
        document.getElementById('taskDescription').value = '';
        document.getElementById('taskPriority').value = 'normal';
        document.getElementById('taskDueDate').value = '';
        
        // NaÄÃ­taj selecty
        try {
            const [horsesRes, usersRes] = await Promise.all([
                fetch('/api/horses', { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } }),
                fetch('/api/admin-users', { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } })
            ]);
            const horsesList = await horsesRes.json();
            const usersList = await usersRes.json();
            
            document.getElementById('taskHorse').innerHTML = '<option value="">-- Å½iadna --</option>' +
                horsesList.map(h => `<option value="${h.id}">${h.stable_name || h.name}</option>`).join('');
            document.getElementById('taskAssigned').innerHTML = '<option value="">-- NepriradenÃ© --</option>' +
                usersList.map(u => `<option value="${u.id}">${u.username}</option>`).join('');
                
            if (id) {
                const task = tasks.find(t => t.id === id);
                if (task) {
                    document.getElementById('taskTitle').value = task.title || '';
                    document.getElementById('taskDescription').value = task.description || '';
                    document.getElementById('taskPriority').value = task.priority || 'normal';
                    document.getElementById('taskDueDate').value = task.due_date || '';
                    document.getElementById('taskHorse').value = task.horse_id || '';
                    document.getElementById('taskAssigned').value = task.assigned_to || '';
                }
            }
        } catch(e) {
            console.error('Error loading task selects:', e);
        }
        
        showModal('taskModal');
    }
    
    async function saveTask() {
        const id = document.getElementById('taskId').value;
        const data = {
            title: document.getElementById('taskTitle').value,
            description: document.getElementById('taskDescription').value,
            priority: document.getElementById('taskPriority').value,
            due_date: document.getElementById('taskDueDate').value || null,
            horse_id: document.getElementById('taskHorse').value || null,
            assigned_to: document.getElementById('taskAssigned').value || null
        };
        
        if (!data.title) {
            alert('VyplÅˆte nÃ¡zov Ãºlohy');
            return;
        }
        
        try {
            const url = id ? `/api/tasks/${id}` : '/api/tasks';
            const method = id ? 'PUT' : 'POST';
            
            const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                body: JSON.stringify(data)
            });
            
            if (!res.ok) throw new Error('Failed to save task');
            
            closeModal('taskModal');
            loadTasks();
        } catch(e) {
            alert('Chyba pri ukladanÃ­: ' + e.message);
        }
    }
    
    function editTask(id) {
        openTaskModal(id);
    }
    
    async function completeTask(id) {
        if (!confirm('OznaÄiÅ¥ Ãºlohu ako dokonÄenÃº?')) return;
        
        try {
            const res = await fetch(`/api/tasks/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                body: JSON.stringify({ status: 'completed', completed_at: new Date().toISOString() })
            });
            if (!res.ok) throw new Error('Failed');
            loadTasks();
        } catch(e) {
            alert('Chyba: ' + e.message);
        }
    }
    
    async function deleteTask(id) {
        if (!confirm('Naozaj zmazaÅ¥ tÃºto Ãºlohu?')) return;
        
        try {
            const res = await fetch(`/api/tasks/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
            });
            if (!res.ok) throw new Error('Failed');
            loadTasks();
        } catch(e) {
            alert('Chyba: ' + e.message);
        }
    }
    
    // ===== RUN NOTIFICATION RULES =====
    async function runNotificationRules() {
        try {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Prebieha...';
            
            const res = await fetch('/api/system-run-rules', {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
            });
            
            const result = await res.json();
            
            if (res.ok) {
                alert(result.message || 'Upozornenia boli obnovenÃ©');
                loadNotifications();
            } else {
                throw new Error(result.error || 'Chyba');
            }
        } catch(e) {
            alert('Chyba: ' + e.message);
        } finally {
            const btn = event.target;
            btn.disabled = false;
            btn.textContent = 'ObnoviÅ¥ upozornenia';
        }
    }

    // ===== AUDIT TRAIL =====
    let auditLogs = [];
    let auditOffset = 0;
    const auditLimit = 50;
    let auditTotal = 0;

    async function loadAuditLogs() {
        try {
            const from = document.getElementById('auditFromDate')?.value || '';
            const to = document.getElementById('auditToDate')?.value || '';
            const entity_type = document.getElementById('auditEntityFilter')?.value || '';
            const action = document.getElementById('auditActionFilter')?.value || '';
            const changed_by = document.getElementById('auditUserFilter')?.value || '';
            
            let url = `/api/audit-logs?limit=${auditLimit}&offset=${auditOffset}`;
            if (from) url += `&from=${from}`;
            if (to) url += `&to=${to}`;
            if (entity_type) url += `&entity_type=${entity_type}`;
            if (action) url += `&action=${action}`;
            if (changed_by) url += `&changed_by=${changed_by}`;
            
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            const result = await res.json();
            
            auditLogs = result.data || [];
            auditTotal = result.total || 0;
            
            renderAuditTable();
            updateAuditPagination();
        } catch(e) {
            console.error('loadAuditLogs error:', e);
        }
    }

    function renderAuditTable() {
        const tbody = document.getElementById('auditLogsTable');
        if (!tbody) return;
        
        const entityLabels = {
            horses: 'Kone', riders: 'Jazdci', trainers: 'Treneri', employees: 'Zamestnanci',
            vaccinations: 'Ockovania', feeding: 'Krmenie', stable_log: 'Mastalna kniha',
            visit_log: 'Navstevna kniha', documents_v2: 'Dokumenty', tasks: 'Ulohy',
            notifications: 'Upozornenia', feeding_items: 'Krmivo'
        };
        
        const actionBadges = {
            INSERT: 'badge-success', UPDATE: 'badge-warning', DELETE: 'badge-danger'
        };
        const actionLabels = {
            INSERT: 'Vytvorenie', UPDATE: 'Uprava', DELETE: 'Zmazanie'
        };
        
        tbody.innerHTML = auditLogs.map(log => {
            const date = new Date(log.created_at).toLocaleString('sk');
            const changedFields = log.changed_fields ? log.changed_fields.join(', ') : '-';
            return `
            <tr>
                <td>${date}</td>
                <td>${entityLabels[log.entity_type] || log.entity_type}<br><small style="color:var(--gray)">${log.entity_id.substring(0, 8)}...</small></td>
                <td><span class="badge ${actionBadges[log.action]}">${actionLabels[log.action]}</span></td>
                <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis">${changedFields}</td>
                <td>${log.changed_by_name || '-'}</td>
                <td><button class="btn btn-sm btn-outline" onclick="showAuditDetail('${log.id}')">Detail</button></td>
            </tr>`;
        }).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--gray)">Ziadne zaznamy</td></tr>';
        
        document.getElementById('auditTotal').textContent = `${auditTotal} zaznamov`;
    }

    function updateAuditPagination() {
        const page = Math.floor(auditOffset / auditLimit) + 1;
        const totalPages = Math.ceil(auditTotal / auditLimit);
        document.getElementById('auditPagination').textContent = `Strana ${page} z ${totalPages || 1}`;
        document.getElementById('auditPrevBtn').disabled = auditOffset === 0;
        document.getElementById('auditNextBtn').disabled = auditOffset + auditLimit >= auditTotal;
    }

    function loadAuditLogsPrev() {
        if (auditOffset > 0) {
            auditOffset -= auditLimit;
            loadAuditLogs();
        }
    }

    function loadAuditLogsNext() {
        if (auditOffset + auditLimit < auditTotal) {
            auditOffset += auditLimit;
            loadAuditLogs();
        }
    }

    async function showAuditDetail(id) {
        try {
            const res = await fetch(`/api/audit-logs/${id}`, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            const log = await res.json();
            
            const entityLabels = {
                horses: 'Kone', riders: 'Jazdci', trainers: 'Treneri', employees: 'Zamestnanci',
                vaccinations: 'Ockovania', feeding: 'Krmenie', stable_log: 'Mastalna kniha',
                visit_log: 'Navstevna kniha', documents_v2: 'Dokumenty', tasks: 'Ulohy',
                notifications: 'Upozornenia'
            };
            const actionLabels = { INSERT: 'Vytvorenie', UPDATE: 'Uprava', DELETE: 'Zmazanie' };
            
            let beforeHtml = '-';
            let afterHtml = '-';
            let diffHtml = '';
            
            if (log.before_data) {
                beforeHtml = '<pre style="background:#f5f5f5;padding:0.5rem;font-size:0.8rem;max-height:300px;overflow:auto">' + JSON.stringify(log.before_data, null, 2) + '</pre>';
            }
            if (log.after_data) {
                afterHtml = '<pre style="background:#f5f5f5;padding:0.5rem;font-size:0.8rem;max-height:300px;overflow:auto">' + JSON.stringify(log.after_data, null, 2) + '</pre>';
            }
            
            if (log.changed_fields && log.changed_fields.length > 0) {
                diffHtml = '<h4 style="margin-top:1rem">Zmenene polia</h4><table class="table" style="font-size:0.85rem"><thead><tr><th>Pole</th><th>Pred</th><th>Po</th></tr></thead><tbody>';
                for (const field of log.changed_fields) {
                    const before = log.before_data ? JSON.stringify(log.before_data[field]) : '-';
                    const after = log.after_data ? JSON.stringify(log.after_data[field]) : '-';
                    diffHtml += `<tr><td><strong>${field}</strong></td><td style="color:var(--danger)">${before}</td><td style="color:var(--success)">${after}</td></tr>`;
                }
                diffHtml += '</tbody></table>';
            }
            
            const html = `
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">
                    <div><strong>Entita:</strong> ${entityLabels[log.entity_type] || log.entity_type}</div>
                    <div><strong>ID zaznamu:</strong> ${log.entity_id}</div>
                    <div><strong>Akcia:</strong> ${actionLabels[log.action]}</div>
                    <div><strong>Pouzivatel:</strong> ${log.changed_by_name || 'System'}</div>
                    <div><strong>Datum:</strong> ${new Date(log.created_at).toLocaleString('sk')}</div>
                </div>
                ${diffHtml}
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem">
                    <div><h4>Pred zmenou</h4>${beforeHtml}</div>
                    <div><h4>Po zmene</h4>${afterHtml}</div>
                </div>
            `;
            
            document.getElementById('auditDetailContent').innerHTML = html;
            showModal('auditDetailModal');
        } catch(e) {
            alert('Chyba pri nacitani detailu: ' + e.message);
        }
    }

    function printAuditTrail() {
        const from = document.getElementById('auditFromDate')?.value || 'od zaciatku';
        const to = document.getElementById('auditToDate')?.value || 'do dnes';
        const today = new Date().toLocaleDateString('sk');
        
        const entityLabels = {
            horses: 'Kone', riders: 'Jazdci', trainers: 'Treneri', employees: 'Zamestnanci',
            vaccinations: 'Ockovania', feeding: 'Krmenie', stable_log: 'Mastalna kniha',
            visit_log: 'Navstevna kniha', documents_v2: 'Dokumenty', tasks: 'Ulohy',
            notifications: 'Upozornenia'
        };
        const actionLabels = { INSERT: 'Vytvorenie', UPDATE: 'Uprava', DELETE: 'Zmazanie' };
        
        const rows = auditLogs.map(log => `
            <tr>
                <td>${new Date(log.created_at).toLocaleString('sk')}</td>
                <td>${entityLabels[log.entity_type] || log.entity_type}</td>
                <td>${actionLabels[log.action]}</td>
                <td>${log.changed_fields ? log.changed_fields.join(', ') : '-'}</td>
                <td>${log.changed_by_name || '-'}</td>
            </tr>
        `).join('');
        
        const html = `
            <h2 style="text-align:center;margin-bottom:0.5rem">JAZDECKY KLUB ZELENA MILA</h2>
            <h3 style="text-align:center;margin-bottom:1rem">Audit trail</h3>
            <p style="text-align:center;margin-bottom:1.5rem">Obdobie: ${from} - ${to}</p>
            <table style="width:100%;border-collapse:collapse;font-size:0.85rem">
                <thead>
                    <tr style="background:#f0f0f0">
                        <th style="border:1px solid #ddd;padding:8px;text-align:left">Datum a cas</th>
                        <th style="border:1px solid #ddd;padding:8px;text-align:left">Entita</th>
                        <th style="border:1px solid #ddd;padding:8px;text-align:left">Akcia</th>
                        <th style="border:1px solid #ddd;padding:8px;text-align:left">Zmenene polia</th>
                        <th style="border:1px solid #ddd;padding:8px;text-align:left">Pouzivatel</th>
                    </tr>
                </thead>
                <tbody>${rows}</tbody>
            </table>
            <p style="margin-top:2rem;font-size:0.85rem;color:#666;text-align:center">
                Dokument bol vytvoreny elektronickym evidencnym systemom prevadzky. Datum: ${today}
            </p>
        `;
        
        document.getElementById('printContent').innerHTML = html;
        document.getElementById('printModalTitle').textContent = 'Tlac Audit trail';
        showModal('printModal');
    }

    async function initAuditFilters() {
        try {
            const res = await fetch('/api/admin-users', { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            const users = await res.json();
            const select = document.getElementById('auditUserFilter');
            if (select && users && users.length) {
                select.innerHTML = '<option value="">Vsetci</option>' + 
                    users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
            }
        } catch(e) { console.error(e); }
    }

    // ===== EXPORTS =====
    let exportData = { stableLog: [], visitLog: [], licenses: [], vaccinations: [], documents: [] };

    function showExportTab(tab) {
        document.querySelectorAll('.export-tab').forEach(t => t.style.display = 'none');
        const el = document.getElementById('export-' + tab);
        if (el) el.style.display = 'block';
    }

    async function loadExportStableLog() {
        const from = document.getElementById('exportStableFrom')?.value || '';
        const to = document.getElementById('exportStableTo')?.value || '';
        let url = '/api/exports/stable-log?';
        if (from) url += `from=${from}&`;
        if (to) url += `to=${to}`;
        try {
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            exportData.stableLog = await res.json();
            renderExportStableLog();
        } catch(e) { console.error(e); }
    }

    function renderExportStableLog() {
        const tbody = document.getElementById('exportStableTable');
        if (!tbody) return;
        tbody.innerHTML = exportData.stableLog.map(r => `
            <tr>
                <td>${r.event_date || ''}</td>
                <td>${r.event_time || ''}</td>
                <td>${r.event_type || ''}</td>
                <td>${r.horses ? (r.horses.stable_name || r.horses.name) : ''}</td>
                <td>${r.horses?.passport_number || ''}</td>
                <td>${(r.notes || '').substring(0, 50)}</td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center">Ziadne zaznamy</td></tr>';
    }

    async function loadExportVisitLog() {
        const from = document.getElementById('exportVisitFrom')?.value || '';
        const to = document.getElementById('exportVisitTo')?.value || '';
        let url = '/api/exports/visit-log?';
        if (from) url += `from=${from}&`;
        if (to) url += `to=${to}`;
        try {
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            exportData.visitLog = await res.json();
            renderExportVisitLog();
        } catch(e) { console.error(e); }
    }

    function renderExportVisitLog() {
        const tbody = document.getElementById('exportVisitTable');
        if (!tbody) return;
        tbody.innerHTML = exportData.visitLog.map(r => `
            <tr>
                <td>${r.arrival_date || ''}</td>
                <td>${r.arrival_time || ''}</td>
                <td>${r.visitor_name || ''}</td>
                <td>${r.organization || ''}</td>
                <td>${r.purpose || ''}</td>
                <td>${r.contact_phone || r.contact_email || ''}</td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center">Ziadne zaznamy</td></tr>';
    }

    async function loadExportLicenses() {
        const status = document.getElementById('exportLicenseStatus')?.value || '';
        const expiry = document.getElementById('exportLicenseExpiry')?.value || '';
        let url = '/api/exports/horses-licenses?';
        if (status) url += `status=${status}&`;
        if (expiry) url += `expiry_days=${expiry}`;
        try {
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            exportData.licenses = await res.json();
            renderExportLicenses();
        } catch(e) { console.error(e); }
    }

    function renderExportLicenses() {
        const tbody = document.getElementById('exportLicensesTable');
        if (!tbody) return;
        tbody.innerHTML = exportData.licenses.map(r => `
            <tr>
                <td>${r.stable_name || r.name || ''}</td>
                <td>${r.passport_number || ''}</td>
                <td>${r.sjf_license_number || ''}</td>
                <td>${r.sjf_license_valid_until || '-'}</td>
                <td>${r.fei_passport_number || ''}</td>
                <td>${r.fei_passport_expiry || '-'}</td>
            </tr>
        `).join('') || '<tr><td colspan="6" style="text-align:center">Ziadne zaznamy</td></tr>';
    }

    async function loadExportVaccinations() {
        const filter = document.getElementById('exportVaccFilter')?.value || '';
        let url = '/api/exports/vaccinations?';
        if (filter === 'overdue') url += 'overdue_only=true';
        else if (filter) url += `expiry_days=${filter}`;
        try {
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            exportData.vaccinations = await res.json();
            renderExportVaccinations();
        } catch(e) { console.error(e); }
    }

    function renderExportVaccinations() {
        const tbody = document.getElementById('exportVaccTable');
        if (!tbody) return;
        tbody.innerHTML = exportData.vaccinations.map(r => `
            <tr>
                <td>${r.horses ? (r.horses.stable_name || r.horses.name) : ''}</td>
                <td>${r.vaccine_type || ''}</td>
                <td>${r.vaccination_date || ''}</td>
                <td>${r.next_date || '-'}</td>
                <td>${r.vet_name || ''}</td>
            </tr>
        `).join('') || '<tr><td colspan="5" style="text-align:center">Ziadne zaznamy</td></tr>';
    }

    async function loadExportDocuments() {
        const from = document.getElementById('exportDocsFrom')?.value || '';
        const to = document.getElementById('exportDocsTo')?.value || '';
        const category = document.getElementById('exportDocsCategory')?.value || '';
        let url = '/api/exports/documents?';
        if (from) url += `from=${from}&`;
        if (to) url += `to=${to}&`;
        if (category) url += `category=${category}`;
        try {
            const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } });
            exportData.documents = await res.json();
            renderExportDocuments();
        } catch(e) { console.error(e); }
    }

    function renderExportDocuments() {
        const tbody = document.getElementById('exportDocsTable');
        if (!tbody) return;
        tbody.innerHTML = exportData.documents.map(r => `
            <tr>
                <td>${r.document_date || ''}</td>
                <td>${r.title || ''}</td>
                <td>${r.category || ''}</td>
                <td>${r.horses ? (r.horses.stable_name || r.horses.name) : ''}</td>
                <td>${r.file_name || ''}</td>
            </tr>
        `).join('') || '<tr><td colspan="5" style="text-align:center">Ziadne zaznamy</td></tr>';
    }

    function downloadExportCSV(type) {
        let url = `/api/exports/${type}?format=csv&`;
        if (type === 'stable-log') {
            url += `from=${document.getElementById('exportStableFrom')?.value || ''}&to=${document.getElementById('exportStableTo')?.value || ''}`;
        } else if (type === 'visit-log') {
            url += `from=${document.getElementById('exportVisitFrom')?.value || ''}&to=${document.getElementById('exportVisitTo')?.value || ''}`;
        } else if (type === 'horses-licenses') {
            url += `status=${document.getElementById('exportLicenseStatus')?.value || ''}&expiry_days=${document.getElementById('exportLicenseExpiry')?.value || ''}`;
        } else if (type === 'vaccinations') {
            const f = document.getElementById('exportVaccFilter')?.value || '';
            if (f === 'overdue') url += 'overdue_only=true';
            else if (f) url += `expiry_days=${f}`;
        } else if (type === 'documents') {
            url += `from=${document.getElementById('exportDocsFrom')?.value || ''}&to=${document.getElementById('exportDocsTo')?.value || ''}&category=${document.getElementById('exportDocsCategory')?.value || ''}`;
        }
        
        const a = document.createElement('a');
        a.href = url;
        a.download = '';
        fetch(url, { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') } })
            .then(res => res.blob())
            .then(blob => {
                const blobUrl = URL.createObjectURL(blob);
                a.href = blobUrl;
                a.click();
                URL.revokeObjectURL(blobUrl);
            });
    }

    function printExportStableLog() {
        const from = document.getElementById('exportStableFrom')?.value || 'od zaciatku';
        const to = document.getElementById('exportStableTo')?.value || 'do dnes';
        const rows = exportData.stableLog.map(r => `
            <tr>
                <td>${r.event_date || ''}</td>
                <td>${r.event_time || ''}</td>
                <td>${r.event_type || ''}</td>
                <td>${r.horses ? (r.horses.stable_name || r.horses.name) : ''}</td>
                <td>${r.horses?.passport_number || ''}</td>
                <td>${r.horses?.microchip || ''}</td>
                <td>${r.notes || ''}</td>
            </tr>
        `).join('');
        printExportTable('Mastalna kniha', `Obdobie: ${from} - ${to}`, 
            '<tr><th>Datum</th><th>Cas</th><th>Typ</th><th>Kon</th><th>Pas</th><th>Cip</th><th>Poznamka</th></tr>', rows);
    }

    function printExportVisitLog() {
        const from = document.getElementById('exportVisitFrom')?.value || 'od zaciatku';
        const to = document.getElementById('exportVisitTo')?.value || 'do dnes';
        const rows = exportData.visitLog.map(r => `
            <tr>
                <td>${r.arrival_date || ''}</td>
                <td>${r.arrival_time || ''}</td>
                <td>${r.visitor_name || ''}</td>
                <td>${r.organization || ''}</td>
                <td>${r.purpose || ''}</td>
                <td>${r.contact_phone || ''}</td>
                <td>${r.signature_text || ''}</td>
            </tr>
        `).join('');
        printExportTable('Navstevna kniha', `Obdobie: ${from} - ${to}`,
            '<tr><th>Datum</th><th>Cas</th><th>Meno</th><th>Organizacia</th><th>Dovod</th><th>Kontakt</th><th>Podpis</th></tr>', rows);
    }

    function printExportLicenses() {
        const rows = exportData.licenses.map(r => `
            <tr>
                <td>${r.stable_name || r.name || ''}</td>
                <td>${r.passport_number || ''}</td>
                <td>${r.microchip || ''}</td>
                <td>${r.sjf_license_number || ''}</td>
                <td>${r.sjf_license_valid_until || '-'}</td>
                <td>${r.fei_passport_number || ''}</td>
                <td>${r.fei_passport_expiry || '-'}</td>
                <td>${r.fei_registered ? 'Ano' : 'Nie'}</td>
            </tr>
        `).join('');
        printExportTable('Licencie SJF/FEI', `Datum: ${new Date().toLocaleDateString('sk')}`,
            '<tr><th>Kon</th><th>Pas</th><th>Cip</th><th>SJF c.</th><th>SJF platnost</th><th>FEI c.</th><th>FEI platnost</th><th>FEI reg.</th></tr>', rows);
    }

    function printExportVaccinations() {
        const rows = exportData.vaccinations.map(r => `
            <tr>
                <td>${r.horses ? (r.horses.stable_name || r.horses.name) : ''}</td>
                <td>${r.horses?.passport_number || ''}</td>
                <td>${r.vaccine_type || ''}</td>
                <td>${r.vaccination_date || ''}</td>
                <td>${r.next_date || '-'}</td>
                <td>${r.batch_number || ''}</td>
                <td>${r.vet_name || ''}</td>
            </tr>
        `).join('');
        printExportTable('Prehad ockovani', `Datum: ${new Date().toLocaleDateString('sk')}`,
            '<tr><th>Kon</th><th>Pas</th><th>Typ vakciny</th><th>Datum</th><th>Dalsi termin</th><th>Sarza</th><th>Veterinar</th></tr>', rows);
    }

    function printExportDocuments() {
        const from = document.getElementById('exportDocsFrom')?.value || 'od zaciatku';
        const to = document.getElementById('exportDocsTo')?.value || 'do dnes';
        const rows = exportData.documents.map(r => `
            <tr>
                <td>${r.document_date || ''}</td>
                <td>${r.title || ''}</td>
                <td>${r.category || ''}</td>
                <td>${r.horses ? (r.horses.stable_name || r.horses.name) : ''}</td>
                <td>${r.file_name || ''}</td>
                <td>${r.description || ''}</td>
            </tr>
        `).join('');
        printExportTable('Dokumenty', `Obdobie: ${from} - ${to}`,
            '<tr><th>Datum</th><th>Nazov</th><th>Kategoria</th><th>Kon</th><th>Subor</th><th>Poznamka</th></tr>', rows);
    }

    function printExportTable(title, subtitle, headerRow, bodyRows) {
        const html = `
            <h2 style="text-align:center;margin-bottom:0.5rem">JAZDECKY KLUB ZELENA MILA</h2>
            <h3 style="text-align:center;margin-bottom:0.5rem">${title}</h3>
            <p style="text-align:center;margin-bottom:1.5rem">${subtitle}</p>
            <table style="width:100%;border-collapse:collapse;font-size:0.8rem">
                <thead style="background:#f0f0f0">${headerRow}</thead>
                <tbody>${bodyRows}</tbody>
            </table>
            <p style="margin-top:2rem;font-size:0.8rem;color:#666;text-align:center">
                Dokument bol vytvoreny elektronickym evidencnym systemom prevadzky. Datum: ${new Date().toLocaleDateString('sk')}
            </p>
        `;
        document.getElementById('printContent').innerHTML = html;
        document.getElementById('printModalTitle').textContent = 'Tlac - ' + title;
        showModal('printModal');
    }
    </script>
</body>
</html>
