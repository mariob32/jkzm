<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | JK Zelen√° m√≠ƒæa</title>
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #228B22; --primary-dark: #1a6b1a; --bg: #f4f6f9; --white: #fff; --dark: #1a1a1a; --gray: #666; --border: #e0e0e0; --success: #28a745; --danger: #dc3545; --warning: #ffc107; --info: #17a2b8; --sidebar-w: 240px; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--dark); font-size: 14px; }
        .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); padding: 1rem; }
        .login-box { background: var(--white); padding: 2.5rem; border-radius: 16px; width: 100%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .login-logo { text-align: center; margin-bottom: 2rem; }
        .login-logo img { height: 80px; }
        .login-title { text-align: center; font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
        .login-sub { text-align: center; color: var(--gray); margin-bottom: 2rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.4rem; font-size: 0.85rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; font-size: 0.95rem; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.4rem; padding: 0.65rem 1.25rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; font-family: inherit; font-size: 0.9rem; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: var(--bg); color: var(--dark); border: 1px solid var(--border); }
        .btn-danger { background: var(--danger); color: var(--white); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .btn-block { width: 100%; }
        .login-error { background: #ffe0e0; color: var(--danger); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; display: none; text-align: center; }
        .app { display: none; min-height: 100vh; }
        .app.active { display: flex; }
        .sidebar { width: var(--sidebar-w); background: var(--dark); color: var(--white); position: fixed; height: 100vh; overflow-y: auto; }
        .sidebar-header { padding: 1.25rem; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 0.75rem; }
        .sidebar-header img { height: 36px; filter: brightness(0) invert(1); }
        .sidebar-header span { font-weight: 600; }
        .nav-section { padding: 1rem 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .nav-title { font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.4); padding: 0 1rem; margin-bottom: 0.5rem; }
        .nav-item { display: flex; align-items: center; gap: 0.6rem; padding: 0.65rem 1rem; color: rgba(255,255,255,0.7); cursor: pointer; transition: all 0.2s; border: none; background: none; width: 100%; text-align: left; font-size: 0.85rem; font-family: inherit; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: var(--white); }
        .nav-item.active { background: var(--primary); color: var(--white); }
        .nav-item .icon { width: 20px; text-align: center; }
        .nav-badge { margin-left: auto; background: var(--danger); font-size: 0.65rem; padding: 0.1rem 0.4rem; border-radius: 50px; }
        .main { flex: 1; margin-left: var(--sidebar-w); }
        .header { background: var(--white); padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 1px 3px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 50; }
        .header h1 { font-size: 1.2rem; font-weight: 600; }
        .header-right { display: flex; gap: 0.5rem; }
        .header-btn { width: 36px; height: 36px; border: none; background: var(--bg); border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; text-decoration: none; color: inherit; }
        .header-btn:hover { background: var(--border); }
        .content { padding: 1.5rem; }
        .page { display: none; }
        .page.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: var(--white); padding: 1.25rem; border-radius: 10px; display: flex; align-items: center; gap: 1rem; }
        .stat-icon { width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; background: rgba(34,139,34,0.1); }
        .stat-value { font-size: 1.5rem; font-weight: 700; }
        .stat-label { font-size: 0.8rem; color: var(--gray); }
        .card { background: var(--white); border-radius: 10px; margin-bottom: 1.5rem; }
        .card-header { padding: 1rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; }
        .card-title { font-size: 1rem; font-weight: 600; }
        .card-body { padding: 1rem; }
        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 0.75rem; text-align: left; }
        th { background: var(--bg); font-size: 0.7rem; font-weight: 600; text-transform: uppercase; color: var(--gray); }
        td { border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        tr:hover td { background: #f9f9f9; }
        .badge { display: inline-block; padding: 0.25rem 0.6rem; border-radius: 50px; font-size: 0.7rem; font-weight: 500; }
        .badge-success { background: rgba(40,167,69,0.1); color: var(--success); }
        .badge-warning { background: rgba(255,193,7,0.15); color: #856404; }
        .badge-danger { background: rgba(220,53,69,0.1); color: var(--danger); }
        .badge-info { background: rgba(23,162,184,0.1); color: var(--info); }
        .actions { display: flex; gap: 0.3rem; }
        .action-btn { width: 28px; height: 28px; border: none; background: var(--bg); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .action-btn:hover { background: var(--primary); color: var(--white); }
        .action-btn.danger:hover { background: var(--danger); }
        .grid-2 { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--white); border-radius: 12px; width: 100%; max-width: 500px; max-height: 90vh; overflow: hidden; }
        .modal-header { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .modal-header h3 { font-size: 1rem; }
        .modal-close { width: 32px; height: 32px; border: none; background: var(--bg); border-radius: 8px; cursor: pointer; font-size: 1rem; }
        .modal-close:hover { background: var(--danger); color: var(--white); }
        .modal-body { padding: 1.25rem; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 1rem 1.25rem; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 0.5rem; }
        .toast { position: fixed; bottom: 1.5rem; right: 1.5rem; padding: 0.85rem 1.25rem; border-radius: 8px; color: var(--white); font-weight: 500; z-index: 9999; transform: translateY(100px); opacity: 0; transition: all 0.3s; }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        .empty { text-align: center; padding: 2rem; color: var(--gray); }
        .feeding-card { background: var(--bg); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
        .feeding-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .feeding-header h4 { font-size: 0.95rem; }
        .feeding-row { display: flex; justify-content: space-between; padding: 0.35rem 0; border-bottom: 1px dashed var(--border); font-size: 0.85rem; }
        .feeding-row:last-child { border-bottom: none; }
        .health-card { background: var(--bg); border-radius: 8px; padding: 1rem; margin-bottom: 0.75rem; }
        .health-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .health-type { font-weight: 600; font-size: 0.95rem; }
        .health-date { font-size: 0.8rem; color: var(--gray); }
        .health-desc { margin-top: 0.5rem; font-size: 0.85rem; color: var(--gray); }
        .feed-item-row { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center; }
        .feed-item-row input { flex: 1; }
        .feed-item-row button { flex-shrink: 0; }
        @media (max-width: 1100px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .grid-2 { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } .stats-grid { grid-template-columns: 1fr; } .form-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="login-page" id="loginPage">
        <div class="login-box">
            <div class="login-logo"><img src="/assets/logo.png" alt="Logo"></div>
            <h2 class="login-title">Admin Panel</h2>
            <p class="login-sub">Prihl√°ste sa do syst√©mu</p>
            <div class="login-error" id="loginError"></div>
            <form id="loginForm">
                <div class="form-group"><label>Email</label><input type="email" id="loginEmail" value="admin@jkzm.sk" required></div>
                <div class="form-group"><label>Heslo</label><input type="password" id="loginPassword" value="admin123" required></div>
                <button type="submit" class="btn btn-primary btn-block" id="loginBtn">Prihl√°si≈• sa</button>
            </form>
        </div>
    </div>

    <div class="app" id="app">
        <aside class="sidebar">
            <div class="sidebar-header"><img src="/assets/logo.png" alt="Logo"><span>Zelen√° m√≠ƒæa</span></div>
            <div class="nav-section">
                <div class="nav-title">Prehƒæad</div>
                <button class="nav-item active" data-page="dashboard"><span class="icon">üìä</span>Dashboard</button>
            </div>
            <div class="nav-section">
                <div class="nav-title">Staj≈àa</div>
                <button class="nav-item" data-page="horses"><span class="icon">üê¥</span>Kone</button>
                <button class="nav-item" data-page="feeding"><span class="icon">ü•ï</span>K≈ïmenie</button>
                <button class="nav-item" data-page="health"><span class="icon">üè•</span>Zdravie</button>
            </div>
            <div class="nav-section">
                <div class="nav-title">ƒΩudia</div>
                <button class="nav-item" data-page="riders"><span class="icon">üë•</span>Jazdci</button>
                <button class="nav-item" data-page="trainers"><span class="icon">üë®‚Äçüè´</span>Tr√©neri</button>
                <button class="nav-item" data-page="employees"><span class="icon">üë∑</span>Zamestnanci</button>
            </div>
            <div class="nav-section">
                <div class="nav-title">Prev√°dzka</div>
                <button class="nav-item" data-page="trainings"><span class="icon">üìà</span>Tr√©ningy</button>
                <button class="nav-item" data-page="bookings"><span class="icon">üìã</span>Rezerv√°cie</button>
                <button class="nav-item" data-page="payments"><span class="icon">üí≥</span>Platby</button>
                <button class="nav-item" data-page="messages"><span class="icon">‚úâÔ∏è</span>Spr√°vy</button>
            </div>
        </aside>

        <main class="main">
            <header class="header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="header-right">
                    <a href="/" class="header-btn" title="Web">üåê</a>
                    <button class="header-btn" id="logoutBtn" title="Odhl√°si≈•">üö™</button>
                </div>
            </header>

            <div class="content">
                <div class="page active" id="page-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-icon">üê¥</div><div><div class="stat-value" id="statHorses">0</div><div class="stat-label">Kone</div></div></div>
                        <div class="stat-card"><div class="stat-icon">üë•</div><div><div class="stat-value" id="statRiders">0</div><div class="stat-label">Jazdci</div></div></div>
                        <div class="stat-card"><div class="stat-icon">üìä</div><div><div class="stat-value" id="statTrainings">0</div><div class="stat-label">Tr√©ningy</div></div></div>
                        <div class="stat-card"><div class="stat-icon">üí∞</div><div><div class="stat-value" id="statRevenue">‚Ç¨0</div><div class="stat-label">Tr≈æby</div></div></div>
                    </div>
                    <div class="card"><div class="card-header"><h3 class="card-title">Dne≈°n√© tr√©ningy</h3></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>ƒåas</th><th>Jazdec</th><th>K√¥≈à</th><th>Tr√©ner</th><th>Stav</th></tr></thead><tbody id="todayTrainings"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-horses">
                    <div class="card"><div class="card-header"><h3 class="card-title">Kone</h3><button class="btn btn-primary btn-sm" onclick="openHorseModal()">+ Prida≈• ko≈àa</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Plemeno</th><th>Farba</th><th>Vek</th><th>√örove≈à</th><th>Stav</th><th></th></tr></thead><tbody id="horsesTable"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-riders">
                    <div class="card"><div class="card-header"><h3 class="card-title">Jazdci</h3><button class="btn btn-primary btn-sm" onclick="openRiderModal()">+ Prida≈• jazdca</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Email</th><th>Telef√≥n</th><th>√örove≈à</th><th>Stav</th><th></th></tr></thead><tbody id="ridersTable"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-trainers">
                    <div class="card"><div class="card-header"><h3 class="card-title">Tr√©neri</h3><button class="btn btn-primary btn-sm" onclick="openTrainerModal()">+ Prida≈• tr√©nera</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>≈†pecializ√°cia</th><th>Email</th><th>Telef√≥n</th><th>Sadzba</th><th></th></tr></thead><tbody id="trainersTable"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-employees">
                    <div class="card"><div class="card-header"><h3 class="card-title">Zamestnanci</h3><button class="btn btn-primary btn-sm" onclick="openEmployeeModal()">+ Prida≈•</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Poz√≠cia</th><th>Email</th><th>Telef√≥n</th><th>N√°stup</th><th></th></tr></thead><tbody id="employeesTable"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-trainings">
                    <div class="card"><div class="card-header"><h3 class="card-title">Tr√©ningy</h3><button class="btn btn-primary btn-sm" onclick="openTrainingModal()">+ Prida≈• tr√©ning</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>D√°tum</th><th>ƒåas</th><th>Jazdec</th><th>K√¥≈à</th><th>Tr√©ner</th><th>Cena</th><th>Stav</th><th></th></tr></thead><tbody id="trainingsTable"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-feeding">
                    <div class="card"><div class="card-header"><h3 class="card-title">K≈ïmne pl√°ny</h3><button class="btn btn-primary btn-sm" onclick="openFeedingModal()">+ Prida≈• k≈ïmenie</button></div><div class="card-body" id="feedingList"></div></div>
                </div>

                <div class="page" id="page-health">
                    <div class="card"><div class="card-header"><h3 class="card-title">Zdravotn√© z√°znamy</h3><button class="btn btn-primary btn-sm" onclick="openHealthModal()">+ Prida≈• z√°znam</button></div><div class="card-body" id="healthList"></div></div>
                </div>

                <div class="page" id="page-bookings">
                    <div class="card"><div class="card-header"><h3 class="card-title">Rezerv√°cie z webu</h3></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Email</th><th>Slu≈æba</th><th>D√°tum</th><th>Stav</th><th></th></tr></thead><tbody id="bookingsTable"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-payments">
                    <div class="card"><div class="card-header"><h3 class="card-title">Platby</h3><button class="btn btn-primary btn-sm" onclick="openPaymentModal()">+ Prida≈• platbu</button></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>D√°tum</th><th>Jazdec</th><th>Suma</th><th>Sp√¥sob</th><th>Popis</th></tr></thead><tbody id="paymentsTable"></tbody></table></div></div></div>
                </div>

                <div class="page" id="page-messages">
                    <div class="card"><div class="card-header"><h3 class="card-title">Spr√°vy</h3></div><div class="card-body"><div class="table-wrap"><table><thead><tr><th>Meno</th><th>Email</th><th>Slu≈æba</th><th>Spr√°va</th><th>Stav</th><th></th></tr></thead><tbody id="messagesTable"></tbody></table></div></div></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Horse Modal -->
    <div class="modal-overlay" id="horseModal">
        <div class="modal">
            <div class="modal-header"><h3 id="horseModalTitle">Prida≈• ko≈àa</h3><button class="modal-close" onclick="closeModal('horseModal')">‚úï</button></div>
            <form id="horseForm">
                <input type="hidden" name="id" id="horseId">
                <div class="modal-body">
                    <div class="form-group"><label>Meno *</label><input type="text" name="name" id="horseName" required></div>
                    <div class="form-row">
                        <div class="form-group"><label>Plemeno</label><input type="text" name="breed" id="horseBreed"></div>
                        <div class="form-group"><label>Farba</label><input type="text" name="color" id="horseColor"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>D√°tum narodenia</label><input type="date" name="birth_date" id="horseBirth"></div>
                        <div class="form-group"><label>V√Ω≈°ka (cm)</label><input type="number" name="height" id="horseHeight"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Pohlavie</label><select name="gender" id="horseGender"><option value="">-</option><option value="stallion">≈Ωrebec</option><option value="mare">Kobyla</option><option value="gelding">Valach</option></select></div>
                        <div class="form-group"><label>√örove≈à</label><select name="level" id="horseLevel"><option value="beginner">Zaƒçiatoƒçn√≠ci</option><option value="intermediate">Pokroƒçil√≠</option><option value="advanced">Sk√∫sen√≠</option><option value="children">Deti</option></select></div>
                    </div>
                    <div class="form-group"><label>Stav</label><select name="status" id="horseStatus"><option value="active">Akt√≠vny</option><option value="inactive">Neakt√≠vny</option><option value="sick">Chor√Ω</option></select></div>
                    <div class="form-group"><label>Pozn√°mky</label><textarea name="notes" id="horseNotes" rows="2"></textarea></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('horseModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <!-- Rider Modal -->
    <div class="modal-overlay" id="riderModal">
        <div class="modal">
            <div class="modal-header"><h3 id="riderModalTitle">Prida≈• jazdca</h3><button class="modal-close" onclick="closeModal('riderModal')">‚úï</button></div>
            <form id="riderForm">
                <input type="hidden" name="id" id="riderId">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group"><label>Meno *</label><input type="text" name="first_name" id="riderFirstName" required></div>
                        <div class="form-group"><label>Priezvisko *</label><input type="text" name="last_name" id="riderLastName" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Email</label><input type="email" name="email" id="riderEmail"></div>
                        <div class="form-group"><label>Telef√≥n</label><input type="tel" name="phone" id="riderPhone"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>D√°tum narodenia</label><input type="date" name="birth_date" id="riderBirth"></div>
                        <div class="form-group"><label>√örove≈à</label><select name="level" id="riderLevel"><option value="beginner">Zaƒçiatoƒçn√≠k</option><option value="intermediate">Pokroƒçil√Ω</option><option value="advanced">Sk√∫sen√Ω</option></select></div>
                    </div>
                    <div class="form-group"><label>Pozn√°mky</label><textarea name="notes" id="riderNotes" rows="2"></textarea></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('riderModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <!-- Trainer Modal -->
    <div class="modal-overlay" id="trainerModal">
        <div class="modal">
            <div class="modal-header"><h3 id="trainerModalTitle">Prida≈• tr√©nera</h3><button class="modal-close" onclick="closeModal('trainerModal')">‚úï</button></div>
            <form id="trainerForm">
                <input type="hidden" name="id" id="trainerId">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group"><label>Meno *</label><input type="text" name="first_name" id="trainerFirstName" required></div>
                        <div class="form-group"><label>Priezvisko *</label><input type="text" name="last_name" id="trainerLastName" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Email</label><input type="email" name="email" id="trainerEmail"></div>
                        <div class="form-group"><label>Telef√≥n</label><input type="tel" name="phone" id="trainerPhone"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>≈†pecializ√°cia</label><input type="text" name="specialization" id="trainerSpec"></div>
                        <div class="form-group"><label>Hodinov√° sadzba (‚Ç¨)</label><input type="number" name="hourly_rate" id="trainerRate" step="0.01"></div>
                    </div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('trainerModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <!-- Employee Modal -->
    <div class="modal-overlay" id="employeeModal">
        <div class="modal">
            <div class="modal-header"><h3 id="employeeModalTitle">Prida≈• zamestnanca</h3><button class="modal-close" onclick="closeModal('employeeModal')">‚úï</button></div>
            <form id="employeeForm">
                <input type="hidden" name="id" id="employeeId">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group"><label>Meno *</label><input type="text" name="first_name" id="employeeFirstName" required></div>
                        <div class="form-group"><label>Priezvisko *</label><input type="text" name="last_name" id="employeeLastName" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Email</label><input type="email" name="email" id="employeeEmail"></div>
                        <div class="form-group"><label>Telef√≥n</label><input type="tel" name="phone" id="employeePhone"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Poz√≠cia</label><input type="text" name="position" id="employeePosition"></div>
                        <div class="form-group"><label>D√°tum n√°stupu</label><input type="date" name="hire_date" id="employeeHire"></div>
                    </div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('employeeModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <!-- Training Modal -->
    <div class="modal-overlay" id="trainingModal">
        <div class="modal">
            <div class="modal-header"><h3>Prida≈• tr√©ning</h3><button class="modal-close" onclick="closeModal('trainingModal')">‚úï</button></div>
            <form id="trainingForm">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group"><label>D√°tum *</label><input type="date" name="scheduled_date" required></div>
                        <div class="form-group"><label>ƒåas *</label><input type="time" name="scheduled_time" required></div>
                    </div>
                    <div class="form-group"><label>Jazdec</label><select name="rider_id" id="selRider"></select></div>
                    <div class="form-group"><label>K√¥≈à</label><select name="horse_id" id="selHorse"></select></div>
                    <div class="form-group"><label>Tr√©ner</label><select name="trainer_id" id="selTrainer"></select></div>
                    <div class="form-row">
                        <div class="form-group"><label>Trvanie (min)</label><input type="number" name="duration" value="60"></div>
                        <div class="form-group"><label>Cena (‚Ç¨)</label><input type="number" name="price" step="0.01"></div>
                    </div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('trainingModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <!-- Feeding Modal -->
    <div class="modal-overlay" id="feedingModal">
        <div class="modal">
            <div class="modal-header"><h3 id="feedingModalTitle">Prida≈• k≈ïmenie</h3><button class="modal-close" onclick="closeModal('feedingModal')">‚úï</button></div>
            <form id="feedingForm">
                <input type="hidden" name="id" id="feedingId">
                <div class="modal-body">
                    <div class="form-group"><label>K√¥≈à *</label><select name="horse_id" id="feedingHorse" required></select></div>
                    <div class="form-row">
                        <div class="form-group"><label>ƒåas d≈àa</label><select name="time_of_day" id="feedingTimeOfDay"><option value="morning">R√°no</option><option value="noon">Obed</option><option value="evening">Veƒçer</option></select></div>
                        <div class="form-group"><label>Presn√Ω ƒças</label><input type="time" name="feed_time" id="feedingTime"></div>
                    </div>
                    <div class="form-group"><label>Polo≈æky krmiva</label><div id="feedItems"></div><button type="button" class="btn btn-secondary btn-sm" onclick="addFeedItem()">+ Prida≈• polo≈æku</button></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('feedingModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <!-- Health Modal -->
    <div class="modal-overlay" id="healthModal">
        <div class="modal">
            <div class="modal-header"><h3 id="healthModalTitle">Prida≈• zdravotn√Ω z√°znam</h3><button class="modal-close" onclick="closeModal('healthModal')">‚úï</button></div>
            <form id="healthForm">
                <input type="hidden" name="id" id="healthId">
                <div class="modal-body">
                    <div class="form-group"><label>K√¥≈à *</label><select name="horse_id" id="healthHorse" required></select></div>
                    <div class="form-row">
                        <div class="form-group"><label>Typ z√°znamu *</label><select name="record_type" id="healthType" required><option value="vaccination">Oƒçkovanie</option><option value="deworming">Odƒçervenie</option><option value="farrier">Podk√∫vanie</option><option value="vet_visit">Veterin√°r</option><option value="injury">Zranenie</option><option value="other">In√©</option></select></div>
                        <div class="form-group"><label>D√°tum</label><input type="date" name="record_date" id="healthDate"></div>
                    </div>
                    <div class="form-group"><label>Popis</label><textarea name="description" id="healthDesc" rows="2"></textarea></div>
                    <div class="form-row">
                        <div class="form-group"><label>Veterin√°r</label><input type="text" name="vet_name" id="healthVet"></div>
                        <div class="form-group"><label>N√°klady (‚Ç¨)</label><input type="number" name="cost" id="healthCost" step="0.01"></div>
                    </div>
                    <div class="form-group"><label>ƒéal≈°√≠ term√≠n</label><input type="date" name="next_date" id="healthNext"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('healthModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal">
            <div class="modal-header"><h3>Prida≈• platbu</h3><button class="modal-close" onclick="closeModal('paymentModal')">‚úï</button></div>
            <form id="paymentForm">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group"><label>D√°tum *</label><input type="date" name="payment_date" required></div>
                        <div class="form-group"><label>Suma (‚Ç¨) *</label><input type="number" name="amount" step="0.01" required></div>
                    </div>
                    <div class="form-group"><label>Jazdec</label><select name="rider_id" id="selPaymentRider"></select></div>
                    <div class="form-group"><label>Sp√¥sob platby</label><select name="payment_method"><option value="cash">Hotovos≈•</option><option value="card">Karta</option><option value="transfer">Prevod</option></select></div>
                    <div class="form-group"><label>Popis</label><input type="text" name="description"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">Zru≈°i≈•</button><button type="submit" class="btn btn-primary">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let token = localStorage.getItem('jkzm_token');
        let user = JSON.parse(localStorage.getItem('jkzm_user') || 'null');
        let horses = [], riders = [], trainers = [];

        async function api(endpoint, options = {}) {
            const headers = { 'Content-Type': 'application/json' };
            if (token) headers['Authorization'] = 'Bearer ' + token;
            try {
                const res = await fetch('/api' + endpoint, { ...options, headers });
                if (res.status === 401) { logout(); throw new Error('Unauthorized'); }
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Error');
                return data;
            } catch (e) { console.error(e); throw e; }
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const error = document.getElementById('loginError');
            btn.disabled = true; btn.textContent = 'Prihlasujem...'; error.style.display = 'none';
            try {
                const res = await fetch('/api/auth/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: document.getElementById('loginEmail').value, password: document.getElementById('loginPassword').value }) });
                const data = await res.json();
                if (res.ok) { token = data.token; user = data.user; localStorage.setItem('jkzm_token', token); localStorage.setItem('jkzm_user', JSON.stringify(user)); showApp(); }
                else { error.textContent = data.error || 'Chyba'; error.style.display = 'block'; }
            } catch (err) { error.textContent = 'Chyba pripojenia'; error.style.display = 'block'; }
            btn.disabled = false; btn.textContent = 'Prihl√°si≈• sa';
        });

        function logout() { token = null; user = null; localStorage.removeItem('jkzm_token'); localStorage.removeItem('jkzm_user'); location.reload(); }
        document.getElementById('logoutBtn').addEventListener('click', logout);

        function showApp() { document.getElementById('loginPage').style.display = 'none'; document.getElementById('app').classList.add('active'); loadDashboard(); }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('page-' + item.dataset.page).classList.add('active');
                document.getElementById('pageTitle').textContent = item.textContent.trim();
                loadPage(item.dataset.page);
            });
        });

        function loadPage(page) {
            const loaders = { dashboard: loadDashboard, horses: loadHorses, riders: loadRiders, trainers: loadTrainers, employees: loadEmployees, feeding: loadFeeding, health: loadHealth, trainings: loadTrainings, bookings: loadBookings, payments: loadPayments, messages: loadMessages };
            if (loaders[page]) loaders[page]();
        }

        async function loadDashboard() {
            try {
                const [stats, today] = await Promise.all([api('/dashboard/stats'), api('/dashboard/today')]);
                document.getElementById('statHorses').textContent = stats.horses?.total || 0;
                document.getElementById('statRiders').textContent = stats.riders?.total || 0;
                document.getElementById('statTrainings').textContent = stats.trainings?.thisMonth || 0;
                document.getElementById('statRevenue').textContent = '‚Ç¨' + (stats.revenue?.thisMonth || 0);
                document.getElementById('todayTrainings').innerHTML = today.length ? today.map(t => `<tr><td>${t.scheduled_time?.slice(0,5)||'-'}</td><td>${t.rider_name||'-'}</td><td>${t.horse_name||'-'}</td><td>${t.trainer_name||'-'}</td><td><span class="badge ${t.status==='completed'?'badge-success':'badge-warning'}">${t.status==='completed'?'‚úì':'ƒåak√°'}</span></td></tr>`).join('') : '<tr><td colspan="5" class="empty">Dnes ≈æiadne tr√©ningy</td></tr>';
            } catch (e) {}
        }

        async function loadHorses() {
            try {
                horses = await api('/horses');
                const levels = { beginner: 'Zaƒçiatoƒçn√≠ci', intermediate: 'Pokroƒçil√≠', advanced: 'Sk√∫sen√≠', children: 'Deti' };
                document.getElementById('horsesTable').innerHTML = horses.length ? horses.map(h => `<tr><td><strong>${h.name}</strong></td><td>${h.breed||'-'}</td><td>${h.color||'-'}</td><td>${h.birth_date ? calcAge(h.birth_date) + ' r.' : '-'}</td><td>${levels[h.level]||'-'}</td><td><span class="badge ${h.status==='active'?'badge-success':'badge-warning'}">${h.status==='active'?'Akt√≠vny':'Neakt√≠vny'}</span></td><td><div class="actions"><button class="action-btn" onclick="editHorse(${h.id})">‚úèÔ∏è</button><button class="action-btn danger" onclick="deleteHorse(${h.id})">üóëÔ∏è</button></div></td></tr>`).join('') : '<tr><td colspan="7" class="empty">≈Ωiadne kone</td></tr>';
            } catch (e) {}
        }

        async function loadRiders() {
            try {
                riders = await api('/riders');
                const levels = { beginner: 'Zaƒçiatoƒçn√≠k', intermediate: 'Pokroƒçil√Ω', advanced: 'Sk√∫sen√Ω' };
                document.getElementById('ridersTable').innerHTML = riders.length ? riders.map(r => `<tr><td><strong>${r.first_name} ${r.last_name}</strong></td><td>${r.email||'-'}</td><td>${r.phone||'-'}</td><td>${levels[r.level]||'-'}</td><td><span class="badge ${r.status==='active'?'badge-success':'badge-warning'}">${r.status||'Akt√≠vny'}</span></td><td><div class="actions"><button class="action-btn" onclick="editRider(${r.id})">‚úèÔ∏è</button><button class="action-btn danger" onclick="deleteRider(${r.id})">üóëÔ∏è</button></div></td></tr>`).join('') : '<tr><td colspan="6" class="empty">≈Ωiadni jazdci</td></tr>';
            } catch (e) {}
        }

        async function loadTrainers() {
            try {
                trainers = await api('/trainers');
                document.getElementById('trainersTable').innerHTML = trainers.length ? trainers.map(t => `<tr><td><strong>${t.first_name} ${t.last_name}</strong></td><td>${t.specialization||'-'}</td><td>${t.email||'-'}</td><td>${t.phone||'-'}</td><td>‚Ç¨${t.hourly_rate||0}/h</td><td><div class="actions"><button class="action-btn" onclick="editTrainer(${t.id})">‚úèÔ∏è</button><button class="action-btn danger" onclick="deleteTrainer(${t.id})">üóëÔ∏è</button></div></td></tr>`).join('') : '<tr><td colspan="6" class="empty">≈Ωiadni tr√©neri</td></tr>';
            } catch (e) {}
        }

        async function loadEmployees() {
            try {
                const employees = await api('/employees');
                document.getElementById('employeesTable').innerHTML = employees.length ? employees.map(e => `<tr><td><strong>${e.first_name} ${e.last_name}</strong></td><td>${e.position||'-'}</td><td>${e.email||'-'}</td><td>${e.phone||'-'}</td><td>${e.hire_date||'-'}</td><td><div class="actions"><button class="action-btn" onclick="editEmployee(${e.id})">‚úèÔ∏è</button><button class="action-btn danger" onclick="deleteEmployee(${e.id})">üóëÔ∏è</button></div></td></tr>`).join('') : '<tr><td colspan="6" class="empty">≈Ωiadni zamestnanci</td></tr>';
            } catch (e) {}
        }

        async function loadTrainings() {
            try {
                const trainings = await api('/trainings');
                document.getElementById('trainingsTable').innerHTML = trainings.length ? trainings.map(t => `<tr><td>${t.scheduled_date}</td><td>${t.scheduled_time?.slice(0,5)||'-'}</td><td>${t.rider_name||'-'}</td><td>${t.horse_name||'-'}</td><td>${t.trainer_name||'-'}</td><td>‚Ç¨${t.price||0}</td><td><span class="badge ${t.status==='completed'?'badge-success':'badge-warning'}">${t.status==='completed'?'‚úì':'ƒåak√°'}</span></td><td><div class="actions"><button class="action-btn danger" onclick="deleteTraining(${t.id})">üóëÔ∏è</button></div></td></tr>`).join('') : '<tr><td colspan="8" class="empty">≈Ωiadne tr√©ningy</td></tr>';
            } catch (e) {}
        }

        async function loadFeeding() {
            try {
                const schedules = await api('/feeding');
                const times = { morning: '‚òÄÔ∏è R√°no', noon: 'üå§Ô∏è Obed', evening: 'üåô Veƒçer' };
                document.getElementById('feedingList').innerHTML = schedules.length ? schedules.map(s => `<div class="feeding-card"><div class="feeding-header"><h4>üê¥ ${s.horse_name} - ${times[s.time_of_day]||s.time_of_day} (${s.feed_time?.slice(0,5)||''})</h4><div class="actions"><button class="action-btn" onclick="editFeeding(${s.id})">‚úèÔ∏è</button><button class="action-btn danger" onclick="deleteFeeding(${s.id})">üóëÔ∏è</button></div></div>${(s.items||[]).map(i => `<div class="feeding-row"><span>${i.feed_type}</span><span>${i.amount} ${i.unit}</span></div>`).join('')||'<div class="feeding-row"><span>≈Ωiadne polo≈æky</span></div>'}</div>`).join('') : '<p class="empty">≈Ωiadne k≈ïmne pl√°ny. Pridajte nov√© k≈ïmenie.</p>';
            } catch (e) {}
        }

        async function loadHealth() {
            try {
                const records = await api('/health');
                const types = { vaccination: 'Oƒçkovanie', deworming: 'Odƒçervenie', farrier: 'Podk√∫vanie', vet_visit: 'Veterin√°r', injury: 'Zranenie', other: 'In√©' };
                document.getElementById('healthList').innerHTML = records.length ? records.map(r => `<div class="health-card"><div class="health-header"><div><div class="health-type">üê¥ ${r.horse_name} - ${types[r.record_type]||r.record_type}</div><div class="health-date">${r.record_date||''} ${r.vet_name ? '‚Ä¢ ' + r.vet_name : ''} ${r.cost ? '‚Ä¢ ‚Ç¨' + r.cost : ''}</div></div><div class="actions"><button class="action-btn" onclick="editHealth(${r.id})">‚úèÔ∏è</button><button class="action-btn danger" onclick="deleteHealth(${r.id})">üóëÔ∏è</button></div></div>${r.description ? '<p class="health-desc">' + r.description + '</p>' : ''}${r.next_date ? '<p class="health-desc"><strong>ƒéal≈°√≠ term√≠n:</strong> ' + r.next_date + '</p>' : ''}</div>`).join('') : '<p class="empty">≈Ωiadne zdravotn√© z√°znamy.</p>';
            } catch (e) {}
        }

        async function loadBookings() {
            try {
                const bookings = await api('/bookings');
                document.getElementById('bookingsTable').innerHTML = bookings.length ? bookings.map(b => `<tr><td>${b.name}</td><td>${b.email}</td><td>${b.service||'-'}</td><td>${b.preferred_date||'-'}</td><td><span class="badge ${b.status==='confirmed'?'badge-success':'badge-warning'}">${b.status==='confirmed'?'OK':'ƒåak√°'}</span></td><td><button class="action-btn" onclick="confirmBooking(${b.id})">‚úì</button></td></tr>`).join('') : '<tr><td colspan="6" class="empty">≈Ωiadne rezerv√°cie</td></tr>';
            } catch (e) {}
        }

        async function loadPayments() {
            try {
                const payments = await api('/payments');
                const methods = { cash: 'Hotovos≈•', card: 'Karta', transfer: 'Prevod' };
                document.getElementById('paymentsTable').innerHTML = payments.length ? payments.map(p => `<tr><td>${p.payment_date}</td><td>${p.rider_name||'-'}</td><td><strong>‚Ç¨${p.amount}</strong></td><td>${methods[p.payment_method]||'Hotovos≈•'}</td><td>${p.description||'-'}</td></tr>`).join('') : '<tr><td colspan="5" class="empty">≈Ωiadne platby</td></tr>';
            } catch (e) {}
        }

        async function loadMessages() {
            try {
                const messages = await api('/contact');
                document.getElementById('messagesTable').innerHTML = messages.length ? messages.map(m => `<tr><td>${m.name}</td><td>${m.email}</td><td>${m.service||'-'}</td><td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${m.message||'-'}</td><td><span class="badge ${m.status==='new'?'badge-warning':'badge-success'}">${m.status==='new'?'Nov√°':'OK'}</span></td><td><button class="action-btn" onclick="markRead(${m.id})">‚úì</button></td></tr>`).join('') : '<tr><td colspan="6" class="empty">≈Ωiadne spr√°vy</td></tr>';
            } catch (e) {}
        }

        // Horse CRUD
        function openHorseModal(data = null) {
            document.getElementById('horseModalTitle').textContent = data ? 'Upravi≈• ko≈àa' : 'Prida≈• ko≈àa';
            document.getElementById('horseId').value = data?.id || '';
            document.getElementById('horseName').value = data?.name || '';
            document.getElementById('horseBreed').value = data?.breed || '';
            document.getElementById('horseColor').value = data?.color || '';
            document.getElementById('horseBirth').value = data?.birth_date || '';
            document.getElementById('horseHeight').value = data?.height || '';
            document.getElementById('horseGender').value = data?.gender || '';
            document.getElementById('horseLevel').value = data?.level || 'beginner';
            document.getElementById('horseStatus').value = data?.status || 'active';
            document.getElementById('horseNotes').value = data?.notes || '';
            openModal('horseModal');
        }
        function editHorse(id) { const h = horses.find(x => x.id === id); if (h) openHorseModal(h); }
        async function deleteHorse(id) { if (confirm('Vymaza≈• ko≈àa?')) { await api('/horses/' + id, { method: 'DELETE' }); toast('Vymazan√©'); loadHorses(); loadDashboard(); } }
        document.getElementById('horseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            const id = data.id; delete data.id;
            if (id) await api('/horses/' + id, { method: 'PUT', body: JSON.stringify(data) });
            else await api('/horses', { method: 'POST', body: JSON.stringify(data) });
            closeModal('horseModal'); toast('Ulo≈æen√©'); loadHorses(); loadDashboard();
        });

        // Rider CRUD
        function openRiderModal(data = null) {
            document.getElementById('riderModalTitle').textContent = data ? 'Upravi≈• jazdca' : 'Prida≈• jazdca';
            document.getElementById('riderId').value = data?.id || '';
            document.getElementById('riderFirstName').value = data?.first_name || '';
            document.getElementById('riderLastName').value = data?.last_name || '';
            document.getElementById('riderEmail').value = data?.email || '';
            document.getElementById('riderPhone').value = data?.phone || '';
            document.getElementById('riderBirth').value = data?.birth_date || '';
            document.getElementById('riderLevel').value = data?.level || 'beginner';
            document.getElementById('riderNotes').value = data?.notes || '';
            openModal('riderModal');
        }
        function editRider(id) { const r = riders.find(x => x.id === id); if (r) openRiderModal(r); }
        async function deleteRider(id) { if (confirm('Vymaza≈• jazdca?')) { await api('/riders/' + id, { method: 'DELETE' }); toast('Vymazan√©'); loadRiders(); } }
        document.getElementById('riderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            const id = data.id; delete data.id;
            if (id) await api('/riders/' + id, { method: 'PUT', body: JSON.stringify(data) });
            else await api('/riders', { method: 'POST', body: JSON.stringify(data) });
            closeModal('riderModal'); toast('Ulo≈æen√©'); loadRiders(); loadDashboard();
        });

        // Trainer CRUD
        function openTrainerModal(data = null) {
            document.getElementById('trainerModalTitle').textContent = data ? 'Upravi≈• tr√©nera' : 'Prida≈• tr√©nera';
            document.getElementById('trainerId').value = data?.id || '';
            document.getElementById('trainerFirstName').value = data?.first_name || '';
            document.getElementById('trainerLastName').value = data?.last_name || '';
            document.getElementById('trainerEmail').value = data?.email || '';
            document.getElementById('trainerPhone').value = data?.phone || '';
            document.getElementById('trainerSpec').value = data?.specialization || '';
            document.getElementById('trainerRate').value = data?.hourly_rate || '';
            openModal('trainerModal');
        }
        function editTrainer(id) { const t = trainers.find(x => x.id === id); if (t) openTrainerModal(t); }
        async function deleteTrainer(id) { if (confirm('Vymaza≈• tr√©nera?')) { await api('/trainers', { method: 'DELETE' }); toast('Vymazan√©'); loadTrainers(); } }
        document.getElementById('trainerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            const id = data.id; delete data.id;
            await api('/trainers', { method: 'POST', body: JSON.stringify(data) });
            closeModal('trainerModal'); toast('Ulo≈æen√©'); loadTrainers();
        });

        // Employee CRUD
        let employees = [];
        function openEmployeeModal(data = null) {
            document.getElementById('employeeModalTitle').textContent = data ? 'Upravi≈• zamestnanca' : 'Prida≈• zamestnanca';
            document.getElementById('employeeId').value = data?.id || '';
            document.getElementById('employeeFirstName').value = data?.first_name || '';
            document.getElementById('employeeLastName').value = data?.last_name || '';
            document.getElementById('employeeEmail').value = data?.email || '';
            document.getElementById('employeePhone').value = data?.phone || '';
            document.getElementById('employeePosition').value = data?.position || '';
            document.getElementById('employeeHire').value = data?.hire_date || '';
            openModal('employeeModal');
        }
        function editEmployee(id) { /* TODO */ }
        async function deleteEmployee(id) { if (confirm('Vymaza≈• zamestnanca?')) { toast('Vymazan√©'); loadEmployees(); } }
        document.getElementById('employeeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            await api('/employees', { method: 'POST', body: JSON.stringify(data) });
            closeModal('employeeModal'); toast('Ulo≈æen√©'); loadEmployees();
        });

        // Training
        async function openTrainingModal() {
            await loadSelects();
            openModal('trainingModal');
        }
        async function deleteTraining(id) { toast('Funkcia sa pripravuje'); }
        document.getElementById('trainingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await api('/trainings', { method: 'POST', body: JSON.stringify(Object.fromEntries(new FormData(e.target))) });
            closeModal('trainingModal'); toast('Tr√©ning pridan√Ω'); loadTrainings(); loadDashboard();
        });

        // Feeding CRUD
        let feedingData = [];
        async function openFeedingModal(data = null) {
            await loadHorsesSelect('feedingHorse');
            document.getElementById('feedingModalTitle').textContent = data ? 'Upravi≈• k≈ïmenie' : 'Prida≈• k≈ïmenie';
            document.getElementById('feedingId').value = data?.id || '';
            document.getElementById('feedingHorse').value = data?.horse_id || '';
            document.getElementById('feedingTimeOfDay').value = data?.time_of_day || 'morning';
            document.getElementById('feedingTime').value = data?.feed_time?.slice(0,5) || '07:00';
            document.getElementById('feedItems').innerHTML = '';
            if (data?.items?.length) data.items.forEach(i => addFeedItem(i));
            else addFeedItem();
            openModal('feedingModal');
        }
        function editFeeding(id) { api('/feeding').then(data => { const f = data.find(x => x.id === id); if (f) openFeedingModal(f); }); }
        async function deleteFeeding(id) { if (confirm('Vymaza≈• k≈ïmenie?')) { await api('/feeding', { method: 'DELETE', body: JSON.stringify({ id }) }); toast('Vymazan√©'); loadFeeding(); } }
        function addFeedItem(data = {}) {
            const div = document.createElement('div');
            div.className = 'feed-item-row';
            div.innerHTML = `<input type="text" placeholder="Typ krmiva" value="${data.feed_type||''}" class="fi-type"><input type="number" placeholder="Mno≈æstvo" value="${data.amount||''}" class="fi-amount" style="width:80px;"><input type="text" placeholder="Jednotka" value="${data.unit||'kg'}" class="fi-unit" style="width:60px;"><button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">‚úï</button>`;
            document.getElementById('feedItems').appendChild(div);
        }
        document.getElementById('feedingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = { id: document.getElementById('feedingId').value, horse_id: document.getElementById('feedingHorse').value, time_of_day: document.getElementById('feedingTimeOfDay').value, feed_time: document.getElementById('feedingTime').value, items: [] };
            document.querySelectorAll('.feed-item-row').forEach(row => {
                const type = row.querySelector('.fi-type').value;
                const amount = row.querySelector('.fi-amount').value;
                const unit = row.querySelector('.fi-unit').value;
                if (type && amount) data.items.push({ feed_type: type, amount: parseFloat(amount), unit: unit || 'kg' });
            });
            if (data.id) await api('/feeding', { method: 'PUT', body: JSON.stringify(data) });
            else await api('/feeding', { method: 'POST', body: JSON.stringify(data) });
            closeModal('feedingModal'); toast('Ulo≈æen√©'); loadFeeding();
        });

        // Health CRUD
        let healthData = [];
        async function openHealthModal(data = null) {
            await loadHorsesSelect('healthHorse');
            document.getElementById('healthModalTitle').textContent = data ? 'Upravi≈• z√°znam' : 'Prida≈• zdravotn√Ω z√°znam';
            document.getElementById('healthId').value = data?.id || '';
            document.getElementById('healthHorse').value = data?.horse_id || '';
            document.getElementById('healthType').value = data?.record_type || 'vaccination';
            document.getElementById('healthDate').value = data?.record_date || new Date().toISOString().split('T')[0];
            document.getElementById('healthDesc').value = data?.description || '';
            document.getElementById('healthVet').value = data?.vet_name || '';
            document.getElementById('healthCost').value = data?.cost || '';
            document.getElementById('healthNext').value = data?.next_date || '';
            openModal('healthModal');
        }
        function editHealth(id) { api('/health').then(data => { const h = data.find(x => x.id === id); if (h) openHealthModal(h); }); }
        async function deleteHealth(id) { if (confirm('Vymaza≈• z√°znam?')) { await api('/health', { method: 'DELETE', body: JSON.stringify({ id }) }); toast('Vymazan√©'); loadHealth(); } }
        document.getElementById('healthForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            const id = data.id; delete data.id;
            if (id) await api('/health', { method: 'PUT', body: JSON.stringify({ id, ...data }) });
            else await api('/health', { method: 'POST', body: JSON.stringify(data) });
            closeModal('healthModal'); toast('Ulo≈æen√©'); loadHealth();
        });

        // Payment
        async function openPaymentModal() { await loadSelects(); openModal('paymentModal'); }
        document.getElementById('paymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await api('/payments', { method: 'POST', body: JSON.stringify(Object.fromEntries(new FormData(e.target))) });
            closeModal('paymentModal'); toast('Platba pridan√°'); loadPayments(); loadDashboard();
        });

        // Bookings & Messages
        async function confirmBooking(id) { await api('/bookings/' + id + '/status', { method: 'PATCH', body: JSON.stringify({ status: 'confirmed' }) }); toast('Potvrden√©'); loadBookings(); }
        async function markRead(id) { await api('/contact/' + id + '/status', { method: 'PATCH', body: JSON.stringify({ status: 'read' }) }); toast('OK'); loadMessages(); }

        // Helpers
        async function loadSelects() {
            const [h, r, t] = await Promise.all([api('/horses'), api('/riders'), api('/trainers')]);
            horses = h; riders = r; trainers = t;
            document.getElementById('selHorse').innerHTML = '<option value="">-</option>' + h.map(x => `<option value="${x.id}">${x.name}</option>`).join('');
            document.getElementById('selRider').innerHTML = '<option value="">-</option>' + r.map(x => `<option value="${x.id}">${x.first_name} ${x.last_name}</option>`).join('');
            document.getElementById('selTrainer').innerHTML = '<option value="">-</option>' + t.map(x => `<option value="${x.id}">${x.first_name} ${x.last_name}</option>`).join('');
            document.getElementById('selPaymentRider').innerHTML = '<option value="">-</option>' + r.map(x => `<option value="${x.id}">${x.first_name} ${x.last_name}</option>`).join('');
        }
        async function loadHorsesSelect(id) {
            const h = await api('/horses');
            document.getElementById(id).innerHTML = '<option value="">Vyberte ko≈àa</option>' + h.map(x => `<option value="${x.id}">${x.name}</option>`).join('');
        }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); }));
        function toast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.className = 'toast success show'; setTimeout(() => t.classList.remove('show'), 3000); }
        function calcAge(d) { return new Date().getFullYear() - new Date(d).getFullYear(); }

        if (token && user) showApp();
    </script>
</body>
</html>
